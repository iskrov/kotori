(()=>{var e={2634:()=>{},9270:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>Fo});var n=r(467),o=r(296),a=r(3029),i=r(2901),s=r(388),l=r(3954),c=r(5501),d=r(6665),u=r(3117),f=r(8833),g=r(6986),y=r(3495),p=r(2907),h=r(3929),m=r(6283),v=r(3668),b=r(4467),x=r(1087),S=r(7109),w=r(2035),j=r(9190),C=r(7204),k=r(5991),T=new((0,i.default)((function e(){(0,a.default)(this,e),this.enabled=!0,this.isWeb="web"===k.default.OS,this.logDirectory=this.isWeb?"":j.documentDirectory+"logs/",this.logFilePath=this.isWeb?"":this.logDirectory+"app.log",this.isDev=!1,this.debugEnabled=!1,this.suppressedWarnings=new Set(["setNativeProps is deprecated"]),this.initializeLogger()}),[{key:"initializeLogger",value:function(){var e=(0,n.default)((function*(){if(!this.isWeb||this.isDev){if(this.isWeb&&this.isDev)return console.log("Logger initialized in web development mode"),void this.setupConsoleOverrides();try{(yield j.getInfoAsync(this.logDirectory)).exists||(yield j.makeDirectoryAsync(this.logDirectory,{intermediates:!0})),(yield j.getInfoAsync(this.logFilePath)).exists||(yield j.writeAsStringAsync(this.logFilePath,"--- Log Start ---\n"));var e=yield j.getInfoAsync(this.logFilePath);e.exists&&e.size>1048576&&(yield j.writeAsStringAsync(this.logFilePath,"--- Log Rotated ---\n"))}catch(t){console.error("Failed to initialize logger:",t)}}}));return function(){return e.apply(this,arguments)}}()},{key:"setupConsoleOverrides",value:function(){var e=this;if(this.isWeb&&this.isDev){var t=console.warn;console.warn=function(){for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];var a=n.join(" ");for(var i of e.suppressedWarnings)if(a.includes(i))return;t.apply(console,n)}}}},{key:"getTimestamp",value:function(){return(new Date).toISOString()}},{key:"writeToFile",value:function(){var e=(0,n.default)((function*(e,t,r){if(this.enabled&&!this.isWeb)try{var n=this.getTimestamp()+" ["+e.toUpperCase()+"] "+t;r&&(n+=" "+JSON.stringify(r,null,2)),n+="\n",yield j.writeAsStringAsync(this.logFilePath,n,{encoding:C.EncodingType.UTF8})}catch(o){o instanceof Error&&"UNAVAILABLE"===o.code&&this.isWeb?console.warn("Attempted to write log file on web, which is not supported."):console.error("Failed to write to log file:",o)}}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"shouldLog",value:function(e){return!!this.enabled&&("error"===e||"warn"===e||!("debug"===e&&!this.debugEnabled)&&(!this.isDev||this.debugEnabled))}},{key:"shouldSuppressMessage",value:function(e){for(var t of this.suppressedWarnings)if(e.includes(t))return!0;return!1}},{key:"debug",value:function(e,t){this.shouldLog("debug")&&(void 0!==t?console.debug(e,t):console.debug(e),this.writeToFile("debug",e,t))}},{key:"info",value:function(e,t){this.shouldLog("info")&&(void 0!==t?console.info(e,t):console.info(e),this.writeToFile("info",e,t))}},{key:"warn",value:function(e,t){this.shouldSuppressMessage(e)||(void 0!==t?console.warn(e,t):console.warn(e),this.writeToFile("warn",e,t))}},{key:"error",value:function(e,t){void 0!==t?console.error(e,t):console.error(e),this.writeToFile("error",e,t)}},{key:"getLogs",value:function(){var e=(0,n.default)((function*(){if(this.isWeb)return"Log files are not available in the web environment.";try{return yield j.readAsStringAsync(this.logFilePath)}catch(e){return console.error("Failed to read log file:",e),"Error reading logs: "+e}}));return function(){return e.apply(this,arguments)}}()},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1}},{key:"enableDebug",value:function(){this.debugEnabled=!0}},{key:"disableDebug",value:function(){this.debugEnabled=!1}},{key:"addSuppressedWarning",value:function(e){this.suppressedWarnings.add(e)}},{key:"removeSuppressedWarning",value:function(e){this.suppressedWarnings.delete(e)}}]));const E=T;function O(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function F(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?O(Object(r),!0).forEach((function(t){(0,b.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):O(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var I=S.default.create({baseURL:"https://api.kotori.io",headers:{"Content-Type":"application/json"},timeout:1e4,withCredentials:!0});try{console.log("API Config:",{baseURL:"https://api.kotori.io",withCredentials:!0,defaultHeaders:I&&I.defaults&&I.defaults.headers?I.defaults.headers:void 0})}catch(Ao){}I.interceptors.request.use(function(){var e=(0,n.default)((function*(e){var t;return"put"===(null==(t=e.method)?void 0:t.toLowerCase())&&(console.log("Making PUT request to:",e.url),console.log("PUT request headers:",e.headers),console.log("PUT request withCredentials:",e.withCredentials)),e}));return function(t){return e.apply(this,arguments)}}(),(function(e){return Promise.reject(e)})),I.interceptors.request.use(function(){var e=(0,n.default)((function*(e){try{var t,r,n=yield x.default.getItem("access_token");if(n)e.headers.Authorization="Bearer "+n,E.debug("API Request: "+(null==(t=e.method)?void 0:t.toUpperCase())+" "+e.url);else E.debug("Unauthenticated API Request: "+(null==(r=e.method)?void 0:r.toUpperCase())+" "+e.url);return e.data instanceof FormData&&(delete e.headers["Content-Type"],E.debug("Removed Content-Type header for FormData request to "+e.url)),e}catch(o){return E.error("API Interceptor Error",o),e}}));return function(t){return e.apply(this,arguments)}}(),(function(e){return E.error("API Request Error",e),Promise.reject(e)})),I.interceptors.response.use((function(e){var t;return E.debug("API Response: "+e.status+" "+(null==(t=e.config.method)?void 0:t.toUpperCase())+" "+e.config.url),e}),function(){var e=(0,n.default)((function*(e){var t,r,n,o,a,i,s,l,c,d,u,f,g,y=e.config;if(e.message&&(e.message.includes("Network Error")||e.message.includes("CORS")||e.message.includes("blocked by CORS policy")))return E.error("CORS or Network Error",{message:e.message,url:null==y?void 0:y.url,method:null==y?void 0:y.method}),Promise.reject({message:"Network or CORS error. Check that the backend server is running and properly configured.",status:0,originalError:e.message});if(!e.response)return E.error("Network Error",{url:null==y?void 0:y.url,method:null==y?void 0:y.method}),Promise.reject({message:"Network error. Please check your connection and try again.",status:0});if(E.error("API Error Response",{status:null==(t=e.response)?void 0:t.status,url:y.url,method:y.method,data:null==(r=e.response)?void 0:r.data}),401===(null==(n=e.response)?void 0:n.status)&&!y._retry){y._retry=!0,E.info("API Response: 401 Unauthorized for "+y.url+". Checking authentication type.");try{var p=yield x.default.getItem("refresh_token"),h=yield x.default.getItem("access_token");if(!p&&h)return E.warn("OPAQUE authentication detected (no refresh token). User needs to re-authenticate."),yield A(),Promise.reject({message:"Session expired. Please login again.",status:401});if(!p)return E.warn("No refresh token available, logging out user"),yield A(),Promise.reject({message:"Session expired. No refresh token. Please login again.",status:401});E.info("Attempting token refresh"),E.info("Calling /api/v1/auth/refresh with refresh token: "+(p?p.substring(0,10)+"...":"null"));var m=yield S.default.post("https://api.kotori.io/api/v1/auth/refresh",{refresh_token:p});if(m.data.access_token){E.info("Token refresh successful. New access token received."),yield x.default.setItem("access_token",m.data.access_token),m.data.refresh_token&&(yield x.default.setItem("refresh_token",m.data.refresh_token),E.info("New refresh token also received and stored."));var v=m.data.access_token;I.defaults.headers.common.Authorization="Bearer "+v,E.info("Retrying original request to "+y.url+" with new token.");var b=F(F({},y),{},{headers:F(F({},y.headers),{},{Authorization:"Bearer "+v})});return(0,S.default)(b)}}catch(T){var w,j;return E.error("Token refresh failed",{message:T.message,status:null==(w=T.response)?void 0:w.status,data:null==(j=T.response)?void 0:j.data}),yield A(),Promise.reject({message:"Session expired. Token refresh failed. Please login again.",status:401,originalError:T.message})}}if(422===(null==(o=e.response)?void 0:o.status)){var C=e.response.data;if(C.errors&&Array.isArray(C.errors))return E.warn("Validation Error",{errors:C.errors,url:y.url}),Promise.reject({message:C.detail||"Validation error",errors:C.errors,status:422})}if(500===(null==(a=e.response)?void 0:a.status)&&null!=(i=e.response)&&null!=(s=i.data)&&s.detail&&"string"===typeof e.response.data.detail&&e.response.data.detail.includes("connection to server"))return E.error("Database Connection Error",{detail:e.response.data.detail,url:y.url}),Promise.reject({message:"Database connection error. Please try again later.",originalError:e.response.data.detail,status:500});var k=(null==(l=e.response)||null==(c=l.data)?void 0:c.detail)||(null==(d=e.response)||null==(u=d.data)?void 0:u.message)||"An error occurred. Please try again.";return E.error("API Error",{message:k,url:y.url,status:null==(f=e.response)?void 0:f.status}),Promise.reject({message:k,status:null==(g=e.response)?void 0:g.status})}));return function(t){return e.apply(this,arguments)}}());var A=function(){var e=(0,n.default)((function*(){try{E.info("Performing API logout"),yield x.default.removeItem("access_token"),yield x.default.removeItem("refresh_token"),yield x.default.removeItem("user"),delete I.defaults.headers.common.Authorization}catch(e){E.error("Logout Error",e)}}));return function(){return e.apply(this,arguments)}}(),P={getEntries:function(e){return I.get("/api/v1/journals",{params:e})},getEntry:function(e){return I.get("/api/v1/journals/"+e)},createEntry:function(e){return I.post("/api/v1/journals/",e)},createEncryptedEntry:function(e){return I.post("/api/journals",{title:e.title||"",content:"",encrypted_content:e.encrypted_content,encryption_iv:e.iv,encryption_salt:e.salt,encrypted_key:e.encrypted_key,key_derivation_iterations:1e5,encryption_algorithm:e.algorithm,encryption_wrap_iv:e.wrapIv,entry_date:e.entry_date||(new Date).toISOString(),audio_url:e.audio_url,tags:e.tags||[],secret_tag_id:e.secret_tag_id,secret_tag_hash:e.secret_tag_hash})},updateEntry:function(e,t){return I.put("/api/v1/journals/"+e,t)},deleteEntry:function(e){return I.delete("/api/v1/journals/"+e)},searchEntries:function(e){return I.get("/api/v1/journals/search",{params:{q:e}})},getEntriesBySecretTag:function(e,t){return I.get("/api/journals/secret-tag/"+e,{params:t})}},R={getReminders:function(e){return I.get("/api/reminders",{params:e})},getReminder:function(e){return I.get("/api/reminders/"+e)},createReminder:function(e){return I.post("/api/reminders",e)},updateReminder:function(e,t){return I.put("/api/reminders/"+e,t)},deleteReminder:function(e){return I.delete("/api/reminders/"+e)}},D={getTags:function(){return I.get("/api/tags")},getRecentTags:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;return I.get("/api/tags/recent",{params:{limit:e}})},getEntriesByTag:function(e){return I.get("/api/tags/"+e+"/entries")},createTag:function(){var e=(0,n.default)((function*(e){return(yield I.post("/api/tags",e)).data}));return function(t){return e.apply(this,arguments)}}(),updateTag:function(){var e=(0,n.default)((function*(e,t){return(yield I.put("/api/tags/"+e,t)).data}));return function(t,r){return e.apply(this,arguments)}}(),deleteTag:function(){var e=(0,n.default)((function*(e){E.info("API: Attempting to delete tag with ID: "+e),E.info("API: DELETE request to: /api/tags/"+e);var t=yield I.delete("/api/tags/"+e);return E.info("API: Delete tag response:",t.data),t.data}));return function(t){return e.apply(this,arguments)}}()};const z=R;var B=r(3370),_=!1;function L(){return N.apply(this,arguments)}function N(){return(N=(0,n.default)((function*(){_||(B.ready&&(yield B.ready),_=!0,E.info("OPAQUE library initialized"))}))).apply(this,arguments)}var M="opaque_registration_record",H="opaque_user_identifier",W=function(){function e(){(0,a.default)(this,e)}return(0,i.default)(e,[{key:"startRegistration",value:function(){var e=(0,n.default)((function*(e,t){try{yield L(),E.info("Starting OPAQUE registration",{userIdentifier:t});var r=B.client.startRegistration({password:e}),n=r.clientRegistrationState,o=r.registrationRequest;if(!n||!o)throw new Error("Failed to generate OPAQUE registration request");return yield x.default.setItem("opaque_registration_state_"+t,JSON.stringify({clientRegistrationState:n,password:e,userIdentifier:t})),E.info("OPAQUE registration started successfully",{registrationRequestLength:o.length,clientRegistrationStateLength:n.length}),{registrationRequest:o,clientRegistrationState:n}}catch(a){throw E.error("OPAQUE registration start failed",a),new Error("Failed to start OPAQUE registration")}}));return function(t,r){return e.apply(this,arguments)}}()},{key:"finishRegistration",value:function(){var e=(0,n.default)((function*(e,t){try{yield L(),E.info("Finishing OPAQUE registration",{userIdentifier:e});var r=yield x.default.getItem("opaque_registration_state_"+e);if(!r)throw new Error("Registration state not found");var n=JSON.parse(r),o=n.clientRegistrationState,a=n.password;E.info("Retrieved stored registration state",{userIdentifier:e,clientRegistrationStateLength:null==o?void 0:o.length,registrationResponseLength:null==t?void 0:t.length,passwordLength:null==a?void 0:a.length});var i=B.client.finishRegistration({clientRegistrationState:o,registrationResponse:t,password:a}).registrationRecord;if(!i)throw new Error("Failed to finish registration");return yield x.default.removeItem("opaque_registration_state_"+e),E.info("OPAQUE registration finished successfully",{userIdentifier:e}),i}catch(s){throw E.error("Failed to finish OPAQUE registration",{userIdentifier:e,error:s}),new Error("OPAQUE registration finish failed: "+s)}}));return function(t,r){return e.apply(this,arguments)}}()},{key:"startLogin",value:function(){var e=(0,n.default)((function*(e,t){try{yield L(),E.info("Starting OPAQUE login",{userIdentifier:t});var r=B.client.startLogin({password:e});if(!r||!r.clientLoginState||!r.startLoginRequest)throw new Error("Failed to generate OPAQUE login request");return yield x.default.setItem("opaque_login_state_"+t,JSON.stringify({clientLoginState:r.clientLoginState,password:e,userIdentifier:t})),E.info("OPAQUE login started successfully",{startLoginRequestLength:r.startLoginRequest.length,clientLoginStateLength:r.clientLoginState.length}),{loginRequest:r.startLoginRequest,clientLoginState:r.clientLoginState}}catch(n){throw E.error("OPAQUE login start failed",n),new Error("Failed to start OPAQUE login")}}));return function(t,r){return e.apply(this,arguments)}}()},{key:"finishLogin",value:function(){var e=(0,n.default)((function*(e,t){try{yield L(),E.info("Finishing OPAQUE login",{userIdentifier:e});var r=yield x.default.getItem("opaque_login_state_"+e);if(!r)throw new Error("Login state not found");var n=JSON.parse(r),o=n.clientLoginState,a=n.password;E.info("Retrieved stored login state",{userIdentifier:e,clientLoginStateLength:null==o?void 0:o.length,loginResponseLength:null==t?void 0:t.length,passwordLength:null==a?void 0:a.length});var i=B.client.finishLogin({clientLoginState:o,loginResponse:t,password:a});if(E.info("OPAQUE finishLogin result",{userIdentifier:e,success:null!==i,resultType:typeof i,resultKeys:i?Object.keys(i):null}),!i)throw new Error("Failed to finish login");var s=i.finishLoginRequest,l=i.sessionKey,c=i.exportKey;return yield x.default.removeItem("opaque_login_state_"+e),E.info("OPAQUE login finished successfully",{userIdentifier:e}),{sessionKey:l,exportKey:c,finishLoginRequest:s}}catch(d){throw E.error("Failed to finish OPAQUE login",{userIdentifier:e,error:d}),new Error("OPAQUE login finish failed: "+d)}}));return function(t,r){return e.apply(this,arguments)}}()},{key:"register",value:function(){var e=(0,n.default)((function*(e,t,r){try{E.info("Starting OPAQUE registration flow",{email:t});var n=(yield this.startRegistration(r,t)).registrationRequest,o=yield I.post("/api/v1/auth/register/start",{userIdentifier:t,opaque_registration_request:n,name:e}),a=o.data.opaque_registration_response,i=yield this.finishRegistration(t,a);yield I.post("/api/v1/auth/register/finish",{session_id:o.data.session_id,userIdentifier:t,opaque_registration_record:i}),E.info("Registration record sent to server",{email:t,registrationRecordLength:i.length,registrationRecordSample:i.substring(0,50)+"..."}),E.info("OPAQUE registration flow completed successfully")}catch(s){throw E.error("OPAQUE registration flow failed",s),s}}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"login",value:function(){var e=(0,n.default)((function*(e,t){try{var r,n;E.info("Starting OPAQUE login",{email:e});var o=yield this.startLogin(t,e),a=yield I.post("/api/v1/auth/login/start",{userIdentifier:e,client_credential_request:o.loginRequest});if(null==(r=a.data)||!r.server_credential_response)throw new Error("Invalid login response from server");var i=yield this.finishLogin(e,a.data.server_credential_response),s=yield I.post("/api/v1/auth/login/finish",{session_id:a.data.session_id,userIdentifier:e,client_credential_finalization:i.finishLoginRequest});if(null==(n=s.data)||!n.access_token)throw new Error("Invalid finish login response from server");return E.info("OPAQUE login completed successfully",{email:e}),{success:!0,user:s.data.user,token:s.data.access_token,sessionKey:i.sessionKey,exportKey:i.exportKey}}catch(l){throw E.error("OPAQUE login failed",{email:e,error:l}),l}}));return function(t,r){return e.apply(this,arguments)}}()},{key:"hasRegistrationRecord",value:function(){var e=(0,n.default)((function*(){try{return null!==(yield x.default.getItem(M))}catch(e){return E.error("Failed to check registration record",e),!1}}));return function(){return e.apply(this,arguments)}}()},{key:"getUserIdentifier",value:function(){var e=(0,n.default)((function*(){try{return yield x.default.getItem(H)}catch(e){return E.error("Failed to get user identifier",e),null}}));return function(){return e.apply(this,arguments)}}()},{key:"clearOpaqueData",value:function(){var e=(0,n.default)((function*(){try{yield x.default.multiRemove([M,H]);var e=(yield x.default.getAllKeys()).filter((function(e){return e.startsWith("opaque_reg_state_")||e.startsWith("opaque_login_state_")}));e.length>0&&(yield x.default.multiRemove(e)),E.info("OPAQUE data cleared successfully")}catch(t){E.error("Failed to clear OPAQUE data",t)}}));return function(){return e.apply(this,arguments)}}()}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}])}(),U=W.getInstance(),V="TagID",K="Encryption",q="VaultKey",Q=new((0,i.default)((function e(){(0,a.default)(this,e),this.sessionKey=null,this.exportKey=null,this.derivedKeys=new Map}),[{key:"decodeBase64ToBytes",value:function(e){for(var t=e.replace(/-/g,"+").replace(/_/g,"/"),r=t.length%4===0?0:4-t.length%4,n=t+"=".repeat(r),o=atob(n),a=new Uint8Array(o.length),i=0;i<o.length;i++)a[i]=o.charCodeAt(i);return a}},{key:"initialize",value:function(e){var t,r,n,o,a=e,i=a.sessionKey,s=a.exportKey;this.sessionKey="string"===typeof i?this.decodeBase64ToBytes(i):i,this.exportKey="string"===typeof s?this.decodeBase64ToBytes(s):s,this.derivedKeys.clear(),E.info("OPAQUE key manager initialized",{sessionKeyType:typeof this.sessionKey,sessionKeyConstructor:null==(t=this.sessionKey)||null==(r=t.constructor)?void 0:r.name,exportKeyType:typeof this.exportKey,exportKeyConstructor:null==(n=this.exportKey)||null==(o=n.constructor)?void 0:o.name})}},{key:"deriveTagIdKey",value:function(){var e=(0,n.default)((function*(e){if(!this.exportKey)throw new Error("OPAQUE key manager not initialized");var t="tagid_"+(e?Array.from(e).join(","):"default");if(this.derivedKeys.has(t))return this.derivedKeys.get(t);try{var r=yield this.deriveKey(this.exportKey,V,32,e);return this.derivedKeys.set(t,r),E.debug("TagID key derived successfully"),r}catch(n){throw E.error("Failed to derive TagID key",n),new Error("TagID key derivation failed")}}));return function(t){return e.apply(this,arguments)}}()},{key:"deriveEncryptionKey",value:function(){var e=(0,n.default)((function*(e){if(!this.exportKey)throw new Error("OPAQUE key manager not initialized");var t="encryption_"+(e?Array.from(e).join(","):"default");if(this.derivedKeys.has(t))return this.derivedKeys.get(t);try{var r=yield this.deriveKey(this.exportKey,K,32,e);return this.derivedKeys.set(t,r),E.debug("Encryption key derived successfully"),r}catch(n){throw E.error("Failed to derive encryption key",n),new Error("Encryption key derivation failed")}}));return function(t){return e.apply(this,arguments)}}()},{key:"deriveVaultKey",value:function(){var e=(0,n.default)((function*(e){if(!this.exportKey)throw new Error("OPAQUE key manager not initialized");var t="vault_"+(e?Array.from(e).join(","):"default");if(this.derivedKeys.has(t))return this.derivedKeys.get(t);try{var r=yield this.deriveKey(this.exportKey,q,32,e);return this.derivedKeys.set(t,r),E.debug("Vault key derived successfully"),r}catch(n){throw E.error("Failed to derive vault key",n),new Error("Vault key derivation failed")}}));return function(t){return e.apply(this,arguments)}}()},{key:"getSessionKey",value:function(){if(!this.sessionKey)throw new Error("OPAQUE key manager not initialized");return this.sessionKey}},{key:"getExportKey",value:function(){if(!this.exportKey)throw new Error("OPAQUE key manager not initialized");return this.exportKey}},{key:"isInitialized",value:function(){return null!==this.sessionKey&&null!==this.exportKey}},{key:"clear",value:function(){for(var e of(this.sessionKey&&(this.sessionKey instanceof Uint8Array&&this.sessionKey.fill(0),this.sessionKey=null),this.exportKey&&(this.exportKey instanceof Uint8Array&&this.exportKey.fill(0),this.exportKey=null),this.derivedKeys.values()))e instanceof Uint8Array&&e.fill(0);this.derivedKeys.clear(),E.info("OPAQUE key manager cleared")}},{key:"deriveKey",value:function(){var e=(0,n.default)((function*(e,t,r,n){try{var o=yield crypto.subtle.importKey("raw",e,"HKDF",!1,["deriveKey","deriveBits"]),a=yield crypto.subtle.deriveBits({name:"HKDF",hash:"SHA-256",salt:n||new Uint8Array(32),info:(new TextEncoder).encode(t)},o,8*r);return new Uint8Array(a)}catch(i){throw E.error("HKDF key derivation failed",i),new Error("Key derivation failed")}}));return function(t,r,n,o){return e.apply(this,arguments)}}()}])),G=r(397);function J(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?J(Object(r),!0).forEach((function(t){(0,b.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):J(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Z=(0,d.createContext)(void 0),X=function(e){var t=e.children,r=(0,d.useState)(!1),a=(0,o.default)(r,2),i=a[0],s=a[1],l=(0,d.useState)(!0),c=(0,o.default)(l,2),u=c[0],f=c[1],g=(0,d.useState)(!0),y=(0,o.default)(g,2),p=y[0],h=y[1],m=(0,d.useState)(null),v=(0,o.default)(m,2),b=v[0],S=v[1];(0,d.useEffect)((function(){var e=function(){var e=(0,n.default)((function*(){try{E.info("Checking OPAQUE authentication status");var e=yield x.default.getItem("access_token"),t=yield x.default.getItem("user"),r=yield x.default.getItem("opaque_session_key"),n=yield x.default.getItem("opaque_export_key");if(e){if(E.info("OPAQUE session token found. Verifying..."),I.defaults.headers.common.Authorization="Bearer "+e,s(!0),t)try{var o=JSON.parse(t);S(o),E.info("Loaded user data from OPAQUE session:",{userId:o.id})}catch(a){E.error("Failed to parse stored user data",a),S(null)}else S(null);try{r&&n?(Q.initialize({sessionKey:r,exportKey:n,finishLoginRequest:""}),E.info("OPAQUE key manager rehydrated from storage")):E.warn("OPAQUE keys not found in storage; per-user encryption will require re-login")}catch(i){E.error("Failed to rehydrate OPAQUE keys",i),Q.clear()}}else s(!1),S(null),delete I.defaults.headers.common.Authorization,E.info("No OPAQUE session token found")}catch(l){E.error("OPAQUE authentication check failed:",l);try{yield x.default.removeItem("access_token"),yield x.default.removeItem("refresh_token"),yield x.default.removeItem("user"),delete I.defaults.headers.common.Authorization,yield U.clearOpaqueData(),Q.clear()}catch(Ao){E.error("Failed to clear auth data:",Ao)}}finally{f(!1),h(!1)}}));return function(){return e.apply(this,arguments)}}();e()}),[]);var w=function(){var e=(0,n.default)((function*(){try{E.info("Logging out OPAQUE user",{userId:null==b?void 0:b.id}),f(!0),yield x.default.removeItem("access_token"),yield x.default.removeItem("refresh_token"),yield x.default.removeItem("user"),yield U.clearOpaqueData(),Q.clear(),delete I.defaults.headers.common.Authorization,E.info("API authorization header cleared"),S(null),s(!1),E.info("OPAQUE logout successful - all auth data cleared")}catch(e){E.error("OPAQUE logout failed:",{userId:null==b?void 0:b.id,status:e.status,message:e.message}),yield x.default.removeItem("access_token"),yield x.default.removeItem("refresh_token"),yield x.default.removeItem("user"),yield U.clearOpaqueData(),Q.clear(),delete I.defaults.headers.common.Authorization,S(null),s(!1),E.info("OPAQUE logout successful - all auth data cleared (fallback)")}finally{f(!1)}}));return function(){return e.apply(this,arguments)}}(),j=function(){var e=(0,n.default)((function*(e){if(b)try{var t=Y(Y({},b),e);S(t),yield x.default.setItem("user",JSON.stringify(t)),E.info("Local user state updated",t)}catch(r){E.error("Failed to update local user state or storage",r)}}));return function(t){return e.apply(this,arguments)}}(),C=function(){var e=(0,n.default)((function*(e,t){try{E.info("OPAQUE login attempt for "+e),f(!0);var r=yield U.login(e,t);Q.initialize({sessionKey:r.sessionKey,exportKey:r.exportKey,finishLoginRequest:""}),yield x.default.setItem("opaque_session_key",r.sessionKey),yield x.default.setItem("opaque_export_key",r.exportKey),I.defaults.headers.common.Authorization="Bearer "+r.token,E.info("OPAQUE login successful",{userId:r.user.id});var n=Y(Y({},r.user),{},{created_at:r.user.created_at||(new Date).toISOString(),updated_at:r.user.updated_at||(new Date).toISOString()});yield x.default.setItem("access_token",r.token),yield x.default.setItem("user",JSON.stringify(n)),S(n),s(!0)}catch(a){var o;throw E.error("OPAQUE login failed:",{email:e,status:a.status,message:a.message,response:null==(o=a.response)?void 0:o.data}),Q.clear(),a}finally{f(!1)}}));return function(t,r){return e.apply(this,arguments)}}(),k=function(){var e=(0,n.default)((function*(e,t,r){try{E.info("OPAQUE registration attempt for "+t),f(!0),yield U.register(e,t,r),E.info("OPAQUE registration successful")}catch(o){var n;throw E.error("OPAQUE registration failed:",{email:t,status:o.status,message:o.message,response:null==(n=o.response)?void 0:n.data}),o}finally{f(!1)}}));return function(t,r,n){return e.apply(this,arguments)}}(),T=function(){var e=(0,n.default)((function*(){try{var e=yield I.get("/api/v1/auth/health");return e.status>=200&&e.status<300}catch(t){return E.warn("OPAQUE support check failed, assuming not supported",t),!1}}));return function(){return e.apply(this,arguments)}}(),O={isAuthenticated:i,isLoading:u,isInitialLoading:p,user:b,logout:w,updateUser:j,opaqueLogin:C,opaqueRegister:k,hasOpaqueSupport:T};return(0,G.jsx)(Z.Provider,{value:O,children:t})},$=function(){var e=(0,d.useContext)(Z);if(void 0===e)throw new Error("useAuth must be used within an AuthProvider");return e};var ee=r(6525),te=r(530),re=r(6773),ne=r(5648),oe=r(8179),ae=r(6146),ie=r(3359),se=r(414),le={primary:"#6366F1",primaryLight:"#A5B4FC",primaryDark:"#4338CA",secondary:"#06B6D4",secondaryLight:"#67E8F9",background:"#FAFAFA",surface:"#FFFFFF",card:"#FFFFFF",text:"#111827",textSecondary:"#6B7280",textDisabled:"#9CA3AF",border:"#E5E7EB",borderLight:"#F3F4F6",notification:"#EF4444",error:"#EF4444",errorLight:"#FEE2E2",success:"#10B981",successLight:"#D1FAE5",warning:"#F59E0B",warningLight:"#FEF3C7",disabled:"#D1D5DB",inputBackground:"#FFFFFF",statusBar:"dark-content",shadow:"rgba(0, 0, 0, 0.1)",onPrimary:"#FFFFFF",onSurface:"#111827",overlay:"rgba(0, 0, 0, 0.5)",accent:"#8B5CF6",accentLight:"#DDD6FE",tabBarActive:"#6366F1",tabBarInactive:"#9CA3AF",black:"#000000",white:"#FFFFFF",gray50:"#F9FAFB",gray100:"#F3F4F6",gray200:"#E5E7EB",gray300:"#D1D5DB",gray400:"#9CA3AF",gray500:"#6B7280",gray600:"#4B5563",gray700:"#374151",gray800:"#1F2937",gray900:"#111827",skeleton:"#E5E7EB",skeletonHighlight:"#F3F4F6"},ce={primary:"#818CF8",primaryLight:"#C7D2FE",primaryDark:"#6366F1",secondary:"#22D3EE",secondaryLight:"#7DD3FC",background:"#0F172A",surface:"#1E293B",card:"#1E293B",text:"#F1F5F9",textSecondary:"#94A3B8",textDisabled:"#64748B",border:"#334155",borderLight:"#475569",notification:"#F87171",error:"#F87171",errorLight:"#450A0A",success:"#34D399",successLight:"#064E3B",warning:"#FBBF24",warningLight:"#451A03",disabled:"#475569",inputBackground:"#334155",statusBar:"light-content",shadow:"rgba(0, 0, 0, 0.3)",onPrimary:"#0F172A",onSurface:"#F1F5F9",overlay:"rgba(0, 0, 0, 0.7)",accent:"#A78BFA",accentLight:"#312E81",tabBarActive:"#818CF8",tabBarInactive:"#64748B",black:"#000000",white:"#FFFFFF",gray50:"#1E293B",gray100:"#334155",gray200:"#475569",gray300:"#64748B",gray400:"#94A3B8",gray500:"#CBD5E1",gray600:"#E2E8F0",gray700:"#F1F5F9",gray800:"#F8FAFC",gray900:"#FFFFFF",skeleton:"#334155",skeletonHighlight:"#475569"},de={fontFamilies:{regular:"ios"===k.default.OS?"SF Pro Text":"Roboto",medium:"ios"===k.default.OS?"SF Pro Text Medium":"Roboto Medium",semiBold:"ios"===k.default.OS?"SF Pro Text Semibold":"Roboto Medium",bold:"ios"===k.default.OS?"SF Pro Text Bold":"Roboto Bold",light:"ios"===k.default.OS?"SF Pro Text Light":"Roboto Light"},fontSizes:{xs:12,sm:14,md:16,lg:18,xl:20,xxl:24,xxxl:30,display:36},lineHeights:{tight:1.25,normal:1.5,loose:1.75},letterSpacing:{tight:-.025,normal:0,wide:.025}},ue={none:0,xs:4,sm:8,md:16,lg:24,xl:32,xxl:48,xxxl:64},fe={none:0,sm:4,md:8,lg:12,xl:16,xxl:24,full:9999},ge={none:{shadowColor:"transparent",shadowOffset:{width:0,height:0},shadowOpacity:0,shadowRadius:0,elevation:0},sm:{shadowColor:"#000",shadowOffset:{width:0,height:1},shadowOpacity:.05,shadowRadius:2,elevation:2},md:{shadowColor:"#000",shadowOffset:{width:0,height:4},shadowOpacity:.1,shadowRadius:6,elevation:4},lg:{shadowColor:"#000",shadowOffset:{width:0,height:10},shadowOpacity:.15,shadowRadius:15,elevation:8},xl:{shadowColor:"#000",shadowOffset:{width:0,height:20},shadowOpacity:.25,shadowRadius:25,elevation:12}},ye={duration:{fast:150,normal:300,slow:500},easing:{ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out"}};var pe=(0,d.createContext)(void 0),he=function(e){var t=e.children,r=se.default.getColorScheme(),a=(0,d.useState)("dark"===r),i=(0,o.default)(a,2),s=i[0],l=i[1],c=(0,d.useState)(!0),u=(0,o.default)(c,2),f=u[0],g=u[1];(0,d.useEffect)((function(){var e=function(){var e=(0,n.default)((function*(){try{var e=yield x.default.getItem("themeMode");e?"system"===e?(g(!0),l("dark"===r)):(g(!1),l("dark"===e)):(g(!0),l("dark"===r))}catch(t){console.error("Failed to load theme preference from storage",t),g(!0),l("dark"===r)}}));return function(){return e.apply(this,arguments)}}();e()}),[r]),(0,d.useEffect)((function(){var e=se.default.addChangeListener((function(e){var t=e.colorScheme;f&&l("dark"===t)}));return function(){return e.remove()}}),[f]);var y=function(){var e=(0,n.default)((function*(){var e=!s;l(e),g(!1);try{yield x.default.setItem("themeMode",e?"dark":"light")}catch(t){console.error("Failed to save theme mode to storage",t)}}));return function(){return e.apply(this,arguments)}}(),p=function(){var e=(0,n.default)((function*(e){if(g(e),e){l("dark"===r);try{yield x.default.setItem("themeMode","system")}catch(t){console.error("Failed to save theme mode (system) to storage",t)}}else try{yield x.default.setItem("themeMode",s?"dark":"light")}catch(t){console.error("Failed to save theme mode (manual) to storage",t)}}));return function(t){return e.apply(this,arguments)}}(),h={colors:s?ce:le,typography:de,spacing:ue,borderRadius:fe,shadows:ge,animations:ye,isDarkMode:s};return(0,G.jsx)(pe.Provider,{value:{theme:h,toggleTheme:y,isSystemTheme:f,setUseSystemTheme:p},children:t})},me=function(){var e=(0,d.useContext)(pe);if(!e)throw new Error("useAppTheme must be used within a ThemeProvider");return e},ve=r(45),be=r(368),xe=["children","extraBottomPadding","contentContainerStyle"];function Se(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function we(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Se(Object(r),!0).forEach((function(t){(0,b.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Se(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var je=(0,d.forwardRef)((function(e,t){var r=e.children,n=e.extraBottomPadding,o=void 0===n?0:n,a=e.contentContainerStyle,i=(0,ve.default)(e,xe),s=me().theme,l="ios"===k.default.OS?88:75,c="ios"===k.default.OS?100:85,d=s.spacing.xl,u=[{paddingBottom:Math.max(c+32,l)+d+o+40},a];return(0,G.jsx)(be.default,we(we({ref:t},i),{},{contentContainerStyle:u,showsVerticalScrollIndicator:!0,keyboardShouldPersistTaps:"handled",scrollEventThrottle:16,children:r}))}));je.displayName="SafeScrollView";const Ce=je;var ke=r(8264),Te=r(4701),Ee=v.default.create({container:{flex:1,backgroundColor:"#f5f5f5",paddingTop:w.default.statusBarHeight},header:{flexDirection:"row",alignItems:"center",justifyContent:"space-between",padding:16,borderBottomWidth:1,borderBottomColor:"#e0e0e0",backgroundColor:"#fff"},title:{fontSize:18,fontWeight:"bold",color:"#333"},closeButton:{padding:8},refreshButton:{padding:8},filterContainer:{flexDirection:"row",padding:8,borderBottomWidth:1,borderBottomColor:"#e0e0e0",backgroundColor:"#fff"},filterButton:{paddingVertical:6,paddingHorizontal:12,borderRadius:16,marginHorizontal:4,backgroundColor:"#f0f0f0"},activeFilter:{backgroundColor:"#7D4CDB"},filterText:{fontSize:14,color:"#666"},activeFilterText:{color:"#fff"},loadingContainer:{flex:1,justifyContent:"center",alignItems:"center"},loadingText:{marginTop:12,fontSize:16,color:"#666"},logsContainer:{flex:1,padding:16,backgroundColor:"#f8f8f8"},logs:{fontFamily:k.default.select({ios:"Menlo",android:"monospace",default:"monospace"}),fontSize:12,color:"#333"},webNotice:{fontSize:16,color:"#666",marginBottom:16,textAlign:"center"},codeBlock:{fontFamily:"monospace",fontSize:14,backgroundColor:"#333",color:"#fff",padding:16,borderRadius:8},footer:{padding:16,borderTopWidth:1,borderTopColor:"#e0e0e0",backgroundColor:"#fff"},clearButton:{backgroundColor:"#f44336",borderRadius:8,padding:12,alignItems:"center"},clearButtonText:{color:"#fff",fontWeight:"bold"}});const Oe=function(e){var t=e.visible,r=e.onClose,a=(0,d.useState)(""),i=(0,o.default)(a,2),s=i[0],l=i[1],c=(0,d.useState)(!0),u=(0,o.default)(c,2),f=u[0],g=u[1],y=(0,d.useState)("all"),p=(0,o.default)(y,2),v=p[0],b=p[1];(0,d.useEffect)((function(){t&&x()}),[t,v]);var x=function(){var e=(0,n.default)((function*(){g(!0);try{var e=yield E.getLogs();if("all"!==v){var t=e.split("\n").filter((function(e){var t="["+v.toUpperCase()+"]";return e.includes(t)})).join("\n");l(t||"No matching logs found.")}else l(e)}catch(r){console.error("Error fetching logs:",r),l("Error loading logs. Please try again.")}finally{g(!1)}}));return function(){return e.apply(this,arguments)}}(),S=function(){var e=(0,n.default)((function*(){l("Logs have been cleared.")}));return function(){return e.apply(this,arguments)}}(),w="web"===k.default.OS;return(0,G.jsx)(ke.default,{animationType:"slide",transparent:!1,visible:t,onRequestClose:r,children:(0,G.jsxs)(Te.default,{style:Ee.container,children:[(0,G.jsxs)(h.default,{style:Ee.header,children:[(0,G.jsx)(ne.default,{style:Ee.closeButton,onPress:r,children:(0,G.jsx)(ae.default,{name:"close",size:24,color:"#333"})}),(0,G.jsx)(m.default,{style:Ee.title,children:"Application Logs"}),(0,G.jsx)(ne.default,{style:Ee.refreshButton,onPress:x,children:(0,G.jsx)(ae.default,{name:"refresh",size:24,color:"#333"})})]}),(0,G.jsxs)(h.default,{style:Ee.filterContainer,children:[(0,G.jsx)(ne.default,{style:[Ee.filterButton,"all"===v&&Ee.activeFilter],onPress:function(){return b("all")},children:(0,G.jsx)(m.default,{style:[Ee.filterText,"all"===v&&Ee.activeFilterText],children:"All"})}),(0,G.jsx)(ne.default,{style:[Ee.filterButton,"error"===v&&Ee.activeFilter],onPress:function(){return b("error")},children:(0,G.jsx)(m.default,{style:[Ee.filterText,"error"===v&&Ee.activeFilterText],children:"Errors"})}),(0,G.jsx)(ne.default,{style:[Ee.filterButton,"warn"===v&&Ee.activeFilter],onPress:function(){return b("warn")},children:(0,G.jsx)(m.default,{style:[Ee.filterText,"warn"===v&&Ee.activeFilterText],children:"Warnings"})}),(0,G.jsx)(ne.default,{style:[Ee.filterButton,"info"===v&&Ee.activeFilter],onPress:function(){return b("info")},children:(0,G.jsx)(m.default,{style:[Ee.filterText,"info"===v&&Ee.activeFilterText],children:"Info"})})]}),f?(0,G.jsxs)(h.default,{style:Ee.loadingContainer,children:[(0,G.jsx)(te.default,{size:"large",color:"#7D4CDB"}),(0,G.jsx)(m.default,{style:Ee.loadingText,children:"Loading logs..."})]}):(0,G.jsx)(be.default,{style:Ee.logsContainer,children:w?(0,G.jsxs)(h.default,{children:[(0,G.jsx)(m.default,{style:Ee.webNotice,children:"Logs are only available in the developer console on web. Please check your browser's developer tools."}),(0,G.jsx)(m.default,{style:Ee.codeBlock,children:"console.log('View logs here in browser console')"})]}):(0,G.jsx)(m.default,{style:Ee.logs,children:s})}),(0,G.jsx)(h.default,{style:Ee.footer,children:(0,G.jsx)(ne.default,{style:Ee.clearButton,onPress:S,children:(0,G.jsx)(m.default,{style:Ee.clearButtonText,children:"Clear Logs"})})})]})})};function Fe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ie(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Fe(Object(r),!0).forEach((function(t){(0,b.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Fe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Ae=function(e){return v.default.create({button:{flexDirection:"row",alignItems:"center",justifyContent:"center",paddingVertical:e.spacing.md,paddingHorizontal:e.spacing.lg,borderRadius:e.borderRadius.lg,minHeight:56},enabledButton:Ie({backgroundColor:e.colors.primary},e.shadows.sm),disabledButton:{backgroundColor:e.colors.disabled},checkingButton:Ie({backgroundColor:e.colors.warning},e.shadows.sm),buttonText:{color:e.colors.white,fontSize:e.typography.fontSizes.md,fontWeight:"600",fontFamily:e.typography.fontFamilies.semiBold,marginLeft:e.spacing.sm},disabledText:{color:e.colors.textDisabled}})};const Pe=function(e){var t=e.mode,r=e.email,a=e.password,i=e.name,s=e.confirmPassword,l=e.onSuccess,c=e.onError,u=e.disabled,f=void 0!==u&&u,g=e.style,y=$(),p=y.opaqueLogin,v=y.opaqueRegister,b=y.hasOpaqueSupport,x=y.isLoading,S=me().theme,w=Ae(S),j=(0,d.useState)(!1),C=(0,o.default)(j,2),k=C[0],T=C[1],O=(0,d.useState)(null),F=(0,o.default)(O,2),I=F[0],A=F[1],P=(0,d.useState)(!0),R=(0,o.default)(P,2),D=R[0],z=R[1];(0,d.useEffect)((function(){var e=function(){var e=(0,n.default)((function*(){try{z(!0);var e=yield b();A(e),E.info("Authentication service check completed",{supported:e})}catch(t){E.error("Failed to check authentication service",t),A(!1)}finally{z(!1)}}));return function(){return e.apply(this,arguments)}}();e()}),[b]);var B=function(){var e=(0,n.default)((function*(){if("register"!==t||null!=i&&i.trim())if(null!=r&&r.trim()){if("register"===t){var e=r.trim();if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e))return void(null==c||c("Please enter a valid email address (e.g., user@example.com)"));if(e.length>254)return void(null==c||c("Email address is too long"));if(e.includes(".."))return void(null==c||c("Email address cannot contain consecutive dots"))}if(a)if("register"===t&&a.length<8)null==c||c("Password must be at least 8 characters long");else{if("register"===t){if(a.length>128)return void(null==c||c("Password is too long (maximum 128 characters)"));if(!s)return void(null==c||c("Please confirm your password"))}if("register"!==t||a===s)if(I)try{T(!0),E.info("Starting secure "+t+" process"),"login"===t?yield p(r,a):yield v(i,r,a),null==l||l()}catch(o){E.error("Secure "+t+" failed:",o);var n="An error occurred during "+t+". Please try again.";401===o.status?n="Invalid email or password. Please try again.":422===o.status?o.message&&"string"===typeof o.message?n=o.message:o.errors&&Array.isArray(o.errors)&&(n=o.errors.join("\n")):400===o.status&&"User already exists"===o.message?n="An account with this email already exists. Please try signing in instead.":409===o.status?n="An account with this email already exists.":500===o.status&&o.message.includes("Database connection error")?n="Cannot connect to the database. Please make sure the database service is running.":0===o.status?n="Unable to connect to the server. Please check your connection and try again.":o.message&&(n=o.message),null==c||c(n)}finally{T(!1)}else null==c||c("Authentication service is currently unavailable");else null==c||c("Passwords do not match")}else null==c||c("Please enter a password")}else null==c||c("Please enter your email address");else null==c||c("Please enter your name")}));return function(){return e.apply(this,arguments)}}(),_=f||x||k||D||!I;return D?(0,G.jsxs)(h.default,{style:[w.button,w.checkingButton,g],children:[(0,G.jsx)(te.default,{size:"small",color:S.colors.white}),(0,G.jsx)(m.default,{style:w.buttonText,children:"Checking Server..."})]}):I?(0,G.jsx)(ne.default,{style:[w.button,_?w.disabledButton:w.enabledButton,g],onPress:B,disabled:_,children:k||x?(0,G.jsx)(te.default,{size:"small",color:S.colors.white}):(0,G.jsx)(m.default,{style:w.buttonText,children:"login"===t?"Sign In":"Create Account"})}):(0,G.jsx)(h.default,{style:[w.button,w.disabledButton,g],children:(0,G.jsx)(m.default,{style:[w.buttonText,w.disabledText],children:"Server Unavailable"})})};function Re(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function De(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Re(Object(r),!0).forEach((function(t){(0,b.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Re(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}ie.maybeCompleteAuthSession();var ze=function(e){return v.default.create({container:{flex:1,backgroundColor:e.colors.background},scrollContainer:{flex:1},scrollContent:{flexGrow:1,padding:e.spacing.lg,paddingTop:e.spacing.xl},welcomeCard:De(De({backgroundColor:e.colors.card,borderRadius:e.borderRadius.xl,padding:e.spacing.xl,marginBottom:e.spacing.lg},e.shadows.md),{},{borderColor:e.isDarkMode?e.colors.border:"transparent",borderWidth:e.isDarkMode?1:0}),logoContainer:{alignItems:"center"},logoCircle:{width:80,height:80,borderRadius:40,backgroundColor:e.colors.primaryLight+"20",alignItems:"center",justifyContent:"center",marginBottom:e.spacing.lg},appName:{fontSize:e.typography.fontSizes.xxxl,fontWeight:"bold",color:e.colors.text,fontFamily:e.typography.fontFamilies.bold,marginBottom:e.spacing.sm},tagline:{fontSize:e.typography.fontSizes.lg,color:e.colors.textSecondary,fontFamily:e.typography.fontFamilies.regular,textAlign:"center"},formCard:De(De({backgroundColor:e.colors.card,borderRadius:e.borderRadius.xl,padding:e.spacing.xl,marginBottom:e.spacing.lg},e.shadows.md),{},{borderColor:e.isDarkMode?e.colors.border:"transparent",borderWidth:e.isDarkMode?1:0}),formHeader:{marginBottom:e.spacing.xl},formTitle:{fontSize:e.typography.fontSizes.xxl,fontWeight:"bold",color:e.colors.text,fontFamily:e.typography.fontFamilies.bold,marginBottom:e.spacing.xs},formSubtitle:{fontSize:e.typography.fontSizes.md,color:e.colors.textSecondary,fontFamily:e.typography.fontFamilies.regular},errorContainer:{flexDirection:"row",alignItems:"center",backgroundColor:e.colors.errorLight,borderRadius:e.borderRadius.md,padding:e.spacing.md,marginBottom:e.spacing.lg,borderWidth:1,borderColor:e.colors.error+"30"},errorText:{color:e.colors.error,fontSize:e.typography.fontSizes.sm,fontFamily:e.typography.fontFamilies.medium,marginLeft:e.spacing.sm,flex:1},inputContainer:{marginBottom:e.spacing.lg},inputWrapper:{flexDirection:"row",alignItems:"center",backgroundColor:e.colors.inputBackground,borderRadius:e.borderRadius.lg,borderWidth:1,borderColor:e.colors.border,paddingHorizontal:e.spacing.md,height:56},inputIcon:{marginRight:e.spacing.md},input:{flex:1,fontSize:e.typography.fontSizes.md,fontFamily:e.typography.fontFamilies.regular,color:e.colors.text},eyeIcon:{padding:e.spacing.xs},loginButton:De({backgroundColor:e.colors.primary,borderRadius:e.borderRadius.lg,height:56,alignItems:"center",justifyContent:"center",marginBottom:e.spacing.lg},e.shadows.sm),dividerContainer:{flexDirection:"row",alignItems:"center",marginVertical:e.spacing.lg},dividerLine:{flex:1,height:1,backgroundColor:e.colors.border},dividerText:{marginHorizontal:e.spacing.md,fontSize:e.typography.fontSizes.sm,color:e.colors.textSecondary,fontFamily:e.typography.fontFamilies.medium},googleButton:De({flexDirection:"row",alignItems:"center",justifyContent:"center",backgroundColor:e.colors.surface,borderRadius:e.borderRadius.lg,height:56,borderWidth:1,borderColor:e.colors.border},e.shadows.sm),googleButtonText:{fontSize:e.typography.fontSizes.md,fontWeight:"600",color:e.colors.text,fontFamily:e.typography.fontFamilies.semiBold,marginLeft:e.spacing.sm},registerCard:De(De({backgroundColor:e.colors.card,borderRadius:e.borderRadius.xl,padding:e.spacing.lg,marginBottom:e.spacing.lg},e.shadows.sm),{},{borderColor:e.isDarkMode?e.colors.border:"transparent",borderWidth:e.isDarkMode?1:0}),registerText:{fontSize:e.typography.fontSizes.md,color:e.colors.textSecondary,fontFamily:e.typography.fontFamilies.regular,textAlign:"center",marginBottom:e.spacing.md},registerButton:{flexDirection:"row",alignItems:"center",justifyContent:"center",backgroundColor:e.colors.primaryLight+"20",borderRadius:e.borderRadius.lg,paddingVertical:e.spacing.md,paddingHorizontal:e.spacing.lg},registerButtonText:{fontSize:e.typography.fontSizes.md,fontWeight:"600",color:e.colors.primary,fontFamily:e.typography.fontFamilies.semiBold,marginRight:e.spacing.xs},debugButton:{flexDirection:"row",alignItems:"center",justifyContent:"center",backgroundColor:e.colors.surface,borderRadius:e.borderRadius.md,paddingVertical:e.spacing.sm,paddingHorizontal:e.spacing.md,marginTop:e.spacing.lg,alignSelf:"center"},debugButtonText:{fontSize:e.typography.fontSizes.xs,color:e.colors.textSecondary,fontFamily:e.typography.fontFamilies.medium,marginLeft:e.spacing.xs}})};const Be=function(){var e=(0,oe.useNavigation)(),t=$().isLoading,r=me().theme,a=ze(r),i=(0,d.useState)(""),s=(0,o.default)(i,2),l=s[0],c=s[1],u=(0,d.useState)(""),f=(0,o.default)(u,2),g=f[0],y=f[1],p=(0,d.useState)(!1),v=(0,o.default)(p,2),b=v[0],x=(v[1],(0,d.useState)(!1)),S=(0,o.default)(x,2),w=S[0],j=S[1],C=(0,d.useState)(null),k=(0,o.default)(C,2),T=k[0],O=k[1],F=(0,d.useState)(!1),I=(0,o.default)(F,2),A=I[0],P=I[1];(0,d.useEffect)((function(){T&&O(null)}),[l,g]);var R=function(){var e=(0,n.default)((function*(){O("Google login is not available with OPAQUE zero-knowledge authentication. Please use email/password registration and login.")}));return function(){return e.apply(this,arguments)}}();return(0,G.jsxs)(h.default,{style:a.container,children:[(0,G.jsxs)(Ce,{style:a.scrollContainer,contentContainerStyle:a.scrollContent,keyboardShouldPersistTaps:"handled",showsVerticalScrollIndicator:!1,children:[(0,G.jsx)(h.default,{style:a.welcomeCard,children:(0,G.jsxs)(h.default,{style:a.logoContainer,children:[(0,G.jsx)(h.default,{style:a.logoCircle,children:(0,G.jsx)(ae.default,{name:"mic",size:32,color:r.colors.primary})}),(0,G.jsx)(m.default,{style:a.appName,children:"Welcome Back"}),(0,G.jsx)(m.default,{style:a.tagline,children:"Sign in to continue your journey"})]})}),(0,G.jsxs)(h.default,{style:a.formCard,children:[(0,G.jsxs)(h.default,{style:a.formHeader,children:[(0,G.jsx)(m.default,{style:a.formTitle,children:"Sign In"}),(0,G.jsx)(m.default,{style:a.formSubtitle,children:"Enter your credentials to access your account"})]}),T&&(0,G.jsxs)(h.default,{style:a.errorContainer,children:[(0,G.jsx)(ae.default,{name:"alert-circle-outline",size:20,color:r.colors.error}),(0,G.jsx)(m.default,{style:a.errorText,children:T})]}),(0,G.jsx)(h.default,{style:a.inputContainer,children:(0,G.jsxs)(h.default,{style:a.inputWrapper,children:[(0,G.jsx)(ae.default,{name:"mail-outline",size:20,color:r.colors.textSecondary,style:a.inputIcon}),(0,G.jsx)(re.default,{style:a.input,placeholder:"Email address",value:l,onChangeText:c,keyboardType:"email-address",autoCapitalize:"none",autoCorrect:!1,placeholderTextColor:r.colors.textDisabled})]})}),(0,G.jsx)(h.default,{style:a.inputContainer,children:(0,G.jsxs)(h.default,{style:a.inputWrapper,children:[(0,G.jsx)(ae.default,{name:"lock-closed-outline",size:20,color:r.colors.textSecondary,style:a.inputIcon}),(0,G.jsx)(re.default,{style:a.input,placeholder:"Password",value:g,onChangeText:y,secureTextEntry:!w,autoCapitalize:"none",autoCorrect:!1,placeholderTextColor:r.colors.textDisabled}),(0,G.jsx)(ne.default,{onPress:function(){return j(!w)},style:a.eyeIcon,children:(0,G.jsx)(ae.default,{name:w?"eye-off-outline":"eye-outline",size:20,color:r.colors.textSecondary})})]})}),(0,G.jsx)(Pe,{mode:"login",email:l,password:g,onSuccess:function(){E.info("Login successful via OPAQUE")},onError:function(e){O(e)},disabled:!l||!g||b||t,style:a.loginButton}),(0,G.jsxs)(h.default,{style:a.dividerContainer,children:[(0,G.jsx)(h.default,{style:a.dividerLine}),(0,G.jsx)(m.default,{style:a.dividerText,children:"or"}),(0,G.jsx)(h.default,{style:a.dividerLine})]}),(0,G.jsxs)(ne.default,{style:a.googleButton,onPress:R,disabled:b||t,children:[(0,G.jsx)(ae.default,{name:"logo-google",size:20,color:"#EA4335"}),(0,G.jsx)(m.default,{style:a.googleButtonText,children:"Continue with Google"})]})]}),(0,G.jsxs)(h.default,{style:a.registerCard,children:[(0,G.jsx)(m.default,{style:a.registerText,children:"Don't have an account?"}),(0,G.jsxs)(ne.default,{onPress:function(){e.navigate("Auth",{screen:"Register"})},style:a.registerButton,children:[(0,G.jsx)(m.default,{style:a.registerButtonText,children:"Create Account"}),(0,G.jsx)(ae.default,{name:"arrow-forward",size:16,color:r.colors.primary})]})]}),!1]}),(0,G.jsx)(Oe,{visible:A,onClose:function(){return P(!1)}})]})};function _e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Le(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_e(Object(r),!0).forEach((function(t){(0,b.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_e(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}ie.maybeCompleteAuthSession();var Ne=function(e){return v.default.create({container:{flex:1,backgroundColor:e.colors.background},scrollContainer:{flex:1},scrollContent:{flexGrow:1,padding:e.spacing.lg,paddingTop:e.spacing.xl},headerContainer:{flexDirection:"row",alignItems:"center",marginBottom:e.spacing.lg},backButton:Le({width:40,height:40,borderRadius:20,backgroundColor:e.colors.surface,alignItems:"center",justifyContent:"center"},e.shadows.sm),welcomeCard:Le(Le({backgroundColor:e.colors.card,borderRadius:e.borderRadius.xl,padding:e.spacing.xl,marginBottom:e.spacing.lg},e.shadows.md),{},{borderColor:e.isDarkMode?e.colors.border:"transparent",borderWidth:e.isDarkMode?1:0}),logoContainer:{alignItems:"center"},logoCircle:{width:80,height:80,borderRadius:40,backgroundColor:e.colors.primaryLight+"20",alignItems:"center",justifyContent:"center",marginBottom:e.spacing.lg},appName:{fontSize:e.typography.fontSizes.xxxl,fontWeight:"bold",color:e.colors.text,fontFamily:e.typography.fontFamilies.bold,marginBottom:e.spacing.sm},tagline:{fontSize:e.typography.fontSizes.lg,color:e.colors.textSecondary,fontFamily:e.typography.fontFamilies.regular,textAlign:"center"},formCard:Le(Le({backgroundColor:e.colors.card,borderRadius:e.borderRadius.xl,padding:e.spacing.xl,marginBottom:e.spacing.lg},e.shadows.md),{},{borderColor:e.isDarkMode?e.colors.border:"transparent",borderWidth:e.isDarkMode?1:0}),formHeader:{marginBottom:e.spacing.xl},formTitle:{fontSize:e.typography.fontSizes.xxl,fontWeight:"bold",color:e.colors.text,fontFamily:e.typography.fontFamilies.bold,marginBottom:e.spacing.xs},formSubtitle:{fontSize:e.typography.fontSizes.md,color:e.colors.textSecondary,fontFamily:e.typography.fontFamilies.regular},errorContainer:{flexDirection:"row",alignItems:"center",backgroundColor:e.colors.errorLight,borderRadius:e.borderRadius.md,padding:e.spacing.md,marginBottom:e.spacing.lg,borderWidth:1,borderColor:e.colors.error+"30"},errorText:{color:e.colors.error,fontSize:e.typography.fontSizes.sm,fontFamily:e.typography.fontFamilies.medium,marginLeft:e.spacing.sm,flex:1},successContainer:{flexDirection:"row",alignItems:"center",backgroundColor:e.colors.successLight||e.colors.success+"20",borderRadius:e.borderRadius.md,padding:e.spacing.md,marginBottom:e.spacing.lg,borderWidth:1,borderColor:e.colors.success+"30"},successText:{color:e.colors.success,fontSize:e.typography.fontSizes.sm,fontFamily:e.typography.fontFamilies.medium,marginBottom:e.spacing.sm},successTextContainer:{flex:1,marginLeft:e.spacing.sm},signInLinkContainer:{flexDirection:"row",alignItems:"center",marginTop:e.spacing.xs},signInLinkText:{color:e.colors.primary,fontSize:e.typography.fontSizes.sm,fontFamily:e.typography.fontFamilies.medium,marginRight:e.spacing.xs},inputContainer:{marginBottom:e.spacing.lg},inputWrapper:{flexDirection:"row",alignItems:"center",backgroundColor:e.colors.inputBackground,borderRadius:e.borderRadius.lg,borderWidth:1,borderColor:e.colors.border,paddingHorizontal:e.spacing.md,height:56},inputIcon:{marginRight:e.spacing.md},input:{flex:1,fontSize:e.typography.fontSizes.md,fontFamily:e.typography.fontFamilies.regular,color:e.colors.text},eyeIcon:{padding:e.spacing.xs},passwordRequirements:{backgroundColor:e.colors.surface,borderRadius:e.borderRadius.md,padding:e.spacing.md,marginBottom:e.spacing.lg,borderWidth:1,borderColor:e.colors.border},requirementsTitle:{fontSize:e.typography.fontSizes.sm,fontWeight:"600",color:e.colors.text,fontFamily:e.typography.fontFamilies.semiBold,marginBottom:e.spacing.sm},requirementItem:{flexDirection:"row",alignItems:"center",marginBottom:e.spacing.xs},requirementText:{fontSize:e.typography.fontSizes.sm,fontFamily:e.typography.fontFamilies.regular,marginLeft:e.spacing.sm},registerButton:Le({backgroundColor:e.colors.primary,borderRadius:e.borderRadius.lg,height:56,alignItems:"center",justifyContent:"center",marginBottom:e.spacing.lg},e.shadows.sm),dividerContainer:{flexDirection:"row",alignItems:"center",marginVertical:e.spacing.lg},dividerLine:{flex:1,height:1,backgroundColor:e.colors.border},dividerText:{marginHorizontal:e.spacing.md,fontSize:e.typography.fontSizes.sm,color:e.colors.textSecondary,fontFamily:e.typography.fontFamilies.medium},googleButton:Le({flexDirection:"row",alignItems:"center",justifyContent:"center",backgroundColor:e.colors.surface,borderRadius:e.borderRadius.lg,height:56,borderWidth:1,borderColor:e.colors.border},e.shadows.sm),googleButtonText:{fontSize:e.typography.fontSizes.md,fontWeight:"600",color:e.colors.text,fontFamily:e.typography.fontFamilies.semiBold,marginLeft:e.spacing.sm},loginCard:Le(Le({backgroundColor:e.colors.card,borderRadius:e.borderRadius.xl,padding:e.spacing.lg,marginBottom:e.spacing.lg},e.shadows.sm),{},{borderColor:e.isDarkMode?e.colors.border:"transparent",borderWidth:e.isDarkMode?1:0}),loginText:{fontSize:e.typography.fontSizes.md,color:e.colors.textSecondary,fontFamily:e.typography.fontFamilies.regular,textAlign:"center",marginBottom:e.spacing.md},loginButton:{flexDirection:"row",alignItems:"center",justifyContent:"center",backgroundColor:e.colors.primaryLight+"20",borderRadius:e.borderRadius.lg,paddingVertical:e.spacing.md,paddingHorizontal:e.spacing.lg},loginButtonText:{fontSize:e.typography.fontSizes.md,fontWeight:"600",color:e.colors.primary,fontFamily:e.typography.fontFamilies.semiBold,marginRight:e.spacing.xs}})};const Me=function(){var e=(0,oe.useNavigation)(),t=$().isLoading,r=me().theme,a=Ne(r);(0,d.useEffect)((function(){return console.log("RegisterScreen mounted"),function(){console.log("RegisterScreen unmounted")}}),[]);var i=(0,d.useState)(""),s=(0,o.default)(i,2),l=s[0],c=s[1],u=(0,d.useState)(""),f=(0,o.default)(u,2),g=f[0],y=f[1],p=(0,d.useState)(""),v=(0,o.default)(p,2),b=v[0],x=v[1],S=(0,d.useState)(""),w=(0,o.default)(S,2),j=w[0],C=w[1],k=(0,d.useState)(!1),T=(0,o.default)(k,2),E=T[0],O=(T[1],(0,d.useState)(!1)),F=(0,o.default)(O,2),I=F[0],A=F[1],P=(0,d.useState)(null),R=(0,o.default)(P,2),D=R[0],z=R[1],B=(0,d.useState)(null),_=(0,o.default)(B,2),L=_[0],N=_[1];(0,d.useEffect)((function(){D&&z(null),L&&N(null)}),[l,g,b,j]);var M=function(){var e=(0,n.default)((function*(){z("Google registration is not available with secure zero-knowledge authentication. Please use email/password registration.")}));return function(){return e.apply(this,arguments)}}(),H=function(){e.navigate("Auth",{screen:"Login"})};return(0,G.jsx)(h.default,{style:a.container,children:(0,G.jsxs)(Ce,{style:a.scrollContainer,contentContainerStyle:a.scrollContent,keyboardShouldPersistTaps:"handled",showsVerticalScrollIndicator:!1,children:[(0,G.jsx)(h.default,{style:a.headerContainer,children:(0,G.jsx)(ne.default,{style:a.backButton,onPress:H,children:(0,G.jsx)(ae.default,{name:"arrow-back",size:24,color:r.colors.text})})}),(0,G.jsx)(h.default,{style:a.welcomeCard,children:(0,G.jsxs)(h.default,{style:a.logoContainer,children:[(0,G.jsx)(h.default,{style:a.logoCircle,children:(0,G.jsx)(ae.default,{name:"person-add",size:32,color:r.colors.primary})}),(0,G.jsx)(m.default,{style:a.appName,children:"Create Account"}),(0,G.jsx)(m.default,{style:a.tagline,children:"Join us and start your journaling journey"})]})}),(0,G.jsxs)(h.default,{style:a.formCard,children:[(0,G.jsxs)(h.default,{style:a.formHeader,children:[(0,G.jsx)(m.default,{style:a.formTitle,children:"Sign Up"}),(0,G.jsx)(m.default,{style:a.formSubtitle,children:"Fill in your information to get started"})]}),D&&(0,G.jsxs)(h.default,{style:a.errorContainer,children:[(0,G.jsx)(ae.default,{name:"alert-circle-outline",size:20,color:r.colors.error}),(0,G.jsx)(m.default,{style:a.errorText,children:D})]}),L&&(0,G.jsxs)(h.default,{style:a.successContainer,children:[(0,G.jsx)(ae.default,{name:"checkmark-circle-outline",size:20,color:r.colors.success}),(0,G.jsxs)(h.default,{style:a.successTextContainer,children:[(0,G.jsx)(m.default,{style:a.successText,children:L}),(0,G.jsxs)(ne.default,{onPress:H,style:a.signInLinkContainer,children:[(0,G.jsx)(m.default,{style:a.signInLinkText,children:"Sign in now"}),(0,G.jsx)(ae.default,{name:"arrow-forward",size:16,color:r.colors.primary})]})]})]}),(0,G.jsx)(h.default,{style:a.inputContainer,children:(0,G.jsxs)(h.default,{style:a.inputWrapper,children:[(0,G.jsx)(ae.default,{name:"person-outline",size:20,color:r.colors.textSecondary,style:a.inputIcon}),(0,G.jsx)(re.default,{style:a.input,placeholder:"Name",value:l,onChangeText:c,autoCapitalize:"words",autoCorrect:!1,placeholderTextColor:r.colors.textDisabled})]})}),(0,G.jsx)(h.default,{style:a.inputContainer,children:(0,G.jsxs)(h.default,{style:a.inputWrapper,children:[(0,G.jsx)(ae.default,{name:"mail-outline",size:20,color:r.colors.textSecondary,style:a.inputIcon}),(0,G.jsx)(re.default,{style:a.input,placeholder:"Email address",value:g,onChangeText:y,keyboardType:"email-address",autoCapitalize:"none",autoCorrect:!1,placeholderTextColor:r.colors.textDisabled})]})}),(0,G.jsx)(h.default,{style:a.inputContainer,children:(0,G.jsxs)(h.default,{style:a.inputWrapper,children:[(0,G.jsx)(ae.default,{name:"lock-closed-outline",size:20,color:r.colors.textSecondary,style:a.inputIcon}),(0,G.jsx)(re.default,{style:a.input,placeholder:"Password",value:b,onChangeText:x,secureTextEntry:!I,autoCapitalize:"none",autoCorrect:!1,placeholderTextColor:r.colors.textDisabled}),(0,G.jsx)(ne.default,{onPress:function(){return A(!I)},style:a.eyeIcon,children:(0,G.jsx)(ae.default,{name:I?"eye-off-outline":"eye-outline",size:20,color:r.colors.textSecondary})})]})}),(0,G.jsx)(h.default,{style:a.inputContainer,children:(0,G.jsxs)(h.default,{style:a.inputWrapper,children:[(0,G.jsx)(ae.default,{name:"lock-closed-outline",size:20,color:r.colors.textSecondary,style:a.inputIcon}),(0,G.jsx)(re.default,{style:a.input,placeholder:"Confirm Password",value:j,onChangeText:C,secureTextEntry:!I,autoCapitalize:"none",autoCorrect:!1,placeholderTextColor:r.colors.textDisabled})]})}),(0,G.jsxs)(h.default,{style:a.passwordRequirements,children:[(0,G.jsx)(m.default,{style:a.requirementsTitle,children:"Password Requirements:"}),(0,G.jsxs)(h.default,{style:a.requirementItem,children:[(0,G.jsx)(ae.default,{name:b.length>=8?"checkmark-circle":"ellipse-outline",size:16,color:b.length>=8?r.colors.success:r.colors.textDisabled}),(0,G.jsx)(m.default,{style:[a.requirementText,{color:b.length>=8?r.colors.success:r.colors.textDisabled}],children:"At least 8 characters"})]}),(0,G.jsxs)(h.default,{style:a.requirementItem,children:[(0,G.jsx)(ae.default,{name:b===j&&b.length>0?"checkmark-circle":"ellipse-outline",size:16,color:b===j&&b.length>0?r.colors.success:r.colors.textDisabled}),(0,G.jsx)(m.default,{style:[a.requirementText,{color:b===j&&b.length>0?r.colors.success:r.colors.textDisabled}],children:"Passwords match"})]})]}),(0,G.jsx)(Pe,{mode:"register",name:l,email:g,password:b,confirmPassword:j,onSuccess:function(){z(null),N("Account created successfully! You can now sign in with your credentials."),console.log("Registration successful via OPAQUE button")},onError:function(e){console.log("RegisterScreen onError called with:",e),N(null),z(e)},disabled:E||t||!!L,style:a.registerButton}),(0,G.jsxs)(h.default,{style:a.dividerContainer,children:[(0,G.jsx)(h.default,{style:a.dividerLine}),(0,G.jsx)(m.default,{style:a.dividerText,children:"or"}),(0,G.jsx)(h.default,{style:a.dividerLine})]}),(0,G.jsxs)(ne.default,{style:a.googleButton,onPress:M,disabled:E||t,children:[(0,G.jsx)(ae.default,{name:"logo-google",size:20,color:"#EA4335"}),(0,G.jsx)(m.default,{style:a.googleButtonText,children:"Continue with Google"})]})]}),(0,G.jsxs)(h.default,{style:a.loginCard,children:[(0,G.jsx)(m.default,{style:a.loginText,children:"Already have an account?"}),(0,G.jsxs)(ne.default,{onPress:H,style:a.loginButton,children:[(0,G.jsx)(m.default,{style:a.loginButtonText,children:"Sign In"}),(0,G.jsx)(ae.default,{name:"arrow-forward",size:16,color:r.colors.primary})]})]})]})})};var He=(0,ee.default)();const We=function(){return(0,G.jsxs)(He.Navigator,{initialRouteName:"Register",screenOptions:{headerShown:!1},children:[(0,G.jsx)(He.Screen,{name:"Login",component:Be}),(0,G.jsx)(He.Screen,{name:"Register",component:Me})]})};var Ue=r(3150),Ve=r(1213),Ke=r(2176);function qe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}const Qe=new((0,i.default)((function e(){(0,a.default)(this,e),this.state={permissionsGranted:!1,audioModeConfigured:!1,isPrewarmed:!1,lastPrewarmTime:0},this.prewarmPromise=null}),[{key:"prewarmAudioSystem",value:function(){var e=(0,n.default)((function*(){if(this.prewarmPromise)yield this.prewarmPromise;else if(this.state.isPrewarmed&&Date.now()-this.state.lastPrewarmTime<3e5)E.debug("Audio system already prewarmed recently, skipping");else{this.prewarmPromise=this.performPrewarm();try{yield this.prewarmPromise}finally{this.prewarmPromise=null}}}));return function(){return e.apply(this,arguments)}}()},{key:"performPrewarm",value:function(){var e=(0,n.default)((function*(){E.info("Starting audio system prewarm...");var e=Date.now();try{yield this.prewarmPermissions(),yield this.prewarmAudioMode(),this.state.isPrewarmed=!0,this.state.lastPrewarmTime=Date.now();var t=Date.now()-e;E.info("Audio system prewarm completed in "+t+"ms")}catch(r){throw E.error("Audio system prewarm failed:",r),this.state.isPrewarmed=!1,r}}));return function(){return e.apply(this,arguments)}}()},{key:"prewarmPermissions",value:function(){var e=(0,n.default)((function*(){try{if(E.debug("Prewarming audio permissions..."),!(yield Ve.requestPermissionsAsync()).granted)return E.warn("Microphone permission not granted during prewarm"),void(this.state.permissionsGranted=!1);this.state.permissionsGranted=!0,E.debug("Audio permissions prewarmed successfully")}catch(e){throw E.error("Failed to prewarm audio permissions:",e),this.state.permissionsGranted=!1,e}}));return function(){return e.apply(this,arguments)}}()},{key:"prewarmAudioMode",value:function(){var e=(0,n.default)((function*(){try{E.debug("Prewarming audio mode configuration..."),yield Ke.setAudioModeAsync({allowsRecordingIOS:!0,playsInSilentModeIOS:!0,shouldDuckAndroid:!0,playThroughEarpieceAndroid:!1,staysActiveInBackground:!1}),this.state.audioModeConfigured=!0,E.debug("Audio mode prewarmed successfully")}catch(e){throw E.error("Failed to prewarm audio mode:",e),this.state.audioModeConfigured=!1,e}}));return function(){return e.apply(this,arguments)}}()},{key:"getPrewarmState",value:function(){return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?qe(Object(r),!0).forEach((function(t){(0,b.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):qe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},this.state)}},{key:"isReadyForRecording",value:function(){return this.state.permissionsGranted&&this.state.audioModeConfigured}},{key:"refreshPrewarm",value:function(){var e=(0,n.default)((function*(){this.state.isPrewarmed=!1,this.state.lastPrewarmTime=0,yield this.prewarmAudioSystem()}));return function(){return e.apply(this,arguments)}}()},{key:"getPerformanceMetrics",value:function(){var e=Date.now();return{isPrewarmed:this.state.isPrewarmed,lastPrewarmTime:this.state.lastPrewarmTime,timeSinceLastPrewarm:this.state.lastPrewarmTime>0?e-this.state.lastPrewarmTime:-1,readyForRecording:this.isReadyForRecording()}}},{key:"cleanup",value:function(){this.state={permissionsGranted:!1,audioModeConfigured:!1,isPrewarmed:!1,lastPrewarmTime:0},this.prewarmPromise=null,E.debug("Audio prewarm service cleaned up")}}]));var Ge=r(6757),Je=r(5110),Ye=[{code:"auto",name:"Auto-detect"},{code:"en-US",name:"English",region:"United States"},{code:"en-GB",name:"English",region:"United Kingdom"},{code:"en-AU",name:"English",region:"Australia"},{code:"en-CA",name:"English",region:"Canada"},{code:"es-ES",name:"Spanish",region:"Spain"},{code:"es-MX",name:"Spanish",region:"Mexico"},{code:"es-US",name:"Spanish",region:"United States"},{code:"fr-FR",name:"French",region:"France"},{code:"fr-CA",name:"French",region:"Canada"},{code:"de-DE",name:"German",region:"Germany"},{code:"it-IT",name:"Italian",region:"Italy"},{code:"pt-BR",name:"Portuguese",region:"Brazil"},{code:"pt-PT",name:"Portuguese",region:"Portugal"},{code:"zh-CN",name:"Chinese",region:"Simplified"},{code:"zh-TW",name:"Chinese",region:"Traditional"},{code:"ja-JP",name:"Japanese",region:"Japan"},{code:"ko-KR",name:"Korean",region:"South Korea"},{code:"ru-RU",name:"Russian",region:"Russia"},{code:"ar-SA",name:"Arabic",region:"Saudi Arabia"},{code:"hi-IN",name:"Hindi",region:"India"},{code:"nl-NL",name:"Dutch",region:"Netherlands"},{code:"pl-PL",name:"Polish",region:"Poland"},{code:"tr-TR",name:"Turkish",region:"Turkey"},{code:"sv-SE",name:"Swedish",region:"Sweden"},{code:"no-NO",name:"Norwegian",region:"Norway"},{code:"da-DK",name:"Danish",region:"Denmark"},{code:"fi-FI",name:"Finnish",region:"Finland"}];function Ze(e){return Ye.some((function(t){return t.code===e}))}function Xe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function $e(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Xe(Object(r),!0).forEach((function(t){(0,b.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Xe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var et={defaultLanguage:"auto",defaultEntryPrivacy:"public",hiddenModeEnabled:!1,hapticFeedbackEnabled:!0,notificationsEnabled:!0,reminderNotifications:!1,dailyReminderTime:"20:00",analyticsEnabled:!0,crashReportsEnabled:!0,autoSaveEnabled:!0,autoRecordingEnabled:!0},tt="@kotori_user_settings";const rt=new((0,i.default)((function e(){(0,a.default)(this,e),this.settings=$e({},et),this.initialized=!1,this.listeners=new Set}),[{key:"initialize",value:function(){var e=(0,n.default)((function*(){if(this.initialized)return this.settings;try{var e=yield x.default.getItem(tt);if(e){var t=JSON.parse(e),r=t.settings||t;this.settings=$e($e({},et),this.validateSettings(r)),E.info("[SettingsService] Settings loaded from storage")}else yield this.saveSettings(this.settings),E.info("[SettingsService] Initialized with default settings")}catch(o){var n=o instanceof Error?o:new Error(String(o));E.error("[SettingsService] Failed to load settings:",n),this.settings=$e({},et)}return this.initialized=!0,this.settings}));return function(){return e.apply(this,arguments)}}()},{key:"getSettings",value:function(){return $e({},this.settings)}},{key:"getSetting",value:function(e){return this.settings[e]}},{key:"updateSetting",value:function(){var e=(0,n.default)((function*(e,t){try{var r=this.validateSingleSetting(e,t);this.settings=$e($e({},this.settings),{},(0,b.default)({},e,r)),yield this.saveSettings(this.settings),this.notifyListeners(),E.info("[SettingsService] Updated setting: "+String(e)+" = "+t)}catch(o){var n=o instanceof Error?o:new Error(String(o));throw E.error("[SettingsService] Failed to update setting "+String(e)+":",n),n}}));return function(t,r){return e.apply(this,arguments)}}()},{key:"updateSettings",value:function(){var e=(0,n.default)((function*(e){try{var t=this.validateSettings(e);this.settings=$e($e({},this.settings),t),yield this.saveSettings(this.settings),this.notifyListeners(),E.info("[SettingsService] Bulk settings update completed")}catch(n){var r=n instanceof Error?n:new Error(String(n));throw E.error("[SettingsService] Failed to update settings:",r),r}}));return function(t){return e.apply(this,arguments)}}()},{key:"resetToDefaults",value:function(){var e=(0,n.default)((function*(){try{this.settings=$e({},et),yield this.saveSettings(this.settings),this.notifyListeners(),E.info("[SettingsService] Settings reset to defaults")}catch(t){var e=t instanceof Error?t:new Error(String(t));throw E.error("[SettingsService] Failed to reset settings:",e),e}}));return function(){return e.apply(this,arguments)}}()},{key:"exportSettings",value:function(){var e=(0,n.default)((function*(){var e={version:"1.0",timestamp:(new Date).toISOString(),settings:this.settings};return JSON.stringify(e,null,2)}));return function(){return e.apply(this,arguments)}}()},{key:"importSettings",value:function(){var e=(0,n.default)((function*(e){try{var t=JSON.parse(e);if(!t.settings)throw new Error("Invalid settings format - missing settings object");var r=this.validateSettings(t.settings);yield this.updateSettings(r),E.info("[SettingsService] Settings imported successfully")}catch(o){var n=o instanceof Error?o:new Error(String(o));throw E.error("[SettingsService] Failed to import settings:",n),new Error("Failed to import settings: "+n.message)}}));return function(t){return e.apply(this,arguments)}}()},{key:"subscribe",value:function(e){var t=this;return this.listeners.add(e),function(){t.listeners.delete(e)}}},{key:"getMigrationInfo",value:function(){var e=Object.keys(this.settings),t=Object.keys(et).filter((function(t){return!e.includes(t)}));return{hasNewSettings:t.length>0,newSettings:t}}},{key:"saveSettings",value:function(){var e=(0,n.default)((function*(e){var t={version:"1.0",timestamp:(new Date).toISOString(),settings:e};yield x.default.setItem(tt,JSON.stringify(t))}));return function(t){return e.apply(this,arguments)}}()},{key:"validateSettings",value:function(e){var t={};for(var r of Object.entries(e)){var n=(0,o.default)(r,2),a=n[0],i=n[1];try{var s=this.validateSingleSetting(a,i);t[a]=s}catch(d){var l=d instanceof Error?d:new Error(String(d));E.warn("[SettingsService] Invalid setting "+a+": "+l.message+", using default");var c=et[a];t[a]=c}}return t}},{key:"validateSingleSetting",value:function(e,t){switch(e){case"defaultLanguage":if("string"!==typeof t||!Ze(t)&&"auto"!==t)throw new Error("Invalid language code: "+t);return t;case"dailyReminderTime":if("string"!==typeof t||!/^\d{2}:\d{2}$/.test(t))throw new Error("Invalid time format: "+t);return t;default:if(typeof t!==typeof et[e])throw new Error("Type mismatch for "+e+": expected "+typeof et[e]+", got "+typeof t);return t}}},{key:"notifyListeners",value:function(){var e=this;this.listeners.forEach((function(t){try{t(e.getSettings())}catch(n){var r=n instanceof Error?n:new Error(String(n));E.error("[SettingsService] Error in settings listener:",r)}}))}}]));var nt=function(e){return e.Selection="selection",e.ImpactLight="impactLight",e.ImpactMedium="impactMedium",e.ImpactHeavy="impactHeavy",e.NotificationSuccess="notificationSuccess",e.NotificationWarning="notificationWarning",e.NotificationError="notificationError",e}({});const ot=new((0,i.default)((function e(){(0,a.default)(this,e),this.expoHaptics=null,this.initialized=!1}),[{key:"initialize",value:function(){var e=(0,n.default)((function*(){if(!this.initialized){try{if("web"!==k.default.OS){var e=r(Object(function(){var e=new Error("Cannot find module 'expo-haptics'");throw e.code="MODULE_NOT_FOUND",e}())).Haptics;this.expoHaptics=e,E.info("[HapticService] Expo Haptics initialized successfully")}else E.info("[HapticService] Web platform - haptics not supported")}catch(t){E.warn("[HapticService] Expo Haptics not available, will use fallback vibration")}this.initialized=!0}}));return function(){return e.apply(this,arguments)}}()},{key:"isHapticEnabled",value:function(){var e=(0,n.default)((function*(){try{return(yield rt.getSettings()).hapticFeedbackEnabled}catch(e){return E.warn("[HapticService] Failed to get haptic setting, defaulting to enabled"),!0}}));return function(){return e.apply(this,arguments)}}()},{key:"impact",value:function(){var e=(0,n.default)((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:nt.ImpactMedium;try{if(yield this.initialize(),!(yield this.isHapticEnabled()))return void E.debug("[HapticService] Haptic feedback disabled in settings");if("web"===k.default.OS)return;this.expoHaptics?yield this.triggerExpoHaptic(e):this.triggerVibrationFallback(e),E.debug("[HapticService] Haptic feedback triggered: "+e)}catch(t){E.error("[HapticService] Failed to trigger haptic feedback:",t)}}));return function(){return e.apply(this,arguments)}}()},{key:"triggerExpoHaptic",value:function(){var e=(0,n.default)((function*(e){if(this.expoHaptics)switch(e){case nt.Selection:yield this.expoHaptics.selectionAsync();break;case nt.ImpactLight:yield this.expoHaptics.impactAsync(this.expoHaptics.ImpactFeedbackStyle.Light);break;case nt.ImpactMedium:yield this.expoHaptics.impactAsync(this.expoHaptics.ImpactFeedbackStyle.Medium);break;case nt.ImpactHeavy:yield this.expoHaptics.impactAsync(this.expoHaptics.ImpactFeedbackStyle.Heavy);break;case nt.NotificationSuccess:yield this.expoHaptics.notificationAsync(this.expoHaptics.NotificationFeedbackType.Success);break;case nt.NotificationWarning:yield this.expoHaptics.notificationAsync(this.expoHaptics.NotificationFeedbackType.Warning);break;case nt.NotificationError:yield this.expoHaptics.notificationAsync(this.expoHaptics.NotificationFeedbackType.Error);break;default:yield this.expoHaptics.impactAsync(this.expoHaptics.ImpactFeedbackStyle.Medium)}}));return function(t){return e.apply(this,arguments)}}()},{key:"triggerVibrationFallback",value:function(e){var t;switch(e){case nt.Selection:t=20;break;case nt.ImpactLight:t=30;break;case nt.ImpactMedium:t=50;break;case nt.ImpactHeavy:t=80;break;case nt.NotificationSuccess:t=100;break;case nt.NotificationWarning:t=150;break;case nt.NotificationError:t=200;break;default:t=50}Je.default.vibrate(t)}},{key:"selection",value:function(){var e=(0,n.default)((function*(){return this.impact(nt.Selection)}));return function(){return e.apply(this,arguments)}}()},{key:"light",value:function(){var e=(0,n.default)((function*(){return this.impact(nt.ImpactLight)}));return function(){return e.apply(this,arguments)}}()},{key:"medium",value:function(){var e=(0,n.default)((function*(){return this.impact(nt.ImpactMedium)}));return function(){return e.apply(this,arguments)}}()},{key:"heavy",value:function(){var e=(0,n.default)((function*(){return this.impact(nt.ImpactHeavy)}));return function(){return e.apply(this,arguments)}}()},{key:"success",value:function(){var e=(0,n.default)((function*(){return this.impact(nt.NotificationSuccess)}));return function(){return e.apply(this,arguments)}}()},{key:"warning",value:function(){var e=(0,n.default)((function*(){return this.impact(nt.NotificationWarning)}));return function(){return e.apply(this,arguments)}}()},{key:"error",value:function(){var e=(0,n.default)((function*(){return this.impact(nt.NotificationError)}));return function(){return e.apply(this,arguments)}}()}]));function at(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function it(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?at(Object(r),!0).forEach((function(t){(0,b.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):at(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var st="web"!==k.default.OS,lt=function(e,t,r){var n=function(){switch(r){case"secondary":return{backgroundColor:e.colors.secondary,shadowColor:e.colors.secondary};case"accent":return{backgroundColor:e.colors.accent,shadowColor:e.colors.accent};default:return{backgroundColor:e.colors.primary,shadowColor:e.colors.primary}}}();return v.default.create({container:{position:"relative"},shadowContainer:it(it({borderRadius:t/2},e.shadows.lg),{},{shadowColor:n.shadowColor}),button:{width:t,height:t,borderRadius:t/2,backgroundColor:n.backgroundColor,justifyContent:"center",alignItems:"center",overflow:"hidden"},touchable:{width:"100%",height:"100%",justifyContent:"center",alignItems:"center"},disabled:{backgroundColor:e.colors.disabled,opacity:.6},icon:{color:e.colors.onPrimary}})};const ct=function(e){var t=e.onPress,r=e.icon,n=void 0===r?"mic":r,o=e.size,a=void 0===o?56:o,i=e.style,s=e.disabled,l=void 0!==s&&s,c=e.variant,u=void 0===c?"primary":c,f=e.testID,g=void 0===f?"floating-action-button":f,y=me().theme,p=lt(y,a,u),m=(0,d.useRef)(new Ge.default.Value(1)).current,v=(0,d.useRef)(new Ge.default.Value(1)).current,b=(0,d.useRef)(new Ge.default.Value(0)).current;(0,d.useEffect)((function(){var e=Ge.default.loop(Ge.default.sequence([Ge.default.timing(v,{toValue:1.05,duration:1e3,useNativeDriver:st}),Ge.default.timing(v,{toValue:1,duration:1e3,useNativeDriver:st})]));return l||e.start(),function(){return e.stop()}}),[l,v]);var x=b.interpolate({inputRange:[0,1],outputRange:["0deg","15deg"]});return(0,G.jsx)(h.default,{style:[p.container,i],children:(0,G.jsx)(Ge.default.View,{style:[p.shadowContainer,{transform:[{scale:v}]}],children:(0,G.jsx)(Ge.default.View,{style:[p.button,l&&p.disabled,{transform:[{scale:m},{rotate:x}]}],children:(0,G.jsx)(ne.default,{style:p.touchable,onPress:function(){l||t()},onPressIn:function(){l||(ot.medium(),Ge.default.parallel([Ge.default.spring(m,{toValue:.95,useNativeDriver:st}),Ge.default.timing(b,{toValue:1,duration:150,useNativeDriver:st})]).start())},onPressOut:function(){l||Ge.default.parallel([Ge.default.spring(m,{toValue:1,tension:150,friction:4,useNativeDriver:st}),Ge.default.timing(b,{toValue:0,duration:150,useNativeDriver:st})]).start()},disabled:l,activeOpacity:.8,testID:g,children:(0,G.jsx)(ae.default,{name:n,size:.5*a,color:p.icon.color})})})})})};var dt=r(5458),ut=r(2660),ft=r(1690),gt=r(5497),yt=function(){function e(){(0,a.default)(this,e)}return(0,i.default)(e,[{key:"isWebCryptoAvailable",value:function(){return"undefined"!==typeof crypto&&"undefined"!==typeof crypto.subtle&&"function"===typeof crypto.subtle.deriveKey}},{key:"getUserSalt",value:function(){var t=(0,n.default)((function*(){try{var t=null;if(t="web"===k.default.OS?localStorage.getItem(e.USER_SALT_KEY):yield x.default.getItem(e.USER_SALT_KEY)){for(var r=atob(t),n=new Uint8Array(r.length),o=0;o<r.length;o++)n[o]=r.charCodeAt(o);return n}var a=crypto.getRandomValues(new Uint8Array(e.SALT_LENGTH)),i=Array.from(a),s=btoa(String.fromCharCode.apply(String,i));return"web"===k.default.OS?localStorage.setItem(e.USER_SALT_KEY,s):yield x.default.setItem(e.USER_SALT_KEY,s),E.info("Generated new user salt for encryption"),a}catch(l){throw E.error("Failed to get or create user salt:",l),new Error("Failed to initialize encryption salt")}}));return function(){return t.apply(this,arguments)}}()},{key:"deriveKeyFromSecret",value:function(){var t=(0,n.default)((function*(t){if(!this.isWebCryptoAvailable())throw new Error("Web Crypto API not available");var r=t.userSecret,n=t.salt,o=t.iterations,a=void 0===o?e.DEFAULT_ITERATIONS:o;try{var i=new TextEncoder,s=yield crypto.subtle.importKey("raw",i.encode(r),"PBKDF2",!1,["deriveKey"]),l=n||(yield this.getUserSalt());return yield crypto.subtle.deriveKey({name:"PBKDF2",salt:l,iterations:a,hash:"SHA-256"},s,{name:e.ALGORITHM,length:e.KEY_LENGTH},!1,["encrypt","decrypt"])}catch(c){throw E.error("Failed to derive encryption key:",c),new Error("Key derivation failed")}}));return function(e){return t.apply(this,arguments)}}()},{key:"getUserMasterKey",value:function(){var t=(0,n.default)((function*(){if(!Q.isInitialized())throw new Error("OPAQUE key manager not initialized");var t=Q.getExportKey(),r=yield crypto.subtle.importKey("raw",t,"HKDF",!1,["deriveKey"]);return yield crypto.subtle.deriveKey({name:"HKDF",hash:"SHA-256",salt:new Uint8Array(32),info:(new TextEncoder).encode(e.MASTER_INFO)},r,{name:e.ALGORITHM,length:e.KEY_LENGTH},!1,["encrypt","decrypt","wrapKey","unwrapKey"])}));return function(){return t.apply(this,arguments)}}()},{key:"generateEntryKey",value:function(){var t=(0,n.default)((function*(){return yield crypto.subtle.generateKey({name:e.ALGORITHM,length:e.KEY_LENGTH},!0,["encrypt","decrypt"])}));return function(){return t.apply(this,arguments)}}()},{key:"exportRawKey",value:function(){var e=(0,n.default)((function*(e){var t=yield crypto.subtle.exportKey("raw",e);return new Uint8Array(t)}));return function(t){return e.apply(this,arguments)}}()},{key:"wrapEntryKey",value:function(){var t=(0,n.default)((function*(t,r,n){var o=yield crypto.subtle.encrypt({name:e.ALGORITHM,iv:n},r,yield this.exportRawKey(t));return new Uint8Array(o)}));return function(e,r,n){return t.apply(this,arguments)}}()},{key:"encryptPerUser",value:function(){var t=(0,n.default)((function*(t){if(!this.isWebCryptoAvailable())throw new Error("Encryption not available on this platform");try{var r=yield this.getUserMasterKey(),n=yield this.generateEntryKey(),o=crypto.getRandomValues(new Uint8Array(e.IV_LENGTH)),a=crypto.getRandomValues(new Uint8Array(e.IV_LENGTH)),i=new TextEncoder,s=yield crypto.subtle.encrypt({name:e.ALGORITHM,iv:o},n,i.encode(t)),l=yield this.wrapEntryKey(n,r,a),c=new Uint8Array(s),d=btoa(String.fromCharCode.apply(String,(0,dt.default)(c))),u=btoa(String.fromCharCode.apply(String,(0,dt.default)(o))),f=btoa(String.fromCharCode.apply(String,(0,dt.default)(a))),g=btoa(String.fromCharCode.apply(String,(0,dt.default)(l)));return E.info("Content encrypted successfully"),{encryptedContent:d,iv:u,wrappedKey:g,wrapIv:f,algorithm:e.ALGORITHM}}catch(y){throw E.error("Encryption failed:",y),new Error("Failed to encrypt content")}}));return function(e){return t.apply(this,arguments)}}()},{key:"decryptContent",value:function(){var t=(0,n.default)((function*(t,r,n,o){if(!this.isWebCryptoAvailable())throw new Error("Decryption not available on this platform");try{var a,i=new Uint8Array(atob(t).split("").map((function(e){return e.charCodeAt(0)}))),s=new Uint8Array(atob(r).split("").map((function(e){return e.charCodeAt(0)})));a=o?new Uint8Array(atob(o).split("").map((function(e){return e.charCodeAt(0)}))):yield this.getUserSalt();var l=yield this.deriveKeyFromSecret({userSecret:n,salt:a}),c=yield crypto.subtle.decrypt({name:e.ALGORITHM,iv:s},l,i),d=(new TextDecoder).decode(c);return E.info("Content decrypted successfully"),d}catch(u){throw E.error("Decryption failed:",u),new Error("Failed to decrypt content - invalid key or corrupted data")}}));return function(e,r,n,o){return t.apply(this,arguments)}}()},{key:"verifyUserSecret",value:function(){var e=(0,n.default)((function*(e,t,r,n){try{return yield this.decryptContent(e,t,r,n),!0}catch(o){return!1}}));return function(t,r,n,o){return e.apply(this,arguments)}}()},{key:"clearEncryptionData",value:function(){var t=(0,n.default)((function*(){try{"web"===k.default.OS?(localStorage.removeItem(e.USER_SALT_KEY),localStorage.removeItem(e.KEY_DERIVATION_PARAMS_KEY)):(yield x.default.removeItem(e.USER_SALT_KEY),yield x.default.removeItem(e.KEY_DERIVATION_PARAMS_KEY)),E.info("Encryption data cleared")}catch(t){E.error("Failed to clear encryption data:",t)}}));return function(){return t.apply(this,arguments)}}()},{key:"generateRandomSecret",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*",r=crypto.getRandomValues(new Uint8Array(e));return Array.from(r).map((function(e){return t[e%70]})).join("")}},{key:"testEncryption",value:function(){var e=(0,n.default)((function*(){try{var e="This is a test message for encryption verification",t="test-user-secret-phrase-123",r=yield this.encryptContent(e,t),n=(yield this.decryptContent(r.encryptedContent,r.iv,t,r.salt))===e;return E.info("Encryption test:",n?"PASSED":"FAILED"),n}catch(o){return E.error("Encryption test failed:",o),!1}}));return function(){return e.apply(this,arguments)}}()}])}();yt.ALGORITHM="AES-GCM",yt.KEY_LENGTH=256,yt.IV_LENGTH=12,yt.SALT_LENGTH=32,yt.DEFAULT_ITERATIONS=1e5,yt.MASTER_INFO="UserMasterKey",yt.USER_SALT_KEY="user_encryption_salt",yt.KEY_DERIVATION_PARAMS_KEY="key_derivation_params";var pt=new yt;const ht=pt;var mt=(0,d.createContext)(void 0),vt=function(e){var t=e.children,r=(0,d.useState)(!1),a=(0,o.default)(r,2),i=a[0],s=a[1],l=(0,d.useState)(!0),c=(0,o.default)(l,2),u=c[0],f=c[1],g=(0,d.useState)(!1),y=(0,o.default)(g,2),p=y[0],h=y[1],m=(0,d.useState)(null),v=(0,o.default)(m,2),b=v[0],S=v[1],w=(0,d.useState)(2),j=(0,o.default)(w,2),C=j[0],k=j[1],T=(0,d.useState)(null),O=(0,o.default)(T,2),F=O[0],I=O[1],A=(0,d.useState)(null),P=(0,o.default)(A,2),R=P[0],D=P[1],z="hidden_mode_setup_completed",B="hidden_mode_verification",_="hidden_mode_session_timeout",L=(0,d.useCallback)((0,n.default)((function*(){try{var e=yield x.default.getItem(z),t=yield x.default.getItem(B);f(!("true"===e&&t));var r=yield x.default.getItem(_);r&&k(parseInt(r,10))}catch(n){E.error("Failed to check hidden mode setup status:",n),f(!0)}})),[]),N=(0,d.useCallback)(function(){var e=(0,n.default)((function*(e){try{if(!e||e.length<8)throw new Error("Secret must be at least 8 characters long");if(!(yield ht.testEncryption()))throw new Error("Encryption test failed - device may not support required security features");var t=yield ht.encryptContent("HIDDEN_MODE_VERIFICATION_SUCCESS",e);yield x.default.setItem(z,"true"),yield x.default.setItem(B,JSON.stringify(t)),f(!1),S(e),h(!0),s(!0),U(),E.info("Hidden mode setup completed successfully")}catch(r){throw E.error("Hidden mode setup failed:",r),r}}));return function(t){return e.apply(this,arguments)}}(),[]),M=(0,d.useCallback)(function(){var e=(0,n.default)((function*(e){try{if(!e)return!1;var t=yield x.default.getItem(B);if(!t)return E.error("No verification data found - hidden mode not set up"),!1;var r=JSON.parse(t);return"HIDDEN_MODE_VERIFICATION_SUCCESS"===(yield ht.decryptContent(r.encryptedContent,r.iv,e,r.salt))?(S(e),h(!0),s(!0),U(),E.info("Hidden mode unlocked successfully"),!0):(E.warn("Hidden mode unlock failed - incorrect secret"),!1)}catch(n){return E.error("Hidden mode unlock error:",n),!1}}));return function(t){return e.apply(this,arguments)}}(),[]),H=(0,d.useCallback)((function(){S(null),h(!1),s(!1),I(null),R&&(clearTimeout(R),D(null)),E.info("Hidden mode locked")}),[R]),W=(0,d.useCallback)((0,n.default)((function*(){try{yield x.default.removeItem(z),yield x.default.removeItem(B),yield x.default.removeItem(_),yield ht.clearEncryptionData(),H(),f(!0),E.info("Hidden mode data cleared")}catch(e){throw E.error("Failed to clear hidden mode data:",e),e}})),[H]),U=(0,d.useCallback)((function(){R&&clearTimeout(R);var e=Date.now()+60*C*1e3;I(e);var t=setTimeout((function(){E.info("Hidden mode session timed out"),H()}),60*C*1e3);D(t)}),[C,R,H]),V=(0,d.useCallback)((function(){p&&(U(),E.info("Hidden mode session extended"))}),[p,U]),K=(0,d.useCallback)((function(){return F&&p?Math.max(0,Math.floor((F-Date.now())/1e3)):0}),[F,p]),q=(0,d.useCallback)(function(){var e=(0,n.default)((function*(e){k(e);try{yield x.default.setItem(_,e.toString())}catch(t){E.error("Failed to save session timeout preference:",t)}}));return function(t){return e.apply(this,arguments)}}(),[]),Q=(0,d.useCallback)(function(){var e=(0,n.default)((function*(e){if(!b)throw new Error("Hidden mode not unlocked - cannot encrypt");return yield ht.encryptContent(e,b)}));return function(t){return e.apply(this,arguments)}}(),[b]),J=(0,d.useCallback)(function(){var e=(0,n.default)((function*(e,t,r){if(!b)throw new Error("Hidden mode not unlocked - cannot decrypt");return yield ht.decryptContent(e,t,b,r)}));return function(t,r,n){return e.apply(this,arguments)}}(),[b]);(0,d.useEffect)((function(){L()}),[L]),(0,d.useEffect)((function(){return function(){R&&clearTimeout(R)}}),[R]);var Y={isHiddenMode:i,isSetupRequired:u,isUnlocked:p,setupHiddenMode:N,unlockHiddenMode:M,lockHiddenMode:H,clearHiddenMode:W,encryptContent:Q,decryptContent:J,sessionTimeoutMinutes:C,setSessionTimeout:q,extendSession:V,getRemainingSessionTime:K};return(0,G.jsx)(mt.Provider,{value:Y,children:t})},bt=function(){var e=(0,d.useContext)(mt);if(!e)throw new Error("useHiddenMode must be used within a HiddenModeProvider");return e};var xt=r(2996),St=r(3583);function wt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function jt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?wt(Object(r),!0).forEach((function(t){(0,b.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):wt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Ct="web"!==k.default.OS,kt=function(e){return v.default.create({container:jt(jt({backgroundColor:e.colors.card,borderRadius:e.borderRadius.xl,padding:e.spacing.lg,marginVertical:e.spacing.sm,marginHorizontal:e.spacing.xs},e.shadows.md),{},{borderColor:e.colors.borderLight,borderWidth:e.isDarkMode?1:0,overflow:"hidden"}),pressed:{backgroundColor:e.isDarkMode?e.colors.gray800:e.colors.gray100},header:{flexDirection:"row",justifyContent:"space-between",alignItems:"flex-start",marginBottom:e.spacing.md},dateContainer:{flex:1},date:{fontSize:e.typography.fontSizes.sm,color:e.colors.textSecondary,fontFamily:e.typography.fontFamilies.medium,marginBottom:e.spacing.xs/2},time:{fontSize:e.typography.fontSizes.xs,color:e.colors.textDisabled,fontFamily:e.typography.fontFamilies.regular},audioIndicator:{backgroundColor:e.colors.accentLight,borderRadius:e.borderRadius.full,padding:e.spacing.sm,marginLeft:e.spacing.md},title:{fontSize:e.typography.fontSizes.xl,fontWeight:"600",color:e.colors.text,marginBottom:e.spacing.md,fontFamily:e.typography.fontFamilies.semiBold,lineHeight:e.typography.lineHeights.tight*e.typography.fontSizes.xl},content:{fontSize:e.typography.fontSizes.md,color:e.colors.textSecondary,marginBottom:e.spacing.lg,lineHeight:e.typography.lineHeights.normal*e.typography.fontSizes.md,fontFamily:e.typography.fontFamilies.regular},tagsContainer:{flexDirection:"row",flexWrap:"wrap",marginBottom:e.spacing.sm},tag:{backgroundColor:e.isDarkMode?e.colors.gray700:e.colors.primaryLight+"20",borderRadius:e.borderRadius.full,paddingHorizontal:e.spacing.md,paddingVertical:e.spacing.sm,marginRight:e.spacing.sm,marginBottom:e.spacing.sm,borderWidth:1,borderColor:e.isDarkMode?e.colors.gray600:e.colors.primaryLight+"40"},tagText:{fontSize:e.typography.fontSizes.xs,color:e.isDarkMode?e.colors.text:e.colors.primary,fontFamily:e.typography.fontFamilies.medium,fontWeight:"500"},moreTagsIndicator:{backgroundColor:e.colors.gray300,borderRadius:e.borderRadius.full,paddingHorizontal:e.spacing.md,paddingVertical:e.spacing.sm,marginRight:e.spacing.sm,marginBottom:e.spacing.sm},moreTagsText:{fontSize:e.typography.fontSizes.xs,color:e.colors.textSecondary,fontFamily:e.typography.fontFamilies.medium},accentLine:{position:"absolute",bottom:0,left:0,right:0,height:3,backgroundColor:e.colors.primary,borderBottomLeftRadius:e.borderRadius.xl,borderBottomRightRadius:e.borderRadius.xl}})};const Tt=function(e){var t=e.entry,r=e.onPress,n=e.style,a=me().theme,i=kt(a),s=(0,d.useState)(!1),l=(0,o.default)(s,2),c=l[0],u=l[1],f=(0,d.useRef)(new Ge.default.Value(1)).current,g=(0,gt.default)("string"===typeof t.entry_date?(0,St.default)(t.entry_date):t.entry_date,"MMM dd, yyyy"),y=(0,gt.default)("string"===typeof t.entry_date?(0,St.default)(t.entry_date):t.entry_date,"h:mm a"),p={transform:[{scale:f}],opacity:f.interpolate({inputRange:[.98,1],outputRange:[.8,1]})};return(0,G.jsx)(Ge.default.View,{style:[p,n],children:(0,G.jsxs)(xt.default,{style:[i.container,c&&i.pressed],onPress:function(){r&&r(t)},onPressIn:function(){u(!0),Ge.default.spring(f,{toValue:.98,useNativeDriver:Ct,tension:100,friction:3}).start()},onPressOut:function(){u(!1),Ge.default.spring(f,{toValue:1,useNativeDriver:Ct,tension:100,friction:3}).start()},testID:"journal-card",children:[(0,G.jsxs)(h.default,{style:i.header,children:[(0,G.jsxs)(h.default,{style:i.dateContainer,children:[(0,G.jsx)(m.default,{style:i.date,testID:"journal-date",children:g}),(0,G.jsx)(m.default,{style:i.time,children:y})]}),t.audio_url&&(0,G.jsx)(h.default,{style:i.audioIndicator,children:(0,G.jsx)(ae.default,{name:"musical-notes",size:18,color:a.colors.accent})})]}),t.title&&(0,G.jsx)(m.default,{style:i.title,testID:"journal-title",numberOfLines:2,children:t.title}),(0,G.jsx)(m.default,{style:i.content,numberOfLines:3,testID:"journal-content",children:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:120;return e?e.length<=t?e:e.substring(0,t)+"...":"No content"}(t.content)}),t.tags&&t.tags.length>0&&(0,G.jsxs)(h.default,{style:i.tagsContainer,testID:"tags-container",children:[t.tags.slice(0,3).map((function(e,r){var n;return(0,G.jsx)(h.default,{style:i.tag,testID:"tag-"+(null!=(n=e.id)?n:r),children:(0,G.jsx)(m.default,{style:i.tagText,children:e.name})},t.id+"-tag-"+(e.id||r)+"-"+e.name)})),t.tags.length>3&&(0,G.jsx)(h.default,{style:i.moreTagsIndicator,children:(0,G.jsxs)(m.default,{style:i.moreTagsText,children:["+",t.tags.length-3]})},t.id+"-more-tags")]}),(0,G.jsx)(h.default,{style:i.accentLine})]})})};var Et=function(e){return v.default.create({header:{backgroundColor:e.colors.card,paddingHorizontal:e.spacing.lg,paddingVertical:e.spacing.lg,borderBottomWidth:1,borderBottomColor:e.colors.border,alignItems:"center"},title:{fontSize:e.typography.fontSizes.xl,fontWeight:"bold",color:e.colors.text,fontFamily:e.typography.fontFamilies.bold},secretTagIndicator:{flexDirection:"row",alignItems:"center",marginTop:e.spacing.xs,paddingHorizontal:e.spacing.sm,paddingVertical:e.spacing.xs,backgroundColor:e.colors.primaryLight||e.colors.primary+"20",borderRadius:12},secretTagText:{fontSize:e.typography.fontSizes.xs,color:e.colors.primary,marginLeft:e.spacing.xs,fontFamily:e.typography.fontFamilies.medium}})};const Ot=function(e){var t=e.title,r=e.showSecretTagIndicator,n=void 0!==r&&r,o=e.secretTagText,a=void 0===o?"Secret Tags Active":o,i=me().theme,s=Et(i);return(0,G.jsxs)(h.default,{style:s.header,children:[(0,G.jsx)(m.default,{style:s.title,children:t}),n&&(0,G.jsxs)(h.default,{style:s.secretTagIndicator,children:[(0,G.jsx)(ae.default,{name:"shield-checkmark",size:16,color:i.colors.primary}),(0,G.jsx)(m.default,{style:s.secretTagText,children:a})]})]})};var Ft={morning:["Good morning, {userName} \ud83c\udf05","{userName}, let's start fresh \u2728","What are you hoping for today, {userName}? \ud83c\udf31","{userName}, the day is yours \u2014 what's on your mind? \u2600\ufe0f","Morning clarity, {userName} \ud83e\uddd8","Ready to capture today's thoughts, {userName}? \ud83d\udcdd","Rise and shine, {userName} \ud83c\udf1e","{userName}, what dreams are you chasing today? \ud83d\udcab","Morning energy is calling, {userName} \ud83d\udd25","{userName}, ready to make today count? \ud83d\udcaa","New day, fresh perspective, {userName} \ud83c\udf3f","What's inspiring you this morning, {userName}? \ud83d\udca1","{userName}, time to bloom \ud83c\udf3a","Morning motivation time, {userName} \u26a1","Seize the morning, {userName} \ud83c\udfc6","{userName}, what story will today tell? \ud83d\udcda","Morning energy is strong, {userName} \ud83c\udfb5","Ready for today's adventure, {userName}? \ud83d\uddfa\ufe0f"],afternoon:["Good afternoon, {userName} \u2600\ufe0f","How's your day going, {userName}? \ud83e\udd14","{userName}, got something to reflect on? \ud83d\udcad","Midday pause \u2014 want to journal something, {userName}? \u23f8\ufe0f","Perfect time for reflection, {userName} \ud83c\udfaf","What's been on your mind today, {userName}? \ud83e\udde0","{userName}, time for a mental check-in \ud83d\udcca","How are you feeling right now, {userName}? \ud83d\udc9d","{userName}, ready to process some thoughts? \ud83d\udd04","What's working well today, {userName}? \u2705","{userName}, any insights to capture? \ud83c\udfa8","Taking a moment to breathe, {userName}? \ud83e\udec1","What's your energy like today, {userName}? \u26a1","{userName}, time to organize your thoughts? \ud83d\udccb","Any breakthroughs to record, {userName}? \ud83d\ude80","{userName}, how's your heart feeling? \u2764\ufe0f","Ready to dive deeper, {userName}? \ud83c\udfca","What patterns are you noticing, {userName}? \ud83d\udd0d"],evening:["Good evening, {userName} \ud83c\udf06","Evening is perfect for reflection, {userName} \ud83c\udf19","What stood out today, {userName}? \u2b50","Unwind your thoughts, {userName} \ud83d\udecb\ufe0f","{userName}, time to process the day \ud83d\udcd6","Evening reflections, {userName}? \ud83c\udf38","Ready to wind down, {userName}? \ud83d\udd6f\ufe0f","What are you grateful for today, {userName}? \ud83d\ude4f","{userName}, time to let go of today's stress \ud83c\udf0a","Any lessons from today, {userName}? \ud83c\udf93","How did today shape you, {userName}? \ud83c\udffa","{userName}, ready for some evening clarity? \ud83d\udd2e","What emotions need attention, {userName}? \ud83c\udfad","{userName}, time to celebrate today's wins? \ud83c\udf89","Any worries to release, {userName}? \ud83d\udd4a\ufe0f","What's your heart telling you, {userName}? \ud83d\udc96","Ready to make peace with today, {userName}? \u262e\ufe0f","{userName}, time for gentle self-reflection? \ud83e\ude9e"],nightOwl:["Up late, {userName}? \ud83c\udf19","Night thoughts can be powerful, {userName} \ud83d\udcab","{userName}, let's capture what's on your mind \ud83c\udf0c","Rest easier \u2014 journal it out, {userName} \ud83d\ude34","Late night insights, {userName} \ud83e\udd89","Sometimes the best thoughts come at night, {userName} \u2728","What's keeping you up, {userName}? \ud83e\udd2f","{userName}, midnight reflections calling? \ud83d\udd5b","Ready to quiet the mind, {userName}? \ud83e\uddd8\u200d\u2640\ufe0f","Any deep thoughts to explore, {userName}? \ud83c\udf0a","{userName}, night time, right time for journaling? \ud83d\udcdd","What's your soul whispering, {userName}? \ud83d\udc7b","{userName}, ready to release today's thoughts? \ud83c\udf88","Any dreams to document, {userName}? \ud83d\udca4","{userName}, late night wisdom session? \ud83e\uddd9\u200d\u2642\ufe0f","What's stirring in your heart, {userName}? \ud83c\udf2a\ufe0f","{userName}, time to empty the mental jar? \ud83e\uded9","Ready for some nocturnal therapy, {userName}? \ud83c\udf03"]},It=function(e){return e.MORNING="morning",e.AFTERNOON="afternoon",e.EVENING="evening",e.NIGHT_OWL="nightOwl",e}(It||{});function At(){var e=(new Date).getHours();return e>=5&&e<12?It.MORNING:e>=12&&e<18?It.AFTERNOON:e>=18&&e<23?It.EVENING:It.NIGHT_OWL}function Pt(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"there",t=At(),r=Ft[t],n=function(e,t){for(var r=(new Date).toDateString()+t,n=0,o=0;o<r.length;o++)n=(n<<5)-n+r.charCodeAt(o),n|=0;return Math.abs(n)%e}(r.length,t);return{mainGreeting:r[n].replace("{userName}",e)}}var Rt=function(e){return v.default.create({container:{flex:1,backgroundColor:e.colors.background},scrollContainer:{flex:1},loadingContainer:{flex:1,justifyContent:"center",alignItems:"center",backgroundColor:e.colors.background},greetingContainer:{paddingHorizontal:e.spacing.lg,paddingTop:e.spacing.md,paddingBottom:e.spacing.lg},greetingCard:{backgroundColor:e.colors.card,borderRadius:e.borderRadius.xl,padding:e.spacing.lg,elevation:e.isDarkMode?1:2,shadowColor:e.colors.shadow,shadowOffset:{width:0,height:e.isDarkMode?1:2},shadowOpacity:e.isDarkMode?.15:.08,shadowRadius:e.isDarkMode?2:4,borderColor:e.isDarkMode?e.colors.border:"transparent",borderWidth:e.isDarkMode?1:0},greetingContent:{alignItems:"flex-start"},greeting:{fontSize:e.typography.fontSizes.xl,fontWeight:"600",color:e.colors.text,fontFamily:e.typography.fontFamilies.semiBold,lineHeight:e.typography.lineHeights.tight*e.typography.fontSizes.xl},date:{fontSize:e.typography.fontSizes.lg,color:e.colors.textSecondary,marginTop:e.spacing.sm,fontFamily:e.typography.fontFamilies.regular,lineHeight:e.typography.lineHeights.normal*e.typography.fontSizes.lg},statsContainer:{flexDirection:"row",justifyContent:"center",alignItems:"center",paddingHorizontal:e.spacing.lg,paddingVertical:e.spacing.lg,gap:e.spacing.md},statCard:{backgroundColor:e.colors.card,borderRadius:12,padding:e.spacing.lg,alignItems:"center",width:"30%",elevation:e.isDarkMode?2:3,shadowColor:e.colors.black,shadowOffset:{width:0,height:e.isDarkMode?2:3},shadowOpacity:e.isDarkMode?.2:.08,shadowRadius:e.isDarkMode?3:4,borderColor:e.isDarkMode?e.colors.border:"transparent",borderWidth:e.isDarkMode?1:0},streakCard:{backgroundColor:e.isDarkMode?e.colors.card:"#FFF8F5",borderColor:e.isDarkMode?e.colors.border:"#FFE5D9",borderWidth:1},statIcon:{marginBottom:e.spacing.sm},statValue:{fontSize:e.typography.fontSizes.xxl,fontWeight:"bold",color:e.colors.primary,fontFamily:e.typography.fontFamilies.bold,marginBottom:e.spacing.xs},streakValue:{color:"#FF6B35"},weekValue:{color:e.colors.secondary},statLabel:{fontSize:e.typography.fontSizes.xs,color:e.colors.textSecondary,fontFamily:e.typography.fontFamilies.medium,textAlign:"center",height:16,lineHeight:16},sectionHeader:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",paddingHorizontal:e.spacing.lg,paddingTop:e.spacing.lg,paddingBottom:e.spacing.sm},sectionTitle:{fontSize:e.typography.fontSizes.xl,fontWeight:"bold",color:e.colors.text,fontFamily:e.typography.fontFamilies.bold},seeAllText:{fontSize:e.typography.fontSizes.md,color:e.colors.primary,fontFamily:e.typography.fontFamilies.semiBold},emptyContainer:{flex:1,justifyContent:"center",alignItems:"center",padding:e.spacing.lg,marginTop:e.spacing.xxl},emptyText:{fontSize:e.typography.fontSizes.md,color:e.colors.textSecondary,marginTop:e.spacing.md,marginBottom:e.spacing.lg,fontFamily:e.typography.fontFamilies.regular},startButton:{backgroundColor:e.colors.primary,paddingVertical:e.spacing.md,paddingHorizontal:e.spacing.xl,borderRadius:25,marginTop:e.spacing.md},startButtonText:{color:e.isDarkMode?e.colors.background:e.colors.white,fontSize:e.typography.fontSizes.md,fontWeight:"bold",fontFamily:e.typography.fontFamilies.bold},vibeContainer:{paddingHorizontal:e.spacing.lg,paddingVertical:e.spacing.lg},vibeTitle:{fontSize:e.typography.fontSizes.xl,fontWeight:"bold",color:e.colors.text,fontFamily:e.typography.fontFamilies.bold,marginBottom:e.spacing.md,textAlign:"center"},vibeButtonsContainer:{flexDirection:"row",justifyContent:"space-between",alignItems:"center"},vibeButton:{backgroundColor:e.colors.card,borderRadius:12,padding:e.spacing.md,alignItems:"center",justifyContent:"center",width:"18%",elevation:e.isDarkMode?1:2,shadowColor:e.colors.shadow,shadowOffset:{width:0,height:e.isDarkMode?1:2},shadowOpacity:e.isDarkMode?.15:.08,shadowRadius:e.isDarkMode?2:3,borderColor:e.isDarkMode?e.colors.border:"transparent",borderWidth:e.isDarkMode?1:0},vibeIcon:{marginBottom:e.spacing.xs},vibeLabel:{fontSize:e.typography.fontSizes.xs,color:e.colors.textSecondary,fontFamily:e.typography.fontFamilies.medium,textAlign:"center"}})};const Dt=function(){var e=(0,oe.useNavigation)(),t=$().user,r=me().theme,a=bt().isHiddenMode,i=Rt(r),s=(0,d.useState)([]),l=(0,o.default)(s,2),c=l[0],u=l[1],f=(0,d.useState)({totalEntries:0,currentStreak:0,entriesThisWeek:0}),g=(0,o.default)(f,2),y=g[0],p=g[1],v=(0,d.useState)(!0),b=(0,o.default)(v,2),x=b[0],S=b[1],w=(0,d.useState)(!1),j=(0,o.default)(w,2),C=j[0],E=j[1],O=(0,d.useMemo)((function(){return Pt(null!=t&&t.full_name?t.full_name.split(" ")[0]:"there")}),[null==t?void 0:t.full_name]),F=(0,d.useMemo)((function(){return a?c:c.filter((function(e){return!e.tags.some((function(e){return"_hidden_entry"===e.name}))}))}),[c,a]);(0,oe.useFocusEffect)(d.useCallback((function(){A()}),[])),(0,d.useEffect)((function(){if(c.length>0){var e=c.map((function(e){return e.id})),t=(0,dt.default)(new Set(e));e.length!==t.length&&T.warn("HomeScreen: Duplicate entry IDs detected!",{ids:e,uniqueIds:t})}}),[c]),(0,d.useEffect)((function(){if(F.length>0){var e=F.map((function(e){return e.id})),t=(0,dt.default)(new Set(e));e.length!==t.length&&T.warn("HomeScreen: Duplicate displayed entry IDs detected!",{displayedIds:e,uniqueDisplayedIds:t})}}),[F]);var A=function(){var e=(0,n.default)((function*(){try{S(!0);var e=yield I.get("/api/users/me/stats");p({totalEntries:e.data.total_entries,currentStreak:e.data.current_streak,entriesThisWeek:e.data.entries_this_week});var t=yield I.get("/api/journals/",{params:{limit:1,sort:"entry_date:desc"}});u(t.data)}catch(o){var r,n;T.error("HomeScreen: Error fetching home data",{message:o.message,status:null==(r=o.response)?void 0:r.status,data:null==(n=o.response)?void 0:n.data}),ft.default.alert("Error","Failed to load your data")}finally{S(!1),E(!1)}}));return function(){return e.apply(this,arguments)}}(),P=function(t,r){var n={grateful:"What are you thankful for?",reflect:"What's been on your mind?",inspired:"Capture that idea before it fades!",stressed:"Want to unload what's weighing you down?",plan:"What's your next step or goal?"}[t];e.navigate("Record",{vibeEmoji:t,vibeTag:r,prefilledPrompt:n})};return x&&!C?(0,G.jsx)(h.default,{style:i.loadingContainer,children:(0,G.jsx)(te.default,{size:"large",color:r.colors.primary,testID:"loading-indicator"})}):(0,G.jsxs)(h.default,{style:i.container,children:[(0,G.jsx)(Ot,{title:"Home"}),(0,G.jsxs)(Ce,{style:i.scrollContainer,refreshControl:"web"!==k.default.OS?(0,G.jsx)(ut.default,{refreshing:C,onRefresh:function(){E(!0),A()},colors:[r.colors.primary],tintColor:r.colors.primary}):void 0,children:[(0,G.jsx)(h.default,{style:i.greetingContainer,children:(0,G.jsx)(h.default,{style:i.greetingCard,children:(0,G.jsxs)(h.default,{style:i.greetingContent,children:[(0,G.jsx)(m.default,{style:i.greeting,children:O.mainGreeting}),(0,G.jsx)(m.default,{style:i.date,children:(0,gt.default)(new Date,"EEEE, MMMM d")})]})})}),(0,G.jsxs)(h.default,{style:i.statsContainer,children:[(0,G.jsxs)(h.default,{style:i.statCard,children:[(0,G.jsx)(ae.default,{name:"book",size:24,color:r.colors.primary,style:i.statIcon}),(0,G.jsx)(m.default,{style:i.statValue,children:y.totalEntries}),(0,G.jsx)(m.default,{style:i.statLabel,children:"Entries"})]}),(0,G.jsxs)(h.default,{style:[i.statCard,i.streakCard],children:[(0,G.jsx)(ae.default,{name:"flame",size:24,color:"#FF6B35",style:i.statIcon}),(0,G.jsx)(m.default,{style:[i.statValue,i.streakValue],children:y.currentStreak}),(0,G.jsx)(m.default,{style:i.statLabel,children:"Streak"})]}),(0,G.jsxs)(h.default,{style:i.statCard,children:[(0,G.jsx)(ae.default,{name:"calendar",size:24,color:r.colors.secondary,style:i.statIcon}),(0,G.jsx)(m.default,{style:[i.statValue,i.weekValue],children:y.entriesThisWeek}),(0,G.jsx)(m.default,{style:i.statLabel,children:"Week"})]})]}),(0,G.jsxs)(h.default,{style:i.vibeContainer,children:[(0,G.jsx)(m.default,{style:i.vibeTitle,children:"Your Current Vibe \ud83d\udcab"}),(0,G.jsxs)(h.default,{style:i.vibeButtonsContainer,children:[(0,G.jsxs)(ne.default,{style:i.vibeButton,onPress:function(){return P("grateful","gratitude")},activeOpacity:.7,children:[(0,G.jsx)(ae.default,{name:"heart-outline",size:24,color:"#B39DFF",style:i.vibeIcon}),(0,G.jsx)(m.default,{style:i.vibeLabel,children:"Grateful"})]}),(0,G.jsxs)(ne.default,{style:i.vibeButton,onPress:function(){return P("reflect","reflection")},activeOpacity:.7,children:[(0,G.jsx)(ae.default,{name:"book-outline",size:24,color:"#6E7CFF",style:i.vibeIcon}),(0,G.jsx)(m.default,{style:i.vibeLabel,children:"Reflective"})]}),(0,G.jsxs)(ne.default,{style:i.vibeButton,onPress:function(){return P("inspired","idea")},activeOpacity:.7,children:[(0,G.jsx)(ae.default,{name:"bulb-outline",size:24,color:"#FFD966",style:i.vibeIcon}),(0,G.jsx)(m.default,{style:i.vibeLabel,children:"Inspired"})]}),(0,G.jsxs)(ne.default,{style:i.vibeButton,onPress:function(){return P("stressed","stress")},activeOpacity:.7,children:[(0,G.jsx)(ae.default,{name:"rainy-outline",size:24,color:"#8CBFFF",style:i.vibeIcon}),(0,G.jsx)(m.default,{style:i.vibeLabel,children:"Stressed"})]}),(0,G.jsxs)(ne.default,{style:i.vibeButton,onPress:function(){return P("plan","plan")},activeOpacity:.7,children:[(0,G.jsx)(ae.default,{name:"radio-button-on-outline",size:24,color:"#51C1C1",style:i.vibeIcon}),(0,G.jsx)(m.default,{style:i.vibeLabel,children:"Planning"})]})]})]}),(0,G.jsxs)(h.default,{style:i.sectionHeader,children:[(0,G.jsx)(m.default,{style:i.sectionTitle,children:"Last Entry"}),(0,G.jsx)(ne.default,{onPress:function(){e.navigate("Journal",{screen:"JournalList"})},children:(0,G.jsx)(m.default,{style:i.seeAllText,children:"See All"})})]}),F.length>0?(0,G.jsx)(Tt,{entry:F[0],onPress:function(){return t=F[0].id,void e.navigate("JournalEntryDetail",{entryId:t.toString()});var t}},"home-entry-"+F[0].id):(0,G.jsxs)(h.default,{style:i.emptyContainer,children:[(0,G.jsx)(ae.default,{name:"book-outline",size:r.spacing.xxl,color:r.colors.disabled}),(0,G.jsx)(m.default,{style:i.emptyText,children:"No journal entries yet"}),(0,G.jsx)(ne.default,{style:i.startButton,onPress:function(){e.navigate("Record")},children:(0,G.jsx)(m.default,{style:i.startButtonText,children:"Start Journaling"})})]})]})]})};var zt=r(6725),Bt=function(e){var t=e.width,r=void 0===t?"100%":t,n=e.height,o=void 0===n?20:n,a=e.borderRadius,i=void 0===a?4:a,s=e.style,l=e.animated,c=void 0===l||l,u=me().theme,f=Mt(u),g=(0,d.useRef)(new Ge.default.Value(0)).current;(0,d.useEffect)((function(){if(c){var e=Ge.default.loop(Ge.default.sequence([Ge.default.timing(g,{toValue:1,duration:1e3,useNativeDriver:!1}),Ge.default.timing(g,{toValue:0,duration:1e3,useNativeDriver:!1})]));return e.start(),function(){return e.stop()}}}),[c,g]);var y=c?g.interpolate({inputRange:[0,1],outputRange:[u.colors.skeleton||u.colors.gray200,u.colors.skeletonHighlight||u.colors.gray300]}):u.colors.skeleton||u.colors.gray200;return(0,G.jsx)(Ge.default.View,{style:[f.skeleton,{width:r,height:o,borderRadius:i,backgroundColor:y},s]})},_t=function(){var e=me().theme,t=Mt(e);return(0,G.jsxs)(h.default,{style:t.journalCardSkeleton,children:[(0,G.jsxs)(h.default,{style:t.journalCardHeader,children:[(0,G.jsx)(Bt,{width:"60%",height:18}),(0,G.jsx)(Bt,{width:80,height:14})]}),(0,G.jsx)(Bt,{width:"100%",height:16,style:{marginTop:e.spacing.sm}}),(0,G.jsx)(Bt,{width:"85%",height:16,style:{marginTop:e.spacing.xs}}),(0,G.jsx)(Bt,{width:"70%",height:16,style:{marginTop:e.spacing.xs}}),(0,G.jsxs)(h.default,{style:t.journalCardFooter,children:[(0,G.jsx)(Bt,{width:60,height:12}),(0,G.jsx)(Bt,{width:40,height:12})]})]})},Lt=function(){var e=me().theme,t=Mt(e);return(0,G.jsxs)(h.default,{style:t.calendarSkeleton,children:[(0,G.jsxs)(h.default,{style:t.calendarHeader,children:[(0,G.jsx)(Bt,{width:30,height:30,borderRadius:15}),(0,G.jsx)(Bt,{width:120,height:20}),(0,G.jsx)(Bt,{width:30,height:30,borderRadius:15})]}),(0,G.jsx)(h.default,{style:t.calendarGrid,children:Array.from({length:35},(function(e,t){return(0,G.jsx)(Bt,{width:35,height:35,borderRadius:4,style:{margin:2}},t)}))})]})},Nt=function(){var e=me().theme,t=Mt(e);return(0,G.jsx)(h.default,{style:t.settingsSkeleton,children:Array.from({length:6},(function(r,n){return(0,G.jsxs)(h.default,{style:t.settingsRow,children:[(0,G.jsxs)(h.default,{style:t.settingsRowLeft,children:[(0,G.jsx)(Bt,{width:24,height:24,borderRadius:12}),(0,G.jsxs)(h.default,{style:t.settingsRowText,children:[(0,G.jsx)(Bt,{width:"70%",height:16}),(0,G.jsx)(Bt,{width:"50%",height:12,style:{marginTop:e.spacing.xs}})]})]}),(0,G.jsx)(Bt,{width:50,height:20,borderRadius:10})]},n)}))})},Mt=function(e){zt.default.get("window").width;return v.default.create({skeleton:{overflow:"hidden"},journalCardSkeleton:{backgroundColor:e.colors.card,padding:e.spacing.md,marginHorizontal:e.spacing.md,marginVertical:e.spacing.sm,borderRadius:e.spacing.sm,borderWidth:1,borderColor:e.colors.border},journalCardHeader:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",marginBottom:e.spacing.sm},journalCardFooter:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",marginTop:e.spacing.md},calendarSkeleton:{backgroundColor:e.colors.card,padding:e.spacing.md,margin:e.spacing.md,borderRadius:e.spacing.sm},calendarHeader:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",marginBottom:e.spacing.md},calendarGrid:{flexDirection:"row",flexWrap:"wrap",justifyContent:"space-around"},settingsSkeleton:{padding:e.spacing.md},settingsRow:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",paddingVertical:e.spacing.md,borderBottomWidth:1,borderBottomColor:e.colors.border},settingsRowLeft:{flexDirection:"row",alignItems:"center",flex:1},settingsRowText:{marginLeft:e.spacing.md,flex:1}})};var Ht="_hidden_entry",Wt=function(e){return v.default.create({container:{flex:1,backgroundColor:e.colors.background},searchContainer:{paddingHorizontal:e.spacing.md,paddingVertical:e.spacing.sm,backgroundColor:e.colors.card,borderBottomWidth:1,borderBottomColor:e.colors.border},searchBar:{flexDirection:"row",alignItems:"center",backgroundColor:e.colors.inputBackground,borderRadius:e.spacing.sm,paddingHorizontal:e.spacing.sm,borderWidth:1,borderColor:e.colors.border},searchIcon:{marginRight:e.spacing.sm},searchInput:{flex:1,paddingVertical:e.spacing.sm,fontSize:e.typography.fontSizes.md,color:e.colors.text,fontFamily:e.typography.fontFamilies.regular},tagsContainer:{paddingVertical:e.spacing.sm,paddingHorizontal:e.spacing.xs,backgroundColor:e.colors.card,borderBottomWidth:1,borderBottomColor:e.colors.border},tagChip:{paddingVertical:e.spacing.xs,paddingHorizontal:e.spacing.md,borderRadius:e.spacing.lg,borderWidth:1,borderColor:e.colors.border,backgroundColor:e.isDarkMode?e.colors.gray700:e.colors.gray100,marginRight:e.spacing.sm},tagChipSelected:{backgroundColor:e.colors.primary,borderColor:e.colors.primary},tagText:{fontSize:e.typography.fontSizes.sm,color:e.colors.textSecondary,fontFamily:e.typography.fontFamilies.regular},tagTextSelected:{color:e.colors.onPrimary,fontFamily:e.typography.fontFamilies.semiBold},loaderContainer:{flex:1,justifyContent:"center",alignItems:"center",backgroundColor:e.colors.background},skeletonContainer:{flex:1,backgroundColor:e.colors.background,paddingTop:e.spacing.sm},emptyContainer:{flex:1,justifyContent:"center",alignItems:"center",padding:e.spacing.lg},emptyText:{fontSize:e.typography.fontSizes.lg,color:e.colors.textSecondary,marginTop:e.spacing.md,textAlign:"center",fontFamily:e.typography.fontFamilies.semiBold},emptySubtext:{fontSize:e.typography.fontSizes.sm,color:e.colors.textSecondary,marginTop:e.spacing.sm,textAlign:"center",paddingHorizontal:e.spacing.xl,fontFamily:e.typography.fontFamilies.regular},listContent:{paddingBottom:e.spacing.lg},monthSection:{marginBottom:e.spacing.md},monthTitle:{fontSize:e.typography.fontSizes.lg,fontWeight:"bold",color:e.colors.text,paddingHorizontal:e.spacing.lg,paddingVertical:e.spacing.sm,backgroundColor:e.isDarkMode?e.colors.gray800:e.colors.gray100,fontFamily:e.typography.fontFamilies.bold},safeBottomPadding:{paddingTop:e.spacing.lg,paddingBottom:"ios"===k.default.OS?200:185},scrollToTopButton:{position:"absolute",bottom:"ios"===k.default.OS?120:105,right:e.spacing.lg,width:48,height:48,borderRadius:24,backgroundColor:e.colors.primary,justifyContent:"center",alignItems:"center",elevation:8,shadowColor:e.colors.shadow,shadowOffset:{width:0,height:4},shadowOpacity:.3,shadowRadius:8,zIndex:1e3}})};const Ut=function(){var e=(0,oe.useNavigation)(),t=me().theme,r=bt().isHiddenMode,a=Wt(t),i=(0,d.useState)([]),s=(0,o.default)(i,2),l=s[0],c=s[1],u=(0,d.useState)([]),f=(0,o.default)(u,2),g=f[0],y=f[1],p=(0,d.useState)(!0),v=(0,o.default)(p,2),b=v[0],x=v[1],S=(0,d.useState)(!1),w=(0,o.default)(S,2),j=w[0],C=w[1],k=(0,d.useState)(""),T=(0,o.default)(k,2),E=T[0],O=T[1],F=(0,d.useState)([]),I=(0,o.default)(F,2),A=I[0],R=I[1],z=(0,d.useState)([]),B=(0,o.default)(z,2),_=B[0],L=B[1],N=(0,d.useRef)(null),M=(0,d.useRef)({offset:0}),H=(0,d.useRef)(!1),W=(0,d.useCallback)((function(){N.current&&(H.current=!0)}),[]),U=function(){var e=(0,n.default)((function*(){try{x(!0);var e=yield P.getEntries({});c(e.data)}catch(t){console.error("Error fetching journal entries",t),ft.default.alert("Error","Failed to load journal entries")}finally{x(!1),C(!1)}}));return function(){return e.apply(this,arguments)}}(),V=function(){var e=(0,n.default)((function*(){try{var e=yield D.getTags();R(e.data.map((function(e){return e.name})))}catch(t){console.error("Error fetching tags",t)}}));return function(){return e.apply(this,arguments)}}(),K=(0,d.useCallback)((function(){if(H.current&&N.current&&g.length>0){var e=setTimeout((function(){try{var e;if(M.current.offset>0)null==(e=N.current)||e.scrollTo({y:M.current.offset,animated:!1});H.current=!1}catch(t){console.log("Failed to restore scroll position:",t),H.current=!1}}),100);return function(){return clearTimeout(e)}}}),[g]);(0,oe.useFocusEffect)((0,d.useCallback)((function(){var e=setTimeout((function(){U(),V()}),500);return function(){clearTimeout(e),W()}}),[])),(0,d.useEffect)((function(){q()}),[E,_,l,r]),(0,d.useEffect)((function(){K()}),[K]);var q=function(){var e=(0,dt.default)(l);if(E.trim()){var t=E.toLowerCase();e=e.filter((function(e){return e.title.toLowerCase().includes(t)||e.content.toLowerCase().includes(t)}))}_.length>0&&(e=e.filter((function(e){return _.every((function(t){return e.tags.some((function(e){return e.name===t}))}))}))),r||(e=e.filter((function(e){return!e.tags.some((function(e){return e.name===Ht}))}))),y(e)},Q=(0,d.useState)(!1),J=(0,o.default)(Q,2),Y=J[0],Z=J[1],X=(0,d.useCallback)((function(e){var t=e.nativeEvent.contentOffset;M.current.offset=t.y,Z(t.y>200)}),[]),$=(0,d.useCallback)((function(){N.current&&N.current.scrollTo({y:0,animated:!0})}),[]);return(0,G.jsxs)(h.default,{style:a.container,children:[(0,G.jsx)(Ot,{title:"Journal"}),(0,G.jsx)(h.default,{style:a.searchContainer,children:(0,G.jsxs)(h.default,{style:a.searchBar,children:[(0,G.jsx)(ae.default,{name:"search",size:t.typography.fontSizes.xl,color:t.colors.textSecondary,style:a.searchIcon}),(0,G.jsx)(re.default,{style:a.searchInput,placeholder:"Search entries...",value:E,onChangeText:O,placeholderTextColor:t.colors.textSecondary}),E?(0,G.jsx)(ne.default,{onPress:function(){return O("")},children:(0,G.jsx)(ae.default,{name:"close-circle",size:t.typography.fontSizes.xl,color:t.colors.textSecondary})}):null]})}),A.length>0&&(0,G.jsx)(h.default,{style:a.tagsContainer,children:(0,G.jsx)(be.default,{horizontal:!0,showsHorizontalScrollIndicator:!1,children:A.map((function(e){return(0,G.jsx)(ne.default,{style:[a.tagChip,_.includes(e)&&a.tagChipSelected],onPress:function(){return function(e){_.includes(e)?L(_.filter((function(t){return t!==e}))):L([].concat((0,dt.default)(_),[e]))}(e)},children:(0,G.jsxs)(m.default,{style:[a.tagText,_.includes(e)&&a.tagTextSelected],children:["#",e]})},e)}))})}),(0,G.jsx)(Ce,{style:{flex:1},contentContainerStyle:{flexGrow:1},refreshControl:(0,G.jsx)(ut.default,{refreshing:j,onRefresh:function(){C(!0),U()},colors:[t.colors.primary],tintColor:t.colors.primary}),onScroll:X,scrollEventThrottle:16,children:b?(0,G.jsx)(h.default,{style:a.skeletonContainer,children:Array.from({length:5},(function(e,t){return(0,G.jsx)(_t,{},"skeleton-"+t)}))}):(0,G.jsx)(G.Fragment,{children:0===g.length?(0,G.jsxs)(h.default,{style:a.emptyContainer,children:[(0,G.jsx)(ae.default,{name:"journal-outline",size:1.5*t.spacing.xxl,color:t.colors.disabled}),(0,G.jsx)(m.default,{style:a.emptyText,children:"No journal entries found"}),(0,G.jsx)(m.default,{style:a.emptySubtext,children:E||_.length>0||!r&&l.some((function(e){return e.tags.some((function(e){return e.name===Ht}))}))?"Try changing your search or filters, or check hidden mode.":"Tap the + button to create your first entry"})]}):(0,G.jsx)(G.Fragment,{children:function(){var e={};return g.forEach((function(t){var r=new Date(t.entry_date),n=(0,gt.default)(r,"MMMM yyyy");e[n]||(e[n]=[]),e[n].push(t)})),Object.entries(e).map((function(e){var t=(0,o.default)(e,2);return{title:t[0],data:t[1]}}))}().map((function(t,r){return(0,G.jsxs)(h.default,{style:a.monthSection,children:[(0,G.jsx)(m.default,{style:a.monthTitle,children:t.title}),t.data.map((function(t,r){return(0,G.jsx)(Tt,{entry:t,onPress:function(){return function(t){console.log("Entry pressed:",t.id),e.navigate("JournalEntryDetail",{entryId:t.id.toString()})}(t)}},"journal-entry-"+t.id+"-"+r)}))]},t.title)}))})})}),Y&&(0,G.jsx)(ne.default,{style:a.scrollToTopButton,onPress:$,activeOpacity:.8,children:(0,G.jsx)(ae.default,{name:"chevron-up",size:24,color:t.colors.white})})]})};var Vt=r(1218),Kt=r(1182),qt=r(465),Qt=r(8340),Gt=r(3969),Jt=r(4580);function Yt(e,t,r){return t=(0,l.default)(t),(0,s.default)(e,Zt()?Reflect.construct(t,r||[],(0,l.default)(e).constructor):t.apply(e,r))}function Zt(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Zt=function(){return!!e})()}var Xt=function(e){function t(e,r){var n,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"OPAQUE_ERROR";return(0,a.default)(this,t),(n=Yt(this,t,[e])).name="OpaqueError",n.code=o,n.timestamp=new Date,n.cause=r,Object.setPrototypeOf(n,t.prototype),n}return(0,c.default)(t,e),(0,i.default)(t,[{key:"getSanitizedMessage",value:function(){return this.code+": "+this.message}},{key:"getDebugInfo",value:function(){return{code:this.code,message:this.message,timestamp:this.timestamp.toISOString(),cause:this.cause,stack:this.stack}}}])}((0,r(531).default)(Error)),$t=function(e){function t(e,r){var n;return(0,a.default)(this,t),(n=Yt(this,t,[e,r,"AUTHENTICATION_ERROR"])).name="AuthenticationError",Object.setPrototypeOf(n,t.prototype),n}return(0,c.default)(t,e),(0,i.default)(t)}(Xt),er=function(e){function t(e,r,n){var o;return(0,a.default)(this,t),(o=Yt(this,t,[e,n,"NETWORK_ERROR"])).name="NetworkError",o.statusCode=r,Object.setPrototypeOf(o,t.prototype),o}return(0,c.default)(t,e),(0,i.default)(t)}(Xt);(function(e){function t(e,r){var n;return(0,a.default)(this,t),(n=Yt(this,t,[e,r,"INITIALIZATION_ERROR"])).name="InitializationError",Object.setPrototypeOf(n,t.prototype),n}(0,c.default)(t,e),(0,i.default)(t)})(Xt),function(e){function t(e,r){var n;return(0,a.default)(this,t),(n=Yt(this,t,[e,r,"MEMORY_ERROR"])).name="MemoryError",Object.setPrototypeOf(n,t.prototype),n}(0,c.default)(t,e),(0,i.default)(t)}(Xt),function(e){function t(e,r){var n;return(0,a.default)(this,t),(n=Yt(this,t,[e,r,"KEY_DERIVATION_ERROR"])).name="KeyDerivationError",Object.setPrototypeOf(n,t.prototype),n}(0,c.default)(t,e),(0,i.default)(t)}(Xt),function(e){function t(e,r){var n;return(0,a.default)(this,t),(n=Yt(this,t,[e,r,"SERIALIZATION_ERROR"])).name="SerializationError",Object.setPrototypeOf(n,t.prototype),n}(0,c.default)(t,e),(0,i.default)(t)}(Xt);var tr=(0,i.default)((function e(){(0,a.default)(this,e)}),null,[{key:"register",value:function(e){this.sensitiveData.add(e)}},{key:"clear",value:function(e){this.sensitiveData.has(e)&&(e.fill(0),this.sensitiveData.delete(e))}},{key:"clearAll",value:function(){this.sensitiveData.forEach((function(e){return e.fill(0)})),this.sensitiveData.clear()}}]);tr.sensitiveData=new Set;var rr=function(){function e(){(0,a.default)(this,e),this.isInitialized=!1}return(0,i.default)(e,[{key:"initialize",value:function(){var e=(0,n.default)((function*(){try{"web"===k.default.OS&&(E.info("Waiting for OPAQUE WebAssembly module to load"),yield Jt.ready,E.info("OPAQUE WebAssembly module loaded successfully")),this.isInitialized=!0,E.info("OPAQUE client initialized successfully")}catch(e){throw E.error("Failed to initialize OPAQUE client",e),new Xt("OPAQUE initialization failed",e)}}));return function(){return e.apply(this,arguments)}}()},{key:"startRegistration",value:function(){var e=(0,n.default)((function*(e){this.ensureInitialized();try{E.debug("Starting OPAQUE registration");var t=Jt.client.startRegistration({password:e});if(!t||!t.clientRegistrationState||!t.registrationRequest)throw new Xt("Invalid registration result from OPAQUE library");return E.debug("OPAQUE registration started successfully"),{registrationRequest:t.registrationRequest,clientState:t.clientRegistrationState}}catch(r){if(E.error("OPAQUE registration start failed",r),r instanceof Xt)throw r;throw new Xt("Failed to start OPAQUE registration",r)}}));return function(t){return e.apply(this,arguments)}}()},{key:"finishRegistration",value:function(){var e=(0,n.default)((function*(e,t,r){this.ensureInitialized();try{E.debug("Finishing OPAQUE registration");var n=Jt.client.finishRegistration({password:e,clientRegistrationState:t,registrationResponse:r.registrationResponse});if(!n||!n.registrationUpload||!n.exportKey)throw new Xt("Invalid registration finish result from OPAQUE library");return tr.register(n.exportKey),E.debug("OPAQUE registration finished successfully"),{registrationUpload:n.registrationUpload,exportKey:n.exportKey}}catch(o){if(E.error("OPAQUE registration finish failed",o),o instanceof Xt)throw o;throw new Xt("Failed to finish OPAQUE registration",o)}}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"startLogin",value:function(){var e=(0,n.default)((function*(e){this.ensureInitialized();try{E.debug("Starting OPAQUE login");var t=Jt.client.startLogin({password:e});if(!t||!t.clientLoginState||!t.credentialRequest)throw new Xt("Invalid login result from OPAQUE library");return E.debug("OPAQUE login started successfully"),{credentialRequest:t.credentialRequest,clientState:t.clientLoginState}}catch(r){if(E.error("OPAQUE login start failed",r),r instanceof Xt)throw r;throw new Xt("Failed to start OPAQUE login",r)}}));return function(t){return e.apply(this,arguments)}}()},{key:"finishLogin",value:function(){var e=(0,n.default)((function*(e,t,r){this.ensureInitialized();try{E.debug("Finishing OPAQUE login");var n=Jt.client.finishLogin({password:e,clientLoginState:t,credentialResponse:r.credentialResponse});if(!n||!n.credentialFinalization||!n.sessionKey||!n.exportKey)throw new $t("OPAQUE authentication failed - invalid credentials");return tr.register(n.sessionKey),tr.register(n.exportKey),E.debug("OPAQUE login finished successfully"),{credentialFinalization:n.credentialFinalization,sessionKey:n.sessionKey,exportKey:n.exportKey}}catch(o){if(E.error("OPAQUE login finish failed",o),o instanceof $t)throw o;if(o instanceof Xt)throw o;throw new Xt("Failed to finish OPAQUE login",o)}}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"deriveVaultKeys",value:function(){var e=(0,n.default)((function*(e,t){try{E.debug("Deriving vault keys from export key");var r=yield this.blake2s(t.trim().toLowerCase(),16),n=yield this.hkdf(e,r,"VaultDataKey",32),o=this.bytesToHex(r);return tr.register(r),tr.register(n),E.debug("Vault keys derived successfully"),{tagId:r,dataKey:n,vaultId:o}}catch(a){throw E.error("Failed to derive vault keys",a),new Xt("Vault key derivation failed",a)}}));return function(t,r){return e.apply(this,arguments)}}()},{key:"clearMemory",value:function(){try{tr.clearAll(),E.debug("OPAQUE client memory cleared")}catch(e){E.error("Failed to clear OPAQUE client memory",e)}}},{key:"getInitializationStatus",value:function(){return this.isInitialized}},{key:"ensureInitialized",value:function(){if(!this.isInitialized)throw new Xt("OPAQUE client not initialized. Call initialize() first.")}},{key:"blake2s",value:function(){var e=(0,n.default)((function*(e,t){var r=(new TextEncoder).encode(e),n=yield crypto.subtle.digest("SHA-256",r);return new Uint8Array(n.slice(0,t))}));return function(t,r){return e.apply(this,arguments)}}()},{key:"hkdf",value:function(){var e=(0,n.default)((function*(e,t,r,n){try{var o=yield crypto.subtle.importKey("raw",e,"HKDF",!1,["deriveBits"]),a=(new TextEncoder).encode(r),i=yield crypto.subtle.deriveBits({name:"HKDF",hash:"SHA-256",salt:t,info:a},o,8*n);return new Uint8Array(i)}catch(s){throw new Xt("HKDF derivation failed",s)}}));return function(t,r,n,o){return e.apply(this,arguments)}}()},{key:"bytesToHex",value:function(e){return Array.from(e).map((function(e){return e.toString(16).padStart(2,"0")})).join("")}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}])}(),nr=(rr.getInstance(),function(){function e(){(0,a.default)(this,e),this.activeSessions=new Map,this.sessionTimeouts=new Map,this.SESSION_TIMEOUT_MS=9e5,this.MAX_AUTHENTICATION_TIME_MS=2e3,this.PHRASE_NORMALIZATION_REGEX=/[^a-zA-Z0-9\s]/g,this.opaqueClient=rr.getInstance()}return(0,i.default)(e,[{key:"checkForSecretPhrase",value:function(){var e=(0,n.default)((function*(e){if(null==e||!e.trim())return{found:!1};try{E.info('[VoicePhraseDetector] Checking phrase: "'+e+'"');var t=this.normalizePhrase(e);if(this.isPanicPhrase(t))return E.warn("[VoicePhraseDetector] Panic phrase detected"),yield this.handlePanicMode(),{found:!0,action:"panic"};var r=yield this.authenticateWithOPAQUE(t);if(r.success&&r.tagId){var n=this.isSessionActive(r.tagId)?"deactivate":"activate";return"activate"===n?yield this.createSession(r.tagId,r.tagName,r.sessionKey,r.vaultKey):yield this.deactivateSession(r.tagId),E.info("[VoicePhraseDetector] Authentication successful: "+r.tagName+" ("+n+")"),{found:!0,tagId:r.tagId,tagName:r.tagName,action:n}}return E.info("[VoicePhraseDetector] No secret phrase detected"),{found:!1}}catch(o){return E.error("[VoicePhraseDetector] Error during phrase detection:",o),{found:!1}}}));return function(t){return e.apply(this,arguments)}}()},{key:"authenticateWithOPAQUE",value:function(){var e=(0,n.default)((function*(e){var t=Date.now();try{var r=yield this.getAvailableSecretTags();if(0===r.length)return{success:!1,error:"No secret tags configured"};for(var n of r)try{if(Date.now()-t>this.MAX_AUTHENTICATION_TIME_MS){E.warn("[VoicePhraseDetector] Authentication timeout reached");break}var o=yield this.opaqueClient.authenticate(n.id,e);if(o.success){var a=yield this.opaqueClient.deriveVaultKey(o.sessionKey,n.id);return{success:!0,tagId:n.id,tagName:n.name,sessionKey:o.sessionKey,vaultKey:a}}}catch(l){l instanceof $t?E.debug("[VoicePhraseDetector] Authentication failed for tag "+n.id+": "+l.message):E.warn("[VoicePhraseDetector] Unexpected error for tag "+n.id+":",l);continue}var i=Date.now()-t;return E.info("[VoicePhraseDetector] Authentication failed for all tags ("+i+"ms)"),{success:!1,error:"Authentication failed"}}catch(l){var s=Date.now()-t;return E.error("[VoicePhraseDetector] OPAQUE authentication error ("+s+"ms):",l),l instanceof er?{success:!1,error:"Network error during authentication"}:l instanceof Xt?{success:!1,error:"Authentication protocol error"}:{success:!1,error:"Unknown authentication error"}}}));return function(t){return e.apply(this,arguments)}}()},{key:"getAvailableSecretTags",value:function(){var e=(0,n.default)((function*(){try{return E.info("[VoicePhraseDetector] Getting available secret tags from server"),[]}catch(e){return E.error("[VoicePhraseDetector] Failed to get available secret tags:",e),[]}}));return function(){return e.apply(this,arguments)}}()},{key:"createSession",value:function(){var e=(0,n.default)((function*(e,t,r,n){var o=this;try{yield this.deactivateSession(e);var a={tagId:e,tagName:t,sessionKey:r,vaultKey:n,createdAt:new Date,expiresAt:new Date(Date.now()+this.SESSION_TIMEOUT_MS)};this.activeSessions.set(e,a);var i=setTimeout((function(){o.deactivateSession(e)}),this.SESSION_TIMEOUT_MS);this.sessionTimeouts.set(e,i),E.info("[VoicePhraseDetector] Session created for tag: "+t+" (expires in "+this.SESSION_TIMEOUT_MS/1e3+"s)")}catch(s){throw E.error("[VoicePhraseDetector] Failed to create session:",s),s}}));return function(t,r,n,o){return e.apply(this,arguments)}}()},{key:"deactivateSession",value:function(){var e=(0,n.default)((function*(e){try{var t=this.activeSessions.get(e);t&&(t.sessionKey.fill(0),t.vaultKey.fill(0),this.activeSessions.delete(e),E.info("[VoicePhraseDetector] Session deactivated for tag: "+t.tagName));var r=this.sessionTimeouts.get(e);r&&(clearTimeout(r),this.sessionTimeouts.delete(e))}catch(n){E.error("[VoicePhraseDetector] Error deactivating session:",n)}}));return function(t){return e.apply(this,arguments)}}()},{key:"isSessionActive",value:function(e){var t=this.activeSessions.get(e);return!!t&&(!(t.expiresAt<new Date)||(this.deactivateSession(e),!1))}},{key:"getActiveSession",value:function(e){return this.isSessionActive(e)&&this.activeSessions.get(e)||null}},{key:"getActiveSessions",value:function(){var e=[];for(var t of this.activeSessions){var r=(0,o.default)(t,2),n=r[0],a=r[1];this.isSessionActive(n)&&e.push(a)}return e}},{key:"handlePanicMode",value:function(){var e=(0,n.default)((function*(){try{E.warn("[VoicePhraseDetector] Entering panic mode - clearing all sessions");var e=Array.from(this.activeSessions.keys());for(var t of e)yield this.deactivateSession(t);yield this.opaqueClient.clearMemory(),E.info("[VoicePhraseDetector] Panic mode complete - all sensitive data cleared")}catch(r){E.error("[VoicePhraseDetector] Error during panic mode:",r)}}));return function(){return e.apply(this,arguments)}}()},{key:"normalizePhrase",value:function(e){return e.toLowerCase().trim().replace(this.PHRASE_NORMALIZATION_REGEX,"").replace(/\s+/g," ")}},{key:"isPanicPhrase",value:function(e){return["emergency delete everything","panic mode now","destroy all data"].some((function(t){return e.includes(t)}))}},{key:"cleanup",value:function(){var e=(0,n.default)((function*(){try{E.info("[VoicePhraseDetector] Cleaning up resources");var e=Array.from(this.activeSessions.keys());for(var t of e)yield this.deactivateSession(t);for(var r of this.sessionTimeouts.values())clearTimeout(r);this.sessionTimeouts.clear(),E.info("[VoicePhraseDetector] Cleanup complete")}catch(n){E.error("[VoicePhraseDetector] Error during cleanup:",n)}}));return function(){return e.apply(this,arguments)}}()}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}])}().getInstance()),or=function(e){var t=zt.default.get("window"),r=t.width,n=(t.height,r>768),o=n?600:r-2*e.spacing.md,a=n?e.spacing.xl:e.spacing.md,i=o-2*e.spacing.sm,s=Math.min(i/7,n?60:45);return v.default.create({container:{flex:1,backgroundColor:e.colors.background},calendarHeader:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",paddingHorizontal:a,paddingVertical:e.spacing.md,borderBottomWidth:1,borderBottomColor:e.colors.border,maxWidth:o,alignSelf:"center",width:"100%"},monthText:{fontSize:e.typography.fontSizes.lg,fontWeight:"bold",color:e.colors.text,fontFamily:e.typography.fontFamilies.bold},calendar:{paddingHorizontal:e.spacing.sm,paddingVertical:e.spacing.md,backgroundColor:e.colors.card,margin:e.spacing.md,borderRadius:8,maxWidth:o,alignSelf:"center",width:n?o:"100%"},weekDays:{flexDirection:"row",justifyContent:"space-around",marginBottom:e.spacing.sm},weekDayText:{fontSize:n?e.typography.fontSizes.sm:e.typography.fontSizes.xs,color:e.colors.textSecondary,fontFamily:e.typography.fontFamilies.semiBold,width:s,textAlign:"center"},daysContainer:{flexDirection:"row",flexWrap:"wrap",justifyContent:"space-around"},dayContainer:{width:s,height:s,justifyContent:"center",alignItems:"center",borderWidth:1,borderColor:"transparent",borderRadius:5,margin:1},selectedDayContainer:{backgroundColor:e.colors.primary,borderColor:e.colors.primary,borderRadius:20},dayText:{fontSize:n?e.typography.fontSizes.sm:e.typography.fontSizes.xs,color:e.colors.text,fontFamily:e.typography.fontFamilies.regular},selectedDayText:{color:e.isDarkMode?e.colors.background:e.colors.white,fontWeight:"bold",fontFamily:e.typography.fontFamilies.bold},entryIndicator:{width:4,height:4,borderRadius:2,backgroundColor:e.colors.secondary,position:"absolute",bottom:n?6:4},selectedEntryIndicator:{backgroundColor:e.isDarkMode?e.colors.background:e.colors.white},selectedDateContainer:{padding:e.spacing.md,flexDirection:"row",justifyContent:"space-between",alignItems:"center",borderTopWidth:1,borderBottomWidth:1,borderColor:e.colors.border,backgroundColor:e.colors.card,maxWidth:o,alignSelf:"center",width:n?o:"100%"},selectedDateText:{fontSize:e.typography.fontSizes.md,fontWeight:"bold",color:e.colors.text,fontFamily:e.typography.fontFamilies.bold},addButton:{backgroundColor:e.colors.primary,padding:e.spacing.sm,borderRadius:20},loaderContainer:{flex:1,justifyContent:"center",alignItems:"center",backgroundColor:e.colors.background},skeletonContainer:{flex:1,backgroundColor:e.colors.background},entriesContainer:{flex:1,maxWidth:o,alignSelf:"center",width:n?o:"100%"},emptyContainer:{flex:1,justifyContent:"center",alignItems:"center",padding:e.spacing.lg,minHeight:n?200:150},emptyText:{fontSize:e.typography.fontSizes.md,color:e.colors.textSecondary,marginTop:e.spacing.md,marginBottom:e.spacing.lg,textAlign:"center",fontFamily:e.typography.fontFamilies.regular},createButton:{backgroundColor:e.colors.primary,paddingVertical:e.spacing.md,paddingHorizontal:e.spacing.xl,borderRadius:25},createButtonText:{color:e.isDarkMode?e.colors.background:e.colors.white,fontSize:e.typography.fontSizes.md,fontWeight:"bold",fontFamily:e.typography.fontFamilies.bold},listContent:{padding:e.spacing.md,paddingBottom:"ios"===k.default.OS?60:50},scrollContainer:{flex:1},scrollContent:{flexGrow:1},entriesListContainer:{minHeight:n?300:200},scrollToTopButton:{position:"absolute",bottom:"ios"===k.default.OS?120:105,right:e.spacing.lg,width:48,height:48,borderRadius:24,backgroundColor:e.colors.primary,justifyContent:"center",alignItems:"center",elevation:8,shadowColor:e.colors.shadow,shadowOffset:{width:0,height:4},shadowOpacity:.3,shadowRadius:8,zIndex:1e3}})};const ar=function(){var e=(0,oe.useNavigation)(),t=me().theme,r=or(t),a=(0,d.useState)(new Date),i=(0,o.default)(a,2),s=i[0],l=i[1],c=(0,d.useState)(new Date),u=(0,o.default)(c,2),f=u[0],g=u[1],y=(0,d.useState)([]),p=(0,o.default)(y,2),v=p[0],b=p[1],x=(0,d.useState)([]),S=(0,o.default)(x,2),w=S[0],j=S[1],C=(0,d.useState)(!0),k=(0,o.default)(C,2),T=k[0],E=k[1],O=(0,d.useState)(!1),F=(0,o.default)(O,2),I=F[0],A=F[1],R=(0,d.useState)(!1),D=(0,o.default)(R,2),z=D[0],B=D[1],_=(0,d.useState)(!1),L=(0,o.default)(_,2),N=L[0],M=L[1],H=(0,d.useRef)(null),W=(0,d.useCallback)((function(e){var t=e.nativeEvent.contentOffset;M(t.y>200)}),[]),U=(0,d.useCallback)((function(){H.current&&H.current.scrollTo({y:0,animated:!0})}),[]);(0,d.useEffect)((function(){var e=function(){var e=(0,n.default)((function*(){var e=nr.getActiveSessions();A(e.length>0)}));return function(){return e.apply(this,arguments)}}();e();var t=setInterval(e,1e3);return function(){return clearInterval(t)}}),[]);var V=(0,d.useMemo)((function(){return v}),[v,I]);(0,oe.useFocusEffect)(d.useCallback((function(){K(),f&&Q(f)}),[f])),(0,d.useEffect)((function(){f&&Q(f)}),[f]),(0,d.useEffect)((function(){f&&v.length>0&&Q(f)}),[I]);var K=function(){var e=(0,n.default)((function*(){try{E(!0);var e=yield P.getEntries({limit:100,include_public:!0}),t=Array.isArray(e.data)?e.data:e.data.entries||[];b(t),yield Q(f)}catch(r){console.error("Error fetching journal entries",r),ft.default.alert("Error","Failed to load journal entries")}finally{E(!1),B(!1)}}));return function(){return e.apply(this,arguments)}}(),q=d.useCallback((function(){B(!0),K()}),[f]),Q=function(){var e=(0,n.default)((function*(e){try{var t=(0,gt.default)(e,"yyyy-MM-dd"),r=(yield P.getEntries({start_date:t,end_date:t,include_public:!0})).data;j(r)}catch(n){console.error("Error fetching entries for date "+(0,gt.default)(e,"yyyy-MM-dd"),n),j([])}}));return function(t){return e.apply(this,arguments)}}(),J=function(){var t=(0,gt.default)(f,"yyyy-MM-dd");e.navigate("Record",{selectedDate:t})},Y=function(e){var t=(0,gt.default)(e,"d"),n=V.some((function(t){try{var r=(0,St.default)(t.entry_date);return r.getFullYear()===e.getFullYear()&&r.getMonth()===e.getMonth()&&r.getDate()===e.getDate()}catch(Ao){return console.error("Error parsing entry_date for indicator: "+t.entry_date,Ao),!1}})),o=(0,Gt.default)(e,f);return(0,G.jsxs)(ne.default,{style:[r.dayContainer,o&&r.selectedDayContainer],onPress:function(){g(e),Q(e)},children:[(0,G.jsx)(m.default,{style:[r.dayText,o&&r.selectedDayText],children:t}),n&&(0,G.jsx)(h.default,{style:[r.entryIndicator,o&&r.selectedEntryIndicator]})]})};return(0,G.jsxs)(h.default,{style:r.container,children:[(0,G.jsx)(Ot,{title:"Calendar",showSecretTagIndicator:I,secretTagText:"Secret Tags Active"}),(0,G.jsxs)(Ce,{style:{flex:1},contentContainerStyle:{flexGrow:1},refreshControl:(0,G.jsx)(ut.default,{refreshing:z,onRefresh:q,colors:[t.colors.primary],tintColor:t.colors.primary}),onScroll:W,ref:H,children:[(0,G.jsxs)(h.default,{style:r.calendarHeader,children:[(0,G.jsx)(ne.default,{onPress:function(){var e=new Date(s);e.setMonth(e.getMonth()-1),l(e)},children:(0,G.jsx)(ae.default,{name:"chevron-back",size:t.typography.fontSizes.xxl,color:t.colors.text})}),(0,G.jsx)(m.default,{style:r.monthText,children:(0,gt.default)(s,"MMMM yyyy")}),(0,G.jsx)(ne.default,{onPress:function(){var e=new Date(s);e.setMonth(e.getMonth()+1),l(e)},children:(0,G.jsx)(ae.default,{name:"chevron-forward",size:t.typography.fontSizes.xxl,color:t.colors.text})})]}),(0,G.jsxs)(h.default,{style:r.calendar,children:[(0,G.jsx)(h.default,{style:r.weekDays,children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map((function(e){return(0,G.jsx)(m.default,{style:r.weekDayText,children:e},e)}))}),(0,G.jsx)(h.default,{style:r.daysContainer,children:function(){var e=(0,Kt.default)(s),t=(0,qt.default)(s);return(0,Qt.default)({start:e,end:t})}().map((function(e){return(0,G.jsx)(h.default,{children:Y(e)},e.toISOString())}))})]}),(0,G.jsxs)(h.default,{style:r.selectedDateContainer,children:[(0,G.jsx)(m.default,{style:r.selectedDateText,children:(0,gt.default)(f,"EEEE, MMMM d, yyyy")}),(0,G.jsx)(ne.default,{style:r.addButton,onPress:J,children:(0,G.jsx)(ae.default,{name:"add",size:t.typography.fontSizes.xxl,color:t.isDarkMode?t.colors.background:t.colors.white})})]}),T?(0,G.jsxs)(h.default,{style:r.skeletonContainer,children:[(0,G.jsx)(Lt,{}),Array.from({length:3},(function(e,t){return(0,G.jsx)(_t,{},"skeleton-"+t)}))]}):(0,G.jsx)(h.default,{style:r.entriesContainer,children:0===w.length?(0,G.jsxs)(h.default,{style:r.emptyContainer,children:[(0,G.jsx)(ae.default,{name:"calendar-outline",size:1.5*t.spacing.xxl,color:t.colors.disabled}),(0,G.jsx)(m.default,{style:r.emptyText,children:"No entries for this date"}),(0,G.jsx)(ne.default,{style:r.createButton,onPress:J,children:(0,G.jsx)(m.default,{style:r.createButtonText,children:"Create Entry"})})]}):(0,G.jsx)(h.default,{style:r.entriesListContainer,children:(0,G.jsx)(Vt.default,{data:w,renderItem:function(t){var r=t.item,n=t.index;return(0,G.jsx)(Tt,{entry:r,onPress:function(){return t=r,void e.navigate("JournalEntryDetail",{entryId:t.id.toString()});var t}},"calendar-entry-"+r.id+"-"+n)},keyExtractor:function(e,t){return"calendar-list-"+e.id+"-"+t},contentContainerStyle:[r.listContent,{paddingBottom:40}],scrollEnabled:!0,nestedScrollEnabled:!0})})})]}),N&&(0,G.jsx)(ne.default,{style:r.scrollToTopButton,onPress:U,activeOpacity:.8,children:(0,G.jsx)(ae.default,{name:"chevron-up",size:24,color:t.colors.white})})]})};const ir=new((0,i.default)((function e(){(0,a.default)(this,e),this.initialized=!1,this.dailyReminderScheduled=!1}),[{key:"initialize",value:function(){var e=(0,n.default)((function*(){try{return this.initialized||(E.info("[NotificationService] Initialized (simplified version)"),this.initialized=!0),!0}catch(e){return E.error("[NotificationService] Failed to initialize:",e),!1}}));return function(){return e.apply(this,arguments)}}()},{key:"requestPermissions",value:function(){var e=(0,n.default)((function*(){try{return E.info("[NotificationService] Permission request (simulated)"),{granted:!0,canAskAgain:!0,status:"granted"}}catch(e){return E.error("[NotificationService] Failed to request permissions:",e),{granted:!1,canAskAgain:!1,status:"denied"}}}));return function(){return e.apply(this,arguments)}}()},{key:"scheduleDailyReminder",value:function(){var e=(0,n.default)((function*(){try{var e=yield rt.getSettings();if(!e.notificationsEnabled||!e.reminderNotifications)return E.info("[NotificationService] Daily reminders disabled in settings"),this.dailyReminderScheduled=!1,!1;var t=e.dailyReminderTime.split(":").map(Number),r=(0,o.default)(t,2),n=r[0],a=r[1];return isNaN(n)||isNaN(a)||n<0||n>23||a<0||a>59?(E.error("[NotificationService] Invalid reminder time: "+e.dailyReminderTime),!1):(this.dailyReminderScheduled=!0,E.info("[NotificationService] Scheduled daily reminder at "+e.dailyReminderTime+" (simulated)"),!0)}catch(i){return E.error("[NotificationService] Failed to schedule daily reminder:",i),!1}}));return function(){return e.apply(this,arguments)}}()},{key:"cancelDailyReminder",value:function(){var e=(0,n.default)((function*(){try{this.dailyReminderScheduled=!1,E.info("[NotificationService] Cancelled daily reminder (simulated)")}catch(e){E.error("[NotificationService] Failed to cancel daily reminder:",e)}}));return function(){return e.apply(this,arguments)}}()},{key:"updateNotificationSettings",value:function(){var e=(0,n.default)((function*(){try{var e=yield rt.getSettings();e.reminderNotifications&&e.notificationsEnabled?yield this.scheduleDailyReminder():yield this.cancelDailyReminder(),E.info("[NotificationService] Updated notification settings")}catch(t){E.error("[NotificationService] Failed to update notification settings:",t)}}));return function(){return e.apply(this,arguments)}}()},{key:"isConfigured",value:function(){var e=(0,n.default)((function*(){try{return!0}catch(e){return E.error("[NotificationService] Failed to check configuration:",e),!1}}));return function(){return e.apply(this,arguments)}}()},{key:"getPermissionStatus",value:function(){var e=(0,n.default)((function*(){try{return"granted"}catch(e){return E.error("[NotificationService] Failed to get permission status:",e),"denied"}}));return function(){return e.apply(this,arguments)}}()},{key:"showTestNotification",value:function(){var e=(0,n.default)((function*(){try{if(!(yield rt.getSettings()).notificationsEnabled)return void ft.default.alert("Notifications Disabled","Please enable notifications in settings to test.");ft.default.alert("\ud83d\udcdd Journal Reminder","This is a test notification. In a full implementation, this would be a proper push notification.",[{text:"OK"}]),E.info("[NotificationService] Showed test notification")}catch(e){E.error("[NotificationService] Failed to show test notification:",e)}}));return function(){return e.apply(this,arguments)}}()},{key:"isDailyReminderScheduled",value:function(){return this.dailyReminderScheduled}}]));var sr=(0,d.createContext)(void 0),lr=function(e){var t=e.children,r=(0,d.useState)(et),a=(0,o.default)(r,2),i=a[0],s=a[1],l=(0,d.useState)(!0),c=(0,o.default)(l,2),u=c[0],f=c[1],g=(0,d.useState)(null),y=(0,o.default)(g,2),p=y[0],h=y[1];(0,d.useEffect)((function(){var e=function(){var e=(0,n.default)((function*(){try{f(!0),h(null);var e=yield rt.initialize();s(e),E.info("[SettingsContext] Settings initialized successfully")}catch(r){var t=r instanceof Error?r.message:"Failed to initialize settings";E.error("[SettingsContext] Settings initialization failed:",r),h(t),s(et)}finally{f(!1)}}));return function(){return e.apply(this,arguments)}}();e()}),[]),(0,d.useEffect)((function(){return rt.subscribe((function(e){s(e),E.debug("[SettingsContext] Settings updated via subscription")}))}),[]);var m=function(){var e=(0,n.default)((function*(e,t){try{h(null),yield rt.updateSetting(e,t),"notificationsEnabled"!==e&&"reminderNotifications"!==e&&"dailyReminderTime"!==e||(yield ir.updateNotificationSettings(),E.info("[SettingsContext] Updated notification settings after "+e+" change"))}catch(n){var r=n instanceof Error?n.message:"Failed to update "+e;throw E.error("[SettingsContext] Failed to update setting "+e+":",n),h(r),n}}));return function(t,r){return e.apply(this,arguments)}}(),v=function(){var e=(0,n.default)((function*(e){try{h(null),yield rt.updateSettings(e)}catch(r){var t=r instanceof Error?r.message:"Failed to update settings";throw E.error("[SettingsContext] Failed to update settings:",r),h(t),r}}));return function(t){return e.apply(this,arguments)}}(),b=function(){var e=(0,n.default)((function*(){try{h(null),yield rt.resetToDefaults(),E.info("[SettingsContext] Settings reset to defaults")}catch(t){var e=t instanceof Error?t.message:"Failed to reset settings";throw E.error("[SettingsContext] Failed to reset settings:",t),h(e),t}}));return function(){return e.apply(this,arguments)}}(),x=function(){var e=(0,n.default)((function*(){try{h(null);var e=yield rt.exportSettings();return E.info("[SettingsContext] Settings exported successfully"),e}catch(r){var t=r instanceof Error?r.message:"Failed to export settings";throw E.error("[SettingsContext] Failed to export settings:",r),h(t),r}}));return function(){return e.apply(this,arguments)}}(),S=function(){var e=(0,n.default)((function*(e){try{h(null),yield rt.importSettings(e),E.info("[SettingsContext] Settings imported successfully")}catch(r){var t=r instanceof Error?r.message:"Failed to import settings";throw E.error("[SettingsContext] Failed to import settings:",r),h(t),r}}));return function(t){return e.apply(this,arguments)}}(),w={settings:i,isLoading:u,error:p,updateSetting:m,updateSettings:v,resetToDefaults:b,exportSettings:x,importSettings:S,getSetting:function(e){return i[e]}};return(0,G.jsx)(sr.Provider,{value:w,children:t})},cr=function(){var e=(0,d.useContext)(sr);if(void 0===e)throw new Error("useSettings must be used within a SettingsProvider");return e};var dr=function(e){return v.default.create({container:{flexDirection:"row",alignItems:"center",paddingVertical:e.spacing.md,paddingHorizontal:e.spacing.lg,backgroundColor:e.colors.card,borderBottomWidth:1,borderBottomColor:e.colors.border,minHeight:64},containerDisabled:{opacity:.6},containerNonInteractive:{},leftSection:{flexDirection:"row",alignItems:"center",flex:1},iconContainer:{width:40,height:40,borderRadius:e.borderRadius.lg,backgroundColor:e.colors.primaryLight+"20",justifyContent:"center",alignItems:"center",marginRight:e.spacing.md},textContainer:{flex:1},title:{fontSize:e.typography.fontSizes.md,fontFamily:e.typography.fontFamilies.semiBold,color:e.colors.text,marginBottom:e.spacing.xs},titleDisabled:{color:e.colors.textSecondary},subtitle:{fontSize:e.typography.fontSizes.sm,fontFamily:e.typography.fontFamilies.regular,color:e.colors.textSecondary,lineHeight:18},subtitleDisabled:{color:e.colors.border},rightSection:{flexDirection:"row",alignItems:"center",marginLeft:e.spacing.md},chevronContainer:{marginLeft:e.spacing.sm}})};const ur=function(e){var t=e.title,r=e.subtitle,n=e.leftIcon,o=e.leftIconColor,a=e.rightElement,i=e.onPress,s=e.disabled,l=void 0!==s&&s,c=e.style,d=e.showChevron,u=void 0!==d&&d,f=e.testID,g=me().theme,y=dr(g),p=!!i&&!l;return(0,G.jsxs)(ne.default,{style:[y.container,l&&y.containerDisabled,!p&&y.containerNonInteractive,c],onPress:function(){!l&&i&&(ot.selection(),i())},disabled:!p,activeOpacity:p?.7:1,testID:f,accessibilityRole:p?"button":"text",accessibilityLabel:r?t+", "+r:t,accessibilityHint:p?"Tap to modify this setting":void 0,children:[(0,G.jsxs)(h.default,{style:y.leftSection,children:[n&&(0,G.jsx)(h.default,{style:y.iconContainer,children:(0,G.jsx)(ae.default,{name:n,size:22,color:l?g.colors.disabled:o||g.colors.primary})}),(0,G.jsxs)(h.default,{style:y.textContainer,children:[(0,G.jsx)(m.default,{style:[y.title,l&&y.titleDisabled],children:t}),r&&(0,G.jsx)(m.default,{style:[y.subtitle,l&&y.subtitleDisabled],children:r})]})]}),(0,G.jsxs)(h.default,{style:y.rightSection,children:[a,u&&p&&(0,G.jsx)(h.default,{style:y.chevronContainer,children:(0,G.jsx)(ae.default,{name:"chevron-forward",size:20,color:l?g.colors.disabled:g.colors.textSecondary})})]})]})};var fr=r(4037);const gr=function(e){var t=e.title,r=e.subtitle,n=e.leftIcon,o=e.value,a=e.onValueChange,i=e.disabled,s=void 0!==i&&i,l=e.style,c=e.testID,d=me().theme,u=(0,G.jsx)(fr.default,{trackColor:{false:d.colors.gray300,true:d.colors.primary+"80"},thumbColor:o?d.colors.primary:d.colors.gray100,ios_backgroundColor:d.colors.gray300,onValueChange:a,value:o,disabled:s,accessibilityLabel:t+" toggle",accessibilityRole:"switch",accessibilityState:{checked:o}});return(0,G.jsx)(ur,{title:t,subtitle:r,leftIcon:n,rightElement:u,onPress:function(){s||a(!o)},disabled:s,style:l,testID:c})};var yr=function(e){return v.default.create({rightContainer:{alignItems:"flex-end"},selectedText:{fontSize:e.typography.fontSizes.md,fontFamily:e.typography.fontFamilies.regular,color:e.colors.textSecondary,textAlign:"right"},selectedTextDisabled:{color:e.colors.disabled},placeholderText:{fontStyle:"italic",color:e.colors.textDisabled},modalContainer:{flex:1,backgroundColor:e.colors.background},modalHeader:{flexDirection:"row",alignItems:"center",justifyContent:"space-between",paddingHorizontal:e.spacing.lg,paddingVertical:e.spacing.md,borderBottomWidth:1,borderBottomColor:e.colors.border,backgroundColor:e.colors.card},headerLeft:{width:60},modalTitle:{fontSize:e.typography.fontSizes.lg,fontFamily:e.typography.fontFamilies.bold,color:e.colors.text,textAlign:"center"},headerButton:{width:60,alignItems:"flex-end"},doneButtonText:{fontSize:e.typography.fontSizes.md,fontFamily:e.typography.fontFamilies.semiBold,color:e.colors.primary},optionsList:{flex:1},optionItem:{flexDirection:"row",alignItems:"center",justifyContent:"space-between",paddingVertical:e.spacing.lg,paddingHorizontal:e.spacing.lg,backgroundColor:e.colors.card,borderBottomWidth:1,borderBottomColor:e.colors.border,minHeight:64},selectedOptionItem:{backgroundColor:e.colors.primaryLight+"20"},optionItemDisabled:{opacity:.5},optionContent:{flex:1},optionLabel:{fontSize:e.typography.fontSizes.md,fontFamily:e.typography.fontFamilies.semiBold,color:e.colors.text},selectedOptionLabel:{color:e.colors.primary},optionLabelDisabled:{color:e.colors.disabled},optionSubtitle:{fontSize:e.typography.fontSizes.sm,fontFamily:e.typography.fontFamilies.regular,color:e.colors.textSecondary,marginTop:e.spacing.xs},optionSubtitleDisabled:{color:e.colors.disabled}})};const pr=function(e){var t=e.title,r=e.subtitle,n=e.leftIcon,a=e.options,i=e.selectedValue,s=e.onValueChange,l=e.disabled,c=void 0!==l&&l,u=e.style,f=e.testID,g=e.placeholder,y=void 0===g?"Select an option":g,p=me().theme,v=yr(p),b=(0,d.useState)(!1),x=(0,o.default)(b,2),S=x[0],w=x[1],j=a.find((function(e){return e.value===i})),C=(null==j?void 0:j.label)||y,k=(0,G.jsx)(h.default,{style:v.rightContainer,children:(0,G.jsx)(m.default,{style:[v.selectedText,c&&v.selectedTextDisabled,!j&&v.placeholderText],children:C})});return(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(ur,{title:t,subtitle:r,leftIcon:n,rightElement:k,onPress:function(){c||w(!0)},disabled:c,style:u,showChevron:!0,testID:f}),(0,G.jsx)(ke.default,{visible:S,animationType:"slide",presentationStyle:"pageSheet",onRequestClose:function(){return w(!1)},children:(0,G.jsxs)(h.default,{style:v.modalContainer,children:[(0,G.jsxs)(h.default,{style:v.modalHeader,children:[(0,G.jsx)(h.default,{style:v.headerLeft}),(0,G.jsx)(m.default,{style:v.modalTitle,children:t}),(0,G.jsx)(ne.default,{style:v.headerButton,onPress:function(){return w(!1)},accessibilityLabel:"Close",accessibilityRole:"button",children:(0,G.jsx)(m.default,{style:v.doneButtonText,children:"Done"})})]}),(0,G.jsx)(Vt.default,{data:a,keyExtractor:function(e){return e.value},renderItem:function(e){var t=e.item;return(0,G.jsxs)(ne.default,{style:[v.optionItem,t.value===i&&v.selectedOptionItem,t.disabled&&v.optionItemDisabled],onPress:function(){return e=t.value,s(e),void w(!1);var e},disabled:t.disabled,accessibilityRole:"button",accessibilityLabel:t.label,accessibilityState:{selected:t.value===i},children:[(0,G.jsxs)(h.default,{style:v.optionContent,children:[(0,G.jsx)(m.default,{style:[v.optionLabel,t.value===i&&v.selectedOptionLabel,t.disabled&&v.optionLabelDisabled],children:t.label}),t.subtitle&&(0,G.jsx)(m.default,{style:[v.optionSubtitle,t.disabled&&v.optionSubtitleDisabled],children:t.subtitle})]}),t.value===i&&(0,G.jsx)(ae.default,{name:"checkmark-circle",size:24,color:p.colors.primary})]})},style:v.optionsList,showsVerticalScrollIndicator:!0,bounces:!0})]})})]})};r(8511);function hr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function mr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?hr(Object(r),!0).forEach((function(t){(0,b.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):hr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var vr=function(e){return v.default.create({container:mr({marginVertical:e.spacing.sm,marginHorizontal:e.spacing.md,backgroundColor:e.colors.card,borderRadius:e.borderRadius.lg,overflow:"hidden"},e.shadows.sm),header:{flexDirection:"row",alignItems:"center",paddingVertical:e.spacing.sm,paddingHorizontal:e.spacing.md,backgroundColor:e.colors.card,borderBottomWidth:1,borderBottomColor:e.colors.border},headerTouchable:{flexDirection:"row",alignItems:"center",flex:1},headerIcon:{marginRight:e.spacing.md},titleContainer:{flex:1},title:{fontSize:e.typography.fontSizes.lg,fontFamily:e.typography.fontFamilies.bold,color:e.colors.text},headerAction:{marginLeft:e.spacing.md},subtitle:{fontSize:e.typography.fontSizes.sm,color:e.colors.textSecondary,marginLeft:e.spacing.sm,padding:e.spacing.xs},childrenContainer:{paddingHorizontal:e.spacing.md,paddingBottom:e.spacing.md},iconContainer:{width:40,height:40,borderRadius:e.borderRadius.md,backgroundColor:e.colors.primaryLight+"20",justifyContent:"center",alignItems:"center",marginRight:e.spacing.md},content:{paddingHorizontal:e.spacing.md,paddingBottom:e.spacing.sm,backgroundColor:e.colors.card}})};const br=function(e){var t=e.title,r=e.subtitle,n=e.icon,a=e.children,i=(e.collapsible,e.initiallyExpanded),s=void 0===i||i,l=e.headerAction,c=me().theme,u=vr(c),f=(0,d.useState)(s),g=(0,o.default)(f,2);g[0],g[1];return(0,G.jsxs)(h.default,{style:u.container,children:[(0,G.jsxs)(h.default,{style:u.header,children:[n&&(0,G.jsx)(ae.default,{name:n,size:20,color:c.colors.textSecondary,style:u.headerIcon}),(0,G.jsxs)(h.default,{style:u.titleContainer,children:[(0,G.jsx)(m.default,{style:u.title,children:t}),r&&(0,G.jsx)(m.default,{style:u.subtitle,children:r})]}),l&&(0,G.jsx)(h.default,{style:u.headerAction,children:l})]}),(0,G.jsx)(h.default,{style:u.childrenContainer,children:a})]})};function xr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Sr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?xr(Object(r),!0).forEach((function(t){(0,b.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var wr=function(e){return v.default.create({container:{flex:1,backgroundColor:e.colors.background},scrollContent:{paddingBottom:100},centerContent:{justifyContent:"center",alignItems:"center"},loadingText:{marginTop:e.spacing.md,fontSize:e.typography.fontSizes.md,color:e.colors.textSecondary,fontFamily:e.typography.fontFamilies.regular},header:{flexDirection:"row",alignItems:"center",justifyContent:"space-between",paddingHorizontal:e.spacing.lg,paddingTop:e.spacing.xl,paddingBottom:e.spacing.lg,borderBottomWidth:1,borderBottomColor:e.colors.border},backButton:Sr({width:40,height:40,borderRadius:20,backgroundColor:e.colors.card,justifyContent:"center",alignItems:"center"},e.shadows.sm),headerTitle:{fontSize:e.typography.fontSizes.xl,fontWeight:"bold",color:e.colors.text,fontFamily:e.typography.fontFamilies.bold},headerSpacer:{width:40},profileBadge:{width:36,height:36,borderRadius:18,backgroundColor:e.colors.primary,justifyContent:"center",alignItems:"center"},profileBadgeText:{fontSize:e.typography.fontSizes.md,fontWeight:"bold",color:e.colors.background,fontFamily:e.typography.fontFamilies.bold},statusText:{fontSize:e.typography.fontSizes.sm,fontFamily:e.typography.fontFamilies.medium},timeText:{fontSize:e.typography.fontSizes.md,color:e.colors.textSecondary,fontFamily:e.typography.fontFamilies.regular},versionText:{fontSize:e.typography.fontSizes.sm,color:e.colors.textSecondary,fontFamily:e.typography.fontFamilies.regular},bottomSpacing:{height:e.spacing.xxxl},scrollToTopButton:{position:"absolute",bottom:30,right:20,zIndex:1e3},scrollToTopButtonInner:Sr({width:50,height:50,borderRadius:25,backgroundColor:e.colors.primary,justifyContent:"center",alignItems:"center"},e.shadows.lg)})};const jr=function(){var e,t=(0,oe.useNavigation)(),r=$(),a=r.user,i=r.logout,s=me(),l=s.theme,c=s.toggleTheme,u=s.isSystemTheme,f=s.setUseSystemTheme,g=cr(),y=g.settings,p=g.updateSetting,v=g.isLoading,b=wr(l),x=(0,d.useState)(!1),S=(0,o.default)(x,2),w=S[0],j=S[1],C=d.useRef(null),k=(0,d.useState)(!1),T=(0,o.default)(k,2),O=T[0],F=T[1],I=d.useRef(new Ge.default.Value(0)).current;if(v)return(0,G.jsx)(h.default,{style:b.container,children:(0,G.jsx)(Nt,{})});var A=Ye.map((function(e){return{value:e.code,label:e.name,subtitle:e.region?""+e.region:void 0}})),P=function(){var e=(0,n.default)((function*(){if(window.confirm("Are you sure you want to sign out?"))try{E.info("[SettingsScreen] User confirmed sign out"),yield i(),E.info("[SettingsScreen] User signed out successfully")}catch(e){E.error("[SettingsScreen] Error during sign out:",e),window.alert("Failed to sign out. Please try again.")}}));return function(){return e.apply(this,arguments)}}(),R=d.useCallback((function(){j(!0),setTimeout((function(){j(!1)}),1e3)}),[]);return(0,G.jsxs)(h.default,{style:b.container,children:[(0,G.jsx)(Ot,{title:"Settings"}),(0,G.jsxs)(Ce,{ref:C,style:b.container,contentContainerStyle:b.scrollContent,showsVerticalScrollIndicator:!1,onScroll:function(e){var t=e.nativeEvent.contentOffset.y>200;t!==O&&(F(t),Ge.default.timing(I,{toValue:t?1:0,duration:200,useNativeDriver:!1}).start())},scrollEventThrottle:16,refreshControl:(0,G.jsx)(ut.default,{refreshing:w,onRefresh:R,colors:[l.colors.primary],tintColor:l.colors.primary}),children:[(0,G.jsxs)(br,{title:"Profile",icon:"person",children:[(0,G.jsx)(ur,{title:"Account",subtitle:(null==a?void 0:a.email)||"No email available",leftIcon:"mail",rightElement:(0,G.jsx)(h.default,{style:b.profileBadge,children:(0,G.jsx)(m.default,{style:b.profileBadgeText,children:(null==a||null==(e=a.email)?void 0:e.charAt(0).toUpperCase())||"U"})})}),(0,G.jsx)(ur,{title:"Sign Out",subtitle:"Sign out of your account",leftIcon:"log-out",onPress:P,showChevron:!0})]}),(0,G.jsx)(br,{title:"Language & Transcription",icon:"language",children:(0,G.jsx)(pr,{title:"Default Language",subtitle:"Language for voice transcription",leftIcon:"globe",options:A,selectedValue:y.defaultLanguage,onValueChange:function(e){return p("defaultLanguage",e)}})}),(0,G.jsxs)(br,{title:"Privacy & Security",icon:"shield-checkmark",children:[(0,G.jsx)(ur,{title:"Tags",subtitle:"Manage regular and privacy tags",leftIcon:"pricetag",onPress:function(){return t.navigate("TagManagement")},showChevron:!0}),(0,G.jsx)(gr,{title:"Analytics",subtitle:"Help improve the app",leftIcon:"analytics",value:y.analyticsEnabled,onValueChange:function(e){return p("analyticsEnabled",e)}}),(0,G.jsx)(gr,{title:"Crash Reports",subtitle:"Send crash reports to developers",leftIcon:"bug",value:y.crashReportsEnabled,onValueChange:function(e){return p("crashReportsEnabled",e)}})]}),(0,G.jsxs)(br,{title:"App Settings",icon:"settings",children:[(0,G.jsx)(gr,{title:"Dark Mode",subtitle:u?"Following system setting":"Manual override",leftIcon:"moon",value:l.isDarkMode,onValueChange:function(){u&&f(!1),c()},disabled:u}),(0,G.jsx)(gr,{title:"Use System Theme",subtitle:"Follow device theme setting",leftIcon:"phone-portrait",value:u,onValueChange:f}),(0,G.jsx)(gr,{title:"Haptic Feedback",subtitle:"Enable subtle vibrations for interactions",leftIcon:"pulse-outline",value:y.hapticFeedbackEnabled,onValueChange:function(e){return p("hapticFeedbackEnabled",e)}}),(0,G.jsx)(gr,{title:"Auto-Save Entry",subtitle:"Automatically save during recording",leftIcon:"save-outline",value:y.autoSaveEnabled,onValueChange:function(e){return p("autoSaveEnabled",e)}}),(0,G.jsx)(gr,{title:"Auto-Start Recording",subtitle:"Automatically start recording when opening record screen",leftIcon:"mic-outline",value:y.autoRecordingEnabled,onValueChange:function(e){return p("autoRecordingEnabled",e)}})]}),(0,G.jsxs)(br,{title:"Notifications",icon:"notifications",children:[(0,G.jsx)(gr,{title:"Push Notifications",subtitle:"Receive app notifications",leftIcon:"notifications",value:y.notificationsEnabled,onValueChange:function(e){return p("notificationsEnabled",e)}}),(0,G.jsx)(gr,{title:"Daily Reminders",subtitle:"Reminder to write in your journal",leftIcon:"time",value:y.reminderNotifications,onValueChange:function(e){return p("reminderNotifications",e)}}),y.reminderNotifications&&(0,G.jsx)(ur,{title:"Reminder Time",subtitle:"Daily reminder at "+y.dailyReminderTime,leftIcon:"alarm",rightElement:(0,G.jsx)(m.default,{style:b.timeText,children:y.dailyReminderTime}),onPress:function(){ft.default.alert("Coming Soon","Time picker will be available in a future update.")},showChevron:!0})]}),(0,G.jsxs)(br,{title:"About",icon:"information-circle",children:[(0,G.jsx)(ur,{title:"Version",subtitle:"Current app version",leftIcon:"code-working",rightElement:(0,G.jsx)(m.default,{style:b.versionText,children:"1.0.0"})}),(0,G.jsx)(ur,{title:"Privacy Policy",subtitle:"View our privacy policy",leftIcon:"document-text",onPress:function(){ft.default.alert("Privacy Policy","Privacy policy will be available soon.")},showChevron:!0}),(0,G.jsx)(ur,{title:"Terms of Service",subtitle:"View terms and conditions",leftIcon:"document",onPress:function(){ft.default.alert("Terms of Service","Terms of service will be available soon.")},showChevron:!0})]}),(0,G.jsx)(h.default,{style:b.bottomSpacing})]}),(0,G.jsx)(Ge.default.View,{style:[b.scrollToTopButton,{opacity:I,transform:[{scale:I.interpolate({inputRange:[0,1],outputRange:[.8,1]})}]}],pointerEvents:O?"auto":"none",children:(0,G.jsx)(ne.default,{style:b.scrollToTopButtonInner,onPress:function(){var e;null==(e=C.current)||e.scrollTo({y:0,animated:!0})},activeOpacity:.7,children:(0,G.jsx)(ae.default,{name:"chevron-up",size:24,color:l.colors.background})})})]})};function Cr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function kr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Cr(Object(r),!0).forEach((function(t){(0,b.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Cr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Tr=(0,Ue.default)(),Er=function(e){return v.default.create({container:{flex:1},tabBarStyle:kr(kr({backgroundColor:e.colors.card,borderTopColor:e.colors.borderLight,borderTopWidth:1,height:"ios"===k.default.OS?88:75,paddingBottom:"ios"===k.default.OS?24:8,paddingTop:8,paddingHorizontal:e.spacing.sm},e.shadows.lg),{},{marginHorizontal:e.spacing.md,marginBottom:"ios"===k.default.OS?e.spacing.lg:e.spacing.md,borderRadius:e.borderRadius.xl,position:"absolute",left:0,right:0,bottom:0}),tabBarLabelStyle:{fontSize:e.typography.fontSizes.xs,fontFamily:e.typography.fontFamilies.medium,marginBottom:"ios"===k.default.OS?0:e.spacing.xs,marginTop:e.spacing.xs},tabBarItemStyle:{paddingVertical:e.spacing.xs,borderRadius:e.borderRadius.md},fabContainer:{position:"absolute",bottom:"ios"===k.default.OS?100:85,alignSelf:"center",zIndex:1e3}})};const Or=function(e){var t=e.navigation,r=me().theme,o=Er(r);(0,d.useEffect)((function(){var e=function(){var e=(0,n.default)((function*(){try{E.info("[MainTabNavigator] Starting audio system prewarm..."),yield Qe.prewarmAudioSystem();var e=Qe.getPerformanceMetrics();E.info("[MainTabNavigator] Audio prewarm completed:",e)}catch(t){E.error("[MainTabNavigator] Audio prewarm failed:",t)}}));return function(){return e.apply(this,arguments)}}();return e(),function(){Qe.cleanup()}}),[]);var a=(0,d.useCallback)((function(){E.info("[MainTabNavigator] FloatingActionButton pressed. Navigating to Record screen."),Qe.isReadyForRecording()||(E.warn("[MainTabNavigator] Audio system not ready, attempting to prewarm..."),Qe.prewarmAudioSystem().catch((function(e){E.error("[MainTabNavigator] Failed to prewarm audio system:",e)}))),t.navigate("Record")}),[t]);return(0,G.jsxs)(h.default,{style:o.container,children:[(0,G.jsxs)(Tr.Navigator,{screenOptions:function(e){var t=e.route;return{headerShown:!1,tabBarActiveTintColor:r.colors.tabBarActive,tabBarInactiveTintColor:r.colors.tabBarInactive,tabBarStyle:o.tabBarStyle,tabBarLabelStyle:o.tabBarLabelStyle,tabBarItemStyle:o.tabBarItemStyle,tabBarIcon:function(e){var r,n=e.focused,o=e.color,a=e.size;return"Home"===t.name?r=n?"home":"home-outline":"Journal"===t.name?r=n?"book":"book-outline":"Calendar"===t.name?r=n?"calendar":"calendar-outline":"Settings"===t.name&&(r=n?"cog":"cog-outline"),r?(0,G.jsx)(ae.default,{name:r,size:n?a+2:a,color:o}):(0,G.jsx)(h.default,{style:{width:a,height:a}})}}},children:[(0,G.jsx)(Tr.Screen,{name:"Home",component:Dt,options:{tabBarLabel:"Home"}}),(0,G.jsx)(Tr.Screen,{name:"Journal",component:Ut,options:{tabBarLabel:"Journal"}}),(0,G.jsx)(Tr.Screen,{name:"Calendar",component:ar,options:{tabBarLabel:"Calendar"}}),(0,G.jsx)(Tr.Screen,{name:"Settings",component:jr,options:{tabBarLabel:"Settings"}})]}),(0,G.jsx)(h.default,{style:o.fabContainer,children:(0,G.jsx)(ct,{onPress:a,icon:"mic",size:64,variant:"primary",testID:"main-record-button"})})]})};var Fr={ENABLE_SECRET_TAGS:!1,ENABLE_OFFLINE_SECRET_TAGS:!1,ENABLE_SECRET_TAG_CACHING:!1,ENABLE_SECURITY_MODE_SWITCHING:!1,ENABLE_BORDER_CROSSING_MODE:!1,ENABLE_TEAM_COLLABORATION:!1,ENABLE_CLOUD_BACKUP:!1},Ir={};function Ar(e){return void 0!==Ir[e]?Ir[e]:Fr[e]}function Pr(){return Ar("ENABLE_SECRET_TAGS")}function Rr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Dr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Rr(Object(r),!0).forEach((function(t){(0,b.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Rr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const zr=function(){function e(){(0,a.default)(this,e),this.maxRetries=2,this.retryDelay=1e3,E.info("Enhanced SpeechToTextService initialized for multi-language support")}return(0,i.default)(e,[{key:"transcribeAudio",value:function(){var e=(0,n.default)((function*(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.languageCodes,n=t.maxAlternatives,o=void 0===n?3:n,a=(t.enableWordConfidence,t.enableSecretTagDetection),i=void 0===a||a;E.info("Requesting enhanced transcription for audio file: "+e+", Languages: "+(r?r.join(", "):"auto-detect")+", Max alternatives: "+o+", Secret tag detection: "+i);try{r&&r.length>0&&this._validateLanguageCodes(r);try{return yield this._performTranscription(e,r,i)}catch(l){var s;if(401===(null==(s=l.response)?void 0:s.status))return E.info("Got 401, manually refreshing token and retrying..."),yield this._retryWithTokenRefresh(e,r,i);throw this._createTranscriptionError(l)}}catch(c){throw E.error("Failed to transcribe audio via enhanced backend API",{message:c.message,type:c.type||"unknown",languageCodes:r,audioPath:e}),c}}));return function(t){return e.apply(this,arguments)}}()},{key:"_validateLanguageCodes",value:function(e){if(e.length>4)throw this._createTranscriptionError({type:"validation",message:"Too many language codes. Maximum 4 allowed, got "+e.length});var t=e.filter((function(e){return"auto"!==e&&!Ze(e)}));if(t.length>0)throw this._createTranscriptionError({type:"validation",message:"Invalid language codes: "+t.join(", ")+". Please use supported language codes."})}},{key:"_performTranscription",value:function(){var e=(0,n.default)((function*(e,t){var r,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=yield this._createFormData(e);t&&t.length>0&&(o.append("language_codes_json",JSON.stringify(t)),E.info("Added language codes to request: "+JSON.stringify(t)));var a=yield x.default.getItem("access_token");if(!a)throw this._createTranscriptionError({type:"authentication",message:"Authentication token not found"});E.info("Sending enhanced audio file to backend /api/speech/transcribe...");var i=yield I.post("/api/speech/transcribe",o,{headers:{Authorization:"Bearer "+a},timeout:3e4});return E.info("Enhanced transcription received successfully. Transcript length: "+((null==(r=i.data.transcript)?void 0:r.length)||0)),yield this._processTranscriptionResponse(i.data,n)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createFormData",value:function(){var e=(0,n.default)((function*(e){var t=new FormData;if("web"===k.default.OS){E.info("Web platform detected, fetching blob data...");var r=yield fetch(e),n=yield r.blob(),o="recording-"+Date.now()+".wav";t.append("file",new File([n],o,{type:n.type||"audio/wav"})),E.info("Appended blob to FormData: "+o+", type: "+(n.type||"audio/wav")+", size: "+n.size)}else{var a,i=yield j.getInfoAsync(e);if(!i.exists)throw this._createTranscriptionError({type:"validation",message:"Audio file not found: "+e});var s=i.uri,l=null==(a=s.split(".").pop())?void 0:a.toLowerCase(),c=this._getAudioMimeType(l),d=s.split("/").pop()||"recording-"+Date.now()+"."+l;t.append("file",{uri:s,name:d,type:c}),E.info("Appended native file to FormData: "+d+", type: "+c)}return t}));return function(t){return e.apply(this,arguments)}}()},{key:"_getAudioMimeType",value:function(e){return{wav:"audio/wav",mp3:"audio/mpeg",mp4:"audio/mp4",m4a:"audio/mp4",aac:"audio/aac",ogg:"audio/ogg",webm:"audio/webm",flac:"audio/flac"}[e||"wav"]||"audio/wav"}},{key:"_processTranscriptionResponse",value:function(){var e=(0,n.default)((function*(e,t){var r,n,o,a,i={transcript:e.transcript||"",detected_language_code:e.detected_language_code||void 0,confidence:"number"===typeof e.confidence?e.confidence:.8,alternatives:Array.isArray(e.alternatives)?e.alternatives:[],word_confidence:Array.isArray(e.word_confidence)?e.word_confidence:[],language_confidence:"number"===typeof e.language_confidence?e.language_confidence:.8,quality_metrics:Dr({average_confidence:(null==(r=e.quality_metrics)?void 0:r.average_confidence)||.8,low_confidence_words:(null==(n=e.quality_metrics)?void 0:n.low_confidence_words)||0,total_words:(null==(o=e.quality_metrics)?void 0:o.total_words)||0},e.quality_metrics)};if(Pr()&&t&&i.transcript.trim())try{E.info('[OPAQUE Voice Detection] Starting detection for transcript: "'+i.transcript+'"');var s=yield nr.checkForSecretPhrase(i.transcript);i.secret_tag_detected=s,E.info("[OPAQUE Voice Detection] Detection result:",s),s.found?(E.info("OPAQUE secret phrase authenticated: "+s.tagName+" ("+s.action+")"),yield this._handleOpaqueTagDetection(s)):E.info('[OPAQUE Voice Detection] No secret phrases authenticated in: "'+i.transcript+'"')}catch(c){E.error("Error during OPAQUE voice detection:",c),i.secret_tag_detected={found:!1}}else{i.secret_tag_detected={found:!1};var l=Pr()?i.transcript.trim()?"Detection disabled by option":"Skipped - empty transcript":"Disabled by global feature flag";E.info("[OPAQUE Voice Detection] "+l)}return E.info("Transcription quality metrics - Avg confidence: "+i.quality_metrics.average_confidence.toFixed(2)+", Low confidence words: "+i.quality_metrics.low_confidence_words+"/"+i.quality_metrics.total_words+", Language confidence: "+i.language_confidence.toFixed(2)+", Secret tag detected: "+((null==(a=i.secret_tag_detected)?void 0:a.found)||!1)),i}));return function(t,r){return e.apply(this,arguments)}}()},{key:"_handleOpaqueTagDetection",value:function(){var e=(0,n.default)((function*(e){try{if("panic"===e.action)return void E.warn("Panic mode detected via OPAQUE authentication");e.tagId&&("activate"===e.action?E.info("OPAQUE secret tag session activated: "+e.tagName):"deactivate"===e.action&&E.info("OPAQUE secret tag session deactivated: "+e.tagName))}catch(t){E.error("Failed to handle OPAQUE tag detection:",t)}}));return function(t){return e.apply(this,arguments)}}()},{key:"_retryWithTokenRefresh",value:function(){var e=(0,n.default)((function*(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];try{var n=yield x.default.getItem("refresh_token");if(!n)throw this._createTranscriptionError({type:"authentication",message:"No refresh token available for retry"});E.info("Attempting to refresh access token...");var o=yield S.default.post("/api/v1/auth/refresh",{refresh_token:n});if(o.data.access_token)return yield x.default.setItem("access_token",o.data.access_token),o.data.refresh_token&&(yield x.default.setItem("refresh_token",o.data.refresh_token)),E.info("Token refreshed successfully, retrying transcription..."),yield this._performTranscription(e,t,r);throw this._createTranscriptionError({type:"authentication",message:"Token refresh failed - no access token received"})}catch(a){throw E.error("Token refresh failed:",a),this._createTranscriptionError({type:"authentication",message:"Authentication failed and token refresh unsuccessful"})}}));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createTranscriptionError",value:function(e){var t;if(e.type&&e.message)return e;var r="unknown",n="Unknown transcription error";if(e.response){var o,a=e.response.status,i=(null==(o=e.response.data)?void 0:o.detail)||e.response.statusText;401===a?(r="authentication",n="Authentication failed"):422===a?(r="validation",n=i||"Validation error"):a>=500?(r="server",n=i||"Server error"):(r="network",n=i||"HTTP "+a+" error")}else e.request?(r="network",n="Network error - unable to reach server"):n=e.message||"Unknown error occurred";return{type:r,message:n,details:(null==(t=e.response)?void 0:t.data)||e}}},{key:"getQualityAssessment",value:function(e){var t,r,n=e.confidence,o=e.quality_metrics.total_words>0?e.quality_metrics.low_confidence_words/e.quality_metrics.total_words:0,a=[];return n>=.9&&o<.1?r="excellent":n>=.8&&o<.2?r="good":n>=.7&&o<.3?(r="fair",a.push("Consider speaking more clearly for better accuracy")):(r="poor",a.push("Try speaking more slowly and clearly"),a.push("Ensure you are in a quiet environment"),e.alternatives.length>0&&a.push("Check alternative transcriptions below")),o>.2&&a.push("Some words had low confidence - review the transcript carefully"),e.detected_language_code||a.push("Language detection failed - try selecting specific languages"),null!=(t=e.secret_tag_detected)&&t.found&&a.push("Secret tag detected: "+(e.secret_tag_detected.tagName||"Unknown")),{overall:r,confidence:n,recommendations:a}}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}])}().getInstance();var Br=r(1632);function _r(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Lr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_r(Object(r),!0).forEach((function(t){(0,b.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_r(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Nr={quality:"HIGH_QUALITY",autoStart:!1,filePrefix:"recording_",requestPermissionOnMount:!0,maxDuration:0};const Mr=function(e){var t=j.documentDirectory+"recordings/",r=Lr(Lr({},Nr),e),a=(0,d.useState)(null),i=(0,o.default)(a,2),s=i[0],l=i[1],c=(0,d.useState)(!1),u=(0,o.default)(c,2),f=u[0],g=u[1],y=(0,d.useState)(0),p=(0,o.default)(y,2),h=p[0],m=p[1],v=(0,d.useState)(null),b=(0,o.default)(v,2),x=b[0],S=b[1],w=(0,d.useState)(!1),C=(0,o.default)(w,2),T=C[0],O=C[1],F=(0,d.useState)(null),I=(0,o.default)(F,2),A=I[0],P=I[1],R=(0,d.useRef)(null),D=(0,d.useRef)(0),z=(0,d.useRef)(null),B=(0,d.useRef)(!1),_=(0,d.useRef)(!1);(0,d.useEffect)((function(){z.current=s}),[s]),(0,d.useEffect)((function(){E.debug("[useAudioRecording] recordingDuration updated: "+h+"s")}),[h]),(0,d.useEffect)((function(){return function(){E.info("[useAudioRecording] Component unmounting. Performing final cleanup."),R.current&&(E.info("[useAudioRecording] Unmount: Clearing timer interval."),clearInterval(R.current),R.current=null),z.current&&(E.warn("[useAudioRecording] Unmount: Stopping and unloading active Audio.Recording object."),z.current.stopAndUnloadAsync().catch((function(e){return E.error("Error stopping/unloading recording on unmount",e)})),z.current=null)}}),[]);var L=(0,d.useCallback)((0,n.default)((function*(){if(B.current)E.debug("[useAudioRecording] Permission request already in progress.");else{B.current=!0,P(null);try{E.info("[useAudioRecording] Requesting audio permissions via Expo AV.");var e=yield Ve.requestPermissionsAsync(),t=e.granted,r=e.status;if(E.info("[useAudioRecording] Expo AV permission request result: granted="+t+", status="+r+"."),t)yield Ke.setAudioModeAsync({allowsRecordingIOS:!0,playsInSilentModeIOS:!0,staysActiveInBackground:!1,shouldDuckAndroid:!0,playThroughEarpieceAndroid:!1}),E.info("[useAudioRecording] Audio mode set successfully after permission grant."),O(!0);else{var n=new Error("Audio recording permission is needed to record audio.");E.warn("[useAudioRecording] Audio recording permission not granted by user."),P(n),O(!1)}}catch(A){var o=A instanceof Error?A:new Error("Failed to request permissions or set audio mode");E.error("[useAudioRecording] Catch block: Audio permission/setup error:",o),P(o),O(!1)}finally{B.current=!1}}})),[]),N=function(){var e=(0,n.default)((function*(){"web"!==k.default.OS&&((yield j.getInfoAsync(t)).exists||(E.info("Creating directory for recordings: "+t),yield j.makeDirectoryAsync(t,{intermediates:!0})))}));return function(){return e.apply(this,arguments)}}(),M=(0,d.useCallback)((0,n.default)((function*(){if(s){E.info("Stopping audio recording..."),g(!1);var e=D.current?Math.floor((Date.now()-D.current)/1e3):0;E.info("[useAudioRecording] Final duration: "+e+"s"),R.current&&(clearInterval(R.current),R.current=null),m(e),D.current=0;try{yield s.stopAndUnloadAsync();var t=s.getURI();E.info("Recording stopped. URI: "+t+", duration: "+e+"s"),S(t),l(null)}catch(n){var r=n instanceof Error?n:new Error("Failed to stop recording");E.error("Failed to stop and unload recording",r),P(r),S(null)}}else E.warn("stopRecording called when no recording is active.")})),[s]),H=(0,d.useCallback)((0,n.default)((function*(){if(P(null),E.info("[useAudioRecording] Attempting to start recording..."),!T)return E.error("[useAudioRecording] startRecording: Permissions are NOT granted. Aborting recording attempt."),void P(new Error("Audio recording permission has not been granted. Please grant permission first."));if(f)E.warn("[useAudioRecording] startRecording called while already recording. Ignoring call.");else try{R.current&&(clearInterval(R.current),R.current=null),E.info("[useAudioRecording] Ensuring recording directory exists..."),yield N(),E.info("[useAudioRecording] Setting audio mode for recording..."),yield Ke.setAudioModeAsync({allowsRecordingIOS:!0,playsInSilentModeIOS:!0,shouldDuckAndroid:!0,playThroughEarpieceAndroid:!1,staysActiveInBackground:!1});var e=r.quality||"HIGH_QUALITY",t=Lr({},Br.RecordingOptionsPresets[e]);"web"===k.default.OS&&(t.web={mimeType:"audio/webm"}),E.info("[useAudioRecording] Creating recording instance...");var n=(yield Ve.Recording.createAsync(t)).recording;l(n),m(0);var o=Date.now();D.current=o,E.info("[useAudioRecording] Setting start time to "+o),g(!0),S(null),E.info("[useAudioRecording] Starting timer interval..."),R.current=setInterval((function(){var e=Date.now();if(!D.current)return E.warn("[useAudioRecording] Timer tick with invalid startTimeRef (0). Clearing interval."),void(R.current&&(clearInterval(R.current),R.current=null));var t=Math.floor((e-D.current)/1e3);E.info("Timer tick: current="+e+", start="+D.current+", elapsed="+t+"s"),t>=0&&t<86400?m(t):E.warn("[useAudioRecording] Invalid elapsed time calculated: "+t+"s. Ignoring this tick."),r.maxDuration&&r.maxDuration>0&&t>=r.maxDuration&&(E.info("Max duration reached: "+t+"s, stopping"),R.current&&(clearInterval(R.current),R.current=null),M())}),1e3),E.info("[useAudioRecording] Started audio recording successfully")}catch(i){var a=i instanceof Error?i:new Error("Failed to start recording");E.error("[useAudioRecording] Failed to start recording",a),P(a),g(!1),D.current=0,R.current&&(clearInterval(R.current),R.current=null)}})),[f,r.quality,r.maxDuration,M,N]);(0,d.useCallback)((function(){if(D.current){var e=Date.now(),t=Math.floor((e-D.current)/1e3);E.info("[useAudioRecording] Timer tick, now: "+e+", start: "+D.current+", elapsed: "+t+"s"),m(t),r.maxDuration&&r.maxDuration>0&&t>=r.maxDuration&&(E.info("[useAudioRecording] Max duration of "+r.maxDuration+"s reached, stopping recording"),M())}else E.warn("[useAudioRecording] updateTimer called but startTimeRef is not set")}),[r.maxDuration,M]);(0,d.useEffect)((function(){var e=!1,t=function(){var t=(0,n.default)((function*(){!r.requestPermissionOnMount||T?T&&r.autoStart&&!f&&!_.current?e||(E.info("[useAudioRecording] Mount/PermissionEffect: Permissions granted. Auto-start conditions met. Calling startRecording."),_.current=!0,H()):T&&r.autoStart&&f?E.debug("[useAudioRecording] Mount/PermissionEffect: Permissions granted and auto-start enabled, but already recording."):T&&!r.autoStart?E.debug("[useAudioRecording] Mount/PermissionEffect: Permissions granted, but auto-start is not enabled."):T&&r.autoStart&&_.current&&E.debug("[useAudioRecording] Mount/PermissionEffect: Auto-start already attempted, skipping to prevent infinite loop."):B.current?E.debug("[useAudioRecording] Mount/PermissionEffect: Permission request already in progress. Waiting for completion."):(E.info("[useAudioRecording] Mount/PermissionEffect: Permissions not granted and no request in progress. Initiating request."),L())}));return function(){return t.apply(this,arguments)}}();return t(),function(){e=!0}}),[r.requestPermissionOnMount,r.autoStart,T,f,L,H]);var W=(0,d.useCallback)(function(){var e=(0,n.default)((function*(e){if(e&&"web"!==k.default.OS)try{(yield j.getInfoAsync(e)).exists&&(E.info("Cleaning up temporary recording file: "+e),yield j.deleteAsync(e))}catch(t){E.error("Failed to delete recording file "+e,t)}}));return function(t){return e.apply(this,arguments)}}(),[]);return{isRecording:f,recordingDuration:h,audioUri:x,startRecording:H,stopRecording:M,cleanupRecordingFile:W,permissionGranted:T,error:A}};const Hr=function(e){var t=e.onOpen,r=e.onClose,a=e.onMessage,i=e.onInterimTranscript,s=e.onFinalTranscript,l=e.onTranscriptionError,c=e.onStatusUpdate,u=(0,d.useRef)(null),f=(0,d.useState)("disconnected"),g=(0,o.default)(f,2),y=g[0],p=g[1],h=(0,d.useState)(null),m=(0,o.default)(h,2),v=m[0],b=m[1];(0,d.useEffect)((function(){return x.default.getItem("access_token").then((function(e){e?b(e):E.warn("WebSocket: Auth token not found on initial load.")})),function(){u.current&&(E.info("useWebSocketTranscription unmounting, closing WebSocket."),u.current.onclose=null,u.current.onerror=null,u.current.onmessage=null,u.current.onopen=null,u.current.close(),u.current=null)}}),[]);var S=(0,d.useCallback)((0,n.default)((function*(){var e,n;if(u.current&&u.current.readyState===WebSocket.OPEN)return E.info("WebSocket already connected."),p("connected"),void(null==t||t());if("connecting"!==y){var o=v;if(o||(E.info("WebSocket: Auth token not in state, re-fetching..."),o=yield x.default.getItem("access_token")),!o)return E.error("WebSocket: Cannot connect. No auth token found (key: access_token)."),p("error"),null==l||l("Authentication Error: Missing token."),void ft.default.alert("Authentication Error","Could not connect to transcription service. Please log in again.");b(o),p("connecting"),E.info("Attempting WebSocket connection...");var d=((null==(e=w.default.expoConfig)||null==(n=e.extra)?void 0:n.apiUrl)||"http://localhost:8001").replace(/^http/,"ws")+"/ws/transcribe";E.info("Connecting to WebSocket: "+d);try{var f=new WebSocket(d);u.current=f,f.onopen=function(){E.info("WebSocket Connected!"),p("connected"),f.send(JSON.stringify({type:"auth",token:o})),null==t||t()},f.onmessage=function(e){try{var t=JSON.parse(e.data);E.debug("WebSocket message received:",t),null==a||a(t),"interim_transcript"===t.type?null==i||i(t.text):"final_transcript"===t.type?null==s||s(t.text,t.language_code):"error"===t.type?(E.error("WebSocket server error:",t.message),null==l||l(t.message)):"status"===t.type?(E.info("WebSocket status update:",t.message),null==c||c(t.message)):"language_detected"===t.type&&E.info("Language detected by server:",t.code)}catch(Ao){E.error("Failed to parse WebSocket message:",Ao),null==l||l("Received malformed message from server.")}},f.onerror=function(e){E.error("WebSocket Error Event:",e),p("error"),null==l||l("WebSocket connection error. Please try again.")},f.onclose=function(e){E.info("WebSocket Closed:",{code:e.code,reason:e.reason}),u.current=null,"error"!==y&&p("disconnected"),null==r||r({code:e.code,reason:e.reason})}}catch(Ao){E.error("Failed to create WebSocket object or initial connection error:",Ao),p("error"),null==l||l("Could not establish connection to transcription service."),u.current=null}}else E.info("WebSocket connection attempt already in progress.")})),[v,y,t,r,a,i,s,l,c]),j=(0,d.useCallback)((function(){u.current&&(E.info("Manually disconnecting WebSocket..."),u.current.close())}),[]),C=(0,d.useCallback)((function(e){if(!u.current||u.current.readyState!==WebSocket.OPEN)return E.warn("Cannot send WebSocket message: Connection not open."),!1;try{var t="string"===typeof e?e:JSON.stringify(e);return u.current.send(t),E.debug("WebSocket message sent:",t),!0}catch(r){return E.error("Failed to send WebSocket message:",r),null==l||l("Failed to send message to server."),!1}}),[l]);return{wsStatus:y,connect:S,disconnect:j,sendMessage:C}};var Wr=function(e){var t=e.onTranscriptionComplete,r=e.onCancel,a=e.autoStart,i=void 0!==a&&a,s=e.onAutoSave,l=cr().settings,c=(0,d.useState)([]),u=(0,o.default)(c,2),f=u[0],g=u[1],y=(0,d.useState)(""),p=(0,o.default)(y,2),h=p[0],m=p[1],v=(0,d.useState)(!1),b=(0,o.default)(v,2),x=b[0],S=b[1],w=(0,d.useState)(null),j=(0,o.default)(w,2),C=j[0],T=j[1],O=(0,d.useState)(!1),F=(0,o.default)(O,2),I=F[0],A=F[1],P=(0,d.useState)(l.defaultLanguage),R=(0,o.default)(P,2),D=R[0],z=R[1];(0,d.useEffect)((function(){z(l.defaultLanguage),E.info("[AudioRecorderLogic] Default language updated to: "+l.defaultLanguage)}),[l.defaultLanguage]);var B=(0,d.useRef)(new Ge.default.Value(1)).current,_=(0,d.useRef)(new Ge.default.Value(0)).current,L=(0,d.useRef)(new Ge.default.Value(0)).current,N=Mr({requestPermissionOnMount:!0,autoStart:i}),M=N.isRecording,H=N.recordingDuration,W=N.audioUri,U=N.startRecording,V=N.stopRecording,K=N.cleanupRecordingFile,q=N.permissionGranted,Q=N.error,G=(0,d.useState)(!1),J=(0,o.default)(G,2),Y=J[0],Z=J[1],X=(0,d.useState)(new Set),$=(0,o.default)(X,2),ee=$[0],te=$[1],re=(0,d.useState)(!1),ne=(0,o.default)(re,2),oe=ne[0],ae=ne[1],ie=(0,d.useRef)(!0),se=(0,d.useRef)(!1);(0,d.useEffect)((function(){M?(Ge.default.loop(Ge.default.sequence([Ge.default.timing(B,{toValue:1.1,duration:700,useNativeDriver:"web"!==k.default.OS}),Ge.default.timing(B,{toValue:1,duration:700,useNativeDriver:"web"!==k.default.OS})])).start(),Ge.default.loop(Ge.default.stagger(300,[Ge.default.sequence([Ge.default.timing(_,{toValue:1,duration:800,useNativeDriver:"web"!==k.default.OS}),Ge.default.timing(_,{toValue:0,duration:800,useNativeDriver:"web"!==k.default.OS})]),Ge.default.sequence([Ge.default.timing(L,{toValue:1,duration:800,useNativeDriver:"web"!==k.default.OS}),Ge.default.timing(L,{toValue:0,duration:800,useNativeDriver:"web"!==k.default.OS})])])).start()):(B.stopAnimation(),B.setValue(1),_.stopAnimation(),_.setValue(0),L.stopAnimation(),L.setValue(0))}),[M,B,_,L]);var le=(0,d.useCallback)((function(e){E.error("WebSocket Transcription Error:",e),ie.current&&(Z(!1),m("Error with live transcription."))}),[]),ce=(0,d.useCallback)((function(e){E.debug("Interim transcript received (WS):",e),ie.current&&m((function(t){return t+e}))}),[]),de=(0,d.useCallback)((function(e,t){E.info("Final transcript (WS): "+e+", lang: "+t),ie.current&&m(e+" ")}),[]),ue=Hr({onInterimTranscript:ce,onFinalTranscript:de,onTranscriptionError:le,onOpen:function(){return E.info("AudioRecorder: WebSocket connection opened.")},onClose:function(e){return E.info("AudioRecorder: WebSocket connection closed.",e)}}),fe=(ue.wsStatus,ue.connect,ue.disconnect);ue.sendMessage;(0,d.useEffect)((function(){return ie.current=!0,E.info("AudioRecorder: Component did mount."),g([]),m(""),S(!1),T(null),A(!1),se.current=!1,ae(!1),function(){E.info("AudioRecorder: Component will unmount. Performing final cleanup."),ie.current=!1,fe()}}),[]),(0,d.useEffect)((function(){if(q){var e=function(){var e=(0,n.default)((function*(){E.info("[AudioRecorder] Permission is granted, ensuring audio mode is set.");try{yield Ke.setAudioModeAsync({allowsRecordingIOS:!0,playsInSilentModeIOS:!0,shouldDuckAndroid:!0,playThroughEarpieceAndroid:!1}),E.info("[AudioRecorder] Audio mode set successfully (on permissionGranted change).")}catch(e){E.error("[AudioRecorder] Failed to set audio mode (on permissionGranted change):",e)}}));return function(){return e.apply(this,arguments)}}();e()}}),[q]);var ge=(0,d.useCallback)((function(){E.info("AudioRecorder: handleDone (X button) called, closing recorder and discarding changes."),ie.current&&(M&&V().catch((function(e){return E.error("Error stopping recording during handleDone:",e)})),r())}),[M,V,r]),ye=(0,d.useCallback)((function(){if(ie.current&&!se.current){var e=f.join("\n").trim();if(e){se.current=!0,ae(!0);var r=(null==C?void 0:C.confidence)||0,n=null==C?void 0:C.detected_language_code;E.info('Accepting enhanced transcript: "'+e.substring(0,50)+'...", confidence: '+r.toFixed(2)+", language: "+(n||"unknown")),ot.success(),t(e,W||void 0,n,r)}else E.warn("No transcript to accept.")}}),[f,C,W,t]),pe=function(){var e=(0,n.default)((function*(e,t){if(ie.current&&!ee.has(e)){te((function(t){return new Set(t).add(e)})),S(!0),m("Processing...");try{var r;E.info("[processSegment] Starting transcription for "+e+" with language: "+t);var n="auto"===t?void 0:[t],o=yield zr.transcribeAudio(e,{languageCodes:n,maxAlternatives:3,enableWordConfidence:!0,enableSecretTagDetection:!0});if(!ie.current)return void E.info("[processSegment] Component unmounted during transcription, ignoring result.");T(o);var a=zr.getQualityAssessment(o),i=null==(r=o.transcript)?void 0:r.trim();if(i){var c;if(null!=(c=o.secret_tag_detected)&&c.found){var d=function(e,t){if(null==t||!t.tagName)return!1;var r=function(e){return e.toLowerCase().replace(/[^a-z0-9]/g,"")},n=r(e),o=r(t.tagName),a=n===o;return a?E.info('[shouldTreatAsSecretTagCommand] Exact match found - transcript: "'+n+'" matches phrase: "'+o+'"'):E.info('[shouldTreatAsSecretTagCommand] No exact match - transcript: "'+n+'" vs phrase: "'+o+'"'),a}(i,o.secret_tag_detected);if(d){E.info('[processSegment] Secret tag command detected - not adding "'+i+'" to transcript segments');var u="activate"===o.secret_tag_detected.action?"activated":"deactivated";return m("Secret tag "+u+" successfully"),void setTimeout((function(){ie.current&&m("")}),2e3)}E.info('[processSegment] Secret tag detected but treating as normal content: "'+i+'"')}var f=i.charAt(0).toUpperCase()+i.slice(1);E.info('[processSegment] Transcription completed - Text: "'+i.substring(0,50)+'...", Confidence: '+o.confidence.toFixed(2)+", Language: "+(o.detected_language_code||t)+", Quality: "+a.overall+", Alternatives: "+o.alternatives.length),a.recommendations.length>0&&E.info("Quality recommendations: "+a.recommendations.join(", ")),g((function(e){var t=[].concat((0,dt.default)(e),[f]);if(E.info("[processSegment] Updated transcript segments: "+t.length+' segments, latest: "'+f+'"'),l.autoSaveEnabled&&s){var r=t.join("\n");E.info('[AutoSave] Triggering auto-save due to new segment. Full transcript: "'+r+'"'),setTimeout((function(){s(r)}),0)}return t})),m("")}else m("No speech detected in this segment."),E.warn("[processSegment] No transcript received from service.")}catch(y){E.error("[processSegment] Transcription failed:",y),ie.current&&m("Error: "+(y.message||"Transcription failed"))}finally{ie.current&&S(!1);try{yield K(e),E.info("[processSegment] Cleaned up audio file: "+e)}catch(p){E.error("[processSegment] Failed to clean up audio file "+e+":",p)}}}else E.info("[processSegment] Skipping "+e+" - component unmounted or already processed.")}));return function(t,r){return e.apply(this,arguments)}}();(0,d.useEffect)((function(){if(W&&!M&&!ee.has(W)&&q){if("auto"!==D&&!Ze(D))return E.error("Invalid language selection: "+D),ft.default.alert("Language Selection Error","Invalid language selected. Using auto-detect."),void z("auto");E.info("[AudioRecorder] useEffect detected new audioUri: "+W+" for language: "+D+". Starting processSegment."),pe(W,D)}}),[W,M,ee,q,D]);var he=function(){var e=(0,n.default)((function*(){if(!q)return ft.default.alert("Permissions Required","Audio recording permission is needed to record."),void E.warn("Mic pressed but permission not granted.");if(M){E.info("[AudioRecorder] Mic press: Stopping current recording segment."),ot.medium();try{yield V()}catch(e){E.error("[AudioRecorder] Error stopping recording segment:",e)}}else{if(x)return E.info("[AudioRecorder] Mic press: Still transcribing previous segment. Please wait."),ot.warning(),void ft.default.alert("Processing","Still processing the previous audio. Please wait a moment.");se.current=!1,E.info("[AudioRecorder] Mic press: Starting new recording segment."),ot.heavy();try{yield U()}catch(e){E.error("[AudioRecorder] Error starting new recording segment:",e),ft.default.alert("Error Starting Recording","Could not start a new recording. Please try again.")}}}));return function(){return e.apply(this,arguments)}}(),me=!M&&!x&&f.length>0;return{transcriptSegments:f,setTranscriptSegments:g,currentSegmentTranscript:h,isTranscribingSegment:x,lastTranscriptionResult:C,showAlternatives:I,setShowAlternatives:A,selectedLanguage:D,isProcessing:Y,hasTranscribedAudio:oe,canAcceptTranscript:me,pulseAnim:B,waveAnim1:_,waveAnim2:L,isRecording:M,recordingDuration:H,audioUri:W,permissionGranted:q,recordingError:Q,handleMicPress:he,handleAcceptTranscript:ye,handleDone:ge,handleLanguageChange:function(e){Ze(e)||"auto"===e?(z(e),E.info("Language changed to: "+e)):E.error("Invalid language code: "+e)},formatDuration:function(e){return Math.floor(e/60)+":"+(e%60).toString().padStart(2,"0")},sanitizeText:function(e){return e.replace(/^[\(\[\u2022\-\*]+\s*/g,"").trim()}}},Ur=r(1950);function Vr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Kr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Vr(Object(r),!0).forEach((function(t){(0,b.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Vr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var qr=zt.default.get("window").height,Qr="web"!==k.default.OS,Gr=(0,d.forwardRef)((function(e,t){var r=e.children,n=e.visible,o=e.onClose,a=e.snapPoints,i=void 0===a?[.3,.6,.9]:a,s=e.initialSnapPoint,l=void 0===s?1:s,c=e.enablePanGesture,u=void 0===c||c,f=e.backdropOpacity,g=void 0===f?.5:f,p=e.style,m=me().theme,v=Jr(m),b=(0,d.useRef)(new Ge.default.Value(qr)).current,x=(0,d.useRef)(new Ge.default.Value(0)).current,S=(0,d.useRef)(0),w=(0,d.useRef)(l),j=(0,d.useRef)(new Ge.default.Value(0)).current,C=i.map((function(e){return qr*(1-e)}));(0,d.useImperativeHandle)(t,(function(){return{snapTo:function(e){e>=0&&e<C.length&&(w.current=e,Ge.default.spring(b,{toValue:C[e],useNativeDriver:Qr}).start())},close:function(){o()}}})),(0,d.useEffect)((function(){n?(Ge.default.parallel([Ge.default.spring(b,{toValue:C[l],useNativeDriver:Qr}),Ge.default.timing(x,{toValue:1,duration:300,useNativeDriver:Qr})]).start(),w.current=l):Ge.default.parallel([Ge.default.spring(b,{toValue:qr,useNativeDriver:Qr}),Ge.default.timing(x,{toValue:0,duration:300,useNativeDriver:Qr})]).start()}),[n,l]);var T=(0,d.useCallback)(Ge.default.event([{nativeEvent:{translationY:j}}],{useNativeDriver:!1,listener:function(e){if(u){var t=e.nativeEvent.translationY;S.current=t}}}),[u,j]),E=(0,d.useCallback)((function(e){if(u&&e.nativeEvent.oldState===y.State.ACTIVE){var t=e.nativeEvent,r=t.translationY,n=t.velocityY,a=C[w.current]+r;j.setValue(0);var i=w.current;if(n>500){if((i=Math.min(w.current+1,C.length-1))===C.length-1&&r>100)return void o()}else if(n<-500)i=Math.max(w.current-1,0);else{var s=1/0;if(C.forEach((function(e,t){var r=Math.abs(a-e);r<s&&(s=r,i=t)})),a>.8*qr)return void o()}w.current=i,Ge.default.spring(b,{toValue:C[i],useNativeDriver:Qr}).start()}}),[u,C,o,b]);if(!n)return null;var O=Ge.default.add(b,j),F=(0,G.jsxs)(h.default,{style:v.container,children:[(0,G.jsx)(Ur.default,{onPress:function(){o()},children:(0,G.jsx)(Ge.default.View,{style:[v.backdrop,{opacity:x.interpolate({inputRange:[0,1],outputRange:[0,g]})}]})}),(0,G.jsx)(y.PanGestureHandler,{onGestureEvent:T,onHandlerStateChange:E,enabled:u,children:(0,G.jsxs)(Ge.default.View,{style:[v.bottomSheet,p,{transform:[{translateY:O}]}],children:[(0,G.jsx)(h.default,{style:v.handle}),(0,G.jsx)(h.default,{style:v.content,children:r})]})})]});return"ios"===k.default.OS?(0,G.jsx)(ke.default,{transparent:!0,visible:n,animationType:"none",onRequestClose:o,children:F}):F})),Jr=function(e){return v.default.create({container:{flex:1,justifyContent:"flex-end"},backdrop:Kr(Kr({},v.default.absoluteFillObject),{},{backgroundColor:e.colors.overlay}),bottomSheet:Kr({backgroundColor:e.colors.surface,borderTopLeftRadius:e.borderRadius.xxl,borderTopRightRadius:e.borderRadius.xxl,minHeight:.3*qr,maxHeight:.95*qr},e.shadows.xl),handle:{width:40,height:4,backgroundColor:e.colors.border,borderRadius:2,alignSelf:"center",marginTop:e.spacing.md,marginBottom:e.spacing.lg},content:{flex:1,paddingHorizontal:e.spacing.lg,paddingBottom:e.spacing.xl}})};const Yr=Gr;function Zr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Xr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Zr(Object(r),!0).forEach((function(t){(0,b.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Zr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var $r=function(e){return v.default.create({container:{marginVertical:e.spacing.md},selector:Xr({flexDirection:"row",alignItems:"center",justifyContent:"space-between",backgroundColor:e.colors.card,borderRadius:e.borderRadius.lg,paddingHorizontal:e.spacing.lg,paddingVertical:e.spacing.lg,borderWidth:1,borderColor:e.colors.border,minHeight:64},e.shadows.sm),selectorDisabled:{opacity:.6,backgroundColor:e.colors.disabled},selectorContent:{flexDirection:"row",alignItems:"center",flex:1},iconContainer:{width:40,height:40,borderRadius:e.borderRadius.lg,backgroundColor:e.colors.primaryLight+"20",justifyContent:"center",alignItems:"center",marginRight:e.spacing.md},textContainer:{flex:1},selectorLabel:{fontSize:e.typography.fontSizes.sm,color:e.colors.textSecondary,fontFamily:e.typography.fontFamilies.medium,marginBottom:e.spacing.xs},selectorText:{fontSize:e.typography.fontSizes.md,color:e.colors.text,fontFamily:e.typography.fontFamilies.semiBold},selectorTextDisabled:{color:e.colors.disabled},modalContent:{flex:1},modalHeader:{marginBottom:e.spacing.lg},modalTitle:{fontSize:e.typography.fontSizes.xl,fontWeight:"bold",color:e.colors.text,fontFamily:e.typography.fontFamilies.bold,marginBottom:e.spacing.xs},modalSubtitle:{fontSize:e.typography.fontSizes.sm,color:e.colors.textSecondary,fontFamily:e.typography.fontFamilies.regular},searchContainer:{marginBottom:e.spacing.lg},searchInputWrapper:{flexDirection:"row",alignItems:"center",backgroundColor:e.colors.inputBackground,borderRadius:e.borderRadius.lg,borderWidth:1,borderColor:e.colors.border,paddingHorizontal:e.spacing.md,minHeight:48},searchIcon:{marginRight:e.spacing.sm},searchInput:{flex:1,fontSize:e.typography.fontSizes.md,color:e.colors.text,fontFamily:e.typography.fontFamilies.regular,paddingVertical:e.spacing.md},clearButton:{padding:e.spacing.xs,marginLeft:e.spacing.sm},resultsCount:{fontSize:e.typography.fontSizes.sm,color:e.colors.textSecondary,fontFamily:e.typography.fontFamilies.regular,marginBottom:e.spacing.md,textAlign:"center"},languageList:{flex:1},languageItem:{flexDirection:"row",alignItems:"center",justifyContent:"space-between",paddingVertical:e.spacing.lg,paddingHorizontal:e.spacing.md,borderRadius:e.borderRadius.md,marginBottom:e.spacing.xs,minHeight:72},selectedLanguageItem:{backgroundColor:e.colors.primaryLight+"20",borderWidth:1,borderColor:e.colors.primaryLight+"40"},languageInfo:{flex:1},languageName:{fontSize:e.typography.fontSizes.md,color:e.colors.text,fontFamily:e.typography.fontFamilies.semiBold,marginBottom:e.spacing.xs},selectedLanguageName:{color:e.colors.primary},languageCode:{fontSize:e.typography.fontSizes.sm,color:e.colors.textSecondary,fontFamily:e.typography.fontFamilies.regular},selectedLanguageCode:{color:e.colors.primary},checkmarkContainer:{marginLeft:e.spacing.md},emptyState:{alignItems:"center",justifyContent:"center",paddingVertical:e.spacing.xxxl},emptyStateText:{fontSize:e.typography.fontSizes.lg,color:e.colors.textSecondary,fontFamily:e.typography.fontFamilies.semiBold,marginTop:e.spacing.md,marginBottom:e.spacing.xs},emptyStateSubtext:{fontSize:e.typography.fontSizes.sm,color:e.colors.textDisabled,fontFamily:e.typography.fontFamilies.regular}})};const en=function(e){var t=e.selectedLanguage,r=e.onLanguageChange,n=e.disabled,a=void 0!==n&&n,i=me().theme,s=$r(i),l=(0,d.useState)(!1),c=(0,o.default)(l,2),u=c[0],f=c[1],g=(0,d.useState)(""),y=(0,o.default)(g,2),p=y[0],v=y[1],b=((0,d.useRef)(null),function(e){var t=Ye.find((function(t){return t.code===e}));if(t)return"auto"===t.code?t.name:t.region?t.name+" ("+t.region+")":t.name;var r=e.split("-")[0],n=Ye.find((function(e){return e.code.startsWith(r+"-")}));return n?n.region?n.name+" ("+n.region+")":n.name:null}(t)||"Auto-detect"),x=Ye.filter((function(e){if(!p.trim())return!0;var t=p.toLowerCase();return e.name.toLowerCase().includes(t)||e.code.toLowerCase().includes(t)||e.region&&e.region.toLowerCase().includes(t)}));return(0,G.jsxs)(h.default,{style:s.container,children:[(0,G.jsxs)(ne.default,{style:[s.selector,a&&s.selectorDisabled],onPress:function(){a||f(!0)},disabled:a,accessibilityLabel:"Current language: "+b+". Tap to change.",accessibilityRole:"button",accessibilityHint:"Opens language selection menu",children:[(0,G.jsxs)(h.default,{style:s.selectorContent,children:[(0,G.jsx)(h.default,{style:s.iconContainer,children:(0,G.jsx)(ae.default,{name:"language",size:22,color:a?i.colors.disabled:i.colors.primary})}),(0,G.jsxs)(h.default,{style:s.textContainer,children:[(0,G.jsx)(m.default,{style:s.selectorLabel,children:"Language"}),(0,G.jsx)(m.default,{style:[s.selectorText,a&&s.selectorTextDisabled],children:b})]})]}),(0,G.jsx)(ae.default,{name:"chevron-down",size:20,color:a?i.colors.disabled:i.colors.textSecondary})]}),(0,G.jsx)(Yr,{visible:u,onClose:function(){f(!1),v("")},snapPoints:[.7,.9],initialSnapPoint:0,children:(0,G.jsxs)(h.default,{style:s.modalContent,children:[(0,G.jsxs)(h.default,{style:s.modalHeader,children:[(0,G.jsx)(m.default,{style:s.modalTitle,children:"Select Language"}),(0,G.jsx)(m.default,{style:s.modalSubtitle,children:"Choose your preferred language for voice transcription"})]}),(0,G.jsx)(h.default,{style:s.searchContainer,children:(0,G.jsxs)(h.default,{style:s.searchInputWrapper,children:[(0,G.jsx)(ae.default,{name:"search",size:20,color:i.colors.textSecondary,style:s.searchIcon}),(0,G.jsx)(re.default,{style:s.searchInput,value:p,onChangeText:v,placeholder:"Search languages...",placeholderTextColor:i.colors.textSecondary,returnKeyType:"search",autoCorrect:!1,autoCapitalize:"none"}),p.length>0&&(0,G.jsx)(ne.default,{onPress:function(){return v("")},style:s.clearButton,accessibilityLabel:"Clear search",children:(0,G.jsx)(ae.default,{name:"close-circle",size:20,color:i.colors.textSecondary})})]})}),p.trim()&&(0,G.jsxs)(m.default,{style:s.resultsCount,children:[x.length," language",1===x.length?"":"s"," found"]}),(0,G.jsx)(Vt.default,{data:x,keyExtractor:function(e){return e.code},renderItem:function(e){var n=e.item;return(0,G.jsxs)(ne.default,{style:[s.languageItem,n.code===t&&s.selectedLanguageItem],onPress:function(){return e=n.code,r(e),f(!1),void v("");var e},accessibilityLabel:"Select "+n.name+" language",accessibilityRole:"button",children:[(0,G.jsxs)(h.default,{style:s.languageInfo,children:[(0,G.jsx)(m.default,{style:[s.languageName,n.code===t&&s.selectedLanguageName],children:n.region?n.name+" ("+n.region+")":n.name}),(0,G.jsx)(m.default,{style:[s.languageCode,n.code===t&&s.selectedLanguageCode],children:n.code})]}),n.code===t&&(0,G.jsx)(h.default,{style:s.checkmarkContainer,children:(0,G.jsx)(ae.default,{name:"checkmark-circle",size:24,color:i.colors.primary})})]})},style:s.languageList,showsVerticalScrollIndicator:!0,ListEmptyComponent:function(){return(0,G.jsxs)(h.default,{style:s.emptyState,children:[(0,G.jsx)(ae.default,{name:"search-outline",size:48,color:i.colors.textDisabled}),(0,G.jsx)(m.default,{style:s.emptyStateText,children:"No languages found"}),(0,G.jsx)(m.default,{style:s.emptyStateSubtext,children:"Try a different search term"})]})},keyboardShouldPersistTaps:"handled",getItemLayout:function(e,t){return{length:72,offset:72*t,index:t}},initialNumToRender:10,maxToRenderPerBatch:10,windowSize:10})]})})]})};function tn(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function rn(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?tn(Object(r),!0).forEach((function(t){(0,b.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tn(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var nn=function(e){e.isRecording;var t=e.waveAnim1,r=e.waveAnim2,n=e.theme,o=Array.from({length:12},(function(e,o){var a=o%2===0?t:r;return(0,G.jsx)(Ge.default.View,{style:[{width:3,backgroundColor:n.colors.primary,marginHorizontal:1,borderRadius:1.5},{height:a.interpolate({inputRange:[0,1],outputRange:[8,25+15*Math.random()]})}]},o)}));return(0,G.jsx)(h.default,{style:{flexDirection:"row",alignItems:"center",justifyContent:"center",height:40,marginVertical:n.spacing.sm},children:o})},on=function(e){return v.default.create({container:{flex:1,backgroundColor:"transparent"},topBar:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",paddingHorizontal:e.spacing.lg,paddingTop:e.spacing.md,paddingBottom:e.spacing.sm},topRightIcons:{flexDirection:"row",alignItems:"center",gap:12},timerTextTopLeft:{fontSize:32,fontWeight:"300",color:e.colors.text,fontFamily:"ios"===k.default.OS?"Helvetica Neue":"Roboto"},languageButton:{padding:8,borderRadius:20,backgroundColor:e.colors.surface,borderWidth:1,borderColor:e.colors.border},lockButton:{padding:8,borderRadius:20,backgroundColor:e.colors.surface,borderWidth:1,borderColor:e.colors.border},recordingButtonContainer:{alignItems:"center",justifyContent:"center",marginVertical:e.spacing.lg},spacer:{flex:.3,minHeight:10},recordingButtonOuter:{width:120,height:120,borderRadius:60,backgroundColor:"rgba(99, 102, 241, 0.2)",alignItems:"center",justifyContent:"center"},recordingButton:{width:90,height:90,borderRadius:45,alignItems:"center",justifyContent:"center",elevation:4,shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.25,shadowRadius:4},recordingButtonInner:{alignItems:"center",justifyContent:"center"},stopIcon:{width:24,height:24,backgroundColor:"white",borderRadius:4},recordingStatusText:{fontSize:16,color:"#E53E3E",fontWeight:"500",marginTop:e.spacing.sm,textAlign:"center"},transcriptCard:rn(rn({backgroundColor:e.colors.card,borderRadius:e.borderRadius.xl,marginHorizontal:e.spacing.md,marginTop:e.spacing.md,marginBottom:e.spacing.lg},e.shadows.md),{},{borderColor:e.colors.borderLight,borderWidth:e.isDarkMode?1:0,overflow:"hidden",flex:1,minHeight:250}),transcriptHeader:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",paddingHorizontal:e.spacing.lg,paddingVertical:e.spacing.md,backgroundColor:e.isDarkMode?e.colors.gray800:e.colors.gray50,borderBottomWidth:1,borderBottomColor:e.colors.borderLight},transcriptLabelContainer:{flexDirection:"row",alignItems:"center"},transcriptLabel:{fontSize:e.typography.fontSizes.md,fontWeight:"600",color:e.colors.text,marginLeft:e.spacing.sm,fontFamily:e.typography.fontFamilies.semiBold},saveButtonSmall:{backgroundColor:e.colors.primary,paddingHorizontal:e.spacing.md,paddingVertical:e.spacing.sm,borderRadius:e.borderRadius.full},saveButtonSmallDisabled:{backgroundColor:e.colors.disabled},saveButtonSmallText:{color:e.colors.onPrimary,fontSize:e.typography.fontSizes.sm,fontWeight:"600",fontFamily:e.typography.fontFamilies.semiBold},transcriptTextInput:{fontSize:e.typography.fontSizes.md,color:e.colors.text,lineHeight:e.typography.lineHeights.normal*e.typography.fontSizes.md,padding:e.spacing.lg,flex:1,textAlignVertical:"top",fontFamily:e.typography.fontFamilies.regular,backgroundColor:"transparent"},transcriptionContainer:{width:"100%",height:120,backgroundColor:e.colors.surface,borderRadius:16,borderWidth:1,borderColor:e.colors.border,marginTop:20,position:"relative"},transcriptionInput:{flex:1,fontSize:16,color:e.colors.text,lineHeight:22,padding:16,textAlignVertical:"top"},transcriptionScroll:{flex:1},transcriptionContent:{padding:16,minHeight:88},transcriptionText:{fontSize:16,color:e.colors.text,lineHeight:22},alternativesScroll:{maxHeight:80,paddingHorizontal:e.spacing.lg,paddingBottom:e.spacing.sm},transcriptionLoader:{position:"absolute",bottom:e.spacing.md,right:e.spacing.md},alternativesContainer:{marginTop:e.spacing.md,paddingTop:e.spacing.md,borderTopWidth:1,borderTopColor:e.colors.borderLight},alternativesTitle:{fontSize:e.typography.fontSizes.sm,fontWeight:"600",color:e.colors.textSecondary,marginBottom:e.spacing.sm,fontFamily:e.typography.fontFamilies.semiBold},alternativeItem:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",paddingVertical:e.spacing.sm,paddingHorizontal:e.spacing.md,backgroundColor:e.isDarkMode?e.colors.gray700:e.colors.gray100,borderRadius:e.borderRadius.md,marginBottom:e.spacing.xs,borderWidth:1,borderColor:e.colors.borderLight},alternativeText:{fontSize:e.typography.fontSizes.sm,color:e.colors.text,flex:1,fontFamily:e.typography.fontFamilies.regular},alternativeConfidence:{fontSize:e.typography.fontSizes.xs,color:e.colors.textSecondary,marginLeft:e.spacing.sm,fontWeight:"500",fontFamily:e.typography.fontFamilies.medium},modalOverlay:{flex:1,backgroundColor:"rgba(0, 0, 0, 0.5)",justifyContent:"center",alignItems:"center"},modalContent:{backgroundColor:e.colors.background,borderRadius:16,padding:20,width:"90%",maxHeight:"80%"},modalHeader:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",marginBottom:20},modalTitle:{fontSize:20,fontWeight:"bold",color:e.colors.text},modalCloseButton:{padding:4}})};const an=function(e){var t=e.transcriptSegments,r=e.setTranscriptSegments,n=e.currentSegmentTranscript,a=e.isTranscribingSegment,i=e.lastTranscriptionResult,s=e.showAlternatives,l=e.selectedLanguage,c=(e.isProcessing,e.canAcceptTranscript),u=(e.pulseAnim,e.waveAnim1),f=e.waveAnim2,g=e.isRecording,y=e.recordingDuration,p=e.permissionGranted,v=e.handleMicPress,b=e.handleAcceptTranscript,x=e.handleLanguageChange,S=e.formatDuration,w=e.setShowAlternatives,j=e.saveButtonState,C=(e.onClose,e.existingContent),k=e.onSaveWithCompleteText,T=me().theme,E=on(T),O=(0,d.useState)(!1),F=(0,o.default)(O,2),I=F[0],A=F[1],P=(0,d.useRef)(new Ge.default.Value(1)).current;(0,d.useEffect)((function(){if(g){var e=Ge.default.loop(Ge.default.sequence([Ge.default.timing(P,{toValue:1.1,duration:800,useNativeDriver:!0}),Ge.default.timing(P,{toValue:1,duration:800,useNativeDriver:!0})]));return e.start(),function(){return e.stop()}}P.setValue(1)}),[g,P]);var R=(0,d.useState)(C||""),D=(0,o.default)(R,2),z=D[0],B=D[1],_=(0,d.useState)(!1),L=(0,o.default)(_,2),N=L[0],M=L[1],H=j||{text:"Save",disabled:!c,isSaving:!1},W=(0,d.useCallback)((function(){if(k&&C){var e;if(N)e=z;else{var n=[];C&&C.trim()&&n.push(C),t.length>0&&n.push(t.join("\n")),e=n.join("\n\n")}k(e),B(e),M(!0),r([])}else{var o=t.join("\n").trim();o&&(b(),B(o),M(!0),r([]))}}),[k,C,z,N,t,b,r]);return(0,G.jsxs)(h.default,{style:E.container,children:[(0,G.jsxs)(h.default,{style:E.topBar,children:[(0,G.jsx)(m.default,{style:E.timerTextTopLeft,children:S(y)}),(0,G.jsxs)(h.default,{style:E.topRightIcons,children:[(0,G.jsx)(ne.default,{style:E.languageButton,onPress:function(){return A(!0)},disabled:g,children:(0,G.jsx)(ae.default,{name:"language",size:20,color:g?T.colors.disabled:T.colors.primary})}),(0,G.jsx)(ne.default,{style:E.lockButton,onPress:function(){return A(!0)},disabled:g,children:(0,G.jsx)(ae.default,{name:"lock-closed",size:20,color:g?T.colors.disabled:T.colors.textSecondary})})]})]}),(0,G.jsx)(nn,{isRecording:g,waveAnim1:u,waveAnim2:f,theme:T}),(0,G.jsx)(h.default,{style:E.recordingButtonContainer,children:(0,G.jsx)(Ge.default.View,{style:[E.recordingButtonOuter,{transform:[{scale:P}]}],children:(0,G.jsx)(ne.default,{style:[E.recordingButton,{backgroundColor:g?"#E53E3E":T.colors.primary}],onPress:v,disabled:!p,children:(0,G.jsx)(h.default,{style:E.recordingButtonInner,children:g?(0,G.jsx)(h.default,{style:E.stopIcon}):(0,G.jsx)(ae.default,{name:"mic",size:32,color:"white"})})})})}),(0,G.jsx)(m.default,{style:E.recordingStatusText,children:g?"Recording in progress":"Ready to record"}),(0,G.jsx)(h.default,{style:E.spacer}),(0,G.jsxs)(h.default,{style:E.transcriptCard,children:[(0,G.jsxs)(h.default,{style:E.transcriptHeader,children:[(0,G.jsxs)(h.default,{style:E.transcriptLabelContainer,children:[(0,G.jsx)(ae.default,{name:"document-text",size:20,color:T.colors.primary}),(0,G.jsx)(m.default,{style:E.transcriptLabel,children:"Transcript"})]}),(0,G.jsx)(ne.default,{style:[E.saveButtonSmall,H.disabled&&E.saveButtonSmallDisabled],onPress:W,disabled:H.disabled,children:H.isSaving?(0,G.jsx)(te.default,{size:"small",color:"white"}):(0,G.jsx)(m.default,{style:E.saveButtonSmallText,children:"Save"})})]}),(0,G.jsx)(re.default,{style:E.transcriptTextInput,value:function(){if(N)return z;var e=[];return C&&C.trim()&&e.push(C),t.length>0&&e.push(t.join("\n")),a&&n&&n.trim()&&"Processing..."!==n&&e.push(n),e.join("\n\n")}(),onChangeText:function(e){a||(B(e),M(!0))},multiline:!0,placeholder:a?"Processing audio...":g?"Listening...":"Tap the microphone to start recording",placeholderTextColor:T.colors.textSecondary,textAlignVertical:"top",editable:!a}),a&&(0,G.jsx)(te.default,{size:"small",color:T.colors.primary,style:E.transcriptionLoader}),s&&(null==i?void 0:i.alternatives)&&i.alternatives.length>0&&(0,G.jsx)(be.default,{style:E.alternativesScroll,showsVerticalScrollIndicator:!1,children:(0,G.jsxs)(h.default,{style:E.alternativesContainer,children:[(0,G.jsx)(m.default,{style:E.alternativesTitle,children:"Alternative transcriptions:"}),i.alternatives.map((function(e,t){return(0,G.jsxs)(ne.default,{style:E.alternativeItem,onPress:function(){e.transcript&&e.transcript.trim()&&(r([e.transcript]),w(!1))},children:[(0,G.jsx)(m.default,{style:E.alternativeText,children:e.transcript}),void 0!==e.confidence&&(0,G.jsxs)(m.default,{style:E.alternativeConfidence,children:[Math.round(100*e.confidence),"%"]})]},t)}))]})})]}),(0,G.jsx)(ke.default,{animationType:"slide",transparent:!0,visible:I,onRequestClose:function(){return A(!1)},children:(0,G.jsx)(h.default,{style:E.modalOverlay,children:(0,G.jsxs)(h.default,{style:E.modalContent,children:[(0,G.jsxs)(h.default,{style:E.modalHeader,children:[(0,G.jsx)(m.default,{style:E.modalTitle,children:"Select Language"}),(0,G.jsx)(ne.default,{style:E.modalCloseButton,onPress:function(){return A(!1)},children:(0,G.jsx)(ae.default,{name:"close",size:24,color:T.colors.text})})]}),(0,G.jsx)(en,{selectedLanguage:l,onLanguageChange:function(e){x(e),A(!1)}})]})})})]})};var sn=function(e){E.info("[cleanupAudioFile] Cleaned up audio file: "+e)},ln=v.default.create({container:{flex:1}});const cn=function(e){var t=e.onSave,r=e.onManualSave,o=e.onTranscriptionComplete,a=e.onCancel,i=e.onAutoSave,s=e.onStateChange,l=e.onCommandDetected,c=e.isEditingInitialContent,u=void 0!==c&&c,f=(e.saveButtonState,e.startRecordingOnMount),g=void 0===f||f,y=e.existingContent,p=e.onSaveWithCompleteText,m=((0,d.useCallback)(function(){var e=(0,n.default)((function*(e,t){try{var r=yield zr.transcribeAudio(e,{languageCodes:[t],enableSecretTagDetection:!0});if(!r)return sn(e),null;var n=r.transcript,o=r.secret_tag_detected;return null!=o&&o.found?(E.info("OPAQUE secret tag detected: "+o.tagName+" ("+o.action+")"),E.info("[processSegment] Transcript was a secret tag command. Halting processing."),sn(e),null==l||l(),null):(function(e){var t,r=[];e.confidence<.85&&r.push("Low transcription confidence."),e.secret_tag_detected&&r.push("Secret tag detected: "+(null==(t=e.secret_tag_details)?void 0:t.tagName))}(r),sn(e),{text:n})}catch(a){return E.error("Error during transcription processSegment",a),sn(e),null}}));return function(t,r){return e.apply(this,arguments)}}(),[l]),Wr({onTranscriptionComplete:function(e,r,n,a){E.info("[AudioRecorder] onTranscriptionComplete triggered."),null==o||o(e),null==t||t(e)},onCancel:function(){E.info("[AudioRecorder] onCancel called."),null==a||a()},onAutoSave:function(e){E.info("[AudioRecorder] onAutoSave called."),null==i||i(e)},autoStart:g&&!u}));(0,d.useEffect)((function(){null==s||s(m.isRecording?"recording":"idle")}),[m.isRecording,s]);var v=(0,d.useCallback)((function(){var e=m.transcriptSegments.join("\n").trim();e&&(null==r||r(e),null==t||t(e))}),[m.transcriptSegments,r,t]);return(0,G.jsx)(h.default,{style:ln.container,children:(0,G.jsx)(an,{isRecording:m.isRecording,transcriptSegments:m.transcriptSegments,setTranscriptSegments:m.setTranscriptSegments,currentSegmentTranscript:m.currentSegmentTranscript,isTranscribingSegment:m.isTranscribingSegment,lastTranscriptionResult:m.lastTranscriptionResult,showAlternatives:m.showAlternatives,setShowAlternatives:m.setShowAlternatives,selectedLanguage:m.selectedLanguage,isProcessing:m.isProcessing,canAcceptTranscript:m.canAcceptTranscript,pulseAnim:m.pulseAnim,waveAnim1:m.waveAnim1,waveAnim2:m.waveAnim2,recordingDuration:m.recordingDuration,permissionGranted:m.permissionGranted,handleMicPress:m.handleMicPress,handleAcceptTranscript:v,handleLanguageChange:m.handleLanguageChange,formatDuration:m.formatDuration,onClose:a,existingContent:y,onSaveWithCompleteText:p})})};function dn(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function un(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?dn(Object(r),!0).forEach((function(t){(0,b.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):dn(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var fn="web"!==k.default.OS,gn=function(e){var t=e.activeTags,r=e.onPress,n=me().theme,a=yn(n),i=(0,d.useState)(new Ge.default.Value(1)),s=(0,o.default)(i,1)[0];if((0,d.useEffect)((function(){if(t.length>0){var e=Ge.default.loop(Ge.default.sequence([Ge.default.timing(s,{toValue:1.2,duration:1500,useNativeDriver:fn}),Ge.default.timing(s,{toValue:1,duration:1500,useNativeDriver:fn})]));return e.start(),function(){return e.stop()}}}),[t.length,s]),!Pr()||0===t.length)return null;var l=t[0];return(0,G.jsx)(ne.default,{style:a.floatingContainer,onPress:r,activeOpacity:.8,children:(0,G.jsxs)(Ge.default.View,{style:[a.floatingIndicator,{backgroundColor:l.colorCode},{transform:[{scale:s}]}],children:[(0,G.jsx)(ae.default,{name:"shield-checkmark",size:16,color:n.colors.background}),t.length>1&&(0,G.jsx)(h.default,{style:a.floatingBadge,children:(0,G.jsx)(m.default,{style:a.floatingBadgeText,children:t.length})})]})})},yn=function(e){return v.default.create({container:{marginVertical:e.spacing.xs},indicator:un({flexDirection:"row",alignItems:"center",backgroundColor:e.colors.card,borderRadius:12,padding:e.spacing.md,borderWidth:2,borderColor:e.colors.primary},e.shadows.sm),colorDot:{width:8,height:8,borderRadius:4,marginRight:e.spacing.sm},content:{flex:1},header:{flexDirection:"row",alignItems:"center",marginBottom:2},title:{fontSize:e.typography.fontSizes.sm,fontWeight:"600",color:e.colors.primary,fontFamily:e.typography.fontFamilies.semiBold,marginLeft:4},tagName:{fontSize:e.typography.fontSizes.md,fontWeight:"500",color:e.colors.text,fontFamily:e.typography.fontFamilies.medium,marginBottom:2},subtitle:{fontSize:e.typography.fontSizes.xs,color:e.colors.textSecondary,fontFamily:e.typography.fontFamilies.regular},compactContainer:{position:"relative"},compactIndicator:un({width:24,height:24,borderRadius:12,justifyContent:"center",alignItems:"center"},e.shadows.sm),multipleTagsBadge:{position:"absolute",top:-4,right:-4,backgroundColor:e.colors.error,borderRadius:8,minWidth:16,height:16,justifyContent:"center",alignItems:"center",paddingHorizontal:4},multipleTagsText:{fontSize:10,fontWeight:"bold",color:e.colors.background,fontFamily:e.typography.fontFamilies.bold},floatingContainer:{position:"absolute",top:e.spacing.lg,right:e.spacing.lg,zIndex:1e3},floatingIndicator:un(un({width:48,height:48,borderRadius:24,justifyContent:"center",alignItems:"center"},e.shadows.lg),{},{position:"relative"}),floatingBadge:{position:"absolute",top:-4,right:-4,backgroundColor:e.colors.background,borderRadius:10,minWidth:20,height:20,justifyContent:"center",alignItems:"center",paddingHorizontal:4,borderWidth:2,borderColor:e.colors.primary},floatingBadgeText:{fontSize:12,fontWeight:"bold",color:e.colors.primary,fontFamily:e.typography.fontFamilies.bold}})};var pn=r(2291),hn=function(){function e(){(0,a.default)(this,e),this.phraseKeys=new Map,this.deviceEntropy=null}return(0,i.default)(e,[{key:"getSecureItem",value:function(){var e=(0,n.default)((function*(e){return"web"===k.default.OS?x.default.getItem(e):pn.getItemAsync(e)}));return function(t){return e.apply(this,arguments)}}()},{key:"setSecureItem",value:function(){var e=(0,n.default)((function*(e,t,r){"web"===k.default.OS?yield x.default.setItem(e,t):yield pn.setItemAsync(e,t,r)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"deleteSecureItem",value:function(){var e=(0,n.default)((function*(e){"web"===k.default.OS?yield x.default.removeItem(e):yield pn.deleteItemAsync(e)}));return function(t){return e.apply(this,arguments)}}()},{key:"isWebCryptoAvailable",value:function(){return"undefined"!==typeof crypto&&"undefined"!==typeof crypto.subtle&&"function"===typeof crypto.subtle.deriveKey}},{key:"isSecureStorageAvailable",value:function(){var e=(0,n.default)((function*(){return"web"===k.default.OS||pn.isAvailableAsync()}));return function(){return e.apply(this,arguments)}}()},{key:"getDeviceEntropy",value:function(){var t=(0,n.default)((function*(){if(this.deviceEntropy)return this.deviceEntropy;try{var t=yield this.getSecureItem(e.DEVICE_INFO);return t?(this.deviceEntropy=this.base64ToArray(t),this.deviceEntropy):(this.deviceEntropy=crypto.getRandomValues(new Uint8Array(e.SALT_LENGTH)),yield this.setSecureItem(e.DEVICE_INFO,this.arrayToBase64(this.deviceEntropy),{requireAuthentication:!1,authenticationPrompt:"Authenticate to access device encryption"}),E.info("Generated new device entropy for encryption"),this.deviceEntropy)}catch(r){throw E.error("Failed to get device entropy:",r),new Error("Failed to initialize device entropy")}}));return function(){return t.apply(this,arguments)}}()},{key:"initializePhraseKey",value:function(){var t=(0,n.default)((function*(t,r){if(!this.isWebCryptoAvailable())throw new Error("Web Crypto API not available");try{var n=yield this.getDeviceEntropy(),o=(new TextEncoder).encode(r),a=new Uint8Array(o.length+n.length);a.set(o,0),a.set(n,o.length);var i=yield crypto.subtle.importKey("raw",a,"PBKDF2",!1,["deriveKey"]),s=crypto.getRandomValues(new Uint8Array(e.SALT_LENGTH)),l=yield crypto.subtle.deriveKey({name:"PBKDF2",salt:s,iterations:e.DEFAULT_ITERATIONS,hash:"SHA-256"},i,{name:e.ALGORITHM,length:e.KEY_LENGTH},!1,["encrypt","decrypt","wrapKey","unwrapKey"]);this.phraseKeys.set(t,l);var c={tagId:t,phraseSalt:this.arrayToBase64(s),iterations:e.DEFAULT_ITERATIONS,createdAt:Date.now()};return yield this.savePhraseKeyInfo(c),a.fill(0),E.info("Secret phrase key initialized for tag: "+t),!0}catch(d){return E.error("Failed to initialize phrase key for tag "+t+":",d),!1}}));return function(e,r){return t.apply(this,arguments)}}()},{key:"loadPhraseKey",value:function(){var t=(0,n.default)((function*(t,r){if(!this.isWebCryptoAvailable())throw new Error("Web Crypto API not available");try{var n=yield this.getPhraseKeyInfo(t);if(!n)return E.warn("No phrase key info found for tag: "+t),!1;var o=yield this.getDeviceEntropy(),a=(new TextEncoder).encode(r),i=new Uint8Array(a.length+o.length);i.set(a,0),i.set(o,a.length);var s=yield crypto.subtle.importKey("raw",i,"PBKDF2",!1,["deriveKey"]),l=this.base64ToArray(n.phraseSalt),c=yield crypto.subtle.deriveKey({name:"PBKDF2",salt:l,iterations:n.iterations,hash:"SHA-256"},s,{name:e.ALGORITHM,length:e.KEY_LENGTH},!1,["encrypt","decrypt","wrapKey","unwrapKey"]);return this.phraseKeys.set(t,c),i.fill(0),E.info("Secret phrase key loaded for tag: "+t),!0}catch(d){return E.error("Failed to load phrase key for tag "+t+":",d),!1}}));return function(e,r){return t.apply(this,arguments)}}()},{key:"encryptEntryWithSecretPhrase",value:function(){var e=(0,n.default)((function*(e,t){var r=this.phraseKeys.get(t);if(!r)throw new Error("Secret phrase key not loaded for tag: "+t);return this.encryptWithKey(e,r)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"decryptEntryWithSecretPhrase",value:function(){var e=(0,n.default)((function*(e,t){var r=this.phraseKeys.get(t);if(!r)throw new Error("Secret phrase key not loaded for tag: "+t);return this.decryptWithKey(e,r)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"isPhraseKeyLoaded",value:function(e){return this.phraseKeys.has(e)}},{key:"unloadPhraseKey",value:function(e){this.phraseKeys.delete(e),E.info("Secret phrase key unloaded for tag: "+e)}},{key:"clearSecretPhraseEncryption",value:function(){var e=(0,n.default)((function*(e){try{this.phraseKeys.delete(e),yield this.deletePhraseKeyInfo(e),E.info("Secret phrase encryption cleared for tag: "+e)}catch(t){throw E.error("Failed to clear phrase encryption for tag "+e+":",t),t}}));return function(t){return e.apply(this,arguments)}}()},{key:"secureClearAllData",value:function(){var t=(0,n.default)((function*(){try{this.phraseKeys.clear(),this.deviceEntropy=null,yield this.deleteSecureItem(e.DEVICE_INFO),yield this.deleteSecureItem(e.PHRASE_KEYS_INFO),E.info("All encryption data securely cleared")}catch(t){throw E.error("Failed to clear all encryption data:",t),t}}));return function(){return t.apply(this,arguments)}}()},{key:"encryptWithKey",value:function(){var t=(0,n.default)((function*(t,r){try{var n=yield crypto.subtle.generateKey({name:e.ALGORITHM,length:e.KEY_LENGTH},!0,["encrypt","decrypt"]),o=crypto.getRandomValues(new Uint8Array(e.SALT_LENGTH)),a=crypto.getRandomValues(new Uint8Array(e.IV_LENGTH)),i=crypto.getRandomValues(new Uint8Array(e.IV_LENGTH)),s=new TextEncoder,l=yield crypto.subtle.encrypt({name:e.ALGORITHM,iv:a},n,s.encode(t)),c=yield crypto.subtle.wrapKey("raw",n,r,{name:e.ALGORITHM,iv:i});return{encryptedContent:this.arrayToBase64(new Uint8Array(l)),encryptedKey:this.arrayToBase64(new Uint8Array(c)),iv:this.arrayToBase64(a),salt:this.arrayToBase64(o),algorithm:e.ALGORITHM,wrapIv:this.arrayToBase64(i)}}catch(d){throw E.error("Failed to encrypt entry:",d),new Error("Encryption failed")}}));return function(e,r){return t.apply(this,arguments)}}()},{key:"decryptWithKey",value:function(){var t=(0,n.default)((function*(t,r){try{var n=this.base64ToArray(t.encryptedContent),o=this.base64ToArray(t.encryptedKey),a=this.base64ToArray(t.iv),i=this.base64ToArray(t.wrapIv),s=yield crypto.subtle.unwrapKey("raw",o,r,{name:e.ALGORITHM,iv:i},{name:e.ALGORITHM,length:e.KEY_LENGTH},!1,["decrypt"]),l=yield crypto.subtle.decrypt({name:e.ALGORITHM,iv:a},s,n);return(new TextDecoder).decode(l)}catch(c){throw E.error("Failed to decrypt entry:",c),new Error("Decryption failed - invalid phrase or corrupted data")}}));return function(e,r){return t.apply(this,arguments)}}()},{key:"savePhraseKeyInfo",value:function(){var t=(0,n.default)((function*(t){try{var r=yield this.getSecureItem(e.PHRASE_KEYS_INFO),n=(r?JSON.parse(r):[]).filter((function(e){return e.tagId!==t.tagId}));n.push(t),yield this.setSecureItem(e.PHRASE_KEYS_INFO,JSON.stringify(n),{requireAuthentication:!0,authenticationPrompt:"Authenticate to manage secret phrase keys"})}catch(o){throw E.error("Failed to save phrase key info:",o),o}}));return function(e){return t.apply(this,arguments)}}()},{key:"getPhraseKeyInfo",value:function(){var t=(0,n.default)((function*(t){try{var r=yield this.getSecureItem(e.PHRASE_KEYS_INFO);return r&&JSON.parse(r).find((function(e){return e.tagId===t}))||null}catch(n){return E.error("Failed to get phrase key info:",n),null}}));return function(e){return t.apply(this,arguments)}}()},{key:"deletePhraseKeyInfo",value:function(){var t=(0,n.default)((function*(t){try{var r=yield this.getSecureItem(e.PHRASE_KEYS_INFO);if(!r)return;var n=JSON.parse(r).filter((function(e){return e.tagId!==t}));0===n.length?yield this.deleteSecureItem(e.PHRASE_KEYS_INFO):yield this.setSecureItem(e.PHRASE_KEYS_INFO,JSON.stringify(n),{requireAuthentication:!0,authenticationPrompt:"Authenticate to manage secret phrase keys"})}catch(o){throw E.error("Failed to delete phrase key info:",o),o}}));return function(e){return t.apply(this,arguments)}}()},{key:"arrayToBase64",value:function(e){var t=Array.from(e,(function(e){return String.fromCharCode(e)})).join("");return btoa(t)}},{key:"base64ToArray",value:function(e){var t=atob(e);return new Uint8Array(t.length).map((function(e,r){return t.charCodeAt(r)}))}}])}();hn.ALGORITHM="AES-GCM",hn.KEY_LENGTH=256,hn.IV_LENGTH=12,hn.SALT_LENGTH=32,hn.DEFAULT_ITERATIONS=1e5,hn.DEVICE_INFO="zk_device_info",hn.PHRASE_KEYS_INFO="zk_phrase_keys_info";var mn=new hn;var vn=new((0,i.default)((function e(){(0,a.default)(this,e)}),[{key:"getAllTags",value:function(){var e=(0,n.default)((function*(){try{E.info("Legacy tagManager: Getting all regular tags from API");var e=(yield D.getTags()).data||[];return E.info("Legacy tagManager: Found "+e.length+" regular tags"),e}catch(t){throw E.error("Failed to get all tags:",t),t}}));return function(){return e.apply(this,arguments)}}()},{key:"createTag",value:function(){var e=(0,n.default)((function*(e,t){try{E.info("Legacy tagManager: Creating regular tag:",{name:e,color:t});var r=yield D.createTag({name:e.trim(),color:t||"#007AFF"});return E.info("Legacy tagManager: Created regular tag:",r),r}catch(n){throw E.error("Failed to create tag:",n),n}}));return function(t,r){return e.apply(this,arguments)}}()},{key:"updateTag",value:function(){var e=(0,n.default)((function*(e,t){try{E.info("Legacy tagManager: Updating tag:",{id:e,updates:t});var r=yield D.updateTag(e,t);return E.info("Legacy tagManager: Updated tag:",r),r}catch(n){throw E.error("Failed to update tag:",n),n}}));return function(t,r){return e.apply(this,arguments)}}()},{key:"deleteTag",value:function(){var e=(0,n.default)((function*(e){try{E.info("Legacy tagManager: Deleting tag:",{id:e}),yield D.deleteTag(e),E.info("Legacy tagManager: Deleted tag successfully")}catch(t){throw E.error("Failed to delete tag:",t),t}}));return function(t){return e.apply(this,arguments)}}()},{key:"getTagById",value:function(){var e=(0,n.default)((function*(e){try{E.info("Legacy tagManager: Getting tag by ID:",{id:e});var t=(yield this.getAllTags()).find((function(t){return String(t.id)===e}))||null;return E.info("Legacy tagManager: Found tag:",t),t}catch(r){throw E.error("Failed to get tag by ID:",r),r}}));return function(t){return e.apply(this,arguments)}}()},{key:"getTagsByIds",value:function(){var e=(0,n.default)((function*(e){try{E.info("Legacy tagManager: Getting tags by IDs:",{ids:e});var t=(yield this.getAllTags()).filter((function(t){return e.includes(String(t.id))}));return E.info("Legacy tagManager: Found "+t.length+" tags"),t}catch(r){throw E.error("Failed to get tags by IDs:",r),r}}));return function(t){return e.apply(this,arguments)}}()},{key:"getActiveSecretTags",value:function(){var e=(0,n.default)((function*(){try{return E.info("Legacy tagManager: Getting active secret tags"),Pr()?(E.warn("getActiveSecretTags not yet implemented - returning empty array"),[]):[]}catch(e){throw E.error("Failed to get active secret tags:",e),e}}));return function(){return e.apply(this,arguments)}}()},{key:"checkForSecretTagPhrases",value:function(){var e=(0,n.default)((function*(e){try{return E.info("Legacy tagManager: Checking for secret tag phrases"),Pr()?(E.warn("checkForSecretTagPhrases not yet implemented - returning not found"),{found:!1}):{found:!1}}catch(t){return E.error("Failed to check for secret tag phrases:",t),{found:!1}}}));return function(t){return e.apply(this,arguments)}}()},{key:"getSecretTags",value:function(){var e=(0,n.default)((function*(){try{return E.info("Legacy tagManager: Getting all secret tags"),Pr()?(E.warn("getSecretTags not yet implemented - returning empty array"),[]):[]}catch(e){throw E.error("Failed to get secret tags:",e),e}}));return function(){return e.apply(this,arguments)}}()},{key:"activateSecretTag",value:function(){var e=(0,n.default)((function*(e){try{if(E.info("Legacy tagManager: Activating secret tag:",{tagId:e}),!Pr())return;E.warn("activateSecretTag not yet implemented - no action taken")}catch(t){throw E.error("Failed to activate secret tag:",t),t}}));return function(t){return e.apply(this,arguments)}}()}]));function bn(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function xn(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?bn(Object(r),!0).forEach((function(t){(0,b.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):bn(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Sn=new((0,i.default)((function e(){(0,a.default)(this,e)}),[{key:"detectAndProcessSecretPhrase",value:function(){var e=(0,n.default)((function*(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!e)return{processedContent:e,detectedTagId:t};try{var r=yield vn.checkForSecretTagPhrases(e);if(r.found&&r.tagId&&"activate"===r.action){E.info("Secret tag activation phrase detected in content for tag: "+r.tagName+" ("+r.tagId+")"),yield vn.activateSecretTag(r.tagId);var n=e;if(r.tagName){var o=new RegExp(r.tagName.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),"gi");n=e.replace(o,"").trim()}return{processedContent:n,detectedTagId:r.tagId}}}catch(a){E.error("Error during secret phrase detection, proceeding with original content.",a)}return{processedContent:e,detectedTagId:t}}));return function(t){return e.apply(this,arguments)}}()},{key:"createEntry",value:function(){var e=(0,n.default)((function*(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.secretTagId,n=t.forcePublic,o=t.detectedTagId,a=n?{processedContent:e.content,detectedTagId:null}:yield this.detectAndProcessSecretPhrase(e.content,null),i=a.processedContent,s=a.detectedTagId,l=xn(xn({},e),{},{content:i}),c=r||o||s;return Pr()?c&&mn.isPhraseKeyLoaded(c)?this.createSecretTagEntry(l,c):(c&&!mn.isPhraseKeyLoaded(c)&&E.warn("Entry should use secret tag "+c+" but phrase encryption not ready, creating public entry"),this.createPublicEntry(l)):this.createPerUserEncryptedEntry(l)}));return function(t){return e.apply(this,arguments)}}()},{key:"createPublicEntry",value:function(){var e=(0,n.default)((function*(e){try{var t=yield P.createEntry({title:e.title||"",content:e.content,entry_date:e.entry_date||(new Date).toISOString(),audio_url:e.audio_url,tags:e.tags||[]});return E.info("Created public journal entry"),t.data}catch(r){throw E.error("Failed to create public journal entry:",r),new Error("Failed to create journal entry")}}));return function(t){return e.apply(this,arguments)}}()},{key:"createPerUserEncryptedEntry",value:function(){var e=(0,n.default)((function*(e){try{var t=yield pt.encryptPerUser(e.content),r=yield P.createEntry({title:e.title||"",content:"",entry_date:e.entry_date||(new Date).toISOString(),audio_url:e.audio_url,tags:e.tags||[],encrypted_content:t.encryptedContent,encryption_iv:t.iv,encrypted_key:t.wrappedKey,encryption_wrap_iv:t.wrapIv,encryption_algorithm:t.algorithm||"AES-GCM"});return E.info("Created per-user encrypted journal entry"),xn(xn({},r.data),{},{content:e.content})}catch(n){throw E.error("Failed to create per-user encrypted journal entry:",n),new Error("Failed to create encrypted journal entry")}}));return function(t){return e.apply(this,arguments)}}()},{key:"createSecretTagEntry",value:function(){var e=(0,n.default)((function*(e,t){if(!mn.isPhraseKeyLoaded(t))throw new Error("Secret tag encryption not loaded for tag: "+t);try{var r=yield mn.encryptEntryWithSecretPhrase(e.content,t),n=(yield vn.getActiveSecretTags(),(yield vn.getSecretTags()).find((function(e){return e.id===t})));if(!n)throw new Error("Secret tag not found: "+t);var o=yield P.createEncryptedEntry({title:e.title||"",encrypted_content:r.encryptedContent,encrypted_key:r.encryptedKey,iv:r.iv,salt:r.salt,algorithm:r.algorithm,entry_date:e.entry_date||(new Date).toISOString(),audio_url:e.audio_url,tags:e.tags||[],wrapIv:r.wrapIv,secret_tag_id:t,secret_tag_hash:n.id});return E.info("Created secret tag journal entry with tag: "+t),xn(xn({},o.data),{},{content:e.content,secret_tag_id:t})}catch(a){throw E.error("Failed to create secret tag journal entry:",a),new Error("Failed to create encrypted journal entry")}}));return function(t,r){return e.apply(this,arguments)}}()},{key:"createSecretTagEntryUnencrypted",value:function(){var e=(0,n.default)((function*(e,t){try{var r=(yield vn.getSecretTags()).find((function(e){return e.id===t}));if(!r)throw new Error("Secret tag not found: "+t);var n=yield P.createEntry({title:e.title||"",content:e.content,entry_date:e.entry_date||(new Date).toISOString(),audio_url:e.audio_url,tags:e.tags||[],secret_tag_id:t,secret_tag_hash:r.id});return E.info("Created secret tag journal entry (unencrypted) with tag: "+t),xn(xn({},n.data),{},{secret_tag_id:t})}catch(o){throw E.error("Failed to create secret tag journal entry (unencrypted):",o),new Error("Failed to create journal entry with secret tag")}}));return function(t,r){return e.apply(this,arguments)}}()},{key:"getEntries",value:function(){var e=(0,n.default)((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var t=(yield vn.getActiveSecretTags()).map((function(e){return e.id})),r=yield P.getEntries(xn(xn({},e),{},{secret_tag_hashes:t,include_public:!0})),n=r.data.entries||r.data;return this.processEntries(n)}catch(o){throw E.error("Failed to get journal entries:",o),new Error("Failed to retrieve journal entries")}}));return function(){return e.apply(this,arguments)}}()},{key:"getEntry",value:function(){var e=(0,n.default)((function*(e){try{var t=(yield P.getEntry(e)).data;if(!t)return null;var r=yield this.processEntries([t]);return r.length>0?r[0]:null}catch(n){throw E.error("Failed to get journal entry "+e+":",n),new Error("Failed to retrieve journal entry")}}));return function(t){return e.apply(this,arguments)}}()},{key:"processEntries",value:function(){var e=(0,n.default)((function*(e){var t=this,r=e,o=(yield vn.getActiveSecretTags()).map((function(e){return e.id})),a=yield Promise.all(r.map(function(){var e=(0,n.default)((function*(e){return e.secret_tag_id&&o.includes(e.secret_tag_id)?t.decryptSecretTagEntry(e):e}));return function(t){return e.apply(this,arguments)}}()));return a.filter((function(e){return null!==e}))}));return function(t){return e.apply(this,arguments)}}()},{key:"decryptSecretTagEntry",value:function(){var e=(0,n.default)((function*(e){var t=e.secret_tag_id;if(!t)return E.warn("Entry has no secret tag ID, cannot decrypt"),null;if(!mn.isPhraseKeyLoaded(t))return E.warn("Cannot decrypt entry: secret tag key not loaded for "+t),null;try{if(!e.encrypted_content||!e.encryption_iv||!e.encryption_salt)return E.warn("Entry missing encryption fields, cannot decrypt"),null;var r={encryptedContent:e.encrypted_content,encryptedKey:e.encrypted_key||"",iv:e.encryption_iv,salt:e.encryption_salt,algorithm:e.encryption_algorithm||"AES-GCM",wrapIv:e.encryption_wrap_iv||e.encryption_iv},n=yield mn.decryptEntryWithSecretPhrase(r,t);return xn(xn({},e),{},{content:n})}catch(o){return E.error("Failed to decrypt secret tag journal entry:",o),xn(xn({},e),{},{content:"[Encrypted Content - Unable to Decrypt]"})}}));return function(t){return e.apply(this,arguments)}}()},{key:"searchEntries",value:function(){var e=(0,n.default)((function*(e){try{var t=(yield vn.getActiveSecretTags()).map((function(e){return e.id})),r=yield P.searchEntries(e,{secret_tag_hashes:t,include_public:!0}),n=r.data.entries||r.data;return this.processEntries(n)}catch(o){throw E.error("Failed to search journal entries:",o),new Error("Failed to search journal entries")}}));return function(t){return e.apply(this,arguments)}}()},{key:"updateEntry",value:function(){var e=(0,n.default)((function*(e,t){try{if("string"===typeof t.content){var r=yield this.detectAndProcessSecretPhrase(t.content),n=r.processedContent,o=r.detectedTagId;if(t.content=n,Pr()&&o&&mn.isPhraseKeyLoaded(o)){E.info("Secret phrase detected during update. Encrypting entry "+e+" with tag "+o+".");var a=yield mn.encryptEntryWithSecretPhrase(n,o),i=(yield vn.getSecretTags()).find((function(e){return e.id===o}));if(!i)throw new Error("Secret tag not found: "+o);var s=xn(xn({},t),{},{content:"",encrypted_content:a.encryptedContent,encrypted_key:a.encryptedKey,iv:a.iv,salt:a.salt,algorithm:a.algorithm,wrapIv:a.wrapIv,secret_tag_id:o,secret_tag_hash:i.id});return xn(xn({},(yield P.updateEntry(e,s)).data),{},{content:n})}if(!Pr()){E.info("Updating entry "+e+" with per-user encryption.");var l=yield pt.encryptPerUser(n),c=xn(xn({},t),{},{content:"",encrypted_content:l.encryptedContent,encryption_iv:l.iv,encrypted_key:l.wrappedKey,encryption_wrap_iv:l.wrapIv,encryption_algorithm:l.algorithm||"AES-GCM"});return xn(xn({},(yield P.updateEntry(e,c)).data),{},{content:n})}}return E.info("Updating public journal entry "+e+"."),(yield P.updateEntry(e,t)).data}catch(d){throw E.error("Failed to update journal entry "+e+":",d),new Error("Failed to update journal entry")}}));return function(t,r){return e.apply(this,arguments)}}()},{key:"deleteEntry",value:function(){var e=(0,n.default)((function*(e){try{yield P.deleteEntry(String(e)),E.info("Deleted journal entry "+String(e))}catch(t){throw E.error("Failed to delete journal entry "+e+":",t),new Error("Failed to delete journal entry")}}));return function(t){return e.apply(this,arguments)}}()}]));function wn(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function jn(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?wn(Object(r),!0).forEach((function(t){(0,b.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):wn(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Cn={};const kn=function(e,t){var r=jn(jn({},Cn),t),a=r.selectedDate,i=r.onSaveComplete,s=r.onSaveError,l=(0,d.useState)(e.id),c=(0,o.default)(l,2),u=c[0],f=c[1],g=(0,d.useState)(!1),y=(0,o.default)(g,2),p=y[0],h=y[1],m=(0,d.useState)(null),v=(0,o.default)(m,2),b=v[0],x=v[1],S=(0,d.useRef)(!0),w=(0,d.useRef)(!1),j=(0,d.useRef)(e);(0,d.useEffect)((function(){j.current=jn(jn({},e),{},{id:u||e.id})}),[e,u]),(0,d.useEffect)((function(){return function(){S.current=!1,w.current=!0}}),[]);var C=(0,d.useCallback)(function(){var e=(0,n.default)((function*(e){if(!S.current||w.current)return E.warn("performSave: Save aborted: Component unmounting or navigation in progress"),null;if(!e.content.trim()&&!e.title.trim()&&!e.audioUri)return E.warn("performSave: Save skipped: No title, content, or audio URI."),null;var t,r=null;if(e.audioUri&&!e.audioUri.startsWith("blob:")?r=e.audioUri:e.audioUri&&E.info("performSave: Detected blob URL for audio. This will not be sent to backend."),a){var n=a.split("-").map(Number),i=(0,o.default)(n,3),l=i[0],c=i[1],d=i[2];t=new Date(Date.UTC(l,c-1,d,12,0,0,0)).toISOString(),E.info("performSave: Using selectedDate "+a+", converted to UTC: "+t)}else t=(new Date).toISOString(),E.info("performSave: Using current date: "+t);var u={title:e.title.trim()||"Journal - "+(0,gt.default)(new Date,"yyyy-MM-dd HH:mm"),content:e.content.trim(),entry_date:t,audio_url:r||void 0,tags:e.tags};try{if(!S.current||w.current)return E.warn("performSave: Save aborted just before API call: Component unmounting or navigation in progress"),null;if(null!==e.id){E.info("performSave: Updating journal entry ID: "+e.id);yield Sn.updateEntry(e.id,u);return E.info("performSave: Journal entry ID: "+e.id+" updated."),e.id}E.info("performSave: Creating new journal entry with data:",u);var g=yield Sn.createEntry(u),y=String(g.id);return E.info("performSave: New journal entry created with ID: "+y),S.current&&!w.current&&f(y),y}catch(h){if(S.current&&!w.current){var p=h instanceof Error?h:new Error("Error saving journal entry");E.error("performSave: Error saving journal entry",p),x(p),s&&s(p)}else E.warn("performSave: Save error occurred, but component unmounted or navigating. Error not propagated.",h);throw h}}));return function(t){return e.apply(this,arguments)}}(),[s,a]),k=(0,d.useCallback)(function(){var e=(0,n.default)((function*(e,t){var r=t||{},n=r.silent,o=void 0!==n&&n,a=r.navigateOnSuccess,l=void 0!==a&&a;if(p)return E.debug("save: Save skipped: Another save operation is in progress."),null;if(!S.current||w.current)return E.warn("save: Save aborted: Component unmounting or navigation in progress"),null;E.info("save: Starting "+(o?"silent":"manual")+" save operation..."),h(!0),x(null);var c=null;try{var d=jn(jn({},j.current),e);return c=yield C(d),E.info("save: performSave completed. Result ID: "+c+"."),S.current&&!w.current&&null!==c&&(f(c),!o&&l&&i?(E.info("save: Triggering navigation callback."),i(c)):E.info("save: Success ("+(o?"silent":"manual")+") - no navigation.")),c}catch(g){if(E.error("save: Save operation failed:",g),!o&&S.current&&!w.current&&s){var u=g instanceof Error?g:new Error("Error saving journal entry");x(u),s(u)}else o&&E.info("save: Silent save failed - no error callback triggered.");return null}finally{S.current&&h(!1)}}));return function(t,r){return e.apply(this,arguments)}}(),[C,p,i,s]);return(0,d.useEffect)((function(){return function(){E.info("Final cleanup on unmount"),S.current=!1,w.current=!0}}),[]),{journalId:u,isSaving:p,save:k,error:b}};function Tn(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function En(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Tn(Object(r),!0).forEach((function(t){(0,b.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Tn(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var On="_hidden_entry",Fn=function(e){return v.default.create({container:{flex:1,justifyContent:"center",alignItems:"center"},modalOverlay:En(En({},v.default.absoluteFillObject),{},{backgroundColor:"rgba(0, 0, 0, 0.4)",zIndex:1}),contentContainer:{flex:1,width:"100%",zIndex:2},recorderContainer:{flex:1,width:"100%",backgroundColor:e.colors.background},modalHeader:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",paddingHorizontal:e.spacing.lg,paddingTop:"ios"===k.default.OS?60:e.spacing.xl,paddingBottom:e.spacing.sm,borderBottomWidth:1,borderBottomColor:e.colors.border,backgroundColor:e.colors.background},modalHandle:{width:40,height:4,backgroundColor:e.colors.border,borderRadius:2,position:"absolute",top:"ios"===k.default.OS?50:e.spacing.md,left:"50%",marginLeft:-20},closeButton:En({width:40,height:40,borderRadius:20,backgroundColor:e.colors.card,justifyContent:"center",alignItems:"center",marginLeft:"auto"},e.shadows.sm),recorderContent:{flex:1},loadingContainer:{flex:1,justifyContent:"center",alignItems:"center",paddingVertical:e.spacing.xl},savingOverlay:En(En({},v.default.absoluteFillObject),{},{backgroundColor:"rgba(0, 0, 0, 0.7)",justifyContent:"center",alignItems:"center",zIndex:3}),loadingText:{marginTop:e.spacing.md,fontSize:e.typography.fontSizes.md,color:e.colors.text,fontFamily:e.typography.fontFamilies.regular},headerTitle:{fontSize:e.typography.fontSizes.lg,fontWeight:"600",color:e.colors.text,fontFamily:e.typography.fontFamilies.semiBold}})};const In=function(){var e,t,r,a;E.info("RecordScreen instance created/rendered.");var i=me().theme,s=Fn(i),l=(0,oe.useNavigation)(),c=(0,oe.useRoute)(),u=bt().isHiddenMode,f=cr().settings.autoRecordingEnabled;(0,d.useEffect)((function(){f?E.info("[RecordScreen] Auto-recording is enabled - recording will start automatically"):E.info("[RecordScreen] Auto-recording is disabled - user must manually start recording")}),[f]);var g=null==(e=c.params)?void 0:e.selectedDate,y=null==(t=c.params)?void 0:t.journalId,p=null==(r=c.params)?void 0:r.vibeEmoji,v=null==(a=c.params)?void 0:a.vibeTag;(0,d.useEffect)((function(){g?E.info("[RecordScreen] Using selected date from calendar: "+g):E.info("[RecordScreen] Using current date for new entry"),y?E.info("[RecordScreen] Appending to existing entry: "+y):E.info("[RecordScreen] Creating new entry"),p&&v&&E.info("[RecordScreen] Vibe check-in: "+p+" (tag: "+v+")")}),[g,y,p,v]);var b=(0,d.useState)(!1),x=(0,o.default)(b,2),S=x[0],w=(x[1],(0,d.useState)(!0)),j=(0,o.default)(w,2),C=j[0],k=(j[1],(0,d.useState)(!1)),T=(0,o.default)(k,2),O=T[0],F=T[1],I=(0,d.useState)([]),A=(0,o.default)(I,2),R=A[0],D=A[1],z=(0,d.useState)("idle"),B=(0,o.default)(z,2),_=(B[0],B[1],(0,d.useState)("")),L=(0,o.default)(_,2),N=L[0],M=L[1],H=(0,d.useState)(""),W=(0,o.default)(H,2),U=W[0],V=W[1],K=(0,d.useState)(""),q=(0,o.default)(K,2),Q=q[0],J=q[1],Y=(0,d.useState)(v?[v]:["journal"]),Z=(0,o.default)(Y,2),X=Z[0],$=Z[1],ee=(0,d.useState)(null),re=(0,o.default)(ee,2),ie=re[0],se=re[1],le=(0,d.useState)(!1),ce=(0,o.default)(le,2),de=(ce[0],ce[1]);(0,d.useEffect)((function(){if(y){var e=function(){var e=(0,n.default)((function*(){try{var e;de(!0);var t=(yield P.getEntry(parseInt(y))).data;E.info("[RecordScreen] Loaded existing entry for appending: "+t.title),M(t.title||"");var r=t.content||"";V(r),J(r),$((null==(e=t.tags)?void 0:e.map((function(e){return e.name})))||["journal"]),se(t.audio_url)}catch(n){E.error("[RecordScreen] Failed to load existing entry "+y+":",n)}finally{de(!1)}}));return function(){return e.apply(this,arguments)}}();e()}}),[y]);var ue=(0,d.useRef)(!0),fe=kn((0,d.useMemo)((function(){var e=X;return u&&!e.includes(On)?e=[].concat((0,dt.default)(e),[On]):!u&&e.includes(On)&&(e=e.filter((function(e){return e!==On}))),{id:y||null,title:N,content:U,tags:e,audioUri:ie}}),[N,U,X,ie,u]),{selectedDate:g,onSaveComplete:(0,d.useCallback)((function(e){ue.current?(e?E.info("[RecordScreen] Save successful (ID: "+e+"). Navigating back."):E.warn("[RecordScreen] Save completed but no ID received. Navigating back anyway."),l.canGoBack()&&l.goBack()):E.debug("[RecordScreen] onSaveComplete: Aborted (unmounted).")}),[l]),onSaveError:(0,d.useCallback)((function(e){ue.current?(E.error("[RecordScreen] Save failed:",e),ft.default.alert("Save Failed","Could not save the recording. Please try again.",[{text:"OK",onPress:function(){l.canGoBack()&&l.goBack()}}])):E.debug("[RecordScreen] onSaveError: Aborted (unmounted).")}),[l])}),ge=fe.isSaving,ye=fe.save;(0,d.useEffect)((function(){return ue.current=!0,function(){ue.current=!1}}),[]),(0,d.useEffect)((function(){if(Pr()){var e=function(){var e=(0,n.default)((function*(){try{var e=yield vn.getActiveSecretTags();D(e)}catch(t){E.error("Failed to load active secret tags:",t)}}));return function(){return e.apply(this,arguments)}}();e()}else D([])}),[]);var pe=(0,d.useCallback)((function(e){E.info("[RecordScreen] Transcription completed, but auto-save is disabled.")}),[]),he=(0,d.useCallback)(function(){var e=(0,n.default)((function*(e,t){if(ue.current&&!ge){E.info("[RecordScreen] Manual save triggered.");var r=y&&Q?Q+"\n\n"+e:e,n=N;if(e&&!N){var o=e.split(" "),a=o.slice(0,5).join(" ")+(o.length>5?"...":"");M(n=p?p+" "+a:a)}V(r),t&&se(t),F(!0);try{yield ye({content:r,title:n})}catch(i){E.error("[RecordScreen] Manual save failed:",i)}}}));return function(t,r){return e.apply(this,arguments)}}(),[ye,N,ge,y,Q]),ve=(0,d.useCallback)(function(){var e=(0,n.default)((function*(e){if(ue.current&&!ge){E.info("[RecordScreen] Save with complete text triggered.");var t=N;if(e&&!N){var r=e.split(" "),n=r.slice(0,5).join(" ")+(r.length>5?"...":"");M(t=n)}F(!0);try{yield ye({content:e,title:t})}catch(o){E.error("[RecordScreen] Save with complete text failed:",o)}}}));return function(t){return e.apply(this,arguments)}}(),[ye,N,ge]),be=(0,d.useCallback)((function(){ue.current?(E.info("[RecordScreen] Recording cancelled."),l.canGoBack()&&l.goBack()):E.debug("[RecordScreen] handleRecorderCancel: Aborted (unmounted).")}),[l]),xe=(0,d.useCallback)((function(){ue.current?(E.info("[RecordScreen] Close button pressed."),l.canGoBack()&&l.goBack()):E.debug("[RecordScreen] handleClose: Aborted (unmounted).")}),[l]),Se=(0,d.useCallback)(function(){var e=(0,n.default)((function*(e){if(ue.current){E.info("[RecordScreen] Auto-save triggered by new segment.");var t=N;if(!N&&e){var r=e.split(" "),n=r.slice(0,5).join(" ")+(r.length>5?"...":"");t=n,M(n)}var o={title:t,content:y&&Q?Q+"\n\n"+e:e};try{var a=yield ye(o,{silent:!0});a?E.info("[RecordScreen] Auto-save successful. Entry ID: "+a):E.warn("[RecordScreen] Auto-save completed but no ID returned.")}catch(i){E.error("[RecordScreen] Auto-save failed:",i)}}else E.debug("[RecordScreen] handleAutoSave: Aborted (unmounted).")}));return function(t){return e.apply(this,arguments)}}(),[ye,N,y,Q]),we=(0,d.useCallback)((function(){return ge?{text:"Saving...",disabled:!0,isSaving:!0}:O&&!ge?{text:"Saved",disabled:!0,isSaving:!1}:{text:"Save",disabled:!1,isSaving:!1}}),[ge,O]),je=(0,d.useCallback)((function(){E.info("[RecordScreen] Secret tag command detected. Navigating back."),l.goBack()}),[l]);return S&&!C?(0,G.jsxs)(h.default,{style:s.container,children:[(0,G.jsx)(h.default,{style:s.modalOverlay}),(0,G.jsxs)(h.default,{style:s.recorderContainer,children:[(0,G.jsxs)(h.default,{style:s.modalHeader,children:[(0,G.jsx)(h.default,{style:s.modalHandle}),(0,G.jsx)(ne.default,{style:s.closeButton,onPress:xe,hitSlop:{top:10,bottom:10,left:10,right:10},children:(0,G.jsx)(ae.default,{name:"close",size:24,color:i.colors.textSecondary})})]}),(0,G.jsxs)(h.default,{style:s.loadingContainer,children:[(0,G.jsx)(te.default,{size:"large",color:i.colors.primary}),(0,G.jsx)(m.default,{style:s.loadingText,children:"Loading Recorder..."})]})]})]}):(0,G.jsxs)(h.default,{style:s.container,children:[!y&&(0,G.jsx)(h.default,{style:s.modalOverlay}),(0,G.jsx)(h.default,{style:s.contentContainer,children:C?(0,G.jsxs)(h.default,{style:s.recorderContainer,children:[(0,G.jsxs)(h.default,{style:s.modalHeader,children:[!y&&(0,G.jsx)(h.default,{style:s.modalHandle}),y&&(0,G.jsx)(m.default,{style:s.headerTitle,children:"Add to Entry"}),(0,G.jsx)(ne.default,{style:s.closeButton,onPress:xe,hitSlop:{top:10,bottom:10,left:10,right:10},children:(0,G.jsx)(ae.default,{name:y?"arrow-back":"close",size:24,color:i.colors.textSecondary})})]}),(0,G.jsxs)(h.default,{style:s.recorderContent,children:[(0,G.jsx)(cn,{onTranscriptionComplete:pe,onCancel:be,onManualSave:he,onAutoSave:Se,saveButtonState:we(),startRecordingOnMount:f,onCommandDetected:je,existingContent:Q||U,onSaveWithCompleteText:ve}),Pr()&&(0,G.jsx)(gn,{activeTags:R,onPress:function(){return l.navigate("TagManagement")}})]})]}):(0,G.jsxs)(h.default,{style:s.recorderContainer,children:[(0,G.jsxs)(h.default,{style:s.modalHeader,children:[(0,G.jsx)(h.default,{style:s.modalHandle}),(0,G.jsx)(ne.default,{style:s.closeButton,onPress:xe,hitSlop:{top:10,bottom:10,left:10,right:10},children:(0,G.jsx)(ae.default,{name:"close",size:24,color:i.colors.textSecondary})})]}),(0,G.jsxs)(h.default,{style:s.loadingContainer,children:[(0,G.jsx)(te.default,{size:"large",color:i.colors.primary}),(0,G.jsx)(m.default,{style:s.loadingText,children:"Processing Recording..."})]})]})}),ge&&(0,G.jsxs)(h.default,{style:s.savingOverlay,children:[(0,G.jsx)(te.default,{size:"large",color:i.colors.primary}),(0,G.jsx)(m.default,{style:s.loadingText,children:"Saving Entry..."})]})]})};var An=function(e,t){var r="small"===t?4:"large"===t?8:6,n="small"===t?10:"large"===t?12:11,o="small"===t?4:"large"===t?8:6;return v.default.create({container:{flexDirection:"row",alignItems:"center",flexWrap:"wrap",gap:o},indicatorGroup:{flexDirection:"row",alignItems:"center"},indicator:{flexDirection:"row",alignItems:"center",paddingHorizontal:r,paddingVertical:r/2,borderRadius:12,gap:4},indicatorText:{fontSize:n,fontWeight:"500",fontFamily:e.typography.fontFamilies.medium},sessionToggle:{}})};const Pn=function(e){var t=e.tag,r=e.showSession,n=void 0===r||r,o=e.showSecurityLevel,a=void 0===o||o,i=e.onSessionToggle,s=e.size,l=void 0===s?"medium":s;if(!Pr())return null;var c=me().theme,d=An(c,l),u=function(){switch(t.security_level){case"enhanced":return{color:"#00C851",icon:"shield-checkmark",label:"Enhanced"};case"standard":return{color:"#007AFF",icon:"shield",label:"Standard"};case"legacy":return{color:"#FF9500",icon:"shield-outline",label:"Legacy"};default:return{color:"#8E8E93",icon:"shield-outline",label:"Unknown"}}}(),f=function(){switch(t.auth_method){case"opaque":return{color:"#00C851",icon:"key",label:"OPAQUE"};case"legacy":return{color:"#FF9500",icon:"key-outline",label:"Legacy"};default:return{color:"#8E8E93",icon:"key-outline",label:"Unknown"}}}();return(0,G.jsxs)(h.default,{style:d.container,children:[a&&(0,G.jsx)(h.default,{style:d.indicatorGroup,children:(0,G.jsxs)(h.default,{style:[d.indicator,{backgroundColor:u.color+"20"}],children:[(0,G.jsx)(ae.default,{name:u.icon,size:"small"===l?12:"large"===l?18:14,color:u.color}),"small"!==l&&(0,G.jsx)(m.default,{style:[d.indicatorText,{color:u.color}],children:u.label})]})}),(0,G.jsx)(h.default,{style:d.indicatorGroup,children:(0,G.jsxs)(h.default,{style:[d.indicator,{backgroundColor:f.color+"20"}],children:[(0,G.jsx)(ae.default,{name:f.icon,size:"small"===l?12:"large"===l?18:14,color:f.color}),"small"!==l&&(0,G.jsx)(m.default,{style:[d.indicatorText,{color:f.color}],children:f.label})]})}),n&&i&&(0,G.jsx)(ne.default,{style:d.sessionToggle,onPress:function(){return i(t.id)},accessibilityLabel:"Toggle session status",accessibilityRole:"button",children:(0,G.jsxs)(h.default,{style:[d.indicator,{backgroundColor:c.colors.primary+"20"}],children:[(0,G.jsx)(ae.default,{name:"time",size:"small"===l?12:"large"===l?18:14,color:c.colors.primary}),"small"!==l&&(0,G.jsx)(m.default,{style:[d.indicatorText,{color:c.colors.primary}],children:"Session"})]})}),t.device_fingerprint&&(0,G.jsx)(h.default,{style:d.indicatorGroup,children:(0,G.jsxs)(h.default,{style:[d.indicator,{backgroundColor:"#00C85120"}],children:[(0,G.jsx)(ae.default,{name:"phone-portrait",size:"small"===l?12:"large"===l?18:14,color:"#00C851"}),"large"===l&&(0,G.jsx)(m.default,{style:[d.indicatorText,{color:"#00C851"}],children:"Device Bound"})]})}),t.migrated_from&&(0,G.jsx)(h.default,{style:d.indicatorGroup,children:(0,G.jsxs)(h.default,{style:[d.indicator,{backgroundColor:"#FF950020"}],children:[(0,G.jsx)(ae.default,{name:"refresh",size:"small"===l?12:"large"===l?18:14,color:"#FF9500"}),"large"===l&&(0,G.jsx)(m.default,{style:[d.indicatorText,{color:"#FF9500"}],children:"Migrated"})]})})]})};function Rn(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Dn(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Rn(Object(r),!0).forEach((function(t){(0,b.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Rn(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var zn=function(e){return v.default.create({container:{flex:1,backgroundColor:e.colors.background},card:Dn({backgroundColor:e.colors.card,margin:e.spacing.lg,padding:e.spacing.xl,borderRadius:12},e.shadows.sm),title:{fontSize:e.typography.fontSizes.xl,fontWeight:"bold",textAlign:"center",marginBottom:e.spacing.lg,color:e.colors.text,fontFamily:e.typography.fontFamilies.bold},description:{fontSize:e.typography.fontSizes.md,lineHeight:24,textAlign:"center",marginBottom:e.spacing.xl,color:e.colors.textSecondary,fontFamily:e.typography.fontFamilies.regular},warningContainer:{backgroundColor:"#FFF3CD",borderColor:"#FFEAA7",borderWidth:1,borderRadius:8,padding:e.spacing.lg,marginBottom:e.spacing.xl},warningHeader:{flexDirection:"row",alignItems:"center",marginBottom:e.spacing.md},warningTitle:{fontSize:e.typography.fontSizes.md,fontWeight:"bold",color:e.colors.error,marginLeft:e.spacing.sm,fontFamily:e.typography.fontFamilies.bold},warningText:{fontSize:e.typography.fontSizes.sm,color:"#856404",lineHeight:20,marginBottom:e.spacing.sm,fontFamily:e.typography.fontFamilies.regular},warningTextBold:{fontSize:e.typography.fontSizes.sm,color:"#721C24",lineHeight:20,fontWeight:"bold",marginBottom:e.spacing.md,fontFamily:e.typography.fontFamilies.bold},warningTips:{marginTop:e.spacing.sm},warningTipTitle:{fontSize:e.typography.fontSizes.sm,fontWeight:"600",color:"#856404",marginBottom:e.spacing.xs,fontFamily:e.typography.fontFamilies.semiBold},warningTip:{fontSize:e.typography.fontSizes.sm,color:"#856404",lineHeight:18,fontFamily:e.typography.fontFamilies.regular,flex:1},warningTipItem:{marginBottom:2,flexDirection:"row",alignItems:"flex-start"},warningBullet:{width:4,height:4,borderRadius:2,backgroundColor:"#856404",marginTop:7,marginRight:e.spacing.xs},successContainer:Dn({flex:1,backgroundColor:e.colors.card,margin:e.spacing.lg,padding:e.spacing.xl,borderRadius:12,alignItems:"center",justifyContent:"center"},e.shadows.sm),successIcon:{marginBottom:e.spacing.xl},successTitle:{fontSize:e.typography.fontSizes.xxl,fontWeight:"bold",color:e.colors.success||"#34C759",textAlign:"center",marginBottom:e.spacing.xl,fontFamily:e.typography.fontFamilies.bold},successDetails:{width:"100%",marginBottom:e.spacing.xl},successLabel:{fontSize:e.typography.fontSizes.sm,color:e.colors.textSecondary,fontWeight:"600",marginBottom:e.spacing.xs,fontFamily:e.typography.fontFamilies.semiBold},successValue:{fontSize:e.typography.fontSizes.lg,color:e.colors.text,fontWeight:"bold",marginBottom:e.spacing.lg,fontFamily:e.typography.fontFamilies.bold},successInstructions:{width:"100%",marginBottom:e.spacing.xl},successInstructionText:{fontSize:e.typography.fontSizes.md,color:e.colors.textSecondary,textAlign:"center",lineHeight:22,fontFamily:e.typography.fontFamilies.regular},continueButton:{backgroundColor:e.colors.primary,paddingHorizontal:e.spacing.xl,paddingVertical:e.spacing.lg,borderRadius:8,minWidth:120},continueButtonText:{color:e.colors.background,fontSize:e.typography.fontSizes.md,fontWeight:"600",textAlign:"center",fontFamily:e.typography.fontFamilies.semiBold},opaqueIndicatorContainer:{marginVertical:e.spacing.md,alignItems:"center"},securityNotice:{flexDirection:"row",backgroundColor:"#FFF9E6",padding:e.spacing.md,borderRadius:8,marginTop:e.spacing.md,borderLeftWidth:4,borderLeftColor:"#FF9500"},securityNoticeIcon:{marginRight:e.spacing.sm,marginTop:2},securityNoticeText:{flex:1,fontSize:e.typography.fontSizes.sm,color:"#8B4513",lineHeight:20,fontFamily:e.typography.fontFamilies.regular},securityNoticeTextBold:{fontWeight:"600",fontFamily:e.typography.fontFamilies.semiBold},authMethodContainer:{marginBottom:e.spacing.lg,backgroundColor:e.colors.surface,padding:e.spacing.md,borderRadius:8},authMethodTitle:{fontSize:e.typography.fontSizes.md,fontWeight:"600",marginBottom:e.spacing.md,color:e.colors.text,fontFamily:e.typography.fontFamilies.semiBold},authMethodOption:{flexDirection:"row",alignItems:"center",justifyContent:"space-between"},authMethodInfo:{flex:1,marginRight:e.spacing.md},authMethodLabel:{fontSize:e.typography.fontSizes.md,fontWeight:"500",color:e.colors.text,fontFamily:e.typography.fontFamilies.medium},authMethodDescription:{fontSize:e.typography.fontSizes.sm,color:e.colors.textSecondary,marginTop:2,fontFamily:e.typography.fontFamilies.regular},securityLevelContainer:{marginTop:e.spacing.md},securityLevelTitle:{fontSize:e.typography.fontSizes.sm,fontWeight:"600",marginBottom:e.spacing.sm,color:e.colors.text,fontFamily:e.typography.fontFamilies.semiBold},securityLevelDescription:{fontSize:e.typography.fontSizes.sm,color:e.colors.textSecondary,marginBottom:e.spacing.md,fontFamily:e.typography.fontFamilies.regular},securityInfoBox:{flexDirection:"row",alignItems:"center",padding:e.spacing.md,borderRadius:8,borderWidth:1,borderColor:"#00C851",backgroundColor:"#00C85110"},securityInfoText:{marginLeft:e.spacing.sm,fontSize:e.typography.fontSizes.md,color:"#00C851",fontFamily:e.typography.fontFamilies.semiBold,fontWeight:"600"},inputContainer:{marginBottom:e.spacing.lg},label:{fontSize:e.typography.fontSizes.md,fontWeight:"600",marginBottom:e.spacing.sm,color:e.colors.text,fontFamily:e.typography.fontFamilies.semiBold},input:{borderWidth:1,borderColor:e.colors.border,borderRadius:8,padding:e.spacing.md,fontSize:e.typography.fontSizes.md,backgroundColor:e.colors.card,color:e.colors.text,fontFamily:e.typography.fontFamilies.regular},inputValid:{borderColor:"#34C759"},inputError:{borderColor:e.colors.error},validationContainer:{marginTop:e.spacing.xs,paddingHorizontal:e.spacing.xs,paddingVertical:4,borderRadius:4,minHeight:20},validationSuccess:{backgroundColor:"#E8F5E8"},validationError:{backgroundColor:"#FFF2F2"},validationText:{fontSize:e.typography.fontSizes.sm,fontFamily:e.typography.fontFamilies.regular,lineHeight:16},validationTextSuccess:{color:"#22C55E"},validationTextError:{color:e.colors.error},colorGrid:{flexDirection:"row",flexWrap:"wrap",justifyContent:"space-between"},colorOption:{width:40,height:40,borderRadius:20,marginBottom:e.spacing.sm,justifyContent:"center",alignItems:"center",borderWidth:2,borderColor:"transparent"},selectedColorOption:{borderColor:e.colors.text,borderWidth:3},buttonContainer:{flexDirection:"row",justifyContent:"space-between",marginBottom:e.spacing.lg},button:{flex:1,padding:e.spacing.lg,borderRadius:8,alignItems:"center",marginHorizontal:e.spacing.sm},createButton:{backgroundColor:e.colors.primary},cancelButton:{backgroundColor:"transparent",borderWidth:1,borderColor:e.colors.textSecondary},buttonText:{color:e.colors.background,fontSize:e.typography.fontSizes.md,fontWeight:"600",fontFamily:e.typography.fontFamilies.semiBold},cancelButtonText:{color:e.colors.textSecondary,fontSize:e.typography.fontSizes.md,fontWeight:"600",fontFamily:e.typography.fontFamilies.semiBold}})};const Bn=function(e){var t=e.onTagCreated,r=e.onCancel,a=e.existingTagNames,i=void 0===a?[]:a,s=e.enableOpaqueAuth,l=void 0===s||s;if(!Pr())return null;var c=me().theme,u=zn(c),f=(0,d.useState)(""),g=(0,o.default)(f,2),y=g[0],p=g[1],v=(0,d.useState)(""),b=(0,o.default)(v,2),x=b[0],S=b[1],w=(0,d.useState)(""),j=(0,o.default)(w,2),C=j[0],k=j[1],T=(0,d.useState)("#007AFF"),O=(0,o.default)(T,2),F=O[0],A=O[1],P=(0,d.useState)(!1),R=(0,o.default)(P,2),D=R[0],z=R[1],B=(0,d.useState)(!0),_=(0,o.default)(B,2),L=_[0],N=(_[1],(0,d.useState)("standard")),M=(0,o.default)(N,1)[0],H=(0,d.useState)(!1),U=(0,o.default)(H,2),V=(U[0],U[1]),K=(0,d.useState)(null),q=(0,o.default)(K,2),Q=q[0],J=q[1],Y=(0,d.useCallback)((function(e){return e.trim()?e.length<2?"Tag name must be at least 2 characters":e.length>50?"Tag name must be less than 50 characters":i.some((function(t){return t.toLowerCase()===e.toLowerCase()}))?"A tag with this name already exists":null:"Tag name cannot be empty"}),[i]),Z=(0,d.useCallback)((function(e){if(!e.trim())return"Activation phrase cannot be empty";if(e.length<3)return"Activation phrase must be at least 3 characters";if(e.length>100)return"Activation phrase must be less than 100 characters";return["the","and","or","but","in","on","at","to","for","of","with","by"].includes(e.toLowerCase().trim())?"Please choose a more unique phrase to avoid accidental activation":null}),[]),X=(0,d.useCallback)((function(e,t){return t.trim()?e!==t?"Phrases do not match":null:"Please confirm your activation phrase"}),[]),$=(0,d.useCallback)((0,n.default)((function*(){var e=Y(y);if(e)ft.default.alert("Invalid Name",e);else{var r=Z(x);if(r)ft.default.alert("Invalid Phrase",r);else{var n=X(x,C);if(n)ft.default.alert("Invalid Confirmation",n);else{z(!0);try{var o,a,i,s,l=x.trim();E.info("\ud83d\ude80 UPDATED CODE: Starting OPAQUE secret tag registration",{tagName:y.trim(),phraseLength:l.length,timestamp:(new Date).toISOString()});var c,d=W.getInstance(),u="secret-tag-"+y.trim().toLowerCase().replace(/\s+/g,"-")+"-"+Date.now();E.info("Step 1: Starting OPAQUE registration with OpaqueAuthService");try{var f,g;c=(yield d.startRegistration(l,u)).registrationRequest,E.info("Step 1 Complete: OPAQUE startRegistration result",{registrationRequestType:typeof c,registrationRequestLength:null==(f=c)?void 0:f.length,registrationRequestSample:null==(g=c)?void 0:g.slice(0,50),registrationRequestFull:c})}catch(H){throw E.error("Step 1 Failed: OPAQUE startRegistration error",H),new Error("OPAQUE startRegistration failed: "+(H instanceof Error?H.message:String(H)))}E.info("Step 2: Sending registration request to server");var h={opaque_registration_request:c,tag_name:y.trim(),color:F};E.info("Request data being sent to backend:",{opaque_registration_request_length:null==(o=c)?void 0:o.length,opaque_registration_request_type:typeof c,opaque_registration_request_sample:null==(a=c)?void 0:a.slice(0,20),tag_name:h.tag_name,color:h.color});var m,v=(yield I.post("/api/v1/secret-tags/register/start",h)).data,b=v.opaque_registration_response,w=v.session_id;v.tag_handle;if(!b)throw new Error("Invalid server registration response");E.info("Step 3: Completing OPAQUE registration");try{var j,T;m=yield d.finishRegistration(u,b),E.info("Step 3 Complete: OPAQUE finishRegistration result",{registrationRecordType:typeof m,registrationRecordLength:null==(j=m)?void 0:j.length,registrationRecordSample:null==(T=m)?void 0:T.slice(0,50),registrationRecordFull:m})}catch(H){throw E.error("Step 3 Failed: OPAQUE finishRegistration error",H),new Error("OPAQUE finishRegistration failed: "+(H instanceof Error?H.message:String(H)))}if(!m)throw new Error("Failed to complete OPAQUE registration");E.info("Step 4: Creating secret tag with OPAQUE data",{registrationRequestType:typeof c,registrationRequestLength:null==(i=c)?void 0:i.length,registrationRequestValue:c,registrationRecordType:typeof m,registrationRecordLength:null==(s=m)?void 0:s.length,registrationRecordValue:m});Array.from({length:16},(function(){return Math.floor(256*Math.random())}));E.info("OPAQUE data before sending to backend:",{registrationRequestType:typeof c,registrationRequestLength:c.length,registrationRequestSample:c.slice(0,20),registrationRecordType:typeof m,registrationRecordLength:m.length,registrationRecordSample:m.slice(0,20)}),E.info("\ud83d\udd0d About to validate base64 data:",{registrationRequestType:typeof c,registrationRequestValue:c,registrationRecordType:typeof m,registrationRecordValue:m});var O=function(e,t){try{var r=e.replace(/-/g,"+").replace(/_/g,"/"),n=r.length%4,o=n?r+"=".repeat(4-n):r,a=atob(o);E.info("\u2705 "+t+" base64url valid (length: "+a.length+")")}catch(H){throw E.error("\u274c "+t+" base64 validation failed:",H),new Error(t+" is not valid base64/base64url")}};try{E.info("\ud83e\uddea Validating OPAQUE base64 data..."),O(c,"registrationRequest"),O(m,"registrationRecord"),E.info("\u2705 All OPAQUE base64 validation passed")}catch(H){throw E.error("Base64 validation failed:",H),new Error("OPAQUE data is not valid base64")}var P=yield I.post("/api/v1/secret-tags/register/finish",{session_id:w,opaque_registration_record:m});if(!P.data)throw new Error("Invalid registration response from server");var R=P.data,D=R.tag_id,B={id:D,tag_name:R.tag_name,color_code:R.color_code,created_at:R.created_at,updated_at:R.updated_at,user_id:R.user_id||0,auth_method:"opaque",security_level:M,authentication_count:0};E.info("OPAQUE secret tag created successfully:",D),J({tagName:y.trim(),phrase:l,isOpaque:!0,tag:B}),p(""),S(""),k(""),A("#007AFF"),V(!1),setTimeout((function(){null==t||t(D)}),3e3)}catch(H){if(E.error("Failed to create secret tag:",H),H&&"object"===typeof H&&"response"in H){var _,L,N=H.response;null!=N&&null!=(_=N.data)&&_.detail&&E.error("Backend validation error detail:",N.data.detail),null!=N&&null!=(L=N.data)&&L.errors&&E.error("Backend validation errors:",N.data.errors)}ft.default.alert("Creation Failed",H instanceof Error?H.message:"Failed to create secret tag")}finally{z(!1)}}}}})),[y,x,C,F,M,Y,Z,X,t]);return Q?(0,G.jsx)(h.default,{style:u.container,children:(0,G.jsxs)(h.default,{style:u.successContainer,children:[(0,G.jsx)(h.default,{style:u.successIcon,children:(0,G.jsx)(ae.default,{name:Q.isOpaque?"shield-checkmark":"checkmark-circle",size:64,color:Q.isOpaque?"#00C851":c.colors.success||"#34C759"})}),(0,G.jsx)(m.default,{style:u.successTitle,children:Q.isOpaque?"OPAQUE Secret Tag Created!":"Secret Tag Created!"}),Q.isOpaque&&Q.tag&&(0,G.jsx)(h.default,{style:u.opaqueIndicatorContainer,children:(0,G.jsx)(Pn,{tag:Q.tag,showSession:!1,showSecurityLevel:!0,size:"large"})}),(0,G.jsxs)(h.default,{style:u.successDetails,children:[(0,G.jsx)(m.default,{style:u.successLabel,children:"Tag Name:"}),(0,G.jsx)(m.default,{style:u.successValue,children:Q.tagName}),(0,G.jsx)(m.default,{style:u.successLabel,children:"Activation Phrase:"}),(0,G.jsxs)(m.default,{style:u.successValue,children:['"',Q.phrase,'"']}),Q.isOpaque&&(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(m.default,{style:u.successLabel,children:"Authentication:"}),(0,G.jsx)(m.default,{style:u.successValue,children:"Zero-Knowledge OPAQUE"})]})]}),(0,G.jsx)(h.default,{style:u.successInstructions,children:(0,G.jsx)(m.default,{style:u.successInstructionText,children:"Your tag is protected with OPAQUE zero-knowledge authentication. Include your activation phrase in journal entries to automatically access encrypted content."})}),Q.isOpaque&&(0,G.jsxs)(h.default,{style:u.securityNotice,children:[(0,G.jsx)(h.default,{style:u.securityNoticeIcon,children:(0,G.jsx)(ae.default,{name:"warning",size:20,color:"#FF9500"})}),(0,G.jsxs)(m.default,{style:u.securityNoticeText,children:[(0,G.jsx)(m.default,{style:u.securityNoticeTextBold,children:"Important:"})," This phrase cannot be recovered if forgotten. Your encrypted entries will be permanently inaccessible without it."]})]}),(0,G.jsx)(ne.default,{style:u.continueButton,onPress:function(){J(null),null==t||t(Q.tagName)},children:(0,G.jsx)(m.default,{style:u.continueButtonText,children:"Continue"})})]})}):(0,G.jsx)(be.default,{style:u.container,children:(0,G.jsxs)(h.default,{style:u.card,children:[(0,G.jsx)(m.default,{style:u.title,children:"Create Secret Tag"}),(0,G.jsx)(m.default,{style:u.description,children:"Secret tags provide independent privacy levels for your journal entries. Include your activation phrase in journal entries to automatically access encrypted content."}),(0,G.jsxs)(h.default,{style:u.securityLevelContainer,children:[(0,G.jsx)(m.default,{style:u.securityLevelTitle,children:"Security Level"}),(0,G.jsx)(m.default,{style:u.securityLevelDescription,children:"All tags use OPAQUE zero-knowledge authentication with server-side phrase detection. Neither we nor anyone else can see or recover your secret tags or entries."}),(0,G.jsxs)(h.default,{style:u.securityInfoBox,children:[(0,G.jsx)(ae.default,{name:"shield-checkmark",size:24,color:"#00C851"}),(0,G.jsx)(m.default,{style:u.securityInfoText,children:"Zero-Knowledge OPAQUE Authentication"})]})]}),(0,G.jsxs)(h.default,{style:u.warningContainer,children:[(0,G.jsxs)(h.default,{style:u.warningHeader,children:[(0,G.jsx)(ae.default,{name:"warning",size:20,color:c.colors.error}),(0,G.jsx)(m.default,{style:u.warningTitle,children:L&&l?"IMPORTANT: OPAQUE Zero-Knowledge Privacy":"IMPORTANT: Zero-Knowledge Privacy"})]}),(0,G.jsx)(m.default,{style:u.warningText,children:"This tag uses OPAQUE zero-knowledge authentication with server-side phrase detection. Neither we nor anyone else can see or recover your secret tags or entries."}),(0,G.jsx)(m.default,{style:u.warningTextBold,children:"If you forget your activation phrase, all entries with this tag will be permanently lost. There is no recovery method."}),(0,G.jsx)(m.default,{style:u.warningTextBold,children:"To access encrypted entries, type your exact activation phrase in a journal entry."}),(0,G.jsxs)(h.default,{style:u.warningTips,children:[(0,G.jsx)(m.default,{style:u.warningTipTitle,children:"Tips for remembering phrases:"}),(0,G.jsxs)(h.default,{style:u.warningTipItem,children:[(0,G.jsx)(h.default,{style:u.warningBullet}),(0,G.jsx)(m.default,{style:u.warningTip,children:"Use phrases that are meaningful to you"})]}),(0,G.jsxs)(h.default,{style:u.warningTipItem,children:[(0,G.jsx)(h.default,{style:u.warningBullet}),(0,G.jsx)(m.default,{style:u.warningTip,children:"Consider writing them down in a secure location"})]}),(0,G.jsxs)(h.default,{style:u.warningTipItem,children:[(0,G.jsx)(h.default,{style:u.warningBullet}),(0,G.jsx)(m.default,{style:u.warningTip,children:"Test your phrases after creation"})]}),L&&l&&(0,G.jsxs)(h.default,{style:u.warningTipItem,children:[(0,G.jsx)(h.default,{style:u.warningBullet}),(0,G.jsx)(m.default,{style:u.warningTip,children:"Ensure this device remains accessible for future use"})]})]})]}),(0,G.jsxs)(h.default,{style:u.inputContainer,children:[(0,G.jsx)(m.default,{style:u.label,children:"Tag Name"}),(0,G.jsx)(re.default,{style:[u.input,y&&Y(y)?u.inputError:u.inputValid],value:y,onChangeText:p,placeholder:"e.g., Work Private, Personal Thoughts",autoCapitalize:"words",autoCorrect:!1,maxLength:50}),(0,G.jsx)(h.default,{style:[u.validationContainer,y&&Y(y)?u.validationError:u.validationSuccess],children:(0,G.jsx)(m.default,{style:[u.validationText,y&&Y(y)?u.validationTextError:u.validationTextSuccess],children:y&&Y(y)?Y(y):y?"\u2713 Tag name looks good":"Enter a unique tag name"})})]}),(0,G.jsxs)(h.default,{style:u.inputContainer,children:[(0,G.jsx)(m.default,{style:u.label,children:"Activation Phrase"}),(0,G.jsx)(re.default,{style:[u.input,x&&Z(x)?u.inputError:u.inputValid],value:x,onChangeText:S,placeholder:"e.g., activate work mode, private thoughts",autoCapitalize:"none",autoCorrect:!1,maxLength:100}),(0,G.jsx)(h.default,{style:[u.validationContainer,x&&Z(x)?u.validationError:u.validationSuccess],children:(0,G.jsx)(m.default,{style:[u.validationText,x&&Z(x)?u.validationTextError:u.validationTextSuccess],children:x&&Z(x)?Z(x):x?"\u2713 Activation phrase looks good":"Enter a unique activation phrase"})})]}),L&&l&&(0,G.jsxs)(h.default,{style:u.inputContainer,children:[(0,G.jsx)(m.default,{style:u.label,children:"Confirm Activation Phrase"}),(0,G.jsx)(re.default,{style:[u.input,C&&X(x,C)?u.inputError:u.inputValid],value:C,onChangeText:k,placeholder:"Re-enter your activation phrase",autoCapitalize:"none",autoCorrect:!1,maxLength:100}),(0,G.jsx)(h.default,{style:[u.validationContainer,C&&X(x,C)?u.validationError:u.validationSuccess],children:(0,G.jsx)(m.default,{style:[u.validationText,C&&X(x,C)?u.validationTextError:u.validationTextSuccess],children:C&&X(x,C)?X(x,C):C&&x===C?"\u2713 Phrases match":"Confirm your activation phrase"})})]}),(0,G.jsxs)(h.default,{style:u.inputContainer,children:[(0,G.jsx)(m.default,{style:u.label,children:"Tag Color"}),(0,G.jsx)(h.default,{style:u.colorGrid,children:["#007AFF","#34C759","#FF9500","#FF3B30","#AF52DE","#FF2D92","#5AC8FA","#FFCC00","#FF6B6B","#4ECDC4","#45B7D1","#96CEB4"].map((function(e){return(0,G.jsx)(ne.default,{style:[u.colorOption,{backgroundColor:e},F===e&&u.selectedColorOption],onPress:function(){return A(e)},children:F===e&&(0,G.jsx)(ae.default,{name:"checkmark",size:16,color:c.colors.background})},e)}))})]}),(0,G.jsxs)(h.default,{style:u.buttonContainer,children:[(0,G.jsx)(ne.default,{style:[u.button,u.cancelButton],onPress:r,disabled:D,children:(0,G.jsx)(m.default,{style:u.cancelButtonText,children:"Cancel"})}),(0,G.jsx)(ne.default,{style:[u.button,u.createButton],onPress:$,disabled:D||!y||!x,children:D?(0,G.jsx)(te.default,{color:"#FFFFFF"}):(0,G.jsx)(m.default,{style:u.buttonText,children:"Create Secret Tag"})})]})]})})};var _n=function(e){return v.default.create({container:{flex:1,backgroundColor:e.colors.background},content:{flex:1,padding:e.spacing.lg},header:{marginBottom:e.spacing.xl,alignItems:"center"},title:{fontSize:e.typography.fontSizes.xxl,fontWeight:"bold",color:e.colors.text,textAlign:"center",marginBottom:e.spacing.sm,fontFamily:e.typography.fontFamilies.bold},subtitle:{fontSize:e.typography.fontSizes.md,color:e.colors.textSecondary,textAlign:"center",fontFamily:e.typography.fontFamilies.regular},inputContainer:{marginBottom:e.spacing.xl},label:{fontSize:e.typography.fontSizes.md,fontWeight:"600",color:e.colors.text,marginBottom:e.spacing.sm,fontFamily:e.typography.fontFamilies.medium},input:{borderWidth:1,borderColor:e.colors.border,borderRadius:e.borderRadius.md,padding:e.spacing.md,fontSize:e.typography.fontSizes.md,color:e.colors.text,backgroundColor:e.colors.inputBackground,fontFamily:e.typography.fontFamilies.regular},colorGrid:{flexDirection:"row",flexWrap:"wrap",gap:e.spacing.md},colorOption:{width:44,height:44,borderRadius:22,justifyContent:"center",alignItems:"center",borderWidth:2,borderColor:"transparent"},selectedColorOption:{borderColor:e.colors.text,borderWidth:3},previewContainer:{marginBottom:e.spacing.xl},tagPreview:{flexDirection:"row",alignItems:"center",backgroundColor:e.colors.card,padding:e.spacing.md,borderRadius:e.borderRadius.md,borderWidth:1,borderColor:e.colors.border},tagColorIndicator:{width:16,height:16,borderRadius:8,marginRight:e.spacing.md},tagPreviewText:{fontSize:e.typography.fontSizes.md,color:e.colors.text,fontFamily:e.typography.fontFamilies.regular},buttonContainer:{flexDirection:"row",padding:e.spacing.lg,gap:e.spacing.md,borderTopWidth:1,borderTopColor:e.colors.border,backgroundColor:e.colors.card},button:{flex:1,paddingVertical:e.spacing.md,paddingHorizontal:e.spacing.lg,borderRadius:e.borderRadius.md,alignItems:"center",justifyContent:"center",minHeight:48},cancelButton:{backgroundColor:e.colors.card,borderWidth:1,borderColor:e.colors.border},cancelButtonText:{fontSize:e.typography.fontSizes.md,color:e.colors.text,fontFamily:e.typography.fontFamilies.medium},createButton:{backgroundColor:e.colors.primary},createButtonText:{fontSize:e.typography.fontSizes.md,color:e.colors.onPrimary,fontFamily:e.typography.fontFamilies.semiBold},disabledButton:{opacity:.5}})};const Ln=function(e){var t=e.onTagCreated,r=e.onCancel,a=e.existingTagNames,i=void 0===a?[]:a,s=me().theme,l=_n(s),c=(0,d.useState)(""),u=(0,o.default)(c,2),f=u[0],g=u[1],y=(0,d.useState)("#007AFF"),p=(0,o.default)(y,2),v=p[0],b=p[1],x=(0,d.useState)(!1),S=(0,o.default)(x,2),w=S[0],j=S[1],C=(0,d.useCallback)((function(e){return e.trim()?e.length<2?"Tag name must be at least 2 characters":e.length>50?"Tag name must be less than 50 characters":i.some((function(t){return t.toLowerCase()===e.toLowerCase()}))?"A tag with this name already exists":null:"Tag name cannot be empty"}),[i]),k=(0,d.useCallback)((0,n.default)((function*(){var e=C(f);if(e)ft.default.alert("Invalid Name",e);else{j(!0);try{var r=yield D.createTag({name:f.trim(),color:v});E.info("Regular tag created:",r),null==t||t(r),g(""),b("#007AFF")}catch(n){E.error("Failed to create regular tag:",n),ft.default.alert("Creation Failed",n instanceof Error?n.message:"Failed to create tag")}finally{j(!1)}}})),[f,v,C,t]),T=f.trim()&&!w;return(0,G.jsxs)(h.default,{style:l.container,children:[(0,G.jsxs)(be.default,{style:l.content,keyboardShouldPersistTaps:"handled",children:[(0,G.jsxs)(h.default,{style:l.header,children:[(0,G.jsx)(m.default,{style:l.title,children:"Create Regular Tag"}),(0,G.jsx)(m.default,{style:l.subtitle,children:"Regular tags help organize your journal entries"})]}),(0,G.jsxs)(h.default,{style:l.inputContainer,children:[(0,G.jsx)(m.default,{style:l.label,children:"Tag Name"}),(0,G.jsx)(re.default,{style:l.input,value:f,onChangeText:g,placeholder:"e.g., Work, Personal, Travel",placeholderTextColor:s.colors.textSecondary,maxLength:50,autoCapitalize:"words",autoCorrect:!1,autoFocus:!0})]}),(0,G.jsxs)(h.default,{style:l.inputContainer,children:[(0,G.jsx)(m.default,{style:l.label,children:"Tag Color"}),(0,G.jsx)(h.default,{style:l.colorGrid,children:["#007AFF","#34C759","#FF9500","#FF3B30","#AF52DE","#FF2D92","#5AC8FA","#FFCC00","#FF6B6B","#4ECDC4","#45B7D1","#96CEB4"].map((function(e){return(0,G.jsx)(ne.default,{style:[l.colorOption,{backgroundColor:e},v===e&&l.selectedColorOption],onPress:function(){return b(e)},children:v===e&&(0,G.jsx)(ae.default,{name:"checkmark",size:16,color:"white"})},e)}))})]}),(0,G.jsxs)(h.default,{style:l.previewContainer,children:[(0,G.jsx)(m.default,{style:l.label,children:"Preview"}),(0,G.jsxs)(h.default,{style:l.tagPreview,children:[(0,G.jsx)(h.default,{style:[l.tagColorIndicator,{backgroundColor:v}]}),(0,G.jsx)(m.default,{style:l.tagPreviewText,children:f||"Your tag name"})]})]})]}),(0,G.jsxs)(h.default,{style:l.buttonContainer,children:[(0,G.jsx)(ne.default,{style:[l.button,l.cancelButton],onPress:r,disabled:w,children:(0,G.jsx)(m.default,{style:l.cancelButtonText,children:"Cancel"})}),(0,G.jsx)(ne.default,{style:[l.button,l.createButton,!T&&l.disabledButton],onPress:k,disabled:!T,children:w?(0,G.jsx)(te.default,{color:"white"}):(0,G.jsx)(m.default,{style:l.createButtonText,children:"Create Tag"})})]})]})};function Nn(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Mn(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Nn(Object(r),!0).forEach((function(t){(0,b.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Nn(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Hn=function(e){return v.default.create({container:Mn({backgroundColor:e.colors.card,borderRadius:12,padding:e.spacing.lg,marginBottom:e.spacing.md,borderWidth:1,borderColor:e.colors.border},e.shadows.sm),activeContainer:{borderColor:e.colors.primary,borderWidth:2},header:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",marginBottom:e.spacing.md},tagInfo:{flexDirection:"row",alignItems:"center",flex:1},colorIndicator:{width:12,height:12,borderRadius:6,marginRight:e.spacing.sm},tagDetails:{flex:1},tagName:{fontSize:e.typography.fontSizes.lg,fontWeight:"600",color:e.colors.text,fontFamily:e.typography.fontFamilies.semiBold,marginBottom:2},tagDate:{fontSize:e.typography.fontSizes.sm,color:e.colors.textSecondary,fontFamily:e.typography.fontFamilies.regular},statusBadge:{paddingHorizontal:e.spacing.sm,paddingVertical:4,borderRadius:12,backgroundColor:e.colors.card},activeStatusBadge:{backgroundColor:e.colors.primary},statusText:{fontSize:e.typography.fontSizes.xs,fontWeight:"600",color:e.colors.textSecondary,fontFamily:e.typography.fontFamilies.semiBold},activeStatusText:{color:e.colors.background},actions:{flexDirection:"row",justifyContent:"space-between",marginBottom:e.spacing.sm},actionButton:{flexDirection:"row",alignItems:"center",paddingHorizontal:e.spacing.md,paddingVertical:e.spacing.sm,borderRadius:8,flex:1,marginHorizontal:2,justifyContent:"center"},toggleButton:{backgroundColor:"transparent",borderWidth:1,borderColor:e.colors.primary},activeToggleButton:{backgroundColor:e.colors.primary},editButton:{backgroundColor:"transparent",borderWidth:1,borderColor:e.colors.border},deleteButton:{backgroundColor:"transparent",borderWidth:1,borderColor:e.colors.error},actionButtonText:{fontSize:e.typography.fontSizes.sm,fontWeight:"600",color:e.colors.primary,fontFamily:e.typography.fontFamilies.semiBold,marginLeft:4},activeActionButtonText:{color:e.colors.background},secondaryActionButtonText:{fontSize:e.typography.fontSizes.sm,fontWeight:"600",color:e.colors.textSecondary,fontFamily:e.typography.fontFamilies.semiBold,marginLeft:4},activeInfo:{flexDirection:"row",alignItems:"center",backgroundColor:e.colors.primaryLight||e.colors.primary+"20",padding:e.spacing.sm,borderRadius:8,marginTop:e.spacing.sm},activeInfoText:{fontSize:e.typography.fontSizes.sm,color:e.colors.primary,fontFamily:e.typography.fontFamilies.regular,marginLeft:e.spacing.xs,flex:1},inactiveInfo:{flexDirection:"row",alignItems:"center",backgroundColor:e.colors.card,borderWidth:1,borderColor:e.colors.border,padding:e.spacing.sm,borderRadius:8,marginTop:e.spacing.sm},inactiveInfoText:{fontSize:e.typography.fontSizes.sm,color:e.colors.textSecondary,fontFamily:e.typography.fontFamilies.regular,marginLeft:e.spacing.xs,flex:1},disabledButton:{opacity:.5,borderColor:e.colors.border}})};const Wn=function(e){var t,r=e.tag,a=e.isActive,i=e.onActivate,s=e.onDeactivate,l=e.onEdit,c=e.onDelete,u=me().theme,f=Hn(u),g=(0,d.useState)(!1),y=(0,o.default)(g,2),p=y[0],v=y[1],b=function(){var e=(0,n.default)((function*(){v(!0);try{a?yield s(r.id):yield i(r.id)}catch(e){E.error("Failed to toggle tag activation:",e),ft.default.alert("Error",e instanceof Error?e.message:"Failed to toggle tag activation")}finally{v(!1)}}));return function(){return e.apply(this,arguments)}}(),x=function(){var e=(0,n.default)((function*(){try{console.log("Proceeding with deletion of tag: "+r.name),yield c(r.id),"web"===k.default.OS?window.alert("The secret tag has been permanently deleted."):ft.default.alert("Tag Deleted","The secret tag has been permanently deleted.")}catch(t){E.error("Failed to delete tag:",t);var e=t instanceof Error?t.message:"Failed to delete tag";"web"===k.default.OS?window.alert("Error: "+e):ft.default.alert("Error",e)}}));return function(){return e.apply(this,arguments)}}();return Pr()?(0,G.jsxs)(h.default,{style:[f.container,a&&f.activeContainer],children:[(0,G.jsxs)(h.default,{style:f.header,children:[(0,G.jsxs)(h.default,{style:f.tagInfo,children:[(0,G.jsx)(h.default,{style:[f.colorIndicator,{backgroundColor:r.colorCode}]}),(0,G.jsxs)(h.default,{style:f.tagDetails,children:[(0,G.jsx)(m.default,{style:f.tagName,children:r.name}),(0,G.jsxs)(m.default,{style:f.tagDate,children:["Created ",(t=r.createdAt,new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}))]})]})]}),(0,G.jsx)(h.default,{style:[f.statusBadge,a&&f.activeStatusBadge],children:(0,G.jsx)(m.default,{style:[f.statusText,a&&f.activeStatusText],children:a?"Active":"Inactive"})})]}),(0,G.jsxs)(h.default,{style:f.actions,children:[(0,G.jsx)(ne.default,{style:[f.actionButton,f.toggleButton,a&&f.activeToggleButton],onPress:b,disabled:p,children:p?(0,G.jsx)(te.default,{size:"small",color:a?u.colors.background:u.colors.primary}):(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(ae.default,{name:a?"eye-off":"eye",size:16,color:a?u.colors.background:u.colors.primary}),(0,G.jsx)(m.default,{style:[f.actionButtonText,a&&f.activeActionButtonText],children:a?"Deactivate":"Activate"})]})}),(0,G.jsxs)(ne.default,{style:[f.actionButton,f.editButton],onPress:function(){return l(r)},disabled:p,children:[(0,G.jsx)(ae.default,{name:"pencil",size:16,color:u.colors.textSecondary}),(0,G.jsx)(m.default,{style:f.secondaryActionButtonText,children:"Edit"})]}),(0,G.jsxs)(ne.default,{style:[f.actionButton,f.deleteButton,!a&&f.disabledButton],onPress:function(){(console.log("Delete button clicked for tag: "+r.name+", isActive: "+a),a)?"web"===k.default.OS?window.confirm('Are you sure you want to delete "'+r.name+'"? This action cannot be undone.\n\nNote: Only active tags can be deleted for security reasons.')&&x():ft.default.alert("Delete Secret Tag",'Are you sure you want to delete "'+r.name+'"? This action cannot be undone.\n\nNote: Only active tags can be deleted for security reasons.',[{text:"Cancel",style:"cancel"},{text:"Delete",style:"destructive",onPress:x}]):"web"===k.default.OS?window.alert("Secret tags can only be deleted when they are active. Please activate the tag first, then try deleting it."):ft.default.alert("Cannot Delete Tag","Secret tags can only be deleted when they are active. Please activate the tag first, then try deleting it.",[{text:"OK",style:"default"}])},disabled:p||!a,children:[(0,G.jsx)(ae.default,{name:"trash",size:16,color:a?u.colors.error:u.colors.textSecondary}),(0,G.jsx)(m.default,{style:[f.secondaryActionButtonText,{color:a?u.colors.error:u.colors.textSecondary}],children:"Delete"})]})]}),a&&(0,G.jsxs)(h.default,{style:f.activeInfo,children:[(0,G.jsx)(ae.default,{name:"information-circle",size:16,color:u.colors.primary}),(0,G.jsx)(m.default,{style:f.activeInfoText,children:"This tag is currently active. New entries will be encrypted with this tag. You can delete this tag while it's active."})]}),!a&&(0,G.jsxs)(h.default,{style:f.inactiveInfo,children:[(0,G.jsx)(ae.default,{name:"information-circle-outline",size:16,color:u.colors.textSecondary}),(0,G.jsx)(m.default,{style:f.inactiveInfoText,children:"Activate this tag to enable deletion and encryption features."})]})]}):null};function Un(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Vn(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Un(Object(r),!0).forEach((function(t){(0,b.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Un(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Kn=function(e){return v.default.create({container:{flex:1,backgroundColor:e.colors.background},tabContainer:{flexDirection:"row",backgroundColor:e.colors.card,borderBottomWidth:1,borderBottomColor:e.colors.border},tab:{flex:1,flexDirection:"row",alignItems:"center",justifyContent:"center",paddingVertical:e.spacing.md,paddingHorizontal:e.spacing.lg},activeTab:{borderBottomWidth:2,borderBottomColor:e.colors.primary},tabText:{marginLeft:e.spacing.sm,fontSize:e.typography.fontSizes.md,color:e.colors.textSecondary,fontFamily:e.typography.fontFamilies.regular},activeTabText:{color:e.colors.primary,fontFamily:e.typography.fontFamilies.semiBold},content:{flex:1,padding:e.spacing.md},loadingContainer:{flex:1,justifyContent:"center",alignItems:"center"},loadingText:{marginTop:e.spacing.md,fontSize:e.typography.fontSizes.md,color:e.colors.textSecondary,fontFamily:e.typography.fontFamilies.regular},regularTagCard:{flexDirection:"row",alignItems:"center",justifyContent:"space-between",backgroundColor:e.colors.card,padding:e.spacing.md,marginBottom:e.spacing.sm,borderRadius:e.borderRadius.lg,borderWidth:1,borderColor:e.colors.border},tagInfo:{flexDirection:"row",alignItems:"center",flex:1},tagColorIndicator:{width:16,height:16,borderRadius:8,marginRight:e.spacing.md},tagName:{fontSize:e.typography.fontSizes.md,color:e.colors.text,fontFamily:e.typography.fontFamilies.regular},tagDeleteButton:{padding:e.spacing.sm},emptyContainer:{flex:1,justifyContent:"center",alignItems:"center",paddingVertical:e.spacing.xxl},emptyText:{fontSize:e.typography.fontSizes.lg,color:e.colors.textSecondary,fontFamily:e.typography.fontFamilies.semiBold,marginTop:e.spacing.md},emptySubtext:{fontSize:e.typography.fontSizes.sm,color:e.colors.textSecondary,fontFamily:e.typography.fontFamilies.regular,textAlign:"center",marginTop:e.spacing.sm,paddingHorizontal:e.spacing.xl},fab:{position:"absolute",bottom:e.spacing.xl,right:e.spacing.xl,width:56,height:56,borderRadius:28,backgroundColor:e.colors.primary,justifyContent:"center",alignItems:"center",elevation:8,shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.25,shadowRadius:4},backButton:{position:"absolute",top:e.spacing.xl,left:e.spacing.md,width:40,height:40,borderRadius:20,backgroundColor:e.colors.card,justifyContent:"center",alignItems:"center",elevation:2,shadowColor:"#000",shadowOffset:{width:0,height:1},shadowOpacity:.2,shadowRadius:2}})};const qn=function(){if(!Pr())return null;var e=(0,oe.useNavigation)(),t=me().theme,r=Kn(t),a=(0,d.useState)([]),i=(0,o.default)(a,2),s=i[0],l=i[1],c=(0,d.useState)([]),u=(0,o.default)(c,2),f=u[0],g=u[1],y=(0,d.useState)(new Set),p=(0,o.default)(y,2),v=p[0],b=p[1],x=(0,d.useState)(!0),S=(0,o.default)(x,2),w=S[0],j=S[1],C=(0,d.useState)(!1),k=(0,o.default)(C,2),T=k[0],O=k[1],F=(0,d.useState)(!1),A=(0,o.default)(F,2),P=A[0],R=A[1],D=(0,d.useState)(!1),z=(0,o.default)(D,2),B=z[0],_=z[1],L=(0,d.useState)("regular"),N=(0,o.default)(L,2),M=N[0],H=N[1],W=(0,d.useCallback)((0,n.default)((function*(){try{var e;E.info("Loading secret tags from server");var t=(null==(e=(yield I.get("/api/v1/secret-tags")).data)?void 0:e.tags)||[];g(t.map((function(e){return Vn(Vn({},e),{},{id:e.tag_id,auth_method:"opaque",security_level:"standard",authentication_count:0})}))),E.info("Loaded "+t.length+" secret tags")}catch(r){E.error("Error loading secret tags:",r),g([])}})),[]),U=(0,d.useCallback)((0,n.default)((function*(){j(!0);try{var e=yield vn.getAllTags();l(e),yield W()}catch(t){E.error("Failed to load tags:",t),ft.default.alert("Error","Failed to load tags")}finally{j(!1)}})),[W]),V=(0,d.useCallback)((0,n.default)((function*(){O(!0),yield U(),O(!1)})),[U]),K=(0,d.useCallback)((function(){_(!0)}),[]),q=(0,d.useCallback)((function(e){l((function(t){return[].concat((0,dt.default)(t),[e])})),_(!1),E.info("Regular tag created:",e)}),[]),Q=(0,d.useCallback)((function(){_(!1)}),[]),J=(0,d.useCallback)(function(){var e=(0,n.default)((function*(e){try{if(!(yield fetch("/api/speech/secret-tag/activate",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({tag_id:e,action:"activate"})})).ok)throw new Error("Failed to activate secret tag");b((function(t){return new Set([].concat((0,dt.default)(t),[e]))})),E.info("Secret tag activated:",e)}catch(t){throw E.error("Failed to activate secret tag:",t),t}}));return function(t){return e.apply(this,arguments)}}(),[]),Y=(0,d.useCallback)(function(){var e=(0,n.default)((function*(e){try{if(!(yield fetch("/api/speech/secret-tag/activate",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({tag_id:e,action:"deactivate"})})).ok)throw new Error("Failed to deactivate secret tag");b((function(t){var r=new Set(t);return r.delete(e),r})),E.info("Secret tag deactivated:",e)}catch(t){throw E.error("Failed to deactivate secret tag:",t),t}}));return function(t){return e.apply(this,arguments)}}(),[]),Z=(0,d.useCallback)((function(e){ft.default.alert("Edit Tag",'Editing "'+e.tag_name+'" is not yet implemented.')}),[]),X=(0,d.useCallback)(function(){var e=(0,n.default)((function*(e){try{var t=yield I.delete("/api/v1/secret-tags/"+e);if(!(t.status>=200&&t.status<300))throw new Error("Failed to delete secret tag");g((function(t){return t.filter((function(t){return t.id!==e}))})),b((function(t){var r=new Set(t);return r.delete(e),r})),E.info("Secret tag deleted:",e)}catch(r){throw E.error("Failed to delete secret tag:",r),r}}));return function(t){return e.apply(this,arguments)}}(),[]),$=(0,d.useCallback)((function(e){R(!1),U()}),[U]),ee=(0,d.useCallback)((function(){"regular"===M?K():R(!0)}),[M,K]);(0,d.useEffect)((function(){U()}),[U]);var re=(0,d.useCallback)((function(e){var o=e.item;return(0,G.jsxs)(h.default,{style:r.regularTagCard,children:[(0,G.jsxs)(h.default,{style:r.tagInfo,children:[(0,G.jsx)(h.default,{style:[r.tagColorIndicator,{backgroundColor:o.color}]}),(0,G.jsx)(m.default,{style:r.tagName,children:o.name})]}),(0,G.jsx)(ne.default,{style:r.tagDeleteButton,onPress:function(){ft.default.alert("Delete Tag",'Are you sure you want to delete "'+o.name+'"?',[{text:"Cancel",style:"cancel"},{text:"Delete",style:"destructive",onPress:function(){var e=(0,n.default)((function*(){try{yield vn.deleteTag(String(o.id)),l((function(e){return e.filter((function(e){return e.id!==o.id}))}))}catch(e){ft.default.alert("Error","Failed to delete tag")}}));return function(){return e.apply(this,arguments)}}()}])},children:(0,G.jsx)(ae.default,{name:"trash",size:18,color:t.colors.error})})]})}),[r,t.colors.error]),ie=(0,d.useCallback)((function(e){var t=e.item;return(0,G.jsx)(Wn,{tag:t,isActive:v.has(t.id),onActivate:J,onDeactivate:Y,onEdit:Z,onDelete:X})}),[v,J,Y,Z,X]);return B?(0,G.jsxs)(h.default,{style:r.container,children:[(0,G.jsx)(Ot,{title:"Create Regular Tag"}),(0,G.jsx)(Ln,{onTagCreated:q,onCancel:Q,existingTagNames:s.map((function(e){return e.name}))})]}):P?(0,G.jsxs)(h.default,{style:r.container,children:[(0,G.jsx)(Ot,{title:"Create Secret Tag"}),(0,G.jsx)(Bn,{onTagCreated:$,onCancel:function(){return R(!1)},existingTagNames:f.map((function(e){return e.tag_name})),enableOpaqueAuth:!0})]}):(0,G.jsxs)(h.default,{style:r.container,children:[(0,G.jsx)(Ot,{title:"Tag Management"}),(0,G.jsxs)(h.default,{style:r.tabContainer,children:[(0,G.jsxs)(ne.default,{style:[r.tab,"regular"===M&&r.activeTab],onPress:function(){return H("regular")},children:[(0,G.jsx)(ae.default,{name:"pricetag",size:20,color:"regular"===M?t.colors.primary:t.colors.textSecondary}),(0,G.jsx)(m.default,{style:[r.tabText,"regular"===M&&r.activeTabText],children:"Regular Tags"})]}),(0,G.jsxs)(ne.default,{style:[r.tab,"secret"===M&&r.activeTab],onPress:function(){return H("secret")},children:[(0,G.jsx)(ae.default,{name:"shield",size:20,color:"secret"===M?t.colors.primary:t.colors.textSecondary}),(0,G.jsx)(m.default,{style:[r.tabText,"secret"===M&&r.activeTabText],children:"Secret Tags"})]})]}),(0,G.jsx)(h.default,{style:r.content,children:w?(0,G.jsxs)(h.default,{style:r.loadingContainer,children:[(0,G.jsx)(te.default,{size:"large",color:t.colors.primary}),(0,G.jsx)(m.default,{style:r.loadingText,children:"Loading tags..."})]}):(0,G.jsx)(G.Fragment,{children:"regular"===M?(0,G.jsx)(Vt.default,{data:s,renderItem:re,keyExtractor:function(e){return String(e.id)},refreshControl:(0,G.jsx)(ut.default,{refreshing:T,onRefresh:V,colors:[t.colors.primary]}),ListEmptyComponent:(0,G.jsxs)(h.default,{style:r.emptyContainer,children:[(0,G.jsx)(ae.default,{name:"pricetag-outline",size:64,color:t.colors.textSecondary}),(0,G.jsx)(m.default,{style:r.emptyText,children:"No regular tags yet"}),(0,G.jsx)(m.default,{style:r.emptySubtext,children:"Tap the + button to create your first tag"})]})}):(0,G.jsx)(Vt.default,{data:f,renderItem:ie,keyExtractor:function(e){return e.id},refreshControl:(0,G.jsx)(ut.default,{refreshing:T,onRefresh:V,colors:[t.colors.primary]}),ListEmptyComponent:(0,G.jsxs)(h.default,{style:r.emptyContainer,children:[(0,G.jsx)(ae.default,{name:"shield-outline",size:64,color:t.colors.textSecondary}),(0,G.jsx)(m.default,{style:r.emptyText,children:"No secret tags yet"}),(0,G.jsx)(m.default,{style:r.emptySubtext,children:"Tap the + button to create your first secret tag"})]})})})}),(0,G.jsx)(ne.default,{style:r.fab,onPress:ee,children:(0,G.jsx)(ae.default,{name:"add",size:24,color:t.colors.onPrimary})}),(0,G.jsx)(ne.default,{style:r.backButton,onPress:function(){return e.goBack()},children:(0,G.jsx)(ae.default,{name:"arrow-back",size:24,color:t.colors.text})})]})};var Qn=r(5324);function Gn(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Jn(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Gn(Object(r),!0).forEach((function(t){(0,b.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Gn(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Yn={SESSION_METADATA:"opaque_session_metadata",DEVICE_FINGERPRINT:"device_fingerprint",LAST_APP_STATE:"last_app_state"},Zn=(0,i.default)((function e(){(0,a.default)(this,e)}),[{key:"store",value:function(){var e=(0,n.default)((function*(e,t){try{var r=JSON.stringify(t);yield x.default.setItem(e,r)}catch(n){throw E.error("Failed to store session data for key "+e+":",n),n}}));return function(t,r){return e.apply(this,arguments)}}()},{key:"retrieve",value:function(){var e=(0,n.default)((function*(e){try{var t=yield x.default.getItem(e);return t?JSON.parse(t):null}catch(r){return E.error("Failed to retrieve session data for key "+e+":",r),null}}));return function(t){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e=(0,n.default)((function*(e){try{yield x.default.removeItem(e)}catch(t){throw E.error("Failed to remove session data for key "+e+":",t),t}}));return function(t){return e.apply(this,arguments)}}()},{key:"clear",value:function(){var e=(0,n.default)((function*(){try{var e=Object.values(Yn);yield x.default.multiRemove(e)}catch(t){throw E.error("Failed to clear session storage:",t),t}}));return function(){return e.apply(this,arguments)}}()}]),Xn=function(){function e(){(0,a.default)(this,e),this.deviceFingerprint=null,this.isAppInBackground=!1,this.lastBackgroundTime=null,this.storageAdapter=new Zn,this.setupAppStateHandling()}return(0,i.default)(e,[{key:"initialize",value:function(){var e=(0,n.default)((function*(){try{E.info("Initializing SessionStorageManager"),yield this.initializeDeviceFingerprint(),yield this.cleanupExpiredSessions(),E.info("SessionStorageManager initialized successfully")}catch(e){throw E.error("Failed to initialize SessionStorageManager:",e),e}}));return function(){return e.apply(this,arguments)}}()},{key:"storeSessionMetadata",value:function(){var e=(0,n.default)((function*(e){try{var t=e.map((function(e){return{tagId:e.tagId,tagName:e.tagName,createdAt:e.createdAt.toISOString(),expiresAt:e.expiresAt.toISOString(),deviceFingerprint:e.deviceFingerprint,isLocked:e.isLocked,lastAccessed:e.lastAccessed.toISOString(),accessCount:e.accessCount,origin:e.origin}}));yield this.storageAdapter.store(Yn.SESSION_METADATA,t),E.info("Stored metadata for "+t.length+" sessions")}catch(r){throw E.error("Failed to store session metadata:",r),r}}));return function(t){return e.apply(this,arguments)}}()},{key:"retrieveSessionMetadata",value:function(){var e=(0,n.default)((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{requireReauth:!0,maxAge:864e5,allowPartialRecovery:!0};try{var t=yield this.storageAdapter.retrieve(Yn.SESSION_METADATA);if(!t||0===t.length)return E.info("No session metadata found for recovery"),[];var r=new Date,n=e.maxAge||864e5,o=new Date(r.getTime()-n),a=[];for(var i of t)try{var s=new Date(i.createdAt),l=new Date(i.expiresAt),c=new Date(i.lastAccessed);if(s<o){E.debug("Session "+i.tagId+" too old, skipping recovery");continue}if(l<r){E.debug("Session "+i.tagId+" expired, skipping recovery");continue}if(this.deviceFingerprint&&i.deviceFingerprint!==this.deviceFingerprint.hash){E.warn("Session "+i.tagId+" device fingerprint mismatch, skipping recovery");continue}var d={tagId:i.tagId,tagName:i.tagName,createdAt:s,expiresAt:l,deviceFingerprint:i.deviceFingerprint,isLocked:i.isLocked,lastAccessed:c,accessCount:i.accessCount,origin:i.origin};a.push(d)}catch(u){if(E.warn("Failed to parse session metadata for "+i.tagId+":",u),!e.allowPartialRecovery)throw u}return E.info("Retrieved "+a.length+" valid sessions for recovery"),a}catch(u){if(E.error("Failed to retrieve session metadata:",u),e.allowPartialRecovery)return[];throw u}}));return function(){return e.apply(this,arguments)}}()},{key:"removeSessionMetadata",value:function(){var e=(0,n.default)((function*(e){try{var t=(yield this.retrieveSessionMetadata({requireReauth:!0,maxAge:864e5,allowPartialRecovery:!0})).filter((function(t){return t.tagId!==e}));yield this.storeSessionMetadata(t),E.info("Removed session metadata for tag "+e)}catch(r){throw E.error("Failed to remove session metadata for tag "+e+":",r),r}}));return function(t){return e.apply(this,arguments)}}()},{key:"clearSessionMetadata",value:function(){var e=(0,n.default)((function*(){try{yield this.storageAdapter.remove(Yn.SESSION_METADATA),E.info("Cleared all session metadata")}catch(e){throw E.error("Failed to clear session metadata:",e),e}}));return function(){return e.apply(this,arguments)}}()},{key:"getDeviceFingerprint",value:function(){return this.deviceFingerprint}},{key:"getBackgroundInfo",value:function(){return this.lastBackgroundTime?{wasBackgrounded:!0,duration:(new Date).getTime()-this.lastBackgroundTime.getTime()}:{wasBackgrounded:!1,duration:null}}},{key:"initializeDeviceFingerprint",value:function(){var e=(0,n.default)((function*(){try{var e=yield x.default.getItem(Yn.DEVICE_FINGERPRINT);if(e)return this.deviceFingerprint=JSON.parse(e),void E.debug("Retrieved existing device fingerprint");this.deviceFingerprint=yield this.generateDeviceFingerprint(),yield x.default.setItem(Yn.DEVICE_FINGERPRINT,JSON.stringify(this.deviceFingerprint)),E.info("Generated new device fingerprint")}catch(t){E.error("Failed to initialize device fingerprint:",t),this.deviceFingerprint=null}}));return function(){return e.apply(this,arguments)}}()},{key:"generateDeviceFingerprint",value:function(){var e=(0,n.default)((function*(){try{var e=k.default.OS,t=k.default.Version.toString(),r="unknown";"undefined"!==typeof window&&window.screen&&(r=window.screen.width+"x"+window.screen.height);var n,o=Intl.DateTimeFormat().resolvedOptions().timeZone,a=Intl.DateTimeFormat().resolvedOptions().locale;"web"===k.default.OS&&"undefined"!==typeof navigator&&(n=navigator.userAgent);var i={platform:e,version:t,screenDimensions:r,timezone:o,language:a,userAgent:n},s=yield this.hashFingerprint(i);return Jn(Jn({},i),{},{hash:s})}catch(l){throw E.error("Failed to generate device fingerprint:",l),l}}));return function(){return e.apply(this,arguments)}}()},{key:"hashFingerprint",value:function(){var e=(0,n.default)((function*(e){try{for(var t=JSON.stringify(e),r=0,n=0;n<t.length;n++){r=(r<<5)-r+t.charCodeAt(n),r|=0}return Math.abs(r).toString(16)}catch(o){return E.error("Failed to hash fingerprint:",o),"unknown"}}));return function(t){return e.apply(this,arguments)}}()},{key:"setupAppStateHandling",value:function(){var e=this;Qn.default.addEventListener("change",(function(t){if("background"===t)e.isAppInBackground=!0,e.lastBackgroundTime=new Date,E.debug("App moved to background");else if("active"===t&&e.isAppInBackground){e.isAppInBackground=!1;var r=e.lastBackgroundTime?(new Date).getTime()-e.lastBackgroundTime.getTime():0;E.debug("App returned to foreground after "+r+"ms")}}))}},{key:"cleanupExpiredSessions",value:function(){var e=(0,n.default)((function*(){try{var e=yield this.retrieveSessionMetadata({requireReauth:!0,maxAge:864e5,allowPartialRecovery:!0}),t=new Date,r=e.filter((function(e){return e.expiresAt>t}));r.length<e.length&&(yield this.storeSessionMetadata(r),E.info("Cleaned up "+(e.length-r.length)+" expired session metadata"))}catch(n){E.error("Failed to cleanup expired sessions:",n)}}));return function(){return e.apply(this,arguments)}}()},{key:"clearAll",value:function(){var e=(0,n.default)((function*(){try{yield this.storageAdapter.clear(),this.deviceFingerprint=null,this.lastBackgroundTime=null,E.info("Cleared all session storage data")}catch(e){throw E.error("Failed to clear session storage:",e),e}}));return function(){return e.apply(this,arguments)}}()}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}])}().getInstance(),$n=function(){function e(){(0,a.default)(this,e),this.isInitialized=!1,this.analyticsEvents=[],this.defaultSettings={enableDeviceBinding:!0,requirePhraseConfirmation:!0,sessionTimeout:15,maxSessionExtensions:5,enableAnalytics:!0,securityLevel:"standard"},this.opaqueClient=rr.getInstance()}return(0,i.default)(e,[{key:"initialize",value:function(){var e=(0,n.default)((function*(){if(this.isInitialized)E.debug("OpaqueTagManager already initialized");else try{E.info("Initializing OpaqueTagManager"),yield this.opaqueClient.initialize(),yield Xn.initialize(),yield this.loadAnalyticsEvents(),this.isInitialized=!0,E.info("OpaqueTagManager initialized successfully")}catch(e){throw E.error("Failed to initialize OpaqueTagManager:",e),e}}));return function(){return e.apply(this,arguments)}}()},{key:"createOpaqueTag",value:function(){var e=(0,n.default)((function*(e){try{this.isInitialized||(yield this.initialize()),E.info("Creating OPAQUE tag: "+e.tag_name);var t=Xn.getDeviceFingerprint();if(!t)throw new Error("Device fingerprinting required for OPAQUE tags");this.validateTagCreationRequest(e);var r=this.generateTagId();E.info("Generated OPAQUE tag ID: "+r);var n={id:r,tag_name:e.tag_name,color_code:e.color_code,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),user_id:1,opaque_server_public_key:"placeholder_key",auth_method:"opaque",device_fingerprint:t.hash,security_level:e.security_level,last_authentication:(new Date).toISOString(),authentication_count:0};yield this.storeOpaqueTag(n);var o={session_key:"placeholder_session_key",vault_key:"placeholder_vault_key",expires_at:new Date(Date.now()+9e5).toISOString()};return yield this.recordAnalyticsEvent({type:"creation",tagId:r,timestamp:new Date,deviceFingerprint:t.hash,securityLevel:e.security_level,metadata:{tagName:e.tag_name,authMethod:"manual"}}),E.info("OPAQUE tag created successfully: "+r),{success:!0,tag:n,session_data:o}}catch(a){return E.error("Failed to create OPAQUE tag:",a),yield this.recordAnalyticsEvent({type:"error",tagId:e.tag_name,timestamp:new Date,deviceFingerprint:e.device_fingerprint,securityLevel:e.security_level,metadata:{error:a instanceof Error?a.message:"Unknown error",operation:"creation"}}),{success:!1,tag:{},error:a instanceof Error?a.message:"Failed to create OPAQUE tag"}}}));return function(t){return e.apply(this,arguments)}}()},{key:"authenticateOpaqueTag",value:function(){var e=(0,n.default)((function*(e){try{E.info("Authenticating OPAQUE tag: "+e.tag_id);var t=Xn.getDeviceFingerprint();if(!t)throw new Error("Device fingerprinting required for OPAQUE authentication");var r=yield this.getOpaqueTag(e.tag_id);if(r&&r.device_fingerprint!==t.hash)throw new Error("Device fingerprint mismatch");E.info("Simulating OPAQUE authentication for tag: "+e.tag_id),r&&(r.last_authentication=(new Date).toISOString(),r.authentication_count=(r.authentication_count||0)+1,yield this.updateOpaqueTag(r));var n={session_key:"placeholder_session_key",vault_key:"placeholder_vault_key",expires_at:new Date(Date.now()+9e5).toISOString()};return yield this.recordAnalyticsEvent({type:"authentication",tagId:e.tag_id,timestamp:new Date,deviceFingerprint:t.hash,securityLevel:(null==r?void 0:r.security_level)||"standard",metadata:{authenticationCount:(null==r?void 0:r.authentication_count)||1}}),E.info("OPAQUE tag authenticated successfully: "+e.tag_id),{success:!0,session_data:n}}catch(o){return E.error("Failed to authenticate OPAQUE tag:",o),yield this.recordAnalyticsEvent({type:"error",tagId:e.tag_id,timestamp:new Date,deviceFingerprint:e.device_fingerprint,securityLevel:"standard",metadata:{error:o instanceof Error?o.message:"Unknown error",operation:"authentication"}}),{success:!1,error:o instanceof Error?o.message:"Authentication failed"}}}));return function(t){return e.apply(this,arguments)}}()},{key:"migrateToOpaque",value:function(){var e=(0,n.default)((function*(e,t){try{E.info("Migrating legacy tag to OPAQUE: "+e.id);var r=Xn.getDeviceFingerprint();if(!r)throw new Error("Device fingerprinting required for OPAQUE migration");var n={tag_name:e.tag_name,activation_phrase:t,color_code:e.color_code,device_fingerprint:r.hash,security_level:"standard"},o=yield this.createOpaqueTag(n);return o.success&&(E.info("Legacy tag migrated successfully: "+e.id+" -> "+o.tag.id),yield this.recordAnalyticsEvent({type:"migration",tagId:o.tag.id,timestamp:new Date,deviceFingerprint:r.hash,securityLevel:"standard",metadata:{legacyTagId:e.id,migrationDate:(new Date).toISOString()}})),o}catch(a){return E.error("Failed to migrate legacy tag to OPAQUE:",a),{success:!1,tag:{},error:a instanceof Error?a.message:"Migration failed"}}}));return function(t,r){return e.apply(this,arguments)}}()},{key:"getMigrationInfo",value:function(e){return{canMigrate:!0,legacyTag:e,estimatedTime:30,securityBenefits:["Zero-knowledge authentication","Device binding protection","Enhanced session management","Advanced security analytics","Protection against server breaches"],risks:["New activation phrase required","Cannot recover if phrase is forgotten","Requires device re-authentication"],requiresReAuth:!0}}},{key:"getOpaqueTags",value:function(){var e=(0,n.default)((function*(){try{return E.debug("Retrieving OPAQUE tags"),[]}catch(e){return E.error("Failed to retrieve OPAQUE tags:",e),[]}}));return function(){return e.apply(this,arguments)}}()},{key:"getAllTags",value:function(){var e=(0,n.default)((function*(){return this.getOpaqueTags()}));return function(){return e.apply(this,arguments)}}()},{key:"getActiveTags",value:function(){var e=(0,n.default)((function*(){try{E.debug("Retrieving active OPAQUE tags");var e=nr.getActiveSessions().map((function(e){var t;return{id:e.tagId,tag_name:e.tagName,color_code:"#FF3B30",created_at:e.createdAt.toISOString(),updated_at:e.lastAccessed.toISOString(),user_id:1,opaque_server_public_key:"",auth_method:"opaque",device_fingerprint:(null==(t=Xn.getDeviceFingerprint())?void 0:t.hash)||"",security_level:"standard",last_authentication:e.lastAccessed.toISOString(),authentication_count:0}}));return E.debug("Found "+e.length+" active OPAQUE tags"),e}catch(t){return E.error("Failed to retrieve active OPAQUE tags:",t),[]}}));return function(){return e.apply(this,arguments)}}()},{key:"activateTag",value:function(){var e=(0,n.default)((function*(e){try{throw E.info("Activating OPAQUE tag: "+e),new Error("Tag activation requires authentication with activation phrase")}catch(t){throw E.error("Failed to activate OPAQUE tag "+e+":",t),t}}));return function(t){return e.apply(this,arguments)}}()},{key:"deactivateTag",value:function(){var e=(0,n.default)((function*(e){try{E.info("Deactivating OPAQUE tag: "+e),nr.isSessionActive(e)&&E.info("OPAQUE tag "+e+" is active, cleanup will be handled by session timeout"),E.info("OPAQUE tag deactivated successfully: "+e)}catch(t){throw E.error("Failed to deactivate OPAQUE tag "+e+":",t),t}}));return function(t){return e.apply(this,arguments)}}()},{key:"deleteTag",value:function(){var e=(0,n.default)((function*(e){if(!(yield this.deleteOpaqueTag(e)))throw new Error("Failed to delete OPAQUE tag: "+e)}));return function(t){return e.apply(this,arguments)}}()},{key:"deleteOpaqueTag",value:function(){var e=(0,n.default)((function*(e){try{return E.info("Deleting OPAQUE tag: "+e),nr.isSessionActive(e)&&E.info("OPAQUE tag "+e+" has active session, it will be cleaned up"),yield this.removeOpaqueTag(e),E.info("OPAQUE tag deleted successfully: "+e),!0}catch(t){return E.error("Failed to delete OPAQUE tag:",t),!1}}));return function(t){return e.apply(this,arguments)}}()},{key:"getAnalyticsEvents",value:function(){return(0,dt.default)(this.analyticsEvents)}},{key:"validateTagCreationRequest",value:function(e){if(!e.tag_name||e.tag_name.trim().length<2)throw new Error("Tag name must be at least 2 characters");if(!e.activation_phrase||e.activation_phrase.trim().length<3)throw new Error("Activation phrase must be at least 3 characters");if(!e.color_code||!e.color_code.match(/^#[0-9A-Fa-f]{6}$/))throw new Error("Invalid color code");if(!e.device_fingerprint)throw new Error("Device fingerprint required")}},{key:"generateTagId",value:function(){return"opaque_tag_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}},{key:"createInitialSession",value:function(){var e=(0,n.default)((function*(e,t){return E.debug("Creating initial session for tag: "+e),{session_key:"placeholder_session_key",vault_key:"placeholder_vault_key",expires_at:new Date(Date.now()+9e5).toISOString()}}));return function(t,r){return e.apply(this,arguments)}}()},{key:"storeOpaqueTag",value:function(){var e=(0,n.default)((function*(e){E.debug("Storing OPAQUE tag: "+e.id)}));return function(t){return e.apply(this,arguments)}}()},{key:"getOpaqueTag",value:function(){var e=(0,n.default)((function*(e){return E.debug("Retrieving OPAQUE tag: "+e),null}));return function(t){return e.apply(this,arguments)}}()},{key:"updateOpaqueTag",value:function(){var e=(0,n.default)((function*(e){e.updated_at=(new Date).toISOString(),E.debug("Updating OPAQUE tag: "+e.id)}));return function(t){return e.apply(this,arguments)}}()},{key:"removeOpaqueTag",value:function(){var e=(0,n.default)((function*(e){E.debug("Removing OPAQUE tag: "+e)}));return function(t){return e.apply(this,arguments)}}()},{key:"recordAnalyticsEvent",value:function(){var e=(0,n.default)((function*(e){try{this.analyticsEvents.push(e),this.analyticsEvents.length>1e3&&(this.analyticsEvents=this.analyticsEvents.slice(-1e3)),E.debug("Recorded analytics event: "+e.type+" for tag "+e.tagId)}catch(t){E.error("Failed to record analytics event:",t)}}));return function(t){return e.apply(this,arguments)}}()},{key:"loadAnalyticsEvents",value:function(){var e=(0,n.default)((function*(){try{E.debug("Loading analytics events")}catch(e){E.error("Failed to load analytics events:",e)}}));return function(){return e.apply(this,arguments)}}()},{key:"cleanup",value:function(){var e=(0,n.default)((function*(){try{E.info("Cleaning up OpaqueTagManager"),this.analyticsEvents=[],this.isInitialized=!1,E.info("OpaqueTagManager cleanup complete")}catch(e){throw E.error("Error during OpaqueTagManager cleanup:",e),e}}));return function(){return e.apply(this,arguments)}}()}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}])}().getInstance(),eo=function(e){return v.default.create({container:{flex:1,backgroundColor:e.colors.background},content:{flex:1,padding:e.spacing.xl,justifyContent:"center"},warningContainer:{alignItems:"center",marginBottom:e.spacing.xl},warningTitle:{fontSize:e.typography.fontSizes.xxl,fontWeight:"bold",color:e.colors.error,textAlign:"center",marginBottom:e.spacing.md,fontFamily:e.typography.fontFamilies.bold},warningMessage:{fontSize:e.typography.fontSizes.lg,color:e.colors.text,textAlign:"center",marginBottom:e.spacing.md,fontFamily:e.typography.fontFamilies.regular},secretTagWarning:{fontSize:e.typography.fontSizes.md,color:e.colors.error,textAlign:"center",marginBottom:e.spacing.md,fontFamily:e.typography.fontFamilies.medium,backgroundColor:e.colors.errorLight||e.colors.error+"20",padding:e.spacing.md,borderRadius:e.borderRadius.md,borderWidth:1,borderColor:e.colors.error+"40"},warningSubtext:{fontSize:e.typography.fontSizes.sm,color:e.colors.textSecondary,textAlign:"center",marginBottom:e.spacing.xl,fontFamily:e.typography.fontFamilies.regular},confirmationContainer:{marginBottom:e.spacing.xl},confirmationLabel:{fontSize:e.typography.fontSizes.md,color:e.colors.text,marginBottom:e.spacing.sm,fontFamily:e.typography.fontFamilies.medium},confirmationInput:{borderWidth:1,borderColor:e.colors.border,borderRadius:e.borderRadius.md,padding:e.spacing.md,fontSize:e.typography.fontSizes.md,color:e.colors.text,backgroundColor:e.colors.inputBackground,fontFamily:e.typography.fontFamilies.regular},buttonContainer:{flexDirection:"row",justifyContent:"space-between",gap:e.spacing.md},button:{flex:1,paddingVertical:e.spacing.md,paddingHorizontal:e.spacing.lg,borderRadius:e.borderRadius.md,alignItems:"center",justifyContent:"center",minHeight:48},cancelButton:{backgroundColor:e.colors.card,borderWidth:1,borderColor:e.colors.border},cancelButtonText:{fontSize:e.typography.fontSizes.md,color:e.colors.text,fontFamily:e.typography.fontFamilies.medium},deleteButton:{backgroundColor:e.colors.error},deleteButtonText:{fontSize:e.typography.fontSizes.md,color:e.colors.onError||e.colors.white,fontFamily:e.typography.fontFamilies.semiBold},disabledButton:{opacity:.5},securityNotice:{flexDirection:"row",alignItems:"center",marginTop:e.spacing.xl,padding:e.spacing.md,backgroundColor:e.colors.card,borderRadius:e.borderRadius.md,borderWidth:1,borderColor:e.colors.border},securityNoticeText:{fontSize:e.typography.fontSizes.sm,color:e.colors.textSecondary,marginLeft:e.spacing.sm,flex:1,fontFamily:e.typography.fontFamilies.regular}})};const to=function(){var e=(0,oe.useNavigation)(),t=(0,oe.useRoute)(),r=me().theme,a=eo(r),i=t.params,s=i.tagId,l=i.tagName,c=i.tagType,u=(0,d.useState)(!1),f=(0,o.default)(u,2),g=f[0],y=f[1],p=(0,d.useState)(""),v=(0,o.default)(p,2),b=v[0],x=v[1],S=(0,d.useState)(!1),w=(0,o.default)(S,2),j=w[0],C=w[1],k="secret"===c,T=k,O=T?l:"DELETE";(0,d.useEffect)((function(){T&&C(!0)}),[T]);var F=function(){var t=(0,n.default)((function*(){if(T&&b!==O)ft.default.alert("Confirmation Required",'Please type "'+O+'" to confirm deletion.');else{y(!0);try{k?(yield $n.deleteTag(s),E.info("Secret tag deleted:",{tagId:s,tagName:l})):(yield vn.deleteTag(s),E.info("Regular tag deleted:",{tagId:s,tagName:l})),ft.default.alert("Tag Deleted",'"'+l+'" has been permanently deleted.',[{text:"OK",onPress:function(){return e.goBack()}}])}catch(t){E.error("Failed to delete tag:",t),ft.default.alert("Delete Failed",t instanceof Error?t.message:"Failed to delete tag. Please try again.")}finally{y(!1)}}}));return function(){return t.apply(this,arguments)}}(),I=!T||b===O;return(0,G.jsxs)(h.default,{style:a.container,children:[(0,G.jsx)(Ot,{title:"Delete Tag"}),(0,G.jsxs)(h.default,{style:a.content,children:[(0,G.jsx)(h.default,{style:a.warningContainer,children:(0,G.jsx)(ae.default,{name:k?"shield-outline":"warning-outline",size:64,color:r.colors.error})}),(0,G.jsx)(m.default,{style:a.warningTitle,children:k?"Delete Secret Tag?":"Delete Tag?"}),(0,G.jsxs)(m.default,{style:a.warningMessage,children:['Are you sure you want to permanently delete "',l,'"?']}),k&&(0,G.jsx)(m.default,{style:a.secretTagWarning,children:"This is a secret tag with encrypted data. Once deleted, all associated encrypted entries will become permanently inaccessible."}),(0,G.jsx)(m.default,{style:a.warningSubtext,children:"This action cannot be undone."}),j&&(0,G.jsxs)(h.default,{style:a.confirmationContainer,children:[(0,G.jsxs)(m.default,{style:a.confirmationLabel,children:['Type "',O,'" to confirm:']}),(0,G.jsx)(re.default,{style:a.confirmationInput,value:b,onChangeText:x,placeholder:O,placeholderTextColor:r.colors.textSecondary,autoCapitalize:"none",autoCorrect:!1})]}),(0,G.jsxs)(h.default,{style:a.buttonContainer,children:[(0,G.jsx)(ne.default,{style:[a.button,a.cancelButton],onPress:function(){e.goBack()},disabled:g,children:(0,G.jsx)(m.default,{style:a.cancelButtonText,children:"Cancel"})}),(0,G.jsx)(ne.default,{style:[a.button,a.deleteButton,(!I||g)&&a.disabledButton],onPress:F,disabled:!I||g,children:g?(0,G.jsx)(te.default,{size:"small",color:r.colors.onError}):(0,G.jsx)(m.default,{style:a.deleteButtonText,children:"Delete"})})]}),k&&(0,G.jsxs)(h.default,{style:a.securityNotice,children:[(0,G.jsx)(ae.default,{name:"information-circle",size:16,color:r.colors.textSecondary}),(0,G.jsx)(m.default,{style:a.securityNoticeText,children:"Secret tags can only be deleted when they are active for security reasons."})]})]})]})};var ro=function(e){return v.default.create({container:{marginBottom:e.spacing.md},title:{fontSize:16,fontWeight:"600",color:e.colors.text,marginBottom:e.spacing.sm,marginLeft:e.spacing.xs},scrollView:{flexGrow:0},scrollContent:{paddingHorizontal:e.spacing.xs},loadingContainer:{flexDirection:"row",alignItems:"center",padding:e.spacing.md},loadingText:{marginLeft:e.spacing.sm,color:e.colors.textSecondary,fontSize:14},tagButton:{backgroundColor:e.colors.surface,borderRadius:e.borderRadius.md,padding:e.spacing.sm,marginRight:e.spacing.sm,borderWidth:1,borderColor:e.colors.border,minWidth:120},tagButtonSelected:{backgroundColor:e.colors.primary+"20",borderColor:e.colors.primary},tagButtonDisabled:{opacity:.5},tagContent:{alignItems:"flex-start"},tagHeader:{flexDirection:"row",alignItems:"center",marginBottom:2},tagIcon:{marginRight:4},tagName:{fontSize:14,fontWeight:"500",color:e.colors.text,flex:1},tagNameSelected:{color:e.colors.primary},tagNameDisabled:{color:e.colors.textSecondary},tagMeta:{fontSize:12,color:e.colors.textSecondary},tagMetaSelected:{color:e.colors.primary+"CC"},tagMetaDisabled:{color:e.colors.textSecondary+"80"}})};const no=function(e){var t=e.onTagSelect,r=e.selectedTags,a=e.maxTags,i=void 0===a?10:a,s=me().theme,l=ro(s),c=(0,d.useState)([]),u=(0,o.default)(c,2),f=u[0],g=u[1],y=(0,d.useState)(!1),p=(0,o.default)(y,2),v=p[0],b=p[1];(0,d.useEffect)((function(){x()}),[]);var x=function(){var e=(0,n.default)((function*(){try{b(!0);var e=yield D.getRecentTags(5);g(e.data)}catch(t){E.error("Failed to load recent tags:",t)}finally{b(!1)}}));return function(){return e.apply(this,arguments)}}(),S=function(e){var t=new Date(e),r=new Date,n=Math.floor((r.getTime()-t.getTime())/864e5);return 0===n?"Today":1===n?"Yesterday":n<7?n+" days ago":t.toLocaleDateString()};return v?(0,G.jsxs)(h.default,{style:l.loadingContainer,children:[(0,G.jsx)(te.default,{size:"small",color:s.colors.primary}),(0,G.jsx)(m.default,{style:l.loadingText,children:"Loading recent tags..."})]}):0===f.length?null:(0,G.jsxs)(h.default,{style:l.container,children:[(0,G.jsx)(m.default,{style:l.title,children:"Recent Tags"}),(0,G.jsx)(be.default,{horizontal:!0,showsHorizontalScrollIndicator:!1,style:l.scrollView,contentContainerStyle:l.scrollContent,children:f.map((function(e){var n=r.some((function(t){return t.id===e.id||t.name.toLowerCase()===e.name.toLowerCase()})),o=r.length>=i&&!n;return(0,G.jsx)(ne.default,{style:[l.tagButton,n&&l.tagButtonSelected,o&&l.tagButtonDisabled],onPress:function(){return function(e){if(!r.some((function(t){return t.id===e.id||t.name.toLowerCase()===e.name.toLowerCase()}))&&!(r.length>=i)){var n={id:e.id,name:e.name,color:e.color,created_at:e.created_at,updated_at:e.updated_at};t(n)}}(e)},disabled:n||o,activeOpacity:.7,children:(0,G.jsxs)(h.default,{style:l.tagContent,children:[(0,G.jsxs)(h.default,{style:l.tagHeader,children:[(0,G.jsx)(ae.default,{name:"pricetag",size:16,color:e.color||s.colors.primary,style:l.tagIcon}),(0,G.jsx)(m.default,{style:[l.tagName,n&&l.tagNameSelected,o&&l.tagNameDisabled],children:e.name})]}),(0,G.jsxs)(m.default,{style:[l.tagMeta,n&&l.tagMetaSelected,o&&l.tagMetaDisabled],children:[S(e.last_used)," \u2022 ",e.usage_count," uses"]})]})},e.id)}))})]})};function oo(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ao(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?oo(Object(r),!0).forEach((function(t){(0,b.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):oo(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var io="web"!==k.default.OS,so=function(e){return v.default.create({container:{marginBottom:e.spacing.md},tagsScrollView:{maxHeight:80,marginBottom:e.spacing.md},tagsContainer:{flexDirection:"row",flexWrap:"nowrap",alignItems:"center",paddingVertical:e.spacing.xs},tag:{flexDirection:"row",alignItems:"center",backgroundColor:e.isDarkMode?e.colors.gray700:e.colors.primaryLight+"20",borderRadius:e.borderRadius.full,paddingHorizontal:e.spacing.md,paddingVertical:e.spacing.sm,marginRight:e.spacing.sm,borderWidth:1,borderColor:e.isDarkMode?e.colors.gray600:e.colors.primaryLight+"40",minHeight:36},tagText:{color:e.isDarkMode?e.colors.text:e.colors.primary,fontSize:e.typography.fontSizes.sm,marginRight:e.spacing.sm,fontFamily:e.typography.fontFamilies.medium,fontWeight:"500"},tagRemoveButton:{padding:e.spacing.xs,marginLeft:e.spacing.xs,borderRadius:e.borderRadius.full},inputContainer:{flexDirection:"row",alignItems:"center",marginBottom:e.spacing.sm},inputWrapper:{flex:1,flexDirection:"row",alignItems:"center",backgroundColor:e.colors.inputBackground,borderWidth:1,borderColor:e.colors.border,borderRadius:e.borderRadius.lg,paddingHorizontal:e.spacing.md,minHeight:48},inputIcon:{marginRight:e.spacing.sm},input:{flex:1,fontSize:e.typography.fontSizes.md,color:e.colors.text,fontFamily:e.typography.fontFamilies.regular,paddingVertical:e.spacing.md},addButton:ao({width:48,height:48,borderRadius:e.borderRadius.lg,backgroundColor:e.colors.primary,justifyContent:"center",alignItems:"center",marginLeft:e.spacing.md},e.shadows.sm),disabledButton:{backgroundColor:e.colors.disabled,opacity:.6},suggestionsContainer:ao({backgroundColor:e.colors.card,borderRadius:e.borderRadius.md,padding:e.spacing.md,marginBottom:e.spacing.sm,borderWidth:1,borderColor:e.colors.borderLight},e.shadows.sm),suggestionsTitle:{fontSize:e.typography.fontSizes.sm,color:e.colors.textSecondary,fontFamily:e.typography.fontFamilies.medium,marginBottom:e.spacing.sm},suggestionsContent:{flexDirection:"row"},suggestionChip:{backgroundColor:e.colors.accent+"20",borderRadius:e.borderRadius.full,paddingHorizontal:e.spacing.md,paddingVertical:e.spacing.sm,marginRight:e.spacing.sm,borderWidth:1,borderColor:e.colors.accent+"40"},suggestionText:{fontSize:e.typography.fontSizes.sm,color:e.colors.accent,fontFamily:e.typography.fontFamilies.medium},helpText:{fontSize:e.typography.fontSizes.xs,color:e.colors.textSecondary,fontFamily:e.typography.fontFamilies.regular,lineHeight:e.typography.lineHeights.normal*e.typography.fontSizes.xs},counterContainer:{alignItems:"flex-end",marginTop:e.spacing.xs},counterText:{fontSize:e.typography.fontSizes.xs,color:e.colors.textDisabled,fontFamily:e.typography.fontFamilies.regular}})};const lo=function(e){var t=e.tags,r=e.onChangeTags,n=e.maxTags,a=void 0===n?10:n,i=e.placeholder,s=void 0===i?"Add tag...":i,l=e.suggestions,c=void 0===l?[]:l,u=me().theme,f=so(u),g=(0,d.useState)(""),y=(0,o.default)(g,2),p=y[0],v=y[1],b=(0,d.useState)(!1),x=(0,o.default)(b,2),S=x[0],w=x[1],j=(0,d.useState)([]),C=(0,o.default)(j,2),k=C[0],T=C[1],E=(0,d.useRef)(null),O=(0,d.useRef)(new Ge.default.Value(0)).current,F=(0,d.useMemo)((function(){return c}),[c]);(0,d.useEffect)((function(){if(p.trim()){var e=t.map((function(e){return e.name.toLowerCase()})),r=F.filter((function(t){return t.toLowerCase().includes(p.toLowerCase())&&!e.includes(t.toLowerCase())}));T(r),w(r.length>0),r.length>0&&Ge.default.timing(O,{toValue:1,duration:200,useNativeDriver:io}).start()}else w(!1),Ge.default.timing(O,{toValue:0,duration:150,useNativeDriver:io}).start()}),[p,F]);var I=function(e){var n=(e||p).trim().toLowerCase();if(n){if(t.map((function(e){return e.name.toLowerCase()})).includes(n)||t.length>=a)return v(""),void w(!1);var o={name:n,id:null};r([].concat((0,dt.default)(t),[o])),v(""),w(!1),setTimeout((function(){var e;null==(e=E.current)||e.focus()}),100)}},A=function(e){var n=t.filter((function(t,r){return r!==e}));r(n)};return(0,G.jsxs)(h.default,{style:f.container,testID:"tag-input-container",children:[(0,G.jsx)(no,{onTagSelect:function(e){var n={name:e.name,id:e.id,color:e.color,created_at:e.created_at,updated_at:e.updated_at};r([].concat((0,dt.default)(t),[n]))},selectedTags:t,maxTags:a}),t.length>0&&(0,G.jsx)(be.default,{horizontal:!0,showsHorizontalScrollIndicator:!1,style:f.tagsScrollView,contentContainerStyle:f.tagsContainer,testID:"tags-scroll-view",keyboardShouldPersistTaps:"handled",children:t.map((function(e,t){return(0,G.jsxs)(Ge.default.View,{style:f.tag,testID:"tag-item-"+e.name+"-"+t,children:[(0,G.jsxs)(m.default,{style:f.tagText,testID:"tag-text-"+e.name,children:["#",e.name]}),(0,G.jsx)(ne.default,{style:f.tagRemoveButton,onPress:function(){return A(t)},testID:"tag-delete-button-"+e.name+"-"+t,accessibilityLabel:"Delete tag "+e.name,hitSlop:{top:8,bottom:8,left:8,right:8},children:(0,G.jsx)(ae.default,{name:"close-circle",size:18,color:u.colors.textSecondary})})]},e.id?"tag-"+e.id:"tag-"+e.name+"-"+t)}))}),(0,G.jsxs)(h.default,{style:f.inputContainer,testID:"tag-input-field-container",children:[(0,G.jsxs)(h.default,{style:f.inputWrapper,children:[(0,G.jsx)(ae.default,{name:"pricetag-outline",size:20,color:u.colors.textSecondary,style:f.inputIcon}),(0,G.jsx)(re.default,{ref:E,style:f.input,value:p,onChangeText:v,onSubmitEditing:function(){return I()},onKeyPress:function(e){var r=e.nativeEvent.key;"Enter"===r||" "===r||","===r?(null==e.preventDefault||e.preventDefault(),I()):"Backspace"===r&&!p&&t.length>0&&A(t.length-1)},onFocus:function(){p.trim()&&k.length>0&&w(!0)},onBlur:function(){setTimeout((function(){w(!1)}),150)},placeholder:t.length>=a?"Maximum "+a+" tags":s,placeholderTextColor:u.colors.textSecondary,returnKeyType:"done",testID:"tag-input-field",editable:t.length<a,autoCorrect:!1,autoCapitalize:"none"})]}),(0,G.jsx)(ne.default,{style:[f.addButton,(!p.trim()||t.length>=a)&&f.disabledButton],onPress:function(){return I()},disabled:!p.trim()||t.length>=a,testID:"add-tag-button",accessibilityLabel:"Add tag",hitSlop:{top:8,bottom:8,left:8,right:8},children:(0,G.jsx)(ae.default,{name:"add",size:22,color:u.colors.onPrimary})})]}),S&&(0,G.jsxs)(Ge.default.View,{style:[f.suggestionsContainer,{opacity:O}],testID:"suggestions-container",children:[(0,G.jsx)(m.default,{style:f.suggestionsTitle,children:"Suggestions:"}),(0,G.jsx)(be.default,{horizontal:!0,showsHorizontalScrollIndicator:!1,contentContainerStyle:f.suggestionsContent,children:k.map((function(e,t){return(0,G.jsx)(ne.default,{style:f.suggestionChip,onPress:function(){return function(e){I(e)}(e)},testID:"suggestion-"+e,children:(0,G.jsxs)(m.default,{style:f.suggestionText,children:["#",e]})},"suggestion-"+t)}))})]}),t.length<a&&0===p.length&&!S&&(0,G.jsx)(m.default,{style:f.helpText,testID:"tag-input-help-text",children:"Press Enter, space, or comma to add \u2022 Backspace to remove last tag"}),(0,G.jsx)(h.default,{style:f.counterContainer,children:(0,G.jsxs)(m.default,{style:f.counterText,children:[t.length,"/",a," tags"]})})]})};function co(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function uo(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?co(Object(r),!0).forEach((function(t){(0,b.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):co(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var fo=zt.default.get("window"),go=(fo.width,fo.height,function(e){return v.default.create({container:{flex:1,backgroundColor:e.colors.background},loadingContainer:{flex:1,backgroundColor:e.colors.background},loadingContent:{flex:1,justifyContent:"center",alignItems:"center",paddingHorizontal:e.spacing.xl},loadingText:{fontSize:e.typography.fontSizes.lg,color:e.colors.textSecondary,marginTop:e.spacing.lg,fontFamily:e.typography.fontFamilies.medium},errorContainer:{flex:1,backgroundColor:e.colors.background},errorContent:{flex:1,justifyContent:"center",alignItems:"center",paddingHorizontal:e.spacing.xl},errorTitle:{fontSize:e.typography.fontSizes.xxl,fontWeight:"bold",color:e.colors.text,marginTop:e.spacing.lg,marginBottom:e.spacing.md,fontFamily:e.typography.fontFamilies.bold},errorText:{fontSize:e.typography.fontSizes.lg,color:e.colors.textSecondary,textAlign:"center",marginBottom:e.spacing.xl,lineHeight:e.typography.lineHeights.normal*e.typography.fontSizes.lg,fontFamily:e.typography.fontFamilies.regular},errorButton:uo({flexDirection:"row",alignItems:"center",backgroundColor:e.colors.primary,paddingVertical:e.spacing.lg,paddingHorizontal:e.spacing.xl,borderRadius:e.borderRadius.xl},e.shadows.md),errorButtonText:{color:e.colors.white,fontSize:e.typography.fontSizes.lg,fontWeight:"600",marginLeft:e.spacing.sm,fontFamily:e.typography.fontFamilies.semiBold},floatingHeader:uo(uo({position:"absolute",top:"ios"===k.default.OS?44:0,left:0,right:0,height:60,backgroundColor:e.colors.card,flexDirection:"row",alignItems:"center",justifyContent:"space-between",paddingHorizontal:e.spacing.lg,zIndex:1e3},e.shadows.lg),{},{borderBottomWidth:1,borderBottomColor:e.colors.border}),headerBackButton:uo({width:40,height:40,borderRadius:20,backgroundColor:e.colors.background,justifyContent:"center",alignItems:"center"},e.shadows.sm),floatingHeaderTitle:{flex:1,fontSize:e.typography.fontSizes.lg,fontWeight:"600",color:e.colors.text,textAlign:"center",marginHorizontal:e.spacing.md,fontFamily:e.typography.fontFamilies.semiBold},headerSpacer:{width:40},mainHeader:{flexDirection:"row",alignItems:"center",justifyContent:"space-between",paddingHorizontal:e.spacing.lg,paddingTop:"ios"===k.default.OS?60:e.spacing.lg,paddingBottom:e.spacing.lg,backgroundColor:e.colors.background},backButton:uo({width:44,height:44,borderRadius:22,backgroundColor:e.colors.card,justifyContent:"center",alignItems:"center"},e.shadows.md),headerActions:{flexDirection:"row",gap:e.spacing.md},headerActionButton:uo({width:44,height:44,borderRadius:22,backgroundColor:e.colors.card,justifyContent:"center",alignItems:"center"},e.shadows.md),deleteHeaderButton:{backgroundColor:e.colors.errorLight+"20"},scrollView:{flex:1},content:{paddingHorizontal:e.spacing.lg,paddingBottom:120},heroSection:uo(uo({backgroundColor:e.colors.card,borderRadius:e.borderRadius.xxl,padding:e.spacing.xl,marginBottom:e.spacing.xl,flexDirection:"row",justifyContent:"space-between",alignItems:"flex-start"},e.shadows.lg),{},{borderWidth:e.isDarkMode?1:0,borderColor:e.colors.border}),dateContainer:{flex:1},dateText:{fontSize:e.typography.fontSizes.xxxl,fontWeight:"bold",color:e.colors.text,marginBottom:e.spacing.xs,fontFamily:e.typography.fontFamilies.bold,letterSpacing:-1},fullDateText:{fontSize:e.typography.fontSizes.lg,color:e.colors.textSecondary,marginBottom:e.spacing.sm,fontFamily:e.typography.fontFamilies.medium},timeContainer:{flexDirection:"row",alignItems:"center",backgroundColor:e.colors.primaryLight+"20",paddingHorizontal:e.spacing.md,paddingVertical:e.spacing.sm,borderRadius:e.borderRadius.full,alignSelf:"flex-start"},timeText:{fontSize:e.typography.fontSizes.sm,color:e.colors.primary,fontWeight:"600",marginLeft:e.spacing.xs,fontFamily:e.typography.fontFamilies.semiBold},audioIndicator:{alignItems:"center",backgroundColor:e.colors.accentLight+"20",paddingHorizontal:e.spacing.lg,paddingVertical:e.spacing.md,borderRadius:e.borderRadius.xl,borderWidth:2,borderColor:e.colors.accent+"30"},audioText:{fontSize:e.typography.fontSizes.xs,color:e.colors.accent,fontWeight:"600",marginTop:e.spacing.xs,fontFamily:e.typography.fontFamilies.semiBold},entrySection:uo(uo({backgroundColor:e.colors.card,borderRadius:e.borderRadius.xxl,padding:e.spacing.xl,marginBottom:e.spacing.xl},e.shadows.md),{},{borderWidth:e.isDarkMode?1:0,borderColor:e.colors.border}),entryHeader:{flexDirection:"row",alignItems:"center",marginBottom:e.spacing.lg,paddingBottom:e.spacing.md,borderBottomWidth:1,borderBottomColor:e.colors.border},entryHeaderText:{fontSize:e.typography.fontSizes.lg,fontWeight:"600",color:e.colors.text,marginLeft:e.spacing.sm,fontFamily:e.typography.fontFamilies.semiBold},entryTitle:{fontSize:e.typography.fontSizes.xxl,fontWeight:"bold",color:e.colors.text,lineHeight:e.typography.lineHeights.tight*e.typography.fontSizes.xxl,fontFamily:e.typography.fontFamilies.bold,letterSpacing:-.5,marginBottom:e.spacing.lg},entryText:{fontSize:e.typography.fontSizes.lg,lineHeight:e.typography.lineHeights.loose*e.typography.fontSizes.lg,color:e.colors.text,fontFamily:e.typography.fontFamilies.regular,letterSpacing:.3},tagsSection:uo(uo({backgroundColor:e.colors.card,borderRadius:e.borderRadius.xxl,padding:e.spacing.xl,marginBottom:e.spacing.xl},e.shadows.md),{},{borderWidth:e.isDarkMode?1:0,borderColor:e.colors.border}),tagsHeader:{flexDirection:"row",alignItems:"center",marginBottom:e.spacing.lg,paddingBottom:e.spacing.md,borderBottomWidth:1,borderBottomColor:e.colors.border},tagsHeaderText:{fontSize:e.typography.fontSizes.lg,fontWeight:"600",color:e.colors.text,marginLeft:e.spacing.sm,flex:1,fontFamily:e.typography.fontFamilies.semiBold},tagCount:{backgroundColor:e.colors.primary,width:24,height:24,borderRadius:12,justifyContent:"center",alignItems:"center"},tagCountText:{fontSize:e.typography.fontSizes.xs,color:e.colors.white,fontWeight:"bold",fontFamily:e.typography.fontFamilies.bold},tagsList:{flexDirection:"row",flexWrap:"wrap",gap:e.spacing.sm},tag:uo({backgroundColor:e.colors.primaryLight+"20",paddingHorizontal:e.spacing.lg,paddingVertical:e.spacing.md,borderRadius:e.borderRadius.full,borderWidth:2,borderColor:e.colors.primary+"30"},e.shadows.sm),tagText:{fontSize:e.typography.fontSizes.sm,color:e.colors.primary,fontWeight:"600",fontFamily:e.typography.fontFamilies.semiBold,letterSpacing:.5},statsSection:uo(uo({backgroundColor:e.colors.card,borderRadius:e.borderRadius.xxl,padding:e.spacing.xl,marginBottom:e.spacing.xl},e.shadows.md),{},{borderWidth:e.isDarkMode?1:0,borderColor:e.colors.border}),statsTitle:{fontSize:e.typography.fontSizes.lg,fontWeight:"600",color:e.colors.text,marginBottom:e.spacing.lg,fontFamily:e.typography.fontFamilies.semiBold},statsGrid:{flexDirection:"row",justifyContent:"space-around"},statItem:{alignItems:"center",flex:1},statValue:{fontSize:e.typography.fontSizes.xxl,fontWeight:"bold",color:e.colors.text,marginTop:e.spacing.sm,marginBottom:e.spacing.xs,fontFamily:e.typography.fontFamilies.bold},statLabel:{fontSize:e.typography.fontSizes.sm,color:e.colors.textSecondary,fontFamily:e.typography.fontFamilies.medium},floatingActions:{position:"absolute",bottom:"ios"===k.default.OS?100:85,right:e.spacing.lg,flexDirection:"column",gap:e.spacing.md},fab:uo(uo({width:56,height:56,borderRadius:28,justifyContent:"center",alignItems:"center"},e.shadows.xl),{},{elevation:8}),editFab:{backgroundColor:e.colors.primary},deleteFab:{backgroundColor:e.colors.error},editModeIndicator:{marginLeft:"auto",padding:e.spacing.sm,borderRadius:e.borderRadius.md,backgroundColor:e.colors.primaryLight+"20",fontSize:e.typography.fontSizes.sm,fontWeight:"600",color:e.colors.primary,fontFamily:e.typography.fontFamilies.semiBold},titleSection:{marginBottom:e.spacing.lg},titleInput:{fontSize:e.typography.fontSizes.lg,fontWeight:"600",color:e.colors.text,fontFamily:e.typography.fontFamilies.semiBold,backgroundColor:e.colors.inputBackground,borderRadius:e.borderRadius.lg,padding:e.spacing.lg,borderWidth:1,borderColor:e.colors.border,minHeight:50},contentSection:{marginBottom:e.spacing.lg},contentInput:{fontSize:e.typography.fontSizes.md,color:e.colors.text,fontFamily:e.typography.fontFamilies.regular,backgroundColor:e.colors.inputBackground,borderRadius:e.borderRadius.lg,padding:e.spacing.lg,borderWidth:1,borderColor:e.colors.border,minHeight:150,lineHeight:e.typography.lineHeights.loose*e.typography.fontSizes.md},recordSection:{alignItems:"center"},recordButton:uo({flexDirection:"row",alignItems:"center",backgroundColor:e.colors.primary,paddingVertical:e.spacing.lg,paddingHorizontal:e.spacing.xl,borderRadius:e.borderRadius.full},e.shadows.md),recordButtonText:{color:e.colors.white,fontSize:e.typography.fontSizes.lg,fontWeight:"600",marginLeft:e.spacing.sm,fontFamily:e.typography.fontFamilies.semiBold}})});const yo=function(){var e,t,r=(0,oe.useNavigation)(),a=(0,oe.useRoute)(),i=me().theme,s=go(i),l=a.params.entryId,c=(0,d.useState)(null),u=(0,o.default)(c,2),f=u[0],g=u[1],y=(0,d.useState)(!0),p=(0,o.default)(y,2),v=p[0],b=p[1],x=(0,d.useState)(!1),S=(0,o.default)(x,2),w=S[0],j=S[1],C=(0,d.useState)(""),k=(0,o.default)(C,2),T=k[0],E=k[1],O=(0,d.useState)(""),F=(0,o.default)(O,2),I=F[0],A=F[1],R=(0,d.useState)([]),D=(0,o.default)(R,2),z=D[0],B=D[1],_=(0,d.useState)(!1),L=(0,o.default)(_,2),N=L[0],M=L[1],H=(0,d.useRef)(new Ge.default.Value(0)).current,W=(0,d.useRef)(new Ge.default.Value(50)).current,U=(0,d.useRef)(new Ge.default.Value(.95)).current,V=(0,d.useRef)(new Ge.default.Value(0)).current,K=(0,d.useRef)(null),q=(0,d.useRef)(null),Q=V.interpolate({inputRange:[0,100],outputRange:[0,1],extrapolate:"clamp"}),J=V.interpolate({inputRange:[0,100],outputRange:[.8,1],extrapolate:"clamp"});(0,oe.useFocusEffect)((0,d.useCallback)((function(){return Y(),function(){H.setValue(0),W.setValue(50),U.setValue(.95)}}),[l])),(0,d.useEffect)((function(){f&&Ge.default.parallel([Ge.default.timing(H,{toValue:1,duration:600,useNativeDriver:!0}),Ge.default.spring(W,{toValue:0,tension:80,friction:8,useNativeDriver:!0}),Ge.default.spring(U,{toValue:1,tension:80,friction:8,useNativeDriver:!0})]).start()}),[f]);var Y=function(){var e=(0,n.default)((function*(){try{b(!0);var e=(yield P.getEntry(String(l))).data;g(e),E(e.title||""),A(e.content||""),B(e.tags||[])}catch(t){console.error("Error fetching entry details",t),ft.default.alert("Error","Failed to load journal entry details")}finally{b(!1)}}));return function(){return e.apply(this,arguments)}}(),Z=function(){ot.light(),j(!w)},X=function(){var e=(0,n.default)((function*(){if(f)try{M(!0),ot.light();var e={title:T,content:I,tags:z.map((function(e){return e.name}))};yield P.updateEntry(String(l),e);console.log("Entry saved successfully");var t=uo(uo({},f),{},{title:T,content:I,tags:z});g(t),j(!1),ot.success()}catch(r){console.error("Error saving entry:",r),ft.default.alert("Error","Failed to save changes: "+(r instanceof Error?r.message:"Unknown error")),ot.error()}finally{M(!1)}else console.error("No entry to save")}));return function(){return e.apply(this,arguments)}}(),$=function(){var e=(0,n.default)((function*(){ot.medium(),r.navigate("DeleteConfirmation",{entryId:l})}));return function(){return e.apply(this,arguments)}}(),ee=function(){ot.light(),w?ft.default.alert("Unsaved Changes","You have unsaved changes. What would you like to do?",[{text:"Discard",style:"destructive",onPress:function(){ot.light(),f&&(E(f.title||""),A(f.content||""),B(f.tags||[])),j(!1),r.goBack()}},{text:"Save & Exit",onPress:function(){var e=(0,n.default)((function*(){yield X(),r.goBack()}));return function(){return e.apply(this,arguments)}}()},{text:"Cancel",style:"cancel"}]):r.goBack()};if(v)return(0,G.jsx)(h.default,{style:s.loadingContainer,children:(0,G.jsxs)(h.default,{style:s.loadingContent,children:[(0,G.jsx)(te.default,{size:"large",color:i.colors.primary}),(0,G.jsx)(m.default,{style:s.loadingText,children:"Loading your entry..."})]})});if(!f)return(0,G.jsx)(h.default,{style:s.errorContainer,children:(0,G.jsxs)(h.default,{style:s.errorContent,children:[(0,G.jsx)(ae.default,{name:"document-text-outline",size:80,color:i.colors.textSecondary}),(0,G.jsx)(m.default,{style:s.errorTitle,children:"Entry Not Found"}),(0,G.jsx)(m.default,{style:s.errorText,children:"This journal entry might have been deleted or moved."}),(0,G.jsxs)(ne.default,{style:s.errorButton,onPress:ee,activeOpacity:.8,children:[(0,G.jsx)(ae.default,{name:"arrow-back",size:20,color:i.colors.white}),(0,G.jsx)(m.default,{style:s.errorButtonText,children:"Go Back"})]})]})});var ie=(0,St.default)(f.entry_date),se=(0,gt.default)(new Date,"yyyy-MM-dd")===(0,gt.default)(ie,"yyyy-MM-dd"),le=(0,gt.default)(new Date(Date.now()-864e5),"yyyy-MM-dd")===(0,gt.default)(ie,"yyyy-MM-dd");return(0,G.jsxs)(Te.default,{style:s.container,children:[(0,G.jsxs)(Ge.default.View,{style:[s.floatingHeader,{opacity:Q,transform:[{scale:J}]}],children:[(0,G.jsx)(ne.default,{style:s.headerBackButton,onPress:ee,activeOpacity:.7,children:(0,G.jsx)(ae.default,{name:"arrow-back",size:24,color:i.colors.text})}),(0,G.jsx)(m.default,{style:s.floatingHeaderTitle,numberOfLines:1,children:f.title||"Journal Entry"}),(0,G.jsx)(h.default,{style:s.headerSpacer})]}),(0,G.jsxs)(h.default,{style:s.mainHeader,children:[(0,G.jsx)(ne.default,{style:s.backButton,onPress:ee,activeOpacity:.7,children:(0,G.jsx)(ae.default,{name:"arrow-back",size:28,color:i.colors.text})}),(0,G.jsxs)(h.default,{style:s.headerActions,children:[w?(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(ne.default,{style:[s.headerActionButton,N&&{opacity:.5}],onPress:function(){var e,t;null==(e=K.current)||e.blur(),null==(t=q.current)||t.blur(),X()},activeOpacity:.7,disabled:N,children:N?(0,G.jsx)(te.default,{size:"small",color:i.colors.primary}):(0,G.jsx)(ae.default,{name:"checkmark",size:24,color:i.colors.success})}),(0,G.jsx)(ne.default,{style:s.headerActionButton,onPress:Z,activeOpacity:.7,children:(0,G.jsx)(ae.default,{name:"eye-outline",size:24,color:i.colors.primary})})]}):(0,G.jsx)(ne.default,{style:s.headerActionButton,onPress:Z,activeOpacity:.7,children:(0,G.jsx)(ae.default,{name:"create-outline",size:24,color:i.colors.primary})}),(0,G.jsx)(ne.default,{style:[s.headerActionButton,s.deleteHeaderButton],onPress:$,activeOpacity:.7,children:(0,G.jsx)(ae.default,{name:"trash-outline",size:24,color:i.colors.error})})]})]}),(0,G.jsx)(Ge.default.ScrollView,{style:s.scrollView,showsVerticalScrollIndicator:!1,scrollEventThrottle:16,onScroll:Ge.default.event([{nativeEvent:{contentOffset:{y:V}}}],{useNativeDriver:!1}),children:(0,G.jsxs)(Ge.default.View,{style:[s.content,{opacity:H,transform:[{translateY:W},{scale:U}]}],children:[(0,G.jsxs)(h.default,{style:s.heroSection,children:[(0,G.jsxs)(h.default,{style:s.dateContainer,children:[(0,G.jsx)(m.default,{style:s.dateText,children:se?"Today":le?"Yesterday":(0,gt.default)(ie,"EEEE, MMMM d")}),(0,G.jsx)(m.default,{style:s.fullDateText,children:(0,gt.default)(ie,"MMMM d, yyyy")}),(0,G.jsxs)(h.default,{style:s.timeContainer,children:[(0,G.jsx)(ae.default,{name:"time-outline",size:16,color:i.colors.textSecondary}),(0,G.jsx)(m.default,{style:s.timeText,children:(0,gt.default)(ie,"h:mm a")})]})]}),f.audio_url&&(0,G.jsxs)(h.default,{style:s.audioIndicator,children:[(0,G.jsx)(ae.default,{name:"musical-notes",size:24,color:i.colors.accent}),(0,G.jsx)(m.default,{style:s.audioText,children:"Audio"})]})]}),(0,G.jsxs)(h.default,{style:s.entrySection,children:[(0,G.jsxs)(h.default,{style:s.entryHeader,children:[(0,G.jsx)(ae.default,{name:"document-text",size:20,color:i.colors.primary}),(0,G.jsx)(m.default,{style:s.entryHeaderText,children:"Your Entry"}),w&&(0,G.jsx)(m.default,{style:s.editModeIndicator,children:"Editing"})]}),(0,G.jsx)(h.default,{style:s.titleSection,children:w?(0,G.jsx)(re.default,{ref:K,style:s.titleInput,value:T,onChangeText:E,placeholder:"Enter title...",multiline:!1,maxLength:100}):(0,G.jsx)(m.default,{style:s.entryTitle,children:f.title||"Untitled Entry"})}),(0,G.jsx)(h.default,{style:s.contentSection,children:w?(0,G.jsx)(re.default,{ref:q,style:s.contentInput,value:I,onChangeText:A,placeholder:"What's on your mind?",multiline:!0,numberOfLines:8,textAlignVertical:"top"}):(0,G.jsx)(m.default,{style:s.entryText,children:f.content})}),w&&(0,G.jsx)(h.default,{style:s.recordSection,children:(0,G.jsxs)(ne.default,{style:s.recordButton,onPress:function(){ot.light(),r.navigate("Record",{journalId:l})},activeOpacity:.8,children:[(0,G.jsx)(ae.default,{name:"mic",size:20,color:i.colors.white}),(0,G.jsx)(m.default,{style:s.recordButtonText,children:"Record"})]})})]}),(0,G.jsxs)(h.default,{style:s.tagsSection,children:[(0,G.jsxs)(h.default,{style:s.tagsHeader,children:[(0,G.jsx)(ae.default,{name:"pricetags",size:20,color:i.colors.primary}),(0,G.jsx)(m.default,{style:s.tagsHeaderText,children:"Tags"}),!w&&(0,G.jsx)(h.default,{style:s.tagCount,children:(0,G.jsx)(m.default,{style:s.tagCountText,children:(null==(e=f.tags)?void 0:e.length)||0})})]}),w?(0,G.jsx)(lo,{tags:z,onChangeTags:B,placeholder:"Add tags...",maxTags:10}):f.tags&&f.tags.length>0&&(0,G.jsx)(h.default,{style:s.tagsList,children:f.tags.map((function(e,t){return(0,G.jsx)(Ge.default.View,{style:[s.tag,{transform:[{scale:H.interpolate({inputRange:[0,1],outputRange:[.8,1]})}]}],children:(0,G.jsx)(m.default,{style:s.tagText,children:e.name})},e.id?String(e.id):f.id+"-tag-"+t)}))})]}),(0,G.jsxs)(h.default,{style:s.statsSection,children:[(0,G.jsx)(m.default,{style:s.statsTitle,children:"Entry Stats"}),(0,G.jsxs)(h.default,{style:s.statsGrid,children:[(0,G.jsxs)(h.default,{style:s.statItem,children:[(0,G.jsx)(ae.default,{name:"text-outline",size:24,color:i.colors.primary}),(0,G.jsx)(m.default,{style:s.statValue,children:w?I.length:f.content.length}),(0,G.jsx)(m.default,{style:s.statLabel,children:"Characters"})]}),(0,G.jsxs)(h.default,{style:s.statItem,children:[(0,G.jsx)(ae.default,{name:"library-outline",size:24,color:i.colors.accent}),(0,G.jsx)(m.default,{style:s.statValue,children:w?I.split(" ").filter((function(e){return e.length>0})).length:f.content.split(" ").length}),(0,G.jsx)(m.default,{style:s.statLabel,children:"Words"})]}),(0,G.jsxs)(h.default,{style:s.statItem,children:[(0,G.jsx)(ae.default,{name:"pricetags-outline",size:24,color:i.colors.secondary}),(0,G.jsx)(m.default,{style:s.statValue,children:w?z.length:(null==(t=f.tags)?void 0:t.length)||0}),(0,G.jsx)(m.default,{style:s.statLabel,children:"Tags"})]})]})]})]})}),(0,G.jsxs)(Ge.default.View,{style:[s.floatingActions,{opacity:H,transform:[{translateY:W}]}],children:[(0,G.jsx)(ne.default,{style:[s.fab,s.editFab],onPress:Z,activeOpacity:.8,children:(0,G.jsx)(ae.default,{name:"create",size:24,color:i.colors.white})}),(0,G.jsx)(ne.default,{style:[s.fab,s.deleteFab],onPress:$,activeOpacity:.8,children:(0,G.jsx)(ae.default,{name:"trash",size:24,color:i.colors.white})})]})]})};var po=r(5165),ho=r(1437),mo=function(e){return v.default.create({container:{flex:1,backgroundColor:e.colors.background},loadingContainer:{flex:1,justifyContent:"center",alignItems:"center",backgroundColor:e.colors.background},scrollContainer:{flex:1,paddingBottom:e.spacing.md},scrollContent:{padding:e.spacing.lg},formGroup:{marginBottom:e.spacing.lg},label:{fontSize:e.typography.fontSizes.md,fontWeight:"bold",color:e.colors.text,marginBottom:e.spacing.sm,fontFamily:e.typography.fontFamilies.bold},input:{backgroundColor:e.isDarkMode?e.colors.gray800:e.colors.white,borderWidth:1,borderColor:e.colors.border,borderRadius:5,paddingHorizontal:e.spacing.md,paddingVertical:e.spacing.sm,fontSize:e.typography.fontSizes.md,color:e.colors.text,fontFamily:e.typography.fontFamilies.regular},textArea:{backgroundColor:e.isDarkMode?e.colors.gray800:e.colors.white,borderWidth:1,borderColor:e.colors.border,borderRadius:5,padding:e.spacing.md,fontSize:e.typography.fontSizes.md,color:e.colors.text,minHeight:100,fontFamily:e.typography.fontFamilies.regular},dateDisplayContainer:{backgroundColor:e.isDarkMode?e.colors.gray700:e.colors.gray100,padding:e.spacing.md,borderRadius:5,marginBottom:e.spacing.md,alignItems:"center"},dateText:{fontSize:e.typography.fontSizes.lg,fontWeight:"bold",color:e.colors.text,fontFamily:e.typography.fontFamilies.bold},timeText:{fontSize:e.typography.fontSizes.md,color:e.colors.textSecondary,marginTop:e.spacing.xs,fontFamily:e.typography.fontFamilies.regular},dateControlsContainer:{flexDirection:"row",justifyContent:"space-around",marginBottom:e.spacing.md},dateControls:{flexDirection:"row",alignItems:"center",backgroundColor:e.isDarkMode?e.colors.gray700:e.colors.gray100,padding:e.spacing.sm,borderRadius:5},controlButton:{padding:e.spacing.sm},controlLabel:{fontSize:e.typography.fontSizes.sm,color:e.colors.text,marginHorizontal:e.spacing.sm,fontFamily:e.typography.fontFamilies.semiBold},switchContainer:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",paddingVertical:e.spacing.md,borderTopWidth:1,borderBottomWidth:1,borderColor:e.colors.border,marginTop:e.spacing.md,marginBottom:e.spacing.lg,paddingHorizontal:e.spacing.xs},buttonContainer:{flexDirection:"row",justifyContent:"space-around",paddingVertical:e.spacing.md,paddingHorizontal:e.spacing.lg,borderTopWidth:1,borderTopColor:e.colors.border,backgroundColor:e.colors.background},button:{borderRadius:5,paddingVertical:e.spacing.md,paddingHorizontal:e.spacing.xl,alignItems:"center",justifyContent:"center",minWidth:120},saveButton:{backgroundColor:e.colors.primary},saveButtonText:{color:e.isDarkMode?e.colors.background:e.colors.white,fontSize:e.typography.fontSizes.md,fontWeight:"bold",fontFamily:e.typography.fontFamilies.bold},cancelButton:{backgroundColor:e.colors.gray200},cancelButtonText:{color:e.isDarkMode?e.colors.text:e.colors.textSecondary,fontSize:e.typography.fontSizes.md,fontFamily:e.typography.fontFamilies.semiBold},disabledButton:{backgroundColor:e.colors.disabled}})};const vo=function(){var e=(0,oe.useNavigation)(),t=(0,oe.useRoute)(),r=me().theme,a=mo(r),i=t.params.reminderId,s=(0,d.useState)(""),l=(0,o.default)(s,2),c=l[0],u=l[1],f=(0,d.useState)(""),g=(0,o.default)(f,2),y=g[0],p=g[1],v=(0,d.useState)(new Date),b=(0,o.default)(v,2),x=b[0],S=b[1],w=(0,d.useState)(!0),j=(0,o.default)(w,2),C=j[0],k=j[1],T=(0,d.useState)(!1),E=(0,o.default)(T,2),O=E[0],F=E[1],I=(0,d.useState)(!1),A=(0,o.default)(I,2),P=A[0],R=A[1];(0,d.useEffect)((function(){i&&D()}),[i]);var D=function(){var e=(0,n.default)((function*(){try{R(!0);var e=(yield z.getReminder(i)).data;u(e.title||""),p(e.note||""),S(new Date(e.reminder_time)),k(e.is_active)}catch(t){console.error("Error fetching reminder data",t),ft.default.alert("Error","Failed to load reminder data")}finally{R(!1)}}));return function(){return e.apply(this,arguments)}}(),B=function(){var t=(0,n.default)((function*(){if(c.trim())try{F(!0);var t={title:c,note:y,reminder_time:x.toISOString(),is_active:C};i?(yield z.updateReminder(i,t),ft.default.alert("Success","Reminder updated successfully")):(yield z.createReminder(t),ft.default.alert("Success","Reminder created successfully")),e.goBack()}catch(r){console.error("Error saving reminder",r),ft.default.alert("Error","Failed to save reminder")}finally{F(!1)}else ft.default.alert("Error","Please enter a title for your reminder")}));return function(){return t.apply(this,arguments)}}();return P?(0,G.jsx)(h.default,{style:a.loadingContainer,children:(0,G.jsx)(te.default,{size:"large",color:r.colors.primary})}):(0,G.jsxs)(h.default,{style:a.container,children:[(0,G.jsxs)(Ce,{style:a.scrollContainer,contentContainerStyle:a.scrollContent,keyboardShouldPersistTaps:"handled",children:[(0,G.jsxs)(h.default,{style:a.formGroup,children:[(0,G.jsx)(m.default,{style:a.label,children:"Title"}),(0,G.jsx)(re.default,{style:a.input,placeholder:"Reminder title",value:c,onChangeText:u,placeholderTextColor:r.colors.textSecondary})]}),(0,G.jsxs)(h.default,{style:a.formGroup,children:[(0,G.jsx)(m.default,{style:a.label,children:"Note"}),(0,G.jsx)(re.default,{style:a.textArea,multiline:!0,numberOfLines:4,placeholder:"Add a note (optional)",value:y,onChangeText:p,textAlignVertical:"top",placeholderTextColor:r.colors.textSecondary})]}),(0,G.jsxs)(h.default,{style:a.formGroup,children:[(0,G.jsx)(m.default,{style:a.label,children:"Reminder Date & Time"}),(0,G.jsxs)(h.default,{style:a.dateDisplayContainer,children:[(0,G.jsx)(m.default,{style:a.dateText,children:(0,gt.default)(x,"EEEE, MMMM d, yyyy")}),(0,G.jsx)(m.default,{style:a.timeText,children:(0,gt.default)(x,"h:mm a")})]}),(0,G.jsxs)(h.default,{style:a.dateControlsContainer,children:[(0,G.jsxs)(h.default,{style:a.dateControls,children:[(0,G.jsx)(ne.default,{style:a.controlButton,onPress:function(){S((function(e){return(0,po.default)(e,-1)}))},children:(0,G.jsx)(ae.default,{name:"remove",size:r.typography.fontSizes.xl,color:r.colors.textSecondary})}),(0,G.jsx)(m.default,{style:a.controlLabel,children:"Date"}),(0,G.jsx)(ne.default,{style:a.controlButton,onPress:function(){S((function(e){return(0,po.default)(e,1)}))},children:(0,G.jsx)(ae.default,{name:"add",size:r.typography.fontSizes.xl,color:r.colors.textSecondary})})]}),(0,G.jsxs)(h.default,{style:a.dateControls,children:[(0,G.jsx)(ne.default,{style:a.controlButton,onPress:function(){S((function(e){return(0,ho.default)(e,-1)}))},children:(0,G.jsx)(ae.default,{name:"remove",size:r.typography.fontSizes.xl,color:r.colors.textSecondary})}),(0,G.jsx)(m.default,{style:a.controlLabel,children:"Time"}),(0,G.jsx)(ne.default,{style:a.controlButton,onPress:function(){S((function(e){return(0,ho.default)(e,1)}))},children:(0,G.jsx)(ae.default,{name:"add",size:r.typography.fontSizes.xl,color:r.colors.textSecondary})})]})]})]}),(0,G.jsxs)(h.default,{style:a.switchContainer,children:[(0,G.jsx)(m.default,{style:a.label,children:"Enable Reminder"}),(0,G.jsx)(fr.default,{trackColor:{false:r.colors.gray300,true:r.colors.primary},thumbColor:C?r.isDarkMode?r.colors.background:r.colors.white:r.colors.gray100,ios_backgroundColor:r.colors.gray300,onValueChange:k,value:C})]})]}),(0,G.jsxs)(h.default,{style:a.buttonContainer,children:[(0,G.jsx)(ne.default,{style:[a.button,a.cancelButton],onPress:function(){return e.goBack()},disabled:O,children:(0,G.jsx)(m.default,{style:a.cancelButtonText,children:"Cancel"})}),(0,G.jsx)(ne.default,{style:[a.button,a.saveButton,O&&a.disabledButton],onPress:B,disabled:O,children:O?(0,G.jsx)(te.default,{size:"small",color:r.isDarkMode?r.colors.background:r.colors.white}):(0,G.jsx)(m.default,{style:a.saveButtonText,children:"Save"})})]})]})};var bo=function(e){return v.default.create({container:{flex:1,backgroundColor:e.colors.background},content:{flex:1,justifyContent:"center",alignItems:"center",paddingHorizontal:e.spacing.xl},iconContainer:{width:3*e.spacing.xxl,height:3*e.spacing.xxl,borderRadius:1.5*e.spacing.xxl,backgroundColor:e.colors.error+"20",justifyContent:"center",alignItems:"center",marginBottom:e.spacing.xl},title:{fontSize:e.typography.fontSizes.xxl,fontWeight:"bold",color:e.colors.text,marginBottom:e.spacing.md,textAlign:"center",fontFamily:e.typography.fontFamilies.bold},message:{fontSize:e.typography.fontSizes.md,color:e.colors.textSecondary,textAlign:"center",lineHeight:e.typography.lineHeights.normal*e.typography.fontSizes.md,marginBottom:e.spacing.xxl,fontFamily:e.typography.fontFamilies.regular},buttonContainer:{flexDirection:"row",width:"100%",gap:e.spacing.md},button:{flex:1,paddingVertical:e.spacing.lg,borderRadius:12,alignItems:"center",justifyContent:"center"},cancelButton:{backgroundColor:e.colors.card,borderWidth:1,borderColor:e.colors.border},deleteButton:{backgroundColor:e.colors.error},cancelButtonText:{fontSize:e.typography.fontSizes.md,color:e.colors.text,fontWeight:"600",fontFamily:e.typography.fontFamilies.semiBold},deleteButtonText:{fontSize:e.typography.fontSizes.md,color:e.colors.white,fontWeight:"600",fontFamily:e.typography.fontFamilies.semiBold}})};const xo=function(){var e=(0,oe.useNavigation)(),t=(0,oe.useRoute)(),r=me().theme,a=bo(r),i=t.params.entryId,s=(0,d.useState)(!1),l=(0,o.default)(s,2),c=l[0],u=l[1],f=function(){var t=(0,n.default)((function*(){if(!c)try{u(!0),ot.medium(),console.log("[DeleteConfirmation] Deleting entry with ID: "+i),yield P.deleteEntry(String(i)),console.log("[DeleteConfirmation] Delete successful"),ot.success(),e.navigate("MainTabs",{screen:"Journal",params:{screen:"JournalList"}})}catch(t){console.error("[DeleteConfirmation] Error deleting entry:",t),t&&"object"===typeof t&&"status"in t&&404===t.status?(console.log("[DeleteConfirmation] Entry already deleted, treating as success"),ot.success(),e.navigate("MainTabs",{screen:"Journal",params:{screen:"JournalList"}})):(ot.error(),e.goBack())}finally{u(!1)}}));return function(){return t.apply(this,arguments)}}();return(0,G.jsx)(Te.default,{style:a.container,children:(0,G.jsxs)(h.default,{style:a.content,children:[(0,G.jsx)(h.default,{style:a.iconContainer,children:(0,G.jsx)(ae.default,{name:"trash-outline",size:2*r.spacing.xxl,color:r.colors.error})}),(0,G.jsx)(m.default,{style:a.title,children:"Delete Journal Entry"}),(0,G.jsx)(m.default,{style:a.message,children:"Are you sure you want to delete this journal entry? This action cannot be undone."}),(0,G.jsxs)(h.default,{style:a.buttonContainer,children:[(0,G.jsx)(ne.default,{style:[a.button,a.cancelButton,c&&{opacity:.5}],onPress:function(){ot.light(),e.goBack()},disabled:c,children:(0,G.jsx)(m.default,{style:a.cancelButtonText,children:"Cancel"})}),(0,G.jsx)(ne.default,{style:[a.button,a.deleteButton,c&&{opacity:.7}],onPress:f,disabled:c,children:c?(0,G.jsx)(te.default,{size:"small",color:r.colors.white}):(0,G.jsx)(m.default,{style:a.deleteButtonText,children:"Delete"})})]})]})})};var So=(0,ee.default)();const wo=function(){return(0,G.jsxs)(So.Navigator,{screenOptions:{headerShown:!1},children:[(0,G.jsx)(So.Screen,{name:"MainTabs",component:Or,options:{headerShown:!1}}),(0,G.jsx)(So.Screen,{name:"Record",component:In,options:{presentation:"modal",headerShown:!1}}),Pr()&&(0,G.jsx)(So.Screen,{name:"TagManagement",component:qn,options:{presentation:"modal",headerShown:!1}}),(0,G.jsx)(So.Screen,{name:"TagDeleteConfirmation",component:to,options:{presentation:"modal",headerShown:!1}}),(0,G.jsx)(So.Screen,{name:"JournalEntryDetail",component:yo,options:{headerShown:!1}}),(0,G.jsx)(So.Screen,{name:"ReminderForm",component:vo,options:{headerShown:!0,title:"Reminder",headerStyle:{backgroundColor:"#f8f9fa"},headerTintColor:"#333"}}),(0,G.jsx)(So.Screen,{name:"DeleteConfirmation",component:xo,options:{presentation:"modal",headerShown:!0,title:"Delete Entry",headerStyle:{backgroundColor:"#f8f9fa"},headerTintColor:"#333"}})]})};var jo=(0,ee.default)(),Co=v.default.create({container:{flex:1,justifyContent:"center",alignItems:"center",backgroundColor:"#f8f9fa"},loadingText:{marginTop:10,fontSize:16,color:"#333"}});const ko=function(){var e=$(),t=e.isAuthenticated,r=e.isLoading,n=e.isInitialLoading,o=e.user;return(0,d.useEffect)((function(){E.info("Navigation state:",{isLoading:r,isInitialLoading:n,isAuthenticated:t,userExists:!!o,platform:k.default.OS,isDev:!1})}),[r,n,t,o]),n?(0,G.jsxs)(h.default,{style:Co.container,children:[(0,G.jsx)(te.default,{size:"large",color:"#7D4CDB"}),(0,G.jsx)(m.default,{style:Co.loadingText,children:"Loading..."})]}):(0,G.jsx)(jo.Navigator,{screenOptions:{headerShown:!1},children:t?(0,G.jsx)(jo.Screen,{name:"Main",component:wo}):(0,G.jsx)(jo.Screen,{name:"Auth",component:We})})};function To(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(To=function(){return!!e})()}var Eo=function(e){function t(){var e,r,n,o;(0,a.default)(this,t);for(var i=arguments.length,c=new Array(i),d=0;d<i;d++)c[d]=arguments[d];return r=this,n=t,o=[].concat(c),n=(0,l.default)(n),(e=(0,s.default)(r,To()?Reflect.construct(n,o||[],(0,l.default)(r).constructor):n.apply(r,o))).state={hasError:!1,error:null},e}return(0,c.default)(t,e),(0,i.default)(t,[{key:"componentDidCatch",value:function(e,t){E.error("App error boundary caught error:",{error:e,errorInfo:t})}},{key:"render",value:function(){var e;return this.state.hasError?(0,G.jsxs)(h.default,{style:Io.errorContainer,children:[(0,G.jsx)(m.default,{style:Io.errorTitle,children:"Something went wrong!"}),(0,G.jsx)(m.default,{style:Io.errorMessage,children:(null==(e=this.state.error)?void 0:e.toString())||"An unexpected error occurred."}),(0,G.jsx)(m.default,{style:Io.errorHint,children:"Please reload the application."})]}):this.props.children}}],[{key:"getDerivedStateFromError",value:function(e){return{hasError:!0,error:e}}}])}(d.Component);p.default.ignoreLogs(["AsyncStorage has been extracted from react-native","Possible Unhandled Promise Rejection","Require cycle:"]);var Oo=function(){var e=me().theme,t=(0,d.useState)(!1),r=(0,o.default)(t,2),a=r[0],i=r[1];(0,d.useEffect)((function(){var e=function(){var e=(0,n.default)((function*(){try{E.info("App initialization completed"),i(!0)}catch(e){E.error("Failed to initialize app:",e),i(!0)}}));return function(){return e.apply(this,arguments)}}();e()}),[]);var s="auto";if("dark-content"===e.colors.statusBar?s="dark":"light-content"===e.colors.statusBar&&(s="light"),!a){var l=v.default.create({loadingContainer:{flex:1,justifyContent:"center",alignItems:"center",backgroundColor:"#FFFFFF"}});return(0,G.jsx)(h.default,{style:l.loadingContainer,children:(0,G.jsx)(m.default,{children:"Initializing app..."})})}return(0,G.jsx)(f.SafeAreaProvider,{children:(0,G.jsx)(X,{children:(0,G.jsx)(he,{children:(0,G.jsx)(lr,{children:(0,G.jsx)(vt,{children:(0,G.jsxs)(g.default,{onStateChange:function(){0},fallback:(0,G.jsx)(h.default,{style:Io.loadingContainer,children:(0,G.jsx)(m.default,{children:"Loading navigation..."})}),children:[(0,G.jsx)(ko,{}),(0,G.jsx)(u.default,{style:s})," "]})})})})})})};function Fo(){return(0,G.jsx)(Eo,{children:(0,G.jsx)(y.GestureHandlerRootView,{style:{flex:1},children:(0,G.jsx)(he,{children:(0,G.jsx)(lr,{children:(0,G.jsx)(vt,{children:(0,G.jsx)(Oo,{})})})})})})}var Io=v.default.create({loadingContainer:{flex:1,justifyContent:"center",alignItems:"center"},errorContainer:{flex:1,justifyContent:"center",alignItems:"center",padding:20,backgroundColor:"#f8f9fa"},errorTitle:{fontSize:24,fontWeight:"bold",color:"#e74c3c",marginBottom:16},errorMessage:{fontSize:16,color:"#333",marginBottom:16,textAlign:"center"},errorHint:{fontSize:14,color:"#666"}})}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={id:n,loaded:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.loaded=!0,a.exports}r.m=e,(()=>{var e=[];r.O=(t,n,o,a)=>{if(!n){var i=1/0;for(d=0;d<e.length;d++){for(var[n,o,a]=e[d],s=!0,l=0;l<n.length;l++)(!1&a||i>=a)&&Object.keys(r.O).every((e=>r.O[e](n[l])))?n.splice(l--,1):(s=!1,a<i&&(i=a));if(s){e.splice(d--,1);var c=o();void 0!==c&&(t=c)}}return t}a=a||0;for(var d=e.length;d>0&&e[d-1][2]>a;d--)e[d]=e[d-1];e[d]=[n,o,a]}})(),r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;r.t=function(n,o){if(1&o&&(n=this(n)),8&o)return n;if("object"===typeof n&&n){if(4&o&&n.__esModule)return n;if(16&o&&"function"===typeof n.then)return n}var a=Object.create(null);r.r(a);var i={};e=e||[null,t({}),t([]),t(t)];for(var s=2&o&&n;"object"==typeof s&&!~e.indexOf(s);s=t(s))Object.getOwnPropertyNames(s).forEach((e=>i[e]=()=>n[e]));return i.default=()=>n,r.d(a,i),a}})(),r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),r.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),r.p="/",(()=>{var e={792:0};r.O.j=t=>0===e[t];var t=(t,n)=>{var o,a,[i,s,l]=n,c=0;if(i.some((t=>0!==e[t]))){for(o in s)r.o(s,o)&&(r.m[o]=s[o]);if(l)var d=l(r)}for(t&&t(n);c<i.length;c++)a=i[c],r.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return r.O(d)},n=self.webpackChunkweb=self.webpackChunkweb||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var n=r.O(void 0,[483],(()=>r(5036)));n=r.O(n)})();
//# sourceMappingURL=main.f81ac833.js.map