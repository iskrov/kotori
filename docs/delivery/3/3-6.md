# [3-6] Create Active Session Indicators

[Back to task list](./tasks.md)

## Description

Build comprehensive UI components to display active OPAQUE secret sessions and their timeout status. This task creates visual indicators, session management widgets, and real-time status updates that help users understand their current encryption session state and manage multiple active sessions effectively.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-01-20 17:35:00 | Created | N/A | Proposed | Task file created | AI Agent |
| 2025-01-20 17:40:00 | Status Update | Proposed | Agreed | Task approved for implementation | User |
| 2025-01-20 17:45:00 | Status Update | Agreed | InProgress | Started implementation | AI Agent |
| 2025-01-20 18:30:00 | Status Update | InProgress | Review | Core components implemented | AI Agent |

## Requirements

### Core Functionality

1. **Session Status Display Components**
   - Real-time active session indicators
   - Session timeout countdown displays
   - Multiple session management interface
   - Session health and security status

2. **Visual Session Indicators**
   - Compact session status badges
   - Full-screen session management overlay
   - Contextual session warnings and alerts
   - Session expiration notifications

3. **Interactive Session Controls**
   - Session extension buttons
   - Manual session termination
   - Session lock/unlock controls
   - Panic mode quick access

4. **Real-time Updates**
   - Live countdown timers
   - Session state change notifications
   - Background session monitoring
   - Automatic UI updates on session events

5. **Integration Points**
   - Header/navigation bar indicators
   - Journal entry form integration
   - Settings screen session management
   - Voice recording session awareness

## Implementation Plan

1. **Core Session Indicator Components**
   - Create SessionStatusBadge for compact display
   - Build SessionTimeoutIndicator with countdown
   - Implement SessionHealthIndicator for security status
   - Design SessionQuickActions for common operations

2. **Session Management Interface**
   - Create SessionManagerModal for full session control
   - Build ActiveSessionsList for multiple session display
   - Implement SessionDetailsCard for individual session info
   - Add SessionControlPanel for advanced operations

3. **Real-time Integration**
   - Connect with SessionManager event system
   - Implement useSessionIndicators hook
   - Add background session monitoring
   - Create session notification system

4. **UI Integration Points**
   - Add session indicators to main navigation
   - Integrate with JournalForm encryption status
   - Enhance RecordScreen with session awareness
   - Update Settings with session management

5. **Responsive Design**
   - Mobile-optimized session indicators
   - Tablet layout for session management
   - Desktop full-featured session interface
   - Accessibility compliance for all components

## Test Plan

**Objective**: Verify that session indicators provide accurate, real-time information about OPAQUE session status and enable effective session management across the application.

**Test Scope**: Session display accuracy, real-time updates, user interactions, performance, and accessibility.

**Environment & Setup**:
- React Native test environment with OPAQUE services
- Multiple active sessions for testing
- Session timeout scenarios
- Cross-platform UI testing

**Key Test Scenarios**:

1. **Session Status Display**
   - Active sessions show correct status and countdown
   - Expired sessions display appropriate warnings
   - Multiple sessions display correctly
   - Session health indicators reflect actual status

2. **Real-time Updates**
   - Countdown timers update every second accurately
   - Session state changes reflect immediately in UI
   - Background session monitoring works correctly
   - UI updates don't cause performance issues

3. **Interactive Controls**
   - Session extension works and updates display
   - Session termination removes indicators
   - Lock/unlock controls function properly
   - Panic mode accessible and functional

4. **Cross-platform Consistency**
   - Indicators display correctly on iOS, Android, Web
   - Touch interactions work on mobile devices
   - Keyboard navigation works on desktop
   - Screen readers can access session information

5. **Performance Testing**
   - Real-time updates don't impact app performance
   - Multiple session indicators scale properly
   - Memory usage remains stable with long sessions
   - Battery impact minimal on mobile devices

6. **Integration Testing**
   - Session indicators integrate with existing UI
   - Voice recording shows session status
   - Journal form reflects encryption capabilities
   - Navigation remains intuitive with indicators

**Success Criteria**:
- Session indicators display accurate real-time information
- Users can easily understand and manage session status
- Interactive controls work reliably across platforms
- Performance impact negligible (<5ms render time)
- Accessibility standards met (WCAG 2.1 AA)
- Integration seamless with existing UI components

## Verification

1. **Visual Indicator Testing**
   - [ ] Session status badges display correct information
   - [ ] Countdown timers show accurate remaining time
   - [ ] Session health indicators reflect security status
   - [ ] Multiple sessions display without overlap
   - [ ] Visual hierarchy clear and intuitive

2. **Real-time Functionality Testing**
   - [ ] Session timers update every second
   - [ ] Session state changes reflect immediately
   - [ ] Background monitoring works continuously
   - [ ] UI updates smooth and performant
   - [ ] Event system integration functional

3. **Interactive Control Testing**
   - [ ] Session extension buttons work correctly
   - [ ] Session termination clears indicators
   - [ ] Lock/unlock controls toggle properly
   - [ ] Panic mode accessible and responsive
   - [ ] Touch/click interactions responsive

4. **Integration Testing**
   - [ ] Navigation bar shows session status
   - [ ] Journal form integration seamless
   - [ ] Recording screen session-aware
   - [ ] Settings screen session management
   - [ ] Cross-component state consistency

5. **Cross-platform Testing**
   - [ ] iOS display and interactions correct
   - [ ] Android functionality complete
   - [ ] Web platform compatibility verified
   - [ ] Responsive design works on all screen sizes
   - [ ] Touch and keyboard navigation functional

6. **Performance and Accessibility Testing**
   - [ ] Real-time updates <5ms render impact
   - [ ] Memory usage stable over time
   - [ ] Battery impact minimal on mobile
   - [ ] Screen reader compatibility verified
   - [ ] Keyboard navigation complete
   - [ ] Color contrast meets WCAG standards

## Files Modified

- `frontend/src/components/session/SessionStatusBadge.tsx` (new component)
- `frontend/src/components/session/SessionTimeoutIndicator.tsx` (new component)
- `frontend/src/components/session/SessionManagerModal.tsx` (new component)
- `frontend/src/components/session/ActiveSessionsList.tsx` (new component)
- `frontend/src/components/session/SessionQuickActions.tsx` (new component)
- `frontend/src/hooks/useSessionIndicators.ts` (new hook)
- `frontend/src/types/sessionIndicatorTypes.ts` (new types)
- `frontend/src/components/navigation/HeaderBar.tsx` (enhanced)
- `frontend/src/screens/main/RecordScreen.tsx` (enhanced)
- `frontend/src/components/JournalForm.tsx` (enhanced)
- `frontend/src/components/__tests__/SessionStatusBadge.test.tsx` (new tests)
- `frontend/src/hooks/__tests__/useSessionIndicators.test.ts` (new tests) 