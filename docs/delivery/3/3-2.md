# [3-2] Update API serializers/validators

## Description
Remove `secret_tag` requirements from journal create/update payloads for normal entries and add support for per-user encryption fields (encrypted_content, encryption_iv, wrapped_key, wrap_iv, encryption_algorithm). Ensure plaintext `content` is optional when encrypted fields are present.

## Status History
| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-08-08 01:12:00 | Status Change | Agreed | InProgress | Started API schema/endpoint updates | ai-agent |
| 2025-08-08 01:25:00 | Status Change | InProgress | Review | Implemented schema/model/service changes | ai-agent |

## Requirements
- `backend/app/schemas/journal.py` allows `content` to be optional if `encrypted_content` is provided.
- `backend/app/models/journal_entry.py` allows `content` to be nullable and adds `encryption_algorithm` column.
- `backend/app/api/v1/endpoints/journal.py` validates encrypted vs plaintext payloads.
- `backend/app/services/journal_service.py` decodes base64 blobs, normalizes field aliases, and returns encrypted fields to client.

## Implementation Plan
- Edit Pydantic schemas to include `encryption_algorithm` and `is_encrypted` flag in responses.
- Edit SQLAlchemy model to add `encryption_algorithm` and make `content` nullable.
- Adjust create/update endpoints and service to handle per-user encrypted submissions.
- No DB migration generated in this task; captured under PBI-4 migration tasks.

## Verification
- Create plaintext entry works unchanged.
- Create per-user encrypted entry with encrypted fields succeeds; server stores blobs and returns `is_encrypted=true`.
- Update entry with encrypted fields works and returns encrypted metadata.

## Files Modified
- `backend/app/schemas/journal.py`
- `backend/app/models/journal_entry.py`
- `backend/app/api/v1/endpoints/journal.py`
- `backend/app/services/journal_service.py`

[Back to task list](../tasks.md)
