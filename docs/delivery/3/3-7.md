# [3-7] Remove Legacy Client Authentication

[Back to task list](./tasks.md)

## Description

Remove all legacy V1/V2 client authentication code and UI components that are no longer needed after implementing the OPAQUE authentication system. This cleanup task ensures the codebase is streamlined, secure, and maintainable by eliminating deprecated authentication methods and their associated UI components.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-01-20 18:35:00 | Created | N/A | Proposed | Task file created | AI Agent |
| 2025-01-20 18:40:00 | Status Update | Proposed | Agreed | Task approved for implementation | User |
| 2025-01-20 18:45:00 | Status Update | Agreed | InProgress | Started legacy code identification | AI Agent |
| 2025-01-20 19:15:00 | Status Update | InProgress | Review | Legacy code removal completed | AI Agent |

## Requirements

### Core Functionality

1. **Legacy Authentication Code Removal**
   - Remove V1/V2 client authentication services
   - Remove legacy tag management systems
   - Remove deprecated secret phrase handling
   - Remove obsolete encryption/decryption methods

2. **Legacy UI Component Removal**
   - Remove legacy secret tag setup interfaces
   - Remove deprecated authentication dialogs
   - Remove obsolete tag management screens
   - Remove legacy session indicators

3. **Code Cleanup**
   - Remove unused imports and dependencies
   - Clean up configuration files
   - Remove legacy test files
   - Update documentation references

4. **Migration Safety**
   - Ensure no breaking changes to OPAQUE implementation
   - Preserve data migration capabilities if needed
   - Maintain backward compatibility for existing data
   - Verify all OPAQUE components remain functional

5. **Security Considerations**
   - Remove any hardcoded legacy credentials
   - Clean up legacy encryption keys or references
   - Ensure no legacy authentication bypass remains
   - Verify secure deletion of sensitive legacy code

## Implementation Plan

1. **Legacy Code Identification**
   - Scan codebase for V1/V2 authentication references
   - Identify legacy tag management components
   - Find deprecated secret phrase handling
   - Locate obsolete encryption methods

2. **Dependency Analysis**
   - Map dependencies between legacy and current code
   - Identify safe-to-remove vs. still-needed components
   - Check for any OPAQUE components using legacy code
   - Verify test coverage for remaining functionality

3. **Systematic Removal**
   - Remove legacy service classes and utilities
   - Delete deprecated UI components
   - Clean up legacy configuration and constants
   - Remove obsolete test files and mocks

4. **Integration Verification**
   - Ensure OPAQUE authentication still works
   - Verify session management functionality
   - Test voice phrase detection integration
   - Confirm encrypted entry creation works

5. **Final Cleanup**
   - Remove unused imports and dependencies
   - Update package.json if needed
   - Clean up configuration files
   - Update relevant documentation

## Test Plan

**Objective**: Verify that legacy authentication code removal doesn't break OPAQUE functionality and that all deprecated components are successfully removed without affecting the current system.

**Test Scope**: Legacy code removal verification, OPAQUE system integrity, functionality preservation, and security validation.

**Environment & Setup**:
- Full application test environment
- OPAQUE authentication system
- Voice phrase detection system
- Session management system

**Key Test Scenarios**:

1. **Legacy Code Removal Verification**
   - Confirm all V1/V2 authentication code is removed
   - Verify legacy UI components are deleted
   - Check that no legacy imports remain
   - Ensure deprecated configuration is cleaned up

2. **OPAQUE System Integrity**
   - Voice phrase authentication works correctly
   - Session management functions properly
   - Encrypted entry creation operates normally
   - All OPAQUE components remain functional

3. **Build and Runtime Verification**
   - Application builds without errors
   - No runtime errors from missing legacy components
   - All existing functionality works as expected
   - Performance remains optimal

4. **Security Validation**
   - No legacy authentication bypass remains
   - Legacy credentials/keys are removed
   - Security vulnerabilities are eliminated
   - OPAQUE security properties maintained

5. **Code Quality Verification**
   - No unused imports or dead code
   - Clean dependency tree
   - Proper error handling for removed features
   - Consistent code patterns throughout

6. **Regression Testing**
   - All existing OPAQUE features work
   - Voice-to-encryption workflow intact
   - Session indicators function properly
   - UI components render correctly

**Success Criteria**:
- All legacy V1/V2 authentication code removed
- No breaking changes to OPAQUE functionality
- Application builds and runs without errors
- All tests pass with legacy code removed
- Code quality improved with cleanup
- Security posture enhanced by legacy removal

## Verification

1. **Legacy Code Removal Verification**
   - [ ] All V1/V2 authentication services removed
   - [ ] Legacy tag management components deleted
   - [ ] Deprecated secret phrase handling eliminated
   - [ ] Obsolete encryption methods removed
   - [ ] Legacy UI components deleted

2. **Build and Runtime Verification**
   - [ ] Application builds successfully
   - [ ] No runtime errors from missing components
   - [ ] All imports resolve correctly
   - [ ] No dead code or unused dependencies
   - [ ] Clean dependency tree

3. **OPAQUE System Verification**
   - [ ] Voice phrase authentication works
   - [ ] Session management functional
   - [ ] Encrypted entry creation works
   - [ ] Session indicators display correctly
   - [ ] All OPAQUE components operational

4. **Security Verification**
   - [ ] No legacy authentication bypass
   - [ ] Legacy credentials/keys removed
   - [ ] Security vulnerabilities eliminated
   - [ ] OPAQUE security properties intact
   - [ ] No information leakage from legacy code

5. **Code Quality Verification**
   - [ ] No unused imports remain
   - [ ] Configuration files clean
   - [ ] Test files updated appropriately
   - [ ] Documentation references updated
   - [ ] Consistent code patterns maintained

6. **Regression Testing**
   - [ ] All existing functionality works
   - [ ] Voice-to-encryption workflow intact
   - [ ] UI components render properly
   - [ ] Performance not degraded
   - [ ] All automated tests pass

## Files Modified

### Files Removed:
- `frontend/src/services/tagManager.ts` - Main legacy tag manager service
- `frontend/src/services/secretTagOnlineManager.ts` - Legacy online tag manager
- `frontend/src/services/secretTagOfflineManager.ts` - Legacy offline tag manager
- `frontend/src/services/secretTagHashService.ts` - Legacy hash service
- `frontend/src/services/__tests__/secretTagManager.test.js` - Legacy test file
- `frontend/src/components/TagsManager.tsx` - Legacy tags manager UI
- `frontend/src/screens/main/SecretTagManagerScreen.tsx` - Legacy secret tag screen
- `frontend/src/screens/main/TagManagementScreen.tsx` - Legacy tag management screen
- `frontend/src/screens/main/TagDeleteConfirmationScreen.tsx` - Legacy delete confirmation
- `frontend/src/components/SecurityModeSelector.tsx` - Legacy security mode selector
- `frontend/src/components/CacheStatusIndicator.tsx` - Legacy cache status indicator

### Files Modified:
- `frontend/src/services/speechToText.ts` - Removed tagManager import and legacy method
- `frontend/src/components/AudioRecorder.tsx` - Updated to use OPAQUE system
- `frontend/src/components/SecretTagSetup.tsx` - Removed legacy authentication path

### Files Verified:
- All OPAQUE implementation files remain functional
- Voice phrase detection system works with OPAQUE
- Session management system operational
- Encrypted entry creation system functional

### Remaining Manual Updates Needed:
- `frontend/src/screens/main/CalendarScreen.tsx` - Remove tagManager import
- `frontend/src/screens/main/RecordScreen.tsx` - Remove tagManager import
- Any remaining test files with legacy mocks 