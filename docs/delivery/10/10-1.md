# [10-1] Create share template models and API

## Description

Define the database schema for sharing templates and implement REST API endpoints for template management. Templates define the questions that will be used to generate structured summaries from journal entries.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-01-27 14:45:00 | Created | N/A | Proposed | Task created | ai-agent |

## Requirements

### Functional Requirements
- Database model for share templates with versioning support
- REST API endpoints for CRUD operations on templates
- Predefined templates for common use cases (wellness, medical, mood)
- Template structure supports multiple languages for questions

### Technical Requirements
- PostgreSQL table for templates storage
- Pydantic schemas for validation
- FastAPI endpoints with proper authentication
- Template format: JSON with question arrays

### Template Structure
```json
{
  "id": "wellness-check-v1",
  "name": "Weekly Wellness Check",
  "description": "General wellness and mood assessment",
  "version": "1.0",
  "category": "wellness",
  "questions": [
    {
      "id": "mood",
      "text": {
        "en": "How has your mood been this week?",
        "es": "¿Cómo ha estado tu estado de ánimo esta semana?",
        "fr": "Comment a été votre humeur cette semaine?"
      },
      "type": "open",
      "required": true
    },
    {
      "id": "sleep",
      "text": {
        "en": "How would you describe your sleep quality?",
        "es": "¿Cómo describirías tu calidad de sueño?",
        "fr": "Comment décririez-vous votre qualité de sommeil?"
      },
      "type": "open",
      "required": true
    }
  ]
}
```

## Implementation Plan

### 1. Database Schema (30 mins)
```sql
CREATE TABLE share_templates (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    template_id VARCHAR(100) UNIQUE NOT NULL,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    category VARCHAR(50),
    version VARCHAR(20) NOT NULL,
    questions JSONB NOT NULL,
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_share_templates_category ON share_templates(category);
CREATE INDEX idx_share_templates_active ON share_templates(is_active);
```

### 2. Backend Models (30 mins)
- `backend/app/models/share_template.py`
- SQLAlchemy model with JSONB field for questions
- Relationship to future share records

### 3. Pydantic Schemas (30 mins)
- `backend/app/schemas/share_template.py`
- Request/response schemas for template CRUD
- Validation for question structure

### 4. API Endpoints (1 hour)
- `backend/app/api/v1/endpoints/share_templates.py`
- GET /api/v1/share-templates (list active templates)
- GET /api/v1/share-templates/{id} (get specific template)
- POST /api/v1/share-templates (create - admin only)
- PUT /api/v1/share-templates/{id} (update - admin only)
- DELETE /api/v1/share-templates/{id} (soft delete - admin only)

### 5. Seed Data (30 mins)
- Migration to insert 3 default templates
- Wellness check, medical visit prep, mood tracker
- Multi-language support for questions

## Verification

### Unit Tests
- Model creation and validation
- Schema serialization/deserialization
- CRUD operations

### Integration Tests
- API endpoint responses
- Authentication/authorization
- Template versioning

### Manual Testing
- Create template via API
- Retrieve template list
- Update template questions
- Verify JSON structure

## Files Modified

### New Files
- `backend/app/models/share_template.py`
- `backend/app/schemas/share_template.py`
- `backend/app/api/v1/endpoints/share_templates.py`
- `backend/migrations/versions/xxx_add_share_templates.py`
- `backend/tests/api/test_share_templates.py`

### Modified Files
- `backend/app/models/__init__.py` (export new model)
- `backend/app/api/v1/__init__.py` (include new router)

## Estimated Time

- Total: 3 hours
- Database and models: 1 hour
- API implementation: 1.5 hours
- Testing: 30 minutes

## Dependencies

- None (this is the foundational task)

## Notes

- Templates are read-mostly data, consider caching
- Version field allows for template evolution without breaking existing shares
- Questions use JSON to allow flexibility in structure
- Multi-language support built in from the start

[Back to task list](./tasks.md)
