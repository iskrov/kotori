# [5-3] Provision Cloud SQL Postgres 17

[Back to task list](./tasks.md)

## Description
Create and configure a Cloud SQL PostgreSQL 17 instance with proper security, backup, and high availability settings for production use.

## Status History
| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-01-27 | Created | N/A | Proposed | Task created for Cloud SQL provisioning | AI Agent |
| 2025-01-27 | Status Update | Proposed | InProgress | Started Cloud SQL instance creation | AI Agent |
| 2025-01-27 | Status Update | InProgress | Done | Cloud SQL instance provisioned with security settings | AI Agent |

## Requirements
- Create Cloud SQL instance: `kotori-db`
- Database version: PostgreSQL 17
- Tier: `db-f1-micro` (production-ready)
- Region: `northamerica-northeast2` (Toronto)
- Storage: 20GB SSD with auto-increase enabled
- Backup configuration:
  - Daily backups at 3:00 AM UTC
  - 7-day backup retention
  - Binary logging enabled
- Maintenance window: Sundays at 4:00 AM
- Security: Private IP with authorized networks
- High availability: Enabled with deletion protection

## Implementation Plan
1. Create Cloud SQL instance with PostgreSQL 17
2. Configure storage, backup, and maintenance settings
3. Create production database: `kotori_prod`
4. Create database user: `kotori_user` with secure password
5. Configure network security with private IP
6. Set up authorized networks for Cloud Run access

## Verification
- ✅ Cloud SQL instance `kotori-db` created successfully
- ✅ PostgreSQL 17 version confirmed
- ✅ Database `kotori_prod` and user `kotori_user` created
- ✅ Daily backups configured with 7-day retention
- ✅ Private IP configured for security
- ✅ Network access properly configured for Cloud Run

## Files Modified
- `deploy/gcp-setup.sh` - Added Cloud SQL provisioning logic
- `deploy/GENERATED_SECRETS.md` - Documented database credentials
- `deploy/README.md` - Added database configuration details
